<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Validate Tree Detection and Crown Delineation | Aerial LiDAR for Fire Model Inputs</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Validate Tree Detection and Crown Delineation | Aerial LiDAR for Fire Model Inputs" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Validate Tree Detection and Crown Delineation | Aerial LiDAR for Fire Model Inputs" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="point-cloud-processing.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html"><i class="fa fa-check"></i><b>2</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#lidar-data-location"><i class="fa fa-check"></i><b>2.1</b> Lidar Data Location</a></li>
<li class="chapter" data-level="2.2" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#individial-tree-detection-tuning-itd_tuning"><i class="fa fa-check"></i><b>2.2</b> Individial Tree Detection Tuning: <code id="itd">itd_tuning()</code></a></li>
<li class="chapter" data-level="2.3" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#point-cloud-tree-extraction-cloud2trees"><i class="fa fa-check"></i><b>2.3</b> Point Cloud Tree Extraction: <code>cloud2trees()</code></a></li>
<li class="chapter" data-level="2.4" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#dbh-modeling-trees_dbh"><i class="fa fa-check"></i><b>2.4</b> DBH Modeling: <code>trees_dbh()</code></a></li>
<li class="chapter" data-level="2.5" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#cbh-modeling-trees_cbh"><i class="fa fa-check"></i><b>2.5</b> CBH Modeling: <code>trees_cbh()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html"><i class="fa fa-check"></i><b>3</b> Validate Tree Detection and Crown Delineation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#neontreeevaluation-overview"><i class="fa fa-check"></i><b>3.1</b> <code>NeonTreeEvaluation</code> overview</a></li>
<li class="chapter" data-level="3.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#lidar-data-in-neontreeevaluation"><i class="fa fa-check"></i><b>3.2</b> lidar data in <code>NeonTreeEvaluation</code></a></li>
<li class="chapter" data-level="3.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#example-validation-process"><i class="fa fa-check"></i><b>3.3</b> Example validation process</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#preliminaries"><i class="fa fa-check"></i><b>3.3.1</b> Preliminaries</a></li>
<li class="chapter" data-level="3.3.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#filter-for-canopy-trees"><i class="fa fa-check"></i><b>3.3.2</b> Filter for “canopy” trees</a></li>
<li class="chapter" data-level="3.3.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#cloud2treescloud2trees"><i class="fa fa-check"></i><b>3.3.3</b> <code>cloud2trees::cloud2trees()</code></a></li>
<li class="chapter" data-level="3.3.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#format-extracted-tree-polygons"><i class="fa fa-check"></i><b>3.3.4</b> Format extracted tree polygons</a></li>
<li class="chapter" data-level="3.3.5" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#test-evaluation"><i class="fa fa-check"></i><b>3.3.5</b> Test evaluation</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#full-validation-process"><i class="fa fa-check"></i><b>3.4</b> Full validation process</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#function-to-extract-trees"><i class="fa fa-check"></i><b>3.4.1</b> Function to extract trees</a></li>
<li class="chapter" data-level="3.4.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#build-evaluation-data"><i class="fa fa-check"></i><b>3.4.2</b> Build evaluation data</a></li>
<li class="chapter" data-level="3.4.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#full-evaluation"><i class="fa fa-check"></i><b>3.4.3</b> Full evaluation</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial LiDAR for Fire Model Inputs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="validate-tree-detection-and-crown-delineation" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Validate Tree Detection and Crown Delineation<a href="validate-tree-detection-and-crown-delineation.html#validate-tree-detection-and-crown-delineation" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section we’ll use the benchmark data made available in the <a href="https://github.com/weecology/NeonTreeEvaluation_package"><code>NeonTreeEvaluation</code></a> data set (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">Weinstein et al. 2021</a>) to evaluate our process for lidar-based tree detection. We’ll implement our tree detection process via the [<code>cloud2trees</code>]<a href="https://github.com/georgewoolsey/cloud2trees" class="uri">https://github.com/georgewoolsey/cloud2trees</a>) package</p>
<p>First, load the standard libraries</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="validate-tree-detection-and-crown-delineation.html#cb31-1" tabindex="-1"></a><span class="co"># bread-and-butter</span></span>
<span id="cb31-2"><a href="validate-tree-detection-and-crown-delineation.html#cb31-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># the tidyverse</span></span>
<span id="cb31-3"><a href="validate-tree-detection-and-crown-delineation.html#cb31-3" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># viridis colors</span></span>
<span id="cb31-4"><a href="validate-tree-detection-and-crown-delineation.html#cb31-4" tabindex="-1"></a><span class="fu">library</span>(harrypotter) <span class="co"># hp colors</span></span>
<span id="cb31-5"><a href="validate-tree-detection-and-crown-delineation.html#cb31-5" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># brewer colors</span></span>
<span id="cb31-6"><a href="validate-tree-detection-and-crown-delineation.html#cb31-6" tabindex="-1"></a><span class="fu">library</span>(scales) <span class="co"># work with number and plot scales</span></span>
<span id="cb31-7"><a href="validate-tree-detection-and-crown-delineation.html#cb31-7" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb31-8"><a href="validate-tree-detection-and-crown-delineation.html#cb31-8" tabindex="-1"></a></span>
<span id="cb31-9"><a href="validate-tree-detection-and-crown-delineation.html#cb31-9" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb31-10"><a href="validate-tree-detection-and-crown-delineation.html#cb31-10" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># interactive html maps</span></span>
<span id="cb31-11"><a href="validate-tree-detection-and-crown-delineation.html#cb31-11" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># tables</span></span>
<span id="cb31-12"><a href="validate-tree-detection-and-crown-delineation.html#cb31-12" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine plots</span></span>
<span id="cb31-13"><a href="validate-tree-detection-and-crown-delineation.html#cb31-13" tabindex="-1"></a><span class="fu">library</span>(ggnewscale) <span class="co"># ggnewscale</span></span>
<span id="cb31-14"><a href="validate-tree-detection-and-crown-delineation.html#cb31-14" tabindex="-1"></a><span class="fu">library</span>(rgl) <span class="co"># rgl plotting</span></span>
<span id="cb31-15"><a href="validate-tree-detection-and-crown-delineation.html#cb31-15" tabindex="-1"></a></span>
<span id="cb31-16"><a href="validate-tree-detection-and-crown-delineation.html#cb31-16" tabindex="-1"></a><span class="co"># spatial analysis</span></span>
<span id="cb31-17"><a href="validate-tree-detection-and-crown-delineation.html#cb31-17" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features</span></span>
<span id="cb31-18"><a href="validate-tree-detection-and-crown-delineation.html#cb31-18" tabindex="-1"></a><span class="fu">library</span>(lidR) <span class="co"># lidar data</span></span>
<span id="cb31-19"><a href="validate-tree-detection-and-crown-delineation.html#cb31-19" tabindex="-1"></a><span class="fu">library</span>(cloud2trees) <span class="co"># tha cloud2trees</span></span>
<span id="cb31-20"><a href="validate-tree-detection-and-crown-delineation.html#cb31-20" tabindex="-1"></a><span class="fu">library</span>(NeonTreeEvaluation) <span class="co"># benchmark data</span></span></code></pre></div>
<div id="neontreeevaluation-overview" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> <code>NeonTreeEvaluation</code> overview<a href="validate-tree-detection-and-crown-delineation.html#neontreeevaluation-overview" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Weinstein et al. (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">2021</a>) developed:</p>
<blockquote>
<p>a benchmark dataset of individual canopy crowns derived from multi-sensor imagery in the National Ecological Observatory Network (Table 1) that provides: 1) co-registered remote sensing data from multiple sensors (LiDAR, RGB imagery, and hyperspectral imagery) to allow comparisons of methods based on any single sensor (e.g., for LiDAR based methods), or any combination of sensors (e.g., combining RGB and hyperspectral), and 2) three types of evaluation data to allow assessing both ‘tree detection’, defined as the identifying the location of individual trees using evaluation data with a point at the crown center , and ‘crown delineation’ defined as identifying the boundary edge of crowns across a broad range of forest types. The benchmark is designed to allow flexibility in both workflow and sensor selection. (p. 2)</p>
</blockquote>
<p><strong>Table 1.</strong> Summary of datasets included in the benchmark dataset. All sensor data has been cropped to the extent of NEON field sampling plots.</p>
<p><img src="../data/journal.pcbi.1009180.t001.PNG" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<p>Note the three data labeled as “Evaluation data” in the table. If you are asking “why three evaluation datasets?”, the authors provide some detail:</p>
<blockquote>
<p>The inclusion of multiple evaluation types is critical because each type of evaluation data has strengths and limitations in evaluating model performance. Field collected stems are the most common evaluation data used in crown detection work due to high confidence that each stem represents a location of a single tree. However, the position of a tree stem can fail to accurately represent the position of the crown as viewed from above due to a combination of spatial errors in alignment with the image data and the tendency for trees to grow at acute angles (tree lean is not measured in the NEON data), such that the center of the crown and position of the stem can be offset by several meters….Image-annotated crowns are relatively easy to scale, allowing the collection of data for a wide range of forest types and for annotation of every visible crown in the image. Using image-annotated crowns supports the evaluation of methods across a broad range of forest types and allows both recall and precision to be calculated. However, since these annotations are not generated by an observer in the field there can be errors due to interpreting the images. This problem is solved using field-annotated crowns in which an observer annotates the remote-sensing imagery on a tablet while in the field [33]. The main limitation to this approach is that it is labor intensive, meaning that only a relatively small amount of validation data can be collected, making it difficult to obtain a large number of crowns across broad scales or assess model precision. Given the tradeoffs in each evaluation type, providing multiple criteria is a useful way of balancing the need for broad scale model verification with rigorous evaluation of field-based measurements. (p. 14-15)</p>
</blockquote>
<p>To evaluate the performance of our aerial point cloud-based algorithm for 1) tree detection and 2) crown delineation using <code>NeonTreeEvaluation</code> we need to ensure our tree polygon data is formatted properly:</p>
<blockquote>
<p>This package takes a standard submission format of predicted crowns in either bounding box or polygons as input and returns the evaluation scores of the detections for each of the three evaluation datasets. This reproducible workflow will facilitate creating a transparent process for future comparisons among crown detection algorithms. (p. 14)</p>
</blockquote>
<p>The authors describe the “standard submission format” on the <a href="https://github.com/weecology/NeonTreeEvaluation_package">package GitHub</a>:</p>
<blockquote>
<p>Each row contains information for one predicted bounding box. The plot_name should be named the same as the files in the dataset without extension (e.g. SJER_021_2018 not SJER_021_2018.tif) and not the full path to the file on disk. Not all evaluation data are available for all plots. Functions like <code>evaluate_field_crowns</code> and <code>evaluate_image_crowns</code> will look for matching plot name and ignore other plots. Depending on the speed of the algorithm, the simplest thing to do is predict all images in the RGB folder (see list_rgb()) and the package will handle matching images with the correct data to the correct evaluation procedure…Instead of bounding boxes, some methods may return polygons. To submit as polygons, create a single unprojected shapefile with polygons in image coordinates. Polygons must be complete with no holes. Here is an example of the above csv file in polygon format. Here the xmin, xmax, etc. columns are ignored since the information is stored in the geometry data.</p>
</blockquote>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="validate-tree-detection-and-crown-delineation.html#cb32-1" tabindex="-1"></a>Simple feature collection with <span class="dv">6</span> features and <span class="dv">7</span> fields</span>
<span id="cb32-2"><a href="validate-tree-detection-and-crown-delineation.html#cb32-2" tabindex="-1"></a>geometry type<span class="sc">:</span>  POLYGON</span>
<span id="cb32-3"><a href="validate-tree-detection-and-crown-delineation.html#cb32-3" tabindex="-1"></a>dimension<span class="sc">:</span>      XY</span>
<span id="cb32-4"><a href="validate-tree-detection-and-crown-delineation.html#cb32-4" tabindex="-1"></a>bbox<span class="sc">:</span>           xmin<span class="sc">:</span> <span class="fl">30.39723</span> ymin<span class="sc">:</span> <span class="fl">122.1164</span> xmax<span class="sc">:</span> <span class="fl">397.5746</span> ymax<span class="sc">:</span> <span class="dv">400</span></span>
<span id="cb32-5"><a href="validate-tree-detection-and-crown-delineation.html#cb32-5" tabindex="-1"></a>CRS<span class="sc">:</span>            <span class="cn">NA</span></span>
<span id="cb32-6"><a href="validate-tree-detection-and-crown-delineation.html#cb32-6" tabindex="-1"></a>       xmin     ymin      xmax     ymax     score label     plot_name</span>
<span id="cb32-7"><a href="validate-tree-detection-and-crown-delineation.html#cb32-7" tabindex="-1"></a><span class="dv">1</span>  <span class="fl">41.01716</span> <span class="fl">230.8854</span> <span class="fl">151.08607</span> <span class="fl">342.6985</span> <span class="fl">0.8098674</span>  Tree DSNY_014_2019</span>
<span id="cb32-8"><a href="validate-tree-detection-and-crown-delineation.html#cb32-8" tabindex="-1"></a><span class="dv">2</span> <span class="fl">357.32129</span> <span class="fl">122.1164</span> <span class="fl">397.57458</span> <span class="fl">159.3758</span> <span class="fl">0.6968824</span>  Tree DSNY_014_2019</span>
<span id="cb32-9"><a href="validate-tree-detection-and-crown-delineation.html#cb32-9" tabindex="-1"></a><span class="dv">3</span>  <span class="fl">30.39723</span> <span class="fl">136.9157</span>  <span class="fl">73.79434</span> <span class="fl">184.9473</span> <span class="fl">0.5713338</span>  Tree DSNY_014_2019</span>
<span id="cb32-10"><a href="validate-tree-detection-and-crown-delineation.html#cb32-10" tabindex="-1"></a><span class="dv">4</span> <span class="fl">260.65921</span> <span class="fl">285.6689</span> <span class="fl">299.68811</span> <span class="fl">326.7933</span> <span class="fl">0.5511004</span>  Tree DSNY_014_2019</span>
<span id="cb32-11"><a href="validate-tree-detection-and-crown-delineation.html#cb32-11" tabindex="-1"></a><span class="dv">5</span> <span class="fl">179.34564</span> <span class="fl">371.6130</span> <span class="fl">232.49385</span> <span class="fl">400.0000</span> <span class="fl">0.4697072</span>  Tree DSNY_014_2019</span>
<span id="cb32-12"><a href="validate-tree-detection-and-crown-delineation.html#cb32-12" tabindex="-1"></a><span class="dv">6</span> <span class="fl">316.27377</span> <span class="fl">378.9802</span> <span class="fl">363.67542</span> <span class="fl">400.0000</span> <span class="fl">0.3259409</span>  Tree DSNY_014_2019</span>
<span id="cb32-13"><a href="validate-tree-detection-and-crown-delineation.html#cb32-13" tabindex="-1"></a>                     st_sfc.lst.</span>
<span id="cb32-14"><a href="validate-tree-detection-and-crown-delineation.html#cb32-14" tabindex="-1"></a><span class="dv">1</span> <span class="fu">POLYGON</span> ((<span class="fl">41.01716</span> <span class="dv">230</span>.<span class="dv">8854</span>...</span>
<span id="cb32-15"><a href="validate-tree-detection-and-crown-delineation.html#cb32-15" tabindex="-1"></a><span class="dv">2</span> <span class="fu">POLYGON</span> ((<span class="fl">357.3213</span> <span class="dv">122</span>.<span class="dv">1164</span>...</span>
<span id="cb32-16"><a href="validate-tree-detection-and-crown-delineation.html#cb32-16" tabindex="-1"></a><span class="dv">3</span> <span class="fu">POLYGON</span> ((<span class="fl">30.39723</span> <span class="dv">136</span>.<span class="dv">9157</span>...</span>
<span id="cb32-17"><a href="validate-tree-detection-and-crown-delineation.html#cb32-17" tabindex="-1"></a><span class="dv">4</span> <span class="fu">POLYGON</span> ((<span class="fl">260.6592</span> <span class="dv">285</span>.<span class="dv">6689</span>...</span>
<span id="cb32-18"><a href="validate-tree-detection-and-crown-delineation.html#cb32-18" tabindex="-1"></a><span class="dv">5</span> <span class="fu">POLYGON</span> ((<span class="fl">179.3456</span> <span class="fl">371.613</span>,...</span>
<span id="cb32-19"><a href="validate-tree-detection-and-crown-delineation.html#cb32-19" tabindex="-1"></a><span class="dv">6</span> <span class="fu">POLYGON</span> ((<span class="fl">316.2738</span> <span class="dv">378</span>.<span class="dv">9802</span>...</span></code></pre></div>
<p>So we are going to: run <code>cloud2trees::cloud2trees()</code> on all lidar data, combine into a single tree list with a row unique by a detected tree and the <code>plot_name</code> column (e.g. “SJER_021_2018”), as an unprojected <code>sf</code> data with polygons in image coordinates. We may need to run <code>cloud2trees::simplify_multipolygon_crowns()</code> prior to submission.</p>
</div>
<div id="lidar-data-in-neontreeevaluation" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> lidar data in <code>NeonTreeEvaluation</code><a href="validate-tree-detection-and-crown-delineation.html#lidar-data-in-neontreeevaluation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>we first have to download evaluation data from the Zenodo archive (1GB), use the download() function to place the data in the correct package location. Download the much larger training data, set <code>training=TRUE</code>.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="validate-tree-detection-and-crown-delineation.html#cb33-1" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span><span class="fu">download</span>(<span class="at">training =</span> T, <span class="at">force =</span> F)</span></code></pre></div>
<p>let’s find what data is available</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="validate-tree-detection-and-crown-delineation.html#cb34-1" tabindex="-1"></a><span class="co"># i did some digging around and the lidar data is here</span></span>
<span id="cb34-2"><a href="validate-tree-detection-and-crown-delineation.html#cb34-2" tabindex="-1"></a>lidar_dir_temp <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;NeonTreeEvaluation&quot;</span>, <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;NeonTreeEvaluation&quot;</span>, <span class="st">&quot;evaluation&quot;</span>, <span class="st">&quot;LiDAR&quot;</span>)</span>
<span id="cb34-3"><a href="validate-tree-detection-and-crown-delineation.html#cb34-3" tabindex="-1"></a><span class="co"># files</span></span>
<span id="cb34-4"><a href="validate-tree-detection-and-crown-delineation.html#cb34-4" tabindex="-1"></a>lidar_files_temp <span class="ot">&lt;-</span> lidar_dir_temp <span class="sc">%&gt;%</span> <span class="fu">list.files</span>(<span class="at">recursive =</span> T, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb34-5"><a href="validate-tree-detection-and-crown-delineation.html#cb34-5" tabindex="-1"></a><span class="co"># look at this</span></span>
<span id="cb34-6"><a href="validate-tree-detection-and-crown-delineation.html#cb34-6" tabindex="-1"></a>lidar_files_temp <span class="sc">%&gt;%</span> <span class="fu">basename</span>() <span class="sc">%&gt;%</span> <span class="fu">sample</span>(<span class="at">size =</span> <span class="dv">9</span>)</span></code></pre></div>
<pre><code>## [1] &quot;TEAK_051_2019.laz&quot;                       
## [2] &quot;BART_039_2019.laz&quot;                       
## [3] &quot;WREF_073_2019.laz&quot;                       
## [4] &quot;2018_SJER_3_253000_4109000_image_573.laz&quot;
## [5] &quot;TALL_021_2019.laz&quot;                       
## [6] &quot;CLBJ_050_2019.laz&quot;                       
## [7] &quot;SOAP_010_2018.laz&quot;                       
## [8] &quot;OSBS_120.las&quot;                            
## [9] &quot;DEJU_023_2019.laz&quot;</code></pre>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="validate-tree-detection-and-crown-delineation.html#cb36-1" tabindex="-1"></a><span class="co"># let&#39;s pull out all sites with `.laz` data and create a data frame for tracking purposes</span></span>
<span id="cb36-2"><a href="validate-tree-detection-and-crown-delineation.html#cb36-2" tabindex="-1"></a>lidar_df <span class="ot">&lt;-</span> lidar_files_temp <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="validate-tree-detection-and-crown-delineation.html#cb36-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb36-4"><a href="validate-tree-detection-and-crown-delineation.html#cb36-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f_path =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb36-5"><a href="validate-tree-detection-and-crown-delineation.html#cb36-5" tabindex="-1"></a>    <span class="co"># create some other variables</span></span>
<span id="cb36-6"><a href="validate-tree-detection-and-crown-delineation.html#cb36-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb36-7"><a href="validate-tree-detection-and-crown-delineation.html#cb36-7" tabindex="-1"></a>      <span class="at">plot_name =</span> f_path <span class="sc">%&gt;%</span> <span class="fu">basename</span>() <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>)</span>
<span id="cb36-8"><a href="validate-tree-detection-and-crown-delineation.html#cb36-8" tabindex="-1"></a>    )</span>
<span id="cb36-9"><a href="validate-tree-detection-and-crown-delineation.html#cb36-9" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb36-10"><a href="validate-tree-detection-and-crown-delineation.html#cb36-10" tabindex="-1"></a>lidar_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 2,186
## Columns: 2
## $ f_path    &lt;chr&gt; &quot;C:/Program Files/R/R-4.3.0/library/NeonTreeEvaluation/extda…
## $ plot_name &lt;chr&gt; &quot;2018_SJER_3_252000_4104000_image_628&quot;, &quot;2018_SJER_3_252000_…</code></pre>
<p>that’s a lot of files…let’s only process the sites with evaluation data</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="validate-tree-detection-and-crown-delineation.html#cb38-1" tabindex="-1"></a><span class="co"># there are functions to get a list of all evaluation data</span></span>
<span id="cb38-2"><a href="validate-tree-detection-and-crown-delineation.html#cb38-2" tabindex="-1"></a><span class="co"># let&#39;s use these to filter our lidar files</span></span>
<span id="cb38-3"><a href="validate-tree-detection-and-crown-delineation.html#cb38-3" tabindex="-1"></a>plotnames_temp <span class="ot">&lt;-</span> <span class="fu">c</span>(</span>
<span id="cb38-4"><a href="validate-tree-detection-and-crown-delineation.html#cb38-4" tabindex="-1"></a>    NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_annotations</span>()</span>
<span id="cb38-5"><a href="validate-tree-detection-and-crown-delineation.html#cb38-5" tabindex="-1"></a>    , NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_field_stems</span>()</span>
<span id="cb38-6"><a href="validate-tree-detection-and-crown-delineation.html#cb38-6" tabindex="-1"></a>    <span class="co"># this one includes file paths, so we have to clean</span></span>
<span id="cb38-7"><a href="validate-tree-detection-and-crown-delineation.html#cb38-7" tabindex="-1"></a>    , NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_field_crowns</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb38-8"><a href="validate-tree-detection-and-crown-delineation.html#cb38-8" tabindex="-1"></a>      stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="at">pattern=</span><span class="st">&quot;(</span><span class="sc">\\</span><span class="st">w+).tif&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb38-9"><a href="validate-tree-detection-and-crown-delineation.html#cb38-9" tabindex="-1"></a>      .[,<span class="dv">2</span>]</span>
<span id="cb38-10"><a href="validate-tree-detection-and-crown-delineation.html#cb38-10" tabindex="-1"></a>    <span class="co"># there are plot_names from the submission data too</span></span>
<span id="cb38-11"><a href="validate-tree-detection-and-crown-delineation.html#cb38-11" tabindex="-1"></a>    , NeonTreeEvaluation<span class="sc">::</span>submission_polygons<span class="sc">$</span>plot_name <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb38-12"><a href="validate-tree-detection-and-crown-delineation.html#cb38-12" tabindex="-1"></a>    , NeonTreeEvaluation<span class="sc">::</span>submission<span class="sc">$</span>plot_name <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb38-13"><a href="validate-tree-detection-and-crown-delineation.html#cb38-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb38-14"><a href="validate-tree-detection-and-crown-delineation.html#cb38-14" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb38-15"><a href="validate-tree-detection-and-crown-delineation.html#cb38-15" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb38-16"><a href="validate-tree-detection-and-crown-delineation.html#cb38-16" tabindex="-1"></a>plotnames_temp <span class="sc">%&gt;%</span> <span class="fu">sample</span>(<span class="dv">11</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;2018_TEAK_3_319000_4102000_image_281&quot;
##  [2] &quot;UNDE_055_2017&quot;                       
##  [3] &quot;HARV_001_2019&quot;                       
##  [4] &quot;RMNP_049&quot;                            
##  [5] &quot;UNDE_030_2020&quot;                       
##  [6] &quot;RMNP_009&quot;                            
##  [7] &quot;MLBS_20_competition&quot;                 
##  [8] &quot;NIWO_018_2018&quot;                       
##  [9] &quot;unnamed_plot_52_competition&quot;         
## [10] &quot;SOAP_002_2019&quot;                       
## [11] &quot;2018_SJER_3_255000_4108000_image_256&quot;</code></pre>
<p>filter our lidar data list</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="validate-tree-detection-and-crown-delineation.html#cb40-1" tabindex="-1"></a>lidar_df <span class="ot">&lt;-</span> lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="validate-tree-detection-and-crown-delineation.html#cb40-2" tabindex="-1"></a>  <span class="co">#filter based on plots in evaluation data</span></span>
<span id="cb40-3"><a href="validate-tree-detection-and-crown-delineation.html#cb40-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(plot_name <span class="sc">%in%</span> plotnames_temp) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="validate-tree-detection-and-crown-delineation.html#cb40-4" tabindex="-1"></a>  <span class="co"># pull out site </span></span>
<span id="cb40-5"><a href="validate-tree-detection-and-crown-delineation.html#cb40-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb40-6"><a href="validate-tree-detection-and-crown-delineation.html#cb40-6" tabindex="-1"></a>    <span class="at">siteID =</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(plot_name, <span class="st">&quot;[A-Z]+&quot;</span>)</span>
<span id="cb40-7"><a href="validate-tree-detection-and-crown-delineation.html#cb40-7" tabindex="-1"></a>  )</span>
<span id="cb40-8"><a href="validate-tree-detection-and-crown-delineation.html#cb40-8" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb40-9"><a href="validate-tree-detection-and-crown-delineation.html#cb40-9" tabindex="-1"></a>lidar_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1,732
## Columns: 3
## $ f_path    &lt;chr&gt; &quot;C:/Program Files/R/R-4.3.0/library/NeonTreeEvaluation/extda…
## $ plot_name &lt;chr&gt; &quot;2018_SJER_3_252000_4104000_image_628&quot;, &quot;2018_SJER_3_252000_…
## $ siteID    &lt;chr&gt; &quot;SJER&quot;, &quot;SJER&quot;, &quot;SJER&quot;, &quot;SJER&quot;, &quot;SJER&quot;, &quot;SJER&quot;, &quot;SJER&quot;, &quot;SJE…</code></pre>
<p>we will want to limit our evaluation to only sites with conifer trees since <code>cloud2trees</code> implements methods developed specifically to quantify conifer forest structure that may not be appropriate for other uses.</p>
<p>we’ll use the field data in the package to look for NEON sites with conifer trees. We’ll use the NEON plant list to identify conifer species: <a href="https://data.neonscience.org/taxonomic-lists?taxonTypeCode=PLANT">https://data.neonscience.org/taxonomic-lists?taxonTypeCode=PLANT</a> (click “DOWNLOAD TAXONOMIC LIST”). We’ll filter for species belonging to Class Pinopsida.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="validate-tree-detection-and-crown-delineation.html#cb42-1" tabindex="-1"></a>conifer_spp <span class="ot">&lt;-</span></span>
<span id="cb42-2"><a href="validate-tree-detection-and-crown-delineation.html#cb42-2" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb42-3"><a href="validate-tree-detection-and-crown-delineation.html#cb42-3" tabindex="-1"></a>    <span class="st">&quot;../data/OS_TAXON_PLANT-20220330T142149.csv&quot;</span></span>
<span id="cb42-4"><a href="validate-tree-detection-and-crown-delineation.html#cb42-4" tabindex="-1"></a>    , <span class="at">show_col_types =</span> F</span>
<span id="cb42-5"><a href="validate-tree-detection-and-crown-delineation.html#cb42-5" tabindex="-1"></a>    , <span class="at">progress =</span> F</span>
<span id="cb42-6"><a href="validate-tree-detection-and-crown-delineation.html#cb42-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-7"><a href="validate-tree-detection-and-crown-delineation.html#cb42-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb42-8"><a href="validate-tree-detection-and-crown-delineation.html#cb42-8" tabindex="-1"></a>    <span class="fu">tolower</span>(<span class="st">`</span><span class="at">class</span><span class="st">`</span>) <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;pinopsida&quot;</span>)</span>
<span id="cb42-9"><a href="validate-tree-detection-and-crown-delineation.html#cb42-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-10"><a href="validate-tree-detection-and-crown-delineation.html#cb42-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb42-11"><a href="validate-tree-detection-and-crown-delineation.html#cb42-11" tabindex="-1"></a>    <span class="at">taxonID =</span> <span class="fu">toupper</span>(taxonID)</span>
<span id="cb42-12"><a href="validate-tree-detection-and-crown-delineation.html#cb42-12" tabindex="-1"></a>    , <span class="at">vernacularName =</span> <span class="fu">tolower</span>(vernacularName)</span>
<span id="cb42-13"><a href="validate-tree-detection-and-crown-delineation.html#cb42-13" tabindex="-1"></a>    , <span class="at">genus =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(genus)</span>
<span id="cb42-14"><a href="validate-tree-detection-and-crown-delineation.html#cb42-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb42-15"><a href="validate-tree-detection-and-crown-delineation.html#cb42-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(taxonID, vernacularName, genus)</span></code></pre></div>
<p>what are some of these conifers?</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="validate-tree-detection-and-crown-delineation.html#cb43-1" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb43-2"><a href="validate-tree-detection-and-crown-delineation.html#cb43-2" tabindex="-1"></a>conifer_spp <span class="sc">%&gt;%</span> </span>
<span id="cb43-3"><a href="validate-tree-detection-and-crown-delineation.html#cb43-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-4"><a href="validate-tree-detection-and-crown-delineation.html#cb43-4" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Conifer species taxonID examples&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb43-5"><a href="validate-tree-detection-and-crown-delineation.html#cb43-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-36">Table 3.1: </span>Conifer species taxonID examples
</caption>
<thead>
<tr>
<th style="text-align:left;">
taxonID
</th>
<th style="text-align:left;">
vernacularName
</th>
<th style="text-align:left;">
genus
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
JUNIPSPP
</td>
<td style="text-align:left;">
juniper
</td>
<td style="text-align:left;">
Juniperus
</td>
</tr>
<tr>
<td style="text-align:left;">
JUMOM
</td>
<td style="text-align:left;">
oneseed juniper
</td>
<td style="text-align:left;">
Juniperus
</td>
</tr>
<tr>
<td style="text-align:left;">
LALA
</td>
<td style="text-align:left;">
tamarack
</td>
<td style="text-align:left;">
Larix
</td>
</tr>
<tr>
<td style="text-align:left;">
PISO
</td>
<td style="text-align:left;">
NA
</td>
<td style="text-align:left;">
Pinus
</td>
</tr>
<tr>
<td style="text-align:left;">
AGATH2SPP
</td>
<td style="text-align:left;">
agathis
</td>
<td style="text-align:left;">
Agathis
</td>
</tr>
<tr>
<td style="text-align:left;">
PITO
</td>
<td style="text-align:left;">
torrey pine
</td>
<td style="text-align:left;">
Pinus
</td>
</tr>
<tr>
<td style="text-align:left;">
ABFR
</td>
<td style="text-align:left;">
fraser fir
</td>
<td style="text-align:left;">
Abies
</td>
</tr>
<tr>
<td style="text-align:left;">
ABCO
</td>
<td style="text-align:left;">
white fir
</td>
<td style="text-align:left;">
Abies
</td>
</tr>
<tr>
<td style="text-align:left;">
PITA
</td>
<td style="text-align:left;">
loblolly pine
</td>
<td style="text-align:left;">
Pinus
</td>
</tr>
<tr>
<td style="text-align:left;">
ARAUC2
</td>
<td style="text-align:left;">
araucaria
</td>
<td style="text-align:left;">
Araucaria
</td>
</tr>
</tbody>
</table>
<p>filter for NEON sites that have conifer trees based on field data from all terrestrial NEON sites with qualifying woody vegetation: <a href="https://data.neonscience.org/data-products/DP1.10098.001">https://data.neonscience.org/data-products/DP1.10098.001</a></p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="validate-tree-detection-and-crown-delineation.html#cb44-1" tabindex="-1"></a>conifer_sites <span class="ot">&lt;-</span> NeonTreeEvaluation<span class="sc">::</span>field <span class="sc">%&gt;%</span> </span>
<span id="cb44-2"><a href="validate-tree-detection-and-crown-delineation.html#cb44-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb44-3"><a href="validate-tree-detection-and-crown-delineation.html#cb44-3" tabindex="-1"></a>    conifer_spp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_conifer =</span> <span class="dv">1</span>)</span>
<span id="cb44-4"><a href="validate-tree-detection-and-crown-delineation.html#cb44-4" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;taxonID&quot;</span></span>
<span id="cb44-5"><a href="validate-tree-detection-and-crown-delineation.html#cb44-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-6"><a href="validate-tree-detection-and-crown-delineation.html#cb44-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">is_conifer =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(is_conifer, <span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb44-7"><a href="validate-tree-detection-and-crown-delineation.html#cb44-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="validate-tree-detection-and-crown-delineation.html#cb44-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb44-9"><a href="validate-tree-detection-and-crown-delineation.html#cb44-9" tabindex="-1"></a>    <span class="at">tot =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb44-10"><a href="validate-tree-detection-and-crown-delineation.html#cb44-10" tabindex="-1"></a>    , <span class="at">conifer =</span> <span class="fu">sum</span>(is_conifer)</span>
<span id="cb44-11"><a href="validate-tree-detection-and-crown-delineation.html#cb44-11" tabindex="-1"></a>    , <span class="at">latitude =</span> <span class="fu">mean</span>(plotLatitude)</span>
<span id="cb44-12"><a href="validate-tree-detection-and-crown-delineation.html#cb44-12" tabindex="-1"></a>    , <span class="at">longitude =</span> <span class="fu">mean</span>(plotLongitude)</span>
<span id="cb44-13"><a href="validate-tree-detection-and-crown-delineation.html#cb44-13" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-14"><a href="validate-tree-detection-and-crown-delineation.html#cb44-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-15"><a href="validate-tree-detection-and-crown-delineation.html#cb44-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">pct_conifer =</span> conifer<span class="sc">/</span>tot)</span></code></pre></div>
<p>what is the breakdown of woody vegetation sampled in NEON sites by the percent conifer?</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="validate-tree-detection-and-crown-delineation.html#cb45-1" tabindex="-1"></a>conifer_sites <span class="sc">%&gt;%</span> </span>
<span id="cb45-2"><a href="validate-tree-detection-and-crown-delineation.html#cb45-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(longitude,latitude)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-3"><a href="validate-tree-detection-and-crown-delineation.html#cb45-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(pct_conifer), <span class="fu">desc</span>(tot)) <span class="sc">%&gt;%</span> </span>
<span id="cb45-4"><a href="validate-tree-detection-and-crown-delineation.html#cb45-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">19</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-5"><a href="validate-tree-detection-and-crown-delineation.html#cb45-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;Conifers in NEON sites&quot;</span>, <span class="at">digits =</span> <span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb45-6"><a href="validate-tree-detection-and-crown-delineation.html#cb45-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-38">Table 3.2: </span>Conifers in NEON sites
</caption>
<thead>
<tr>
<th style="text-align:left;">
siteID
</th>
<th style="text-align:right;">
tot
</th>
<th style="text-align:right;">
conifer
</th>
<th style="text-align:right;">
pct_conifer
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:right;">
1804
</td>
<td style="text-align:right;">
1804
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
ONAQ
</td>
<td style="text-align:right;">
88
</td>
<td style="text-align:right;">
88
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
MOAB
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
29
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
HEAL
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
21
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
YELL
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
13
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
TEAK
</td>
<td style="text-align:right;">
621
</td>
<td style="text-align:right;">
619
</td>
<td style="text-align:right;">
1.00
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:right;">
173
</td>
<td style="text-align:right;">
169
</td>
<td style="text-align:right;">
0.98
</td>
</tr>
<tr>
<td style="text-align:left;">
ABBY
</td>
<td style="text-align:right;">
268
</td>
<td style="text-align:right;">
241
</td>
<td style="text-align:right;">
0.90
</td>
</tr>
<tr>
<td style="text-align:left;">
RMNP
</td>
<td style="text-align:right;">
1375
</td>
<td style="text-align:right;">
1083
</td>
<td style="text-align:right;">
0.79
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP
</td>
<td style="text-align:right;">
503
</td>
<td style="text-align:right;">
389
</td>
<td style="text-align:right;">
0.77
</td>
</tr>
<tr>
<td style="text-align:left;">
DSNY
</td>
<td style="text-align:right;">
34
</td>
<td style="text-align:right;">
26
</td>
<td style="text-align:right;">
0.76
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:right;">
2144
</td>
<td style="text-align:right;">
1521
</td>
<td style="text-align:right;">
0.71
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:right;">
1288
</td>
<td style="text-align:right;">
858
</td>
<td style="text-align:right;">
0.67
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:right;">
562
</td>
<td style="text-align:right;">
336
</td>
<td style="text-align:right;">
0.60
</td>
</tr>
<tr>
<td style="text-align:left;">
HARV
</td>
<td style="text-align:right;">
3736
</td>
<td style="text-align:right;">
1701
</td>
<td style="text-align:right;">
0.46
</td>
</tr>
<tr>
<td style="text-align:left;">
TREE
</td>
<td style="text-align:right;">
1303
</td>
<td style="text-align:right;">
430
</td>
<td style="text-align:right;">
0.33
</td>
</tr>
<tr>
<td style="text-align:left;">
BART
</td>
<td style="text-align:right;">
3636
</td>
<td style="text-align:right;">
1022
</td>
<td style="text-align:right;">
0.28
</td>
</tr>
<tr>
<td style="text-align:left;">
BONA
</td>
<td style="text-align:right;">
188
</td>
<td style="text-align:right;">
48
</td>
<td style="text-align:right;">
0.26
</td>
</tr>
<tr>
<td style="text-align:left;">
STEI
</td>
<td style="text-align:right;">
754
</td>
<td style="text-align:right;">
151
</td>
<td style="text-align:right;">
0.20
</td>
</tr>
</tbody>
</table>
<p>let’s only keep NEON sites with &gt;50% of the woody vegetation sampled as conifer</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="validate-tree-detection-and-crown-delineation.html#cb46-1" tabindex="-1"></a><span class="co"># minimum pct conifer</span></span>
<span id="cb46-2"><a href="validate-tree-detection-and-crown-delineation.html#cb46-2" tabindex="-1"></a>min_conifer_pct <span class="ot">&lt;-</span> .<span class="dv">5</span></span>
<span id="cb46-3"><a href="validate-tree-detection-and-crown-delineation.html#cb46-3" tabindex="-1"></a><span class="co"># data frame of sites</span></span>
<span id="cb46-4"><a href="validate-tree-detection-and-crown-delineation.html#cb46-4" tabindex="-1"></a>conifer_sites <span class="ot">&lt;-</span> conifer_sites <span class="sc">%&gt;%</span></span>
<span id="cb46-5"><a href="validate-tree-detection-and-crown-delineation.html#cb46-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(pct_conifer<span class="sc">&gt;</span>min_conifer_pct)</span></code></pre></div>
<p>finally, we’ll filter our lidar processing data for only these conifer sites</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="validate-tree-detection-and-crown-delineation.html#cb47-1" tabindex="-1"></a>lidar_df <span class="ot">&lt;-</span> lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb47-2"><a href="validate-tree-detection-and-crown-delineation.html#cb47-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(conifer_sites, <span class="at">by =</span> <span class="st">&quot;siteID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb47-3"><a href="validate-tree-detection-and-crown-delineation.html#cb47-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;longitude&quot;</span>,<span class="st">&quot;latitude&quot;</span>), <span class="at">crs =</span> <span class="dv">4326</span>, <span class="at">remove =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb47-4"><a href="validate-tree-detection-and-crown-delineation.html#cb47-4" tabindex="-1"></a>  <span class="co"># filter out corrupt las files</span></span>
<span id="cb47-5"><a href="validate-tree-detection-and-crown-delineation.html#cb47-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb47-6"><a href="validate-tree-detection-and-crown-delineation.html#cb47-6" tabindex="-1"></a>    <span class="sc">!</span>plot_name <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb47-7"><a href="validate-tree-detection-and-crown-delineation.html#cb47-7" tabindex="-1"></a>      <span class="st">&quot;NIWO_005_2018&quot;</span></span>
<span id="cb47-8"><a href="validate-tree-detection-and-crown-delineation.html#cb47-8" tabindex="-1"></a>      , <span class="st">&quot;SOAP_014_2018&quot;</span></span>
<span id="cb47-9"><a href="validate-tree-detection-and-crown-delineation.html#cb47-9" tabindex="-1"></a>      , <span class="st">&quot;MOAB_003_2018&quot;</span></span>
<span id="cb47-10"><a href="validate-tree-detection-and-crown-delineation.html#cb47-10" tabindex="-1"></a>      , <span class="st">&quot;NIWO_009_2018&quot;</span></span>
<span id="cb47-11"><a href="validate-tree-detection-and-crown-delineation.html#cb47-11" tabindex="-1"></a>      , <span class="st">&quot;TEAK_028_2018&quot;</span></span>
<span id="cb47-12"><a href="validate-tree-detection-and-crown-delineation.html#cb47-12" tabindex="-1"></a>      , <span class="st">&quot;YELL_058_2020&quot;</span></span>
<span id="cb47-13"><a href="validate-tree-detection-and-crown-delineation.html#cb47-13" tabindex="-1"></a>      , <span class="st">&quot;RMNP_011_2018&quot;</span></span>
<span id="cb47-14"><a href="validate-tree-detection-and-crown-delineation.html#cb47-14" tabindex="-1"></a>      , <span class="st">&quot;YELL_030_2018&quot;</span></span>
<span id="cb47-15"><a href="validate-tree-detection-and-crown-delineation.html#cb47-15" tabindex="-1"></a>      , <span class="st">&quot;YELL_051_2019&quot;</span></span>
<span id="cb47-16"><a href="validate-tree-detection-and-crown-delineation.html#cb47-16" tabindex="-1"></a>      , <span class="st">&quot;SOAP_014_2019&quot;</span></span>
<span id="cb47-17"><a href="validate-tree-detection-and-crown-delineation.html#cb47-17" tabindex="-1"></a>      , <span class="st">&quot;TEAK_005_2018&quot;</span></span>
<span id="cb47-18"><a href="validate-tree-detection-and-crown-delineation.html#cb47-18" tabindex="-1"></a>    )</span>
<span id="cb47-19"><a href="validate-tree-detection-and-crown-delineation.html#cb47-19" tabindex="-1"></a>  )</span></code></pre></div>
<p>what NEON sites have conifers and the most lidar plots</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="validate-tree-detection-and-crown-delineation.html#cb48-1" tabindex="-1"></a>lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb48-2"><a href="validate-tree-detection-and-crown-delineation.html#cb48-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb48-3"><a href="validate-tree-detection-and-crown-delineation.html#cb48-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb48-4"><a href="validate-tree-detection-and-crown-delineation.html#cb48-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb48-5"><a href="validate-tree-detection-and-crown-delineation.html#cb48-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">11</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-6"><a href="validate-tree-detection-and-crown-delineation.html#cb48-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;NEON sites with conifers and lidar plots&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb48-7"><a href="validate-tree-detection-and-crown-delineation.html#cb48-7" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-41">Table 3.3: </span>NEON sites with conifers and lidar plots
</caption>
<thead>
<tr>
<th style="text-align:left;">
siteID
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TEAK
</td>
<td style="text-align:right;">
120
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:right;">
87
</td>
</tr>
<tr>
<td style="text-align:left;">
YELL
</td>
<td style="text-align:right;">
83
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:right;">
71
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP
</td>
<td style="text-align:right;">
71
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:right;">
63
</td>
</tr>
<tr>
<td style="text-align:left;">
ABBY
</td>
<td style="text-align:right;">
55
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:right;">
54
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:right;">
50
</td>
</tr>
<tr>
<td style="text-align:left;">
DSNY
</td>
<td style="text-align:right;">
46
</td>
</tr>
<tr>
<td style="text-align:left;">
HEAL
</td>
<td style="text-align:right;">
29
</td>
</tr>
</tbody>
</table>
<p>what is the spatial distribution of these sites?</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="validate-tree-detection-and-crown-delineation.html#cb49-1" tabindex="-1"></a>lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb49-2"><a href="validate-tree-detection-and-crown-delineation.html#cb49-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb49-3"><a href="validate-tree-detection-and-crown-delineation.html#cb49-3" tabindex="-1"></a>  mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb49-4"><a href="validate-tree-detection-and-crown-delineation.html#cb49-4" tabindex="-1"></a>    <span class="at">zcol =</span> <span class="st">&quot;siteID&quot;</span>, <span class="at">legend =</span> F</span>
<span id="cb49-5"><a href="validate-tree-detection-and-crown-delineation.html#cb49-5" tabindex="-1"></a>    , <span class="at">layer.name =</span> <span class="st">&quot;NEON site&quot;</span></span>
<span id="cb49-6"><a href="validate-tree-detection-and-crown-delineation.html#cb49-6" tabindex="-1"></a>    , <span class="at">col.regions =</span> viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n=</span><span class="fu">nrow</span>(conifer_sites))</span>
<span id="cb49-7"><a href="validate-tree-detection-and-crown-delineation.html#cb49-7" tabindex="-1"></a>  )</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-0cce386812daac963f04" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-0cce386812daac963f04">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[45.76170271641791,63.87034470520231,28.08222958823529,63.87322733333333,31.19748024733096,38.26231868965518,40.04172801108648,40.17957887499999,29.69109949456522,40.24394090109091,37.03389210536779,32.94875689412314,37.00258338164251,44.95853400000001],[-122.3339110559701,-145.7525825260116,-81.40931664705882,-149.2856364285714,-84.46601650711743,-109.3457485172414,-105.5650561036585,-112.5173911477273,-81.98834036801242,-105.5346183541818,-119.2642730019881,-87.39915964505597,-119.0076350660226,-110.6024355384615],6,null,"NEON site",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#30123B","#424AB3","#467EF4","#31AFF5","#18DAC7","#38F491","#83FF52","#BDF534","#E9D539","#FEAA33","#F8721C","#E03F08","#B61C02","#7A0403"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>ABBY&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 55&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>DEJU&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 87&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>DSNY&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 46&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>HEAL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 29&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>JERC&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 50&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>MOAB&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 11&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>NIWO&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 63&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>ONAQ&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>  1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>OSBS&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 71&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>RMNP&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 29&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>SOAP&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 71&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>TALL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 54&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>TEAK&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>120&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>YELL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 83&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["ABBY","DEJU","DSNY","HEAL","JERC","MOAB","NIWO","ONAQ","OSBS","RMNP","SOAP","TALL","TEAK","YELL"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],"NEON site",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[28.08222958823529,63.87322733333333],"lng":[-149.2856364285714,-81.40931664705882]},"fitBounds":[28.08222958823529,-149.2856364285714,63.87322733333333,-81.40931664705882,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>that’s pretty good geographic coverage and in places that we expect to have conifers ;D</p>
</div>
<div id="example-validation-process" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Example validation process<a href="validate-tree-detection-and-crown-delineation.html#example-validation-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>now that we have our lidar data that we can test our point cloud-based tree detection and crown segmentation process against, let’s walk through the validation for a single plot</p>
<p>we’ll test with a single point cloud in our filtered list from conifer sites with validation data</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="validate-tree-detection-and-crown-delineation.html#cb50-1" tabindex="-1"></a>lidar_df_row <span class="ot">&lt;-</span> <span class="dv">1</span></span>
<span id="cb50-2"><a href="validate-tree-detection-and-crown-delineation.html#cb50-2" tabindex="-1"></a><span class="co"># lidar_df$f_path[47] %&gt;% lidR::readLAS() %&gt;% lidR::st_crs()</span></span></code></pre></div>
<div id="preliminaries" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Preliminaries<a href="validate-tree-detection-and-crown-delineation.html#preliminaries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="view-the-point-cloud" class="section level4 hasAnchor" number="3.3.1.1">
<h4><span class="header-section-number">3.3.1.1</span> View the point cloud<a href="validate-tree-detection-and-crown-delineation.html#view-the-point-cloud" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>this step isn’t necessary for validation, but let’s see what this point cloud data looks like</p>
<p>We can plot the point cloud with and color by the point height</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="validate-tree-detection-and-crown-delineation.html#cb51-1" tabindex="-1"></a>lidar_df<span class="sc">$</span>f_path[lidar_df_row] <span class="sc">%&gt;%</span> </span>
<span id="cb51-2"><a href="validate-tree-detection-and-crown-delineation.html#cb51-2" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">readLAS</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb51-3"><a href="validate-tree-detection-and-crown-delineation.html#cb51-3" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb51-4"><a href="validate-tree-detection-and-crown-delineation.html#cb51-4" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Z&quot;</span>, <span class="at">breaks =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="at">legend =</span> T</span>
<span id="cb51-5"><a href="validate-tree-detection-and-crown-delineation.html#cb51-5" tabindex="-1"></a>   , <span class="at">pal =</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">house =</span> <span class="st">&quot;gryffindor&quot;</span>)</span>
<span id="cb51-6"><a href="validate-tree-detection-and-crown-delineation.html#cb51-6" tabindex="-1"></a>  )</span></code></pre></div>
<p>there are trees in there for sure (and conifer trees by the looks of it)</p>
<p>let’s look at the co-registered RGB imagery (notice that the <code>NeonTreeEvaluation</code> commands rely on the deprecated <code>raster</code> package :)</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="validate-tree-detection-and-crown-delineation.html#cb52-1" tabindex="-1"></a><span class="co"># read rgb</span></span>
<span id="cb52-2"><a href="validate-tree-detection-and-crown-delineation.html#cb52-2" tabindex="-1"></a>rgb_temp <span class="ot">&lt;-</span> lidar_df<span class="sc">$</span>plot_name[lidar_df_row] <span class="sc">%&gt;%</span></span>
<span id="cb52-3"><a href="validate-tree-detection-and-crown-delineation.html#cb52-3" tabindex="-1"></a>  NeonTreeEvaluation<span class="sc">::</span><span class="fu">get_data</span>(<span class="at">type =</span> <span class="st">&quot;rgb&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="validate-tree-detection-and-crown-delineation.html#cb52-4" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">stack</span>()</span>
<span id="cb52-5"><a href="validate-tree-detection-and-crown-delineation.html#cb52-5" tabindex="-1"></a></span>
<span id="cb52-6"><a href="validate-tree-detection-and-crown-delineation.html#cb52-6" tabindex="-1"></a><span class="co"># read image annotated crown data and make polygons</span></span>
<span id="cb52-7"><a href="validate-tree-detection-and-crown-delineation.html#cb52-7" tabindex="-1"></a>polys_temp <span class="ot">&lt;-</span></span>
<span id="cb52-8"><a href="validate-tree-detection-and-crown-delineation.html#cb52-8" tabindex="-1"></a>  lidar_df<span class="sc">$</span>plot_name[lidar_df_row] <span class="sc">%&gt;%</span></span>
<span id="cb52-9"><a href="validate-tree-detection-and-crown-delineation.html#cb52-9" tabindex="-1"></a>  NeonTreeEvaluation<span class="sc">::</span><span class="fu">get_data</span>(<span class="at">type =</span> <span class="st">&quot;annotations&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb52-10"><a href="validate-tree-detection-and-crown-delineation.html#cb52-10" tabindex="-1"></a>  NeonTreeEvaluation<span class="sc">::</span><span class="fu">xml_parse</span>() </span>
<span id="cb52-11"><a href="validate-tree-detection-and-crown-delineation.html#cb52-11" tabindex="-1"></a>polys_temp <span class="ot">&lt;-</span> NeonTreeEvaluation<span class="sc">::</span><span class="fu">boxes_to_spatial_polygons</span>(polys_temp,rgb_temp)</span>
<span id="cb52-12"><a href="validate-tree-detection-and-crown-delineation.html#cb52-12" tabindex="-1"></a></span>
<span id="cb52-13"><a href="validate-tree-detection-and-crown-delineation.html#cb52-13" tabindex="-1"></a><span class="co"># plot</span></span>
<span id="cb52-14"><a href="validate-tree-detection-and-crown-delineation.html#cb52-14" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plotRGB</span>(rgb_temp <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">rast</span>())</span>
<span id="cb52-15"><a href="validate-tree-detection-and-crown-delineation.html#cb52-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb52-16"><a href="validate-tree-detection-and-crown-delineation.html#cb52-16" tabindex="-1"></a>  polys_temp <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">vect</span>()</span>
<span id="cb52-17"><a href="validate-tree-detection-and-crown-delineation.html#cb52-17" tabindex="-1"></a>  , <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;red&quot;</span></span>
<span id="cb52-18"><a href="validate-tree-detection-and-crown-delineation.html#cb52-18" tabindex="-1"></a>  , <span class="at">lwd =</span> <span class="dv">2</span> , <span class="at">add =</span> <span class="cn">TRUE</span></span>
<span id="cb52-19"><a href="validate-tree-detection-and-crown-delineation.html#cb52-19" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-46-1.png" width="1008" /></p>
</div>
<div id="itd-variable-window" class="section level4 hasAnchor" number="3.3.1.2">
<h4><span class="header-section-number">3.3.1.2</span> ITD variable window<a href="validate-tree-detection-and-crown-delineation.html#itd-variable-window" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>We discussed our method for individual tree detection (ITD) in <a href="point-cloud-processing.html#itd">this prior section</a>. For our validation, we’ll be using the default window size in the <code>cloud2trees::cloud2trees()</code> and <code>cloud2trees::raster2trees()</code> settings.</p>
<p>Let’s see what that looks like</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="validate-tree-detection-and-crown-delineation.html#cb53-1" tabindex="-1"></a>ws_temp <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">itd_ws_functions</span>()[[<span class="st">&quot;log_fn&quot;</span>]]</span>
<span id="cb53-2"><a href="validate-tree-detection-and-crown-delineation.html#cb53-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-3"><a href="validate-tree-detection-and-crown-delineation.html#cb53-3" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="at">fun=</span>ws_temp, <span class="at">lwd=</span><span class="fl">1.2</span>, <span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="validate-tree-detection-and-crown-delineation.html#cb53-4" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="validate-tree-detection-and-crown-delineation.html#cb53-5" tabindex="-1"></a>  <span class="fu">labs</span>(</span>
<span id="cb53-6"><a href="validate-tree-detection-and-crown-delineation.html#cb53-6" tabindex="-1"></a>    <span class="at">x =</span> <span class="st">&quot;heights&quot;</span>, <span class="at">y =</span> <span class="st">&quot;ws&quot;</span></span>
<span id="cb53-7"><a href="validate-tree-detection-and-crown-delineation.html#cb53-7" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;`cloud2trees` default ITD variable window function&quot;</span></span>
<span id="cb53-8"><a href="validate-tree-detection-and-crown-delineation.html#cb53-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb53-9"><a href="validate-tree-detection-and-crown-delineation.html#cb53-9" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-49-1.png" width="1008" /></p>
</div>
</div>
<div id="filter-for-canopy-trees" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Filter for “canopy” trees<a href="validate-tree-detection-and-crown-delineation.html#filter-for-canopy-trees" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>First, we’ll process the point cloud and get a tree list using our <code>cloud2trees::cloud2trees()</code> method with all defaults except we’ll raise the minimum height of trees to search to 3 m. The (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">Weinstein et al. 2021</a>) benchmark was developed specifically for “canopy” trees and the field-collected stems evaluation data only includes &gt;10 cm DBH trees:</p>
<blockquote>
<p>NEON field crews sample all trees within a plot that are greater than 10cm DBH, regardless of whether the tree crown can be seen in the remote sensing image data. While understory tree detection is an important area of future work, the scope of this benchmark is focused on crowns in the canopy that are visible from above. (p. 10)</p>
</blockquote>
<p>In order to set up our point cloud-based algorithm to find “canopy” trees, we’ll identify the shortest live tree in the field-collected stems data to set our <code>min_height</code> in <code>cloud2trees::cloud2trees()</code></p>
<p>we’ll use the filters found in <code>clean_field_data()</code> from <a href="https://github.com/weecology/NeonTreeEvaluation_package/blob/724bdb0a9a3ea6433450f62c69a8fadce9ccdb66/R/evaluate_field_stems.R"><code>NeonTreeEvaluation</code></a> as an internal function</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="validate-tree-detection-and-crown-delineation.html#cb54-1" tabindex="-1"></a>percentile_for_ht <span class="ot">&lt;-</span> <span class="fl">0.05</span></span>
<span id="cb54-2"><a href="validate-tree-detection-and-crown-delineation.html#cb54-2" tabindex="-1"></a><span class="co"># get non-na heights from neon field measured trees</span></span>
<span id="cb54-3"><a href="validate-tree-detection-and-crown-delineation.html#cb54-3" tabindex="-1"></a>neon_field_heights <span class="ot">&lt;-</span></span>
<span id="cb54-4"><a href="validate-tree-detection-and-crown-delineation.html#cb54-4" tabindex="-1"></a>  NeonTreeEvaluation<span class="sc">::</span>field <span class="sc">%&gt;%</span> </span>
<span id="cb54-5"><a href="validate-tree-detection-and-crown-delineation.html#cb54-5" tabindex="-1"></a>  <span class="co"># filters found in `clean_field_data()`</span></span>
<span id="cb54-6"><a href="validate-tree-detection-and-crown-delineation.html#cb54-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb54-7"><a href="validate-tree-detection-and-crown-delineation.html#cb54-7" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">is.na</span>(itcEasting)</span>
<span id="cb54-8"><a href="validate-tree-detection-and-crown-delineation.html#cb54-8" tabindex="-1"></a>    , <span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(eventID,<span class="st">&quot;2014&quot;</span>)</span>
<span id="cb54-9"><a href="validate-tree-detection-and-crown-delineation.html#cb54-9" tabindex="-1"></a>    , growthForm <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;single bole tree&quot;</span>,<span class="st">&quot;multi-bole tree&quot;</span>,<span class="st">&quot;small tree&quot;</span>,<span class="st">&quot;sapling&quot;</span>)</span>
<span id="cb54-10"><a href="validate-tree-detection-and-crown-delineation.html#cb54-10" tabindex="-1"></a>    , stemDiameter<span class="sc">&gt;</span><span class="dv">15</span></span>
<span id="cb54-11"><a href="validate-tree-detection-and-crown-delineation.html#cb54-11" tabindex="-1"></a>    , (height<span class="sc">&gt;</span><span class="dv">3</span><span class="sc">|</span><span class="fu">is.na</span>(height))</span>
<span id="cb54-12"><a href="validate-tree-detection-and-crown-delineation.html#cb54-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span></span>
<span id="cb54-13"><a href="validate-tree-detection-and-crown-delineation.html#cb54-13" tabindex="-1"></a>  <span class="co"># getting only non-na</span></span>
<span id="cb54-14"><a href="validate-tree-detection-and-crown-delineation.html#cb54-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(height))</span>
<span id="cb54-15"><a href="validate-tree-detection-and-crown-delineation.html#cb54-15" tabindex="-1"></a><span class="co"># get 5th tile ht by site</span></span>
<span id="cb54-16"><a href="validate-tree-detection-and-crown-delineation.html#cb54-16" tabindex="-1"></a>neon_site_heights <span class="ot">&lt;-</span> </span>
<span id="cb54-17"><a href="validate-tree-detection-and-crown-delineation.html#cb54-17" tabindex="-1"></a>  neon_field_heights <span class="sc">%&gt;%</span> </span>
<span id="cb54-18"><a href="validate-tree-detection-and-crown-delineation.html#cb54-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb54-19"><a href="validate-tree-detection-and-crown-delineation.html#cb54-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb54-20"><a href="validate-tree-detection-and-crown-delineation.html#cb54-20" tabindex="-1"></a>    <span class="at">site_prcntl_ht =</span> <span class="fu">quantile</span>(<span class="fu">floor</span>(height), <span class="at">probs =</span> percentile_for_ht, <span class="at">na.rm =</span> T)</span>
<span id="cb54-21"><a href="validate-tree-detection-and-crown-delineation.html#cb54-21" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb54-22"><a href="validate-tree-detection-and-crown-delineation.html#cb54-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>()</span></code></pre></div>
<p>look at the summary of height data across all sites and plots</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="validate-tree-detection-and-crown-delineation.html#cb55-1" tabindex="-1"></a><span class="fu">summary</span>(neon_field_heights<span class="sc">$</span>height)</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##    3.10   11.60   15.90   16.48   20.30  119.80</code></pre>
<p>what does this look like for each NEON site?</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="validate-tree-detection-and-crown-delineation.html#cb57-1" tabindex="-1"></a>neon_field_heights <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="validate-tree-detection-and-crown-delineation.html#cb57-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(neon_site_heights) <span class="sc">%&gt;%</span> </span>
<span id="cb57-3"><a href="validate-tree-detection-and-crown-delineation.html#cb57-3" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">group =</span> siteID)) <span class="sc">+</span></span>
<span id="cb57-4"><a href="validate-tree-detection-and-crown-delineation.html#cb57-4" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">color =</span> <span class="st">&quot;gold&quot;</span>,<span class="at">fill =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">alpha =</span> <span class="fl">0.7</span>, <span class="at">lwd =</span> <span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb57-5"><a href="validate-tree-detection-and-crown-delineation.html#cb57-5" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> site_prcntl_ht), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-6"><a href="validate-tree-detection-and-crown-delineation.html#cb57-6" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="at">facets =</span> <span class="fu">vars</span>(siteID), <span class="at">ncol =</span> <span class="dv">7</span>, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>) <span class="sc">+</span></span>
<span id="cb57-7"><a href="validate-tree-detection-and-crown-delineation.html#cb57-7" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">6</span>)) <span class="sc">+</span></span>
<span id="cb57-8"><a href="validate-tree-detection-and-crown-delineation.html#cb57-8" tabindex="-1"></a>    <span class="fu">labs</span>(</span>
<span id="cb57-9"><a href="validate-tree-detection-and-crown-delineation.html#cb57-9" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;height (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb57-10"><a href="validate-tree-detection-and-crown-delineation.html#cb57-10" tabindex="-1"></a>      , <span class="at">subtitle =</span> <span class="fu">paste0</span>(</span>
<span id="cb57-11"><a href="validate-tree-detection-and-crown-delineation.html#cb57-11" tabindex="-1"></a>        <span class="st">&quot;heights of </span><span class="sc">\&quot;</span><span class="st">canopy</span><span class="sc">\&quot;</span><span class="st"> trees in NeonTreeEvaluation with &quot;</span></span>
<span id="cb57-12"><a href="validate-tree-detection-and-crown-delineation.html#cb57-12" tabindex="-1"></a>        , scales<span class="sc">::</span><span class="fu">number</span>(percentile_for_ht<span class="sc">*</span><span class="dv">100</span>, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb57-13"><a href="validate-tree-detection-and-crown-delineation.html#cb57-13" tabindex="-1"></a>        , <span class="st">&quot;th percentile by site&quot;</span></span>
<span id="cb57-14"><a href="validate-tree-detection-and-crown-delineation.html#cb57-14" tabindex="-1"></a>      )</span>
<span id="cb57-15"><a href="validate-tree-detection-and-crown-delineation.html#cb57-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb57-16"><a href="validate-tree-detection-and-crown-delineation.html#cb57-16" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb57-17"><a href="validate-tree-detection-and-crown-delineation.html#cb57-17" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text.y =</span> <span class="fu">element_blank</span>(), <span class="at">axis.ticks.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-53-1.png" width="1008" /></p>
<p>what is the overall 5th percentile to use for minimum height?</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="validate-tree-detection-and-crown-delineation.html#cb58-1" tabindex="-1"></a>(neon_min_ht <span class="ot">&lt;-</span> <span class="fu">quantile</span>(neon_field_heights<span class="sc">$</span>height, <span class="at">probs =</span> percentile_for_ht) <span class="sc">%&gt;%</span> <span class="fu">floor</span>())</span></code></pre></div>
<pre><code>## 5% 
##  6</code></pre>
<p>let’s attach this to our data frame of lidar data files</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="validate-tree-detection-and-crown-delineation.html#cb60-1" tabindex="-1"></a>lidar_df <span class="ot">&lt;-</span> lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="validate-tree-detection-and-crown-delineation.html#cb60-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(neon_site_heights, <span class="at">by =</span> <span class="st">&quot;siteID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="validate-tree-detection-and-crown-delineation.html#cb60-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">site_prcntl_ht =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(site_prcntl_ht,neon_min_ht))</span></code></pre></div>
</div>
<div id="cloud2treescloud2trees" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> <code>cloud2trees::cloud2trees()</code><a href="validate-tree-detection-and-crown-delineation.html#cloud2treescloud2trees" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="validate-tree-detection-and-crown-delineation.html#cb61-1" tabindex="-1"></a>ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2trees</span>(</span>
<span id="cb61-2"><a href="validate-tree-detection-and-crown-delineation.html#cb61-2" tabindex="-1"></a>  <span class="at">input_las_dir =</span> lidar_df<span class="sc">$</span>f_path[lidar_df_row]</span>
<span id="cb61-3"><a href="validate-tree-detection-and-crown-delineation.html#cb61-3" tabindex="-1"></a>  , <span class="at">output_dir =</span> <span class="fu">tempdir</span>()</span>
<span id="cb61-4"><a href="validate-tree-detection-and-crown-delineation.html#cb61-4" tabindex="-1"></a>  , <span class="at">min_height =</span> lidar_df<span class="sc">$</span>site_prcntl_ht[lidar_df_row]</span>
<span id="cb61-5"><a href="validate-tree-detection-and-crown-delineation.html#cb61-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## Read files headers: [==========] 100% (1 threads)                    Overall: [          ] 0% (1 threads) | : no progress                     Overall: [          ] 0% (1 threads) | read_las: [          ] 0% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 1% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 2% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 3% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 4% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 5% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 6% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 7% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 8% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [          ] 9% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 10% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 11% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 12% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 13% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 14% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 15% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 16% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 17% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 18% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=         ] 19% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 20% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 21% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 22% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 23% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 24% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 25% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 26% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 27% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 28% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==        ] 29% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 30% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 31% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 32% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 33% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 34% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 35% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 36% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 37% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 38% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [===       ] 39% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 40% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 41% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 42% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 43% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 44% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 45% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 46% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 47% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 48% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [====      ] 49% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 50% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 51% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 52% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 53% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 54% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 55% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 56% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 57% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 58% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=====     ] 59% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 60% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 61% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 62% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 63% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 64% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 65% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 66% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 67% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 68% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [======    ] 69% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 70% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 71% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 72% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 73% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 74% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 75% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 76% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 77% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 78% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [=======   ] 79% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 80% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 81% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 82% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 83% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 84% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 85% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 86% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 87% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 88% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========  ] 89% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 90% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 91% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 92% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 93% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 94% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 95% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 96% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 97% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 98% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [========= ] 99% (1 threads)                    Overall: [          ] 0% (1 threads) | read_las: [==========] 100% (1 threads)                    Overall: [          ] 0% (1 threads) | CSF: no progress                     Overall: [          ] 0% (1 threads) | Delaunay triangulation: no progress                     Overall: [          ] 0% (1 threads) | Delaunay triangulation: no progress                     Overall: [          ] 0% (1 threads) | Interpolation: [          ] 0% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 1% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 2% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 3% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 4% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 5% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 6% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 7% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 8% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 9% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [==========] 100% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 0% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 1% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 2% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 3% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 4% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 5% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 6% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 7% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 8% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [          ] 9% (10 threads)                    Overall: [          ] 0% (1 threads) | Interpolation: [==========] 100% (10 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 0% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 1% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 2% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 3% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 4% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 5% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 6% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 7% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 8% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [          ] 9% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 10% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 11% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 12% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 13% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 14% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 15% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 16% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 17% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 18% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=         ] 19% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 20% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 21% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 22% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 23% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 24% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 25% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 26% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 27% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 28% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==        ] 29% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 30% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 31% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 32% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 33% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 34% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 35% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 36% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 37% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 38% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [===       ] 39% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 40% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 41% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 42% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 43% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 44% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 45% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 46% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 47% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 48% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [====      ] 49% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 50% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 51% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 52% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 53% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 54% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 55% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 56% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 57% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 58% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=====     ] 59% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 60% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 61% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 62% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 63% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 64% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 65% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 66% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 67% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 68% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [======    ] 69% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 70% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 71% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 72% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 73% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 74% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 75% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 76% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 77% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 78% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [=======   ] 79% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 80% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 81% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 82% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 83% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 84% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 85% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 86% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 87% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 88% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========  ] 89% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 90% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 91% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 92% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 93% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 94% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 95% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 96% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 97% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 98% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [========= ] 99% (1 threads)                    Overall: [          ] 0% (1 threads) | Write LAS: [==========] 100% (1 threads)                    Overall: [==========] 100% (1 threads) |                     Overall: [==========] 100% (1 threads)                    </code></pre>
<p>quick check our our heights</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="validate-tree-detection-and-crown-delineation.html#cb63-1" tabindex="-1"></a>ans<span class="sc">$</span>crowns_sf<span class="sc">$</span>tree_height_m <span class="sc">%&gt;%</span> <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
##   6.498  11.685  15.795  23.470  33.645  52.462</code></pre>
</div>
<div id="format-extracted-tree-polygons" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Format extracted tree polygons<a href="validate-tree-detection-and-crown-delineation.html#format-extracted-tree-polygons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we need to format our extracted trees for <code>NeonTreeEvaluation</code> evaluation and submission</p>
<p>first, we’ll simplify multipolygon crowns</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="validate-tree-detection-and-crown-delineation.html#cb65-1" tabindex="-1"></a>ans<span class="sc">$</span>crowns_sf <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>(ans<span class="sc">$</span>crowns_sf)</span></code></pre></div>
<p>check out our extracted trees</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="validate-tree-detection-and-crown-delineation.html#cb66-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb66-2"><a href="validate-tree-detection-and-crown-delineation.html#cb66-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb66-3"><a href="validate-tree-detection-and-crown-delineation.html#cb66-3" tabindex="-1"></a>    <span class="at">data =</span> ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="validate-tree-detection-and-crown-delineation.html#cb66-4" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="validate-tree-detection-and-crown-delineation.html#cb66-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb66-6"><a href="validate-tree-detection-and-crown-delineation.html#cb66-6" tabindex="-1"></a>    , <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> x, <span class="at">y =</span> y, <span class="at">fill =</span> f)</span>
<span id="cb66-7"><a href="validate-tree-detection-and-crown-delineation.html#cb66-7" tabindex="-1"></a>    , <span class="at">na.rm =</span> T</span>
<span id="cb66-8"><a href="validate-tree-detection-and-crown-delineation.html#cb66-8" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-9"><a href="validate-tree-detection-and-crown-delineation.html#cb66-9" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp</span>(</span>
<span id="cb66-10"><a href="validate-tree-detection-and-crown-delineation.html#cb66-10" tabindex="-1"></a>    <span class="at">option =</span> <span class="st">&quot;gryffindor&quot;</span></span>
<span id="cb66-11"><a href="validate-tree-detection-and-crown-delineation.html#cb66-11" tabindex="-1"></a>    , <span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="at">n=</span><span class="dv">10</span>)</span>
<span id="cb66-12"><a href="validate-tree-detection-and-crown-delineation.html#cb66-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-13"><a href="validate-tree-detection-and-crown-delineation.html#cb66-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb66-14"><a href="validate-tree-detection-and-crown-delineation.html#cb66-14" tabindex="-1"></a>    <span class="at">data =</span> ans<span class="sc">$</span>crowns_sf</span>
<span id="cb66-15"><a href="validate-tree-detection-and-crown-delineation.html#cb66-15" tabindex="-1"></a>    , <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;gray33&quot;</span>, <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb66-16"><a href="validate-tree-detection-and-crown-delineation.html#cb66-16" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb66-17"><a href="validate-tree-detection-and-crown-delineation.html#cb66-17" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb66-18"><a href="validate-tree-detection-and-crown-delineation.html#cb66-18" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>)) <span class="sc">+</span></span>
<span id="cb66-19"><a href="validate-tree-detection-and-crown-delineation.html#cb66-19" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;CHM (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb66-20"><a href="validate-tree-detection-and-crown-delineation.html#cb66-20" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb66-21"><a href="validate-tree-detection-and-crown-delineation.html#cb66-21" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">axis.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-59-1.png" width="1008" /></p>
<p>we’ll reserve judgement and let the data talk</p>
<p>format the data for <code>NeonTreeEvaluation</code> submission and evaluation</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="validate-tree-detection-and-crown-delineation.html#cb67-1" tabindex="-1"></a>return_sf <span class="ot">&lt;-</span></span>
<span id="cb67-2"><a href="validate-tree-detection-and-crown-delineation.html#cb67-2" tabindex="-1"></a>  ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb67-3"><a href="validate-tree-detection-and-crown-delineation.html#cb67-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-4"><a href="validate-tree-detection-and-crown-delineation.html#cb67-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rowwise</span>(<span class="st">&quot;treeID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb67-5"><a href="validate-tree-detection-and-crown-delineation.html#cb67-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb67-6"><a href="validate-tree-detection-and-crown-delineation.html#cb67-6" tabindex="-1"></a>    <span class="at">xmin =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">1</span>]</span>
<span id="cb67-7"><a href="validate-tree-detection-and-crown-delineation.html#cb67-7" tabindex="-1"></a>    , <span class="at">ymin =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">2</span>]</span>
<span id="cb67-8"><a href="validate-tree-detection-and-crown-delineation.html#cb67-8" tabindex="-1"></a>    , <span class="at">xmax =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">3</span>]</span>
<span id="cb67-9"><a href="validate-tree-detection-and-crown-delineation.html#cb67-9" tabindex="-1"></a>    , <span class="at">ymax =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">4</span>]</span>
<span id="cb67-10"><a href="validate-tree-detection-and-crown-delineation.html#cb67-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb67-11"><a href="validate-tree-detection-and-crown-delineation.html#cb67-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb67-12"><a href="validate-tree-detection-and-crown-delineation.html#cb67-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb67-13"><a href="validate-tree-detection-and-crown-delineation.html#cb67-13" tabindex="-1"></a>    <span class="at">label =</span> <span class="st">&quot;Tree&quot;</span></span>
<span id="cb67-14"><a href="validate-tree-detection-and-crown-delineation.html#cb67-14" tabindex="-1"></a>    , <span class="at">plot_name =</span> lidar_df<span class="sc">$</span>plot_name[lidar_df_row]</span>
<span id="cb67-15"><a href="validate-tree-detection-and-crown-delineation.html#cb67-15" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb67-16"><a href="validate-tree-detection-and-crown-delineation.html#cb67-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(xmin,xmax,ymin,ymax,label,plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb67-17"><a href="validate-tree-detection-and-crown-delineation.html#cb67-17" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_set_crs</span>(<span class="cn">NA</span>)</span>
<span id="cb67-18"><a href="validate-tree-detection-and-crown-delineation.html#cb67-18" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb67-19"><a href="validate-tree-detection-and-crown-delineation.html#cb67-19" tabindex="-1"></a>return_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 36
## Columns: 7
## $ xmin      &lt;dbl&gt; 314489.2, 314481.0, 314456.0, 314489.8, 314481.2, 314457.0, …
## $ xmax      &lt;dbl&gt; 314490.2, 314483.2, 314463.2, 314496.0, 314491.5, 314458.8, …
## $ ymin      &lt;dbl&gt; 4099619, 4099617, 4099611, 4099610, 4099606, 4099609, 409960…
## $ ymax      &lt;dbl&gt; 4099620, 4099620, 4099620, 4099620, 4099619, 4099611, 409961…
## $ label     &lt;chr&gt; &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tre…
## $ plot_name &lt;chr&gt; &quot;2018_TEAK_3_314000_4099000_image_334&quot;, &quot;2018_TEAK_3_314000_…
## $ geometry  &lt;POLYGON&gt; POLYGON ((314489.2 4099620,..., POLYGON ((314481 4099620…</code></pre>
<p>does this match the submission polygon data from the <code>NeonTreeEvaluation</code> package?</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="validate-tree-detection-and-crown-delineation.html#cb69-1" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span>submission_polygons <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 126,574
## Columns: 8
## $ xmin        &lt;dbl&gt; 41.01716, 357.32129, 30.39723, 260.65921, 179.34564, 316.2…
## $ ymin        &lt;dbl&gt; 230.8854218, 122.1164017, 136.9156647, 285.6688843, 371.61…
## $ xmax        &lt;dbl&gt; 151.08607, 397.57458, 73.79434, 299.68811, 232.49385, 363.…
## $ ymax        &lt;dbl&gt; 342.69846, 159.37578, 184.94730, 326.79330, 400.00000, 400…
## $ score       &lt;dbl&gt; 0.8098674, 0.6968824, 0.5713338, 0.5511004, 0.4697072, 0.3…
## $ label       &lt;chr&gt; &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;T…
## $ plot_name   &lt;chr&gt; &quot;DSNY_014_2019&quot;, &quot;DSNY_014_2019&quot;, &quot;DSNY_014_2019&quot;, &quot;DSNY_0…
## $ st_sfc.lst. &lt;POLYGON&gt; POLYGON ((41.01716 230.8854..., POLYGON ((357.3213 122…</code></pre>
<p>yes, except for the “score” column which I’m pretty sure is an artifact from after evaluation?</p>
</div>
<div id="test-evaluation" class="section level3 hasAnchor" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Test evaluation<a href="validate-tree-detection-and-crown-delineation.html#test-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We compared our tree detection and crown delineation results to the three types of evaluation data (i.e. “ground truth” data) presented by Weinstein et al. (2021): field-collected stems, image-annotated crowns, and field-annotated crowns. Field-collected stems offer precise tree locations but might not align with the position of the tree crown as viewed from above (e.g. due to tree lean), image-annotated crowns outline crown boundaries but are subjective, and field-annotated crowns combine the benefits of both but are highly resource-intensive.</p>
<div id="scores-for-an-image-annotated-crowns" class="section level4 hasAnchor" number="3.3.5.1">
<h4><span class="header-section-number">3.3.5.1</span> Scores for an image-annotated crowns<a href="validate-tree-detection-and-crown-delineation.html#scores-for-an-image-annotated-crowns" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The main data source are image-annotated crowns, in which a single observer annotated visible trees in 200 40m x 40m images from across the United States. Get the benchmark score image-annotated “ground truth” data.</p>
<p><em>in testing, including the <code>sf</code> polygon data did not work…switching to the bbox method with <code>sf::st_drop_geometry()</code></em></p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="validate-tree-detection-and-crown-delineation.html#cb71-1" tabindex="-1"></a>rslt_img_annttd_crwns <span class="ot">&lt;-</span> NeonTreeEvaluation<span class="sc">::</span><span class="fu">evaluate_image_crowns</span>(</span>
<span id="cb71-2"><a href="validate-tree-detection-and-crown-delineation.html#cb71-2" tabindex="-1"></a>  <span class="at">predictions =</span> return_sf <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb71-3"><a href="validate-tree-detection-and-crown-delineation.html#cb71-3" tabindex="-1"></a>  , <span class="at">show =</span> T</span>
<span id="cb71-4"><a href="validate-tree-detection-and-crown-delineation.html#cb71-4" tabindex="-1"></a>  , <span class="at">summarize =</span> T</span>
<span id="cb71-5"><a href="validate-tree-detection-and-crown-delineation.html#cb71-5" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1] &quot;2018_TEAK_3_314000_4099000_image_334&quot;</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-62-1.png" width="1008" /></p>
<p>in the plot (if there is a plot), “red” boxes are crowns our point cloud-based method extracted and “black” are the image annotated crowns</p>
<p>it looks like the overlay is generally the same but we are still extracting trees that may not be considered “canopy” trees ;<br />
</p>
<p>what is in the return from <code>NeonTreeEvaluation::evaluate_image_crowns()</code> ?</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="validate-tree-detection-and-crown-delineation.html#cb73-1" tabindex="-1"></a>rslt_img_annttd_crwns <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;overall&quot;     &quot;by_site&quot;     &quot;plot_level&quot;  &quot;count_error&quot;</code></pre>
<p><code>overall</code>: must be across all NEON sites, plots, and trees included for evaluation</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="validate-tree-detection-and-crown-delineation.html#cb75-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>overall</span></code></pre></div>
<pre><code>## # A tibble: 1 × 2
##   precision recall
##       &lt;dbl&gt;  &lt;dbl&gt;
## 1     0.194   0.28</code></pre>
<p><code>by_site</code>: must be across plots, and trees included for evaluation in a NEON sites</p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="validate-tree-detection-and-crown-delineation.html#cb77-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>by_site</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
## # Groups:   Site [1]
##   Site  recall precision
##   &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;
## 1 TEAK    0.28     0.194</code></pre>
<p><code>plot_level</code>: must be across trees included for evaluation in a NEON site, plot combination</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="validate-tree-detection-and-crown-delineation.html#cb79-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>plot_level</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
## # Groups:   plot_name [1]
##   plot_name                            recall precision
##   &lt;chr&gt;                                 &lt;dbl&gt;     &lt;dbl&gt;
## 1 2018_TEAK_3_314000_4099000_image_334   0.28     0.194</code></pre>
<p>count_error is the number of predicted trees minus the number of “ground truth” trees but in graphical form so we’ll skip it</p>
</div>
<div id="scores-for-an-field-annotated-crowns" class="section level4 hasAnchor" number="3.3.5.2">
<h4><span class="header-section-number">3.3.5.2</span> Scores for an field-annotated crowns<a href="validate-tree-detection-and-crown-delineation.html#scores-for-an-field-annotated-crowns" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The second data source is a small number of field-annotated crowns from two geographic sites. These crowns were drawn on a tablet while physically standing in the field, thereby reducing the uncertainty in crown segmentation.</p>
<p><em>not all plots have field-annotated crowns</em></p>
<p><code>NeonTreeEvaluation::evaluate_field_crowns()</code> returns an error if “No plot names matching the field crown data, see list_field_crowns for paths to RGB field crown imagery.”… so, we’ll have to capture errors in our checks?</p>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="validate-tree-detection-and-crown-delineation.html#cb81-1" tabindex="-1"></a><span class="co"># safe it</span></span>
<span id="cb81-2"><a href="validate-tree-detection-and-crown-delineation.html#cb81-2" tabindex="-1"></a>safe_evaluate_field_crowns <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">safely</span>(NeonTreeEvaluation<span class="sc">::</span>evaluate_field_crowns)</span>
<span id="cb81-3"><a href="validate-tree-detection-and-crown-delineation.html#cb81-3" tabindex="-1"></a><span class="co"># test it</span></span>
<span id="cb81-4"><a href="validate-tree-detection-and-crown-delineation.html#cb81-4" tabindex="-1"></a>rslt_fld_crwns <span class="ot">&lt;-</span> <span class="fu">safe_evaluate_field_crowns</span>(</span>
<span id="cb81-5"><a href="validate-tree-detection-and-crown-delineation.html#cb81-5" tabindex="-1"></a>  <span class="at">predictions =</span> return_sf <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb81-6"><a href="validate-tree-detection-and-crown-delineation.html#cb81-6" tabindex="-1"></a>  , <span class="at">show =</span> T</span>
<span id="cb81-7"><a href="validate-tree-detection-and-crown-delineation.html#cb81-7" tabindex="-1"></a>  , <span class="at">summarize =</span> T</span>
<span id="cb81-8"><a href="validate-tree-detection-and-crown-delineation.html#cb81-8" tabindex="-1"></a>)</span></code></pre></div>
<p>did it do it?</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="validate-tree-detection-and-crown-delineation.html#cb82-1" tabindex="-1"></a>rslt_fld_crwns<span class="sc">$</span>error</span></code></pre></div>
<pre><code>## &lt;simpleError in .f(...): No plot names matching the field crown data, see list_field_crowns for paths to RGB field crown imagery.&gt;</code></pre>
<p>nope!</p>
</div>
<div id="scores-for-an-field-collected-stems" class="section level4 hasAnchor" number="3.3.5.3">
<h4><span class="header-section-number">3.3.5.3</span> Scores for an field-collected stems<a href="validate-tree-detection-and-crown-delineation.html#scores-for-an-field-collected-stems" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The third data source is the NEON Woody Vegetation Structure Dataset. Each tree stem is represented by a single point. This data has been filtered to represent overstory trees visible in the remote sensing imagery.</p>
<p><em>not all plots have field-collected stems</em></p>
<p><code>NeonTreeEvaluation::evaluate_field_stems()</code> returns an error if “No submitted plot_names with matching field stem data, see list_field_stems()”… so, we’ll have to capture errors in our checks?</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="validate-tree-detection-and-crown-delineation.html#cb84-1" tabindex="-1"></a><span class="co"># safe it</span></span>
<span id="cb84-2"><a href="validate-tree-detection-and-crown-delineation.html#cb84-2" tabindex="-1"></a>safe_evaluate_field_stems <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">safely</span>(NeonTreeEvaluation<span class="sc">::</span>evaluate_field_stems)</span>
<span id="cb84-3"><a href="validate-tree-detection-and-crown-delineation.html#cb84-3" tabindex="-1"></a><span class="co"># test it</span></span>
<span id="cb84-4"><a href="validate-tree-detection-and-crown-delineation.html#cb84-4" tabindex="-1"></a>rslt_fld_stems <span class="ot">&lt;-</span> <span class="fu">safe_evaluate_field_stems</span>(</span>
<span id="cb84-5"><a href="validate-tree-detection-and-crown-delineation.html#cb84-5" tabindex="-1"></a>  <span class="at">predictions =</span> return_sf <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb84-6"><a href="validate-tree-detection-and-crown-delineation.html#cb84-6" tabindex="-1"></a>  , <span class="at">show =</span> T</span>
<span id="cb84-7"><a href="validate-tree-detection-and-crown-delineation.html#cb84-7" tabindex="-1"></a>  , <span class="at">summarize =</span> T</span>
<span id="cb84-8"><a href="validate-tree-detection-and-crown-delineation.html#cb84-8" tabindex="-1"></a>)</span></code></pre></div>
<p>did it do it?</p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="validate-tree-detection-and-crown-delineation.html#cb85-1" tabindex="-1"></a>rslt_fld_stems<span class="sc">$</span>error</span></code></pre></div>
<pre><code>## &lt;simpleError in .f(...): No submitted plot_names with matching field stem data, see list_field_stems()&gt;</code></pre>
<p>nope!</p>
</div>
</div>
</div>
<div id="full-validation-process" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Full validation process<a href="validate-tree-detection-and-crown-delineation.html#full-validation-process" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Above, we tested the validation process for a single sample plot. Here we’ll create a function to detect trees and delineate tree crowns using our <code>cloud2trees::cloud2trees()</code> method to apply over all sample plots. Then we’ll compare our tree detection and crown delineation results to the three types of evaluation data (i.e. “ground truth” data) presented by Weinstein et al. (2021): field-collected stems, image-annotated crowns, and field-annotated crowns. Field-collected stems offer precise tree locations but might not align with the position of the tree crown as viewed from above (e.g. due to tree lean), image-annotated crowns outline crown boundaries but are subjective, and field-annotated crowns combine the benefits of both but are highly resource-intensive.</p>
<div id="function-to-extract-trees" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Function to extract trees<a href="validate-tree-detection-and-crown-delineation.html#function-to-extract-trees" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s create a function to extract trees and format for evaluation using our <code>lidar_df</code> data which includes a data frame of file paths with the appropriate plot name</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="validate-tree-detection-and-crown-delineation.html#cb87-1" tabindex="-1"></a>cloud2trees_for_eval <span class="ot">&lt;-</span> <span class="cf">function</span>(lidar_df_row, lidar_df, ws, <span class="at">min_height =</span> <span class="cn">NA</span>) {</span>
<span id="cb87-2"><a href="validate-tree-detection-and-crown-delineation.html#cb87-2" tabindex="-1"></a>  <span class="co"># message</span></span>
<span id="cb87-3"><a href="validate-tree-detection-and-crown-delineation.html#cb87-3" tabindex="-1"></a>  <span class="fu">message</span>(<span class="fu">paste0</span>(<span class="st">&quot;doing the work for ...... &quot;</span>, lidar_df<span class="sc">$</span>plot_name[lidar_df_row]))</span>
<span id="cb87-4"><a href="validate-tree-detection-and-crown-delineation.html#cb87-4" tabindex="-1"></a>  <span class="co"># run c2t</span></span>
<span id="cb87-5"><a href="validate-tree-detection-and-crown-delineation.html#cb87-5" tabindex="-1"></a>  qc2t <span class="ot">&lt;-</span> purrr<span class="sc">::</span><span class="fu">safely</span>(cloud2trees<span class="sc">::</span>cloud2trees)</span>
<span id="cb87-6"><a href="validate-tree-detection-and-crown-delineation.html#cb87-6" tabindex="-1"></a>  ans <span class="ot">&lt;-</span> <span class="fu">qc2t</span>(</span>
<span id="cb87-7"><a href="validate-tree-detection-and-crown-delineation.html#cb87-7" tabindex="-1"></a>    <span class="at">input_las_dir =</span> lidar_df<span class="sc">$</span>f_path[lidar_df_row]</span>
<span id="cb87-8"><a href="validate-tree-detection-and-crown-delineation.html#cb87-8" tabindex="-1"></a>    , <span class="at">output_dir =</span> <span class="fu">tempdir</span>()</span>
<span id="cb87-9"><a href="validate-tree-detection-and-crown-delineation.html#cb87-9" tabindex="-1"></a>    , <span class="at">min_height =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(min_height, lidar_df<span class="sc">$</span>site_prcntl_ht[lidar_df_row], <span class="dv">2</span>)</span>
<span id="cb87-10"><a href="validate-tree-detection-and-crown-delineation.html#cb87-10" tabindex="-1"></a>    , <span class="at">ws =</span> ws</span>
<span id="cb87-11"><a href="validate-tree-detection-and-crown-delineation.html#cb87-11" tabindex="-1"></a>  )</span>
<span id="cb87-12"><a href="validate-tree-detection-and-crown-delineation.html#cb87-12" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.null</span>(ans<span class="sc">$</span>error)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb87-13"><a href="validate-tree-detection-and-crown-delineation.html#cb87-13" tabindex="-1"></a>  ans <span class="ot">&lt;-</span> ans<span class="sc">$</span>result</span>
<span id="cb87-14"><a href="validate-tree-detection-and-crown-delineation.html#cb87-14" tabindex="-1"></a>  <span class="co"># simp</span></span>
<span id="cb87-15"><a href="validate-tree-detection-and-crown-delineation.html#cb87-15" tabindex="-1"></a>  ans<span class="sc">$</span>crowns_sf <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>(ans<span class="sc">$</span>crowns_sf)</span>
<span id="cb87-16"><a href="validate-tree-detection-and-crown-delineation.html#cb87-16" tabindex="-1"></a>  <span class="co"># return</span></span>
<span id="cb87-17"><a href="validate-tree-detection-and-crown-delineation.html#cb87-17" tabindex="-1"></a>  return_sf <span class="ot">&lt;-</span></span>
<span id="cb87-18"><a href="validate-tree-detection-and-crown-delineation.html#cb87-18" tabindex="-1"></a>    ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb87-19"><a href="validate-tree-detection-and-crown-delineation.html#cb87-19" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-20"><a href="validate-tree-detection-and-crown-delineation.html#cb87-20" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>(<span class="st">&quot;treeID&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb87-21"><a href="validate-tree-detection-and-crown-delineation.html#cb87-21" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb87-22"><a href="validate-tree-detection-and-crown-delineation.html#cb87-22" tabindex="-1"></a>      <span class="at">xmin =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">1</span>]</span>
<span id="cb87-23"><a href="validate-tree-detection-and-crown-delineation.html#cb87-23" tabindex="-1"></a>      , <span class="at">ymin =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">2</span>]</span>
<span id="cb87-24"><a href="validate-tree-detection-and-crown-delineation.html#cb87-24" tabindex="-1"></a>      , <span class="at">xmax =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">3</span>]</span>
<span id="cb87-25"><a href="validate-tree-detection-and-crown-delineation.html#cb87-25" tabindex="-1"></a>      , <span class="at">ymax =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">4</span>]</span>
<span id="cb87-26"><a href="validate-tree-detection-and-crown-delineation.html#cb87-26" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb87-27"><a href="validate-tree-detection-and-crown-delineation.html#cb87-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb87-28"><a href="validate-tree-detection-and-crown-delineation.html#cb87-28" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb87-29"><a href="validate-tree-detection-and-crown-delineation.html#cb87-29" tabindex="-1"></a>      <span class="at">label =</span> <span class="st">&quot;Tree&quot;</span></span>
<span id="cb87-30"><a href="validate-tree-detection-and-crown-delineation.html#cb87-30" tabindex="-1"></a>      , <span class="at">plot_name =</span> lidar_df<span class="sc">$</span>plot_name[lidar_df_row]</span>
<span id="cb87-31"><a href="validate-tree-detection-and-crown-delineation.html#cb87-31" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb87-32"><a href="validate-tree-detection-and-crown-delineation.html#cb87-32" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(xmin,xmax,ymin,ymax,label,plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb87-33"><a href="validate-tree-detection-and-crown-delineation.html#cb87-33" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_crs</span>(<span class="cn">NA</span>)</span>
<span id="cb87-34"><a href="validate-tree-detection-and-crown-delineation.html#cb87-34" tabindex="-1"></a>  <span class="co"># give the workers a rest</span></span>
<span id="cb87-35"><a href="validate-tree-detection-and-crown-delineation.html#cb87-35" tabindex="-1"></a>  <span class="fu">Sys.sleep</span>(<span class="dv">3</span>)</span>
<span id="cb87-36"><a href="validate-tree-detection-and-crown-delineation.html#cb87-36" tabindex="-1"></a>  <span class="fu">return</span>(return_sf)</span>
<span id="cb87-37"><a href="validate-tree-detection-and-crown-delineation.html#cb87-37" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="build-evaluation-data" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Build evaluation data<a href="validate-tree-detection-and-crown-delineation.html#build-evaluation-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s run each point cloud through our lidar-based tree detection implemented via <code>cloud2trees::cloud2trees()</code></p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="validate-tree-detection-and-crown-delineation.html#cb88-1" tabindex="-1"></a><span class="co"># where should we save the file?</span></span>
<span id="cb88-2"><a href="validate-tree-detection-and-crown-delineation.html#cb88-2" tabindex="-1"></a>submission_fn <span class="ot">&lt;-</span> <span class="st">&quot;../data/NeonTreeEvaluation_submission.gpkg&quot;</span></span>
<span id="cb88-3"><a href="validate-tree-detection-and-crown-delineation.html#cb88-3" tabindex="-1"></a><span class="co"># if we don&#39;t already have the data, run it</span></span>
<span id="cb88-4"><a href="validate-tree-detection-and-crown-delineation.html#cb88-4" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(submission_fn)){</span>
<span id="cb88-5"><a href="validate-tree-detection-and-crown-delineation.html#cb88-5" tabindex="-1"></a><span class="co"># if(T){</span></span>
<span id="cb88-6"><a href="validate-tree-detection-and-crown-delineation.html#cb88-6" tabindex="-1"></a>  my_submission <span class="ot">&lt;-</span> </span>
<span id="cb88-7"><a href="validate-tree-detection-and-crown-delineation.html#cb88-7" tabindex="-1"></a>    <span class="co"># 1:nrow(lidar_df) %&gt;% # uncomment this when it gets real</span></span>
<span id="cb88-8"><a href="validate-tree-detection-and-crown-delineation.html#cb88-8" tabindex="-1"></a>    <span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(lidar_df), <span class="at">size =</span> <span class="dv">222</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb88-9"><a href="validate-tree-detection-and-crown-delineation.html#cb88-9" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(\(x) </span>
<span id="cb88-10"><a href="validate-tree-detection-and-crown-delineation.html#cb88-10" tabindex="-1"></a>      <span class="fu">cloud2trees_for_eval</span>(</span>
<span id="cb88-11"><a href="validate-tree-detection-and-crown-delineation.html#cb88-11" tabindex="-1"></a>        <span class="at">lidar_df_row =</span> x</span>
<span id="cb88-12"><a href="validate-tree-detection-and-crown-delineation.html#cb88-12" tabindex="-1"></a>        , <span class="at">lidar_df =</span> lidar_df</span>
<span id="cb88-13"><a href="validate-tree-detection-and-crown-delineation.html#cb88-13" tabindex="-1"></a>        , <span class="at">ws =</span> cloud2trees<span class="sc">::</span><span class="fu">itd_ws_functions</span>()[[<span class="st">&quot;log_fn&quot;</span>]]</span>
<span id="cb88-14"><a href="validate-tree-detection-and-crown-delineation.html#cb88-14" tabindex="-1"></a>      )</span>
<span id="cb88-15"><a href="validate-tree-detection-and-crown-delineation.html#cb88-15" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb88-16"><a href="validate-tree-detection-and-crown-delineation.html#cb88-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb88-17"><a href="validate-tree-detection-and-crown-delineation.html#cb88-17" tabindex="-1"></a>  <span class="co"># save it </span></span>
<span id="cb88-18"><a href="validate-tree-detection-and-crown-delineation.html#cb88-18" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_write</span>(my_submission, submission_fn, <span class="at">append =</span> F)</span>
<span id="cb88-19"><a href="validate-tree-detection-and-crown-delineation.html#cb88-19" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb88-20"><a href="validate-tree-detection-and-crown-delineation.html#cb88-20" tabindex="-1"></a>  my_submission <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(submission_fn)</span>
<span id="cb88-21"><a href="validate-tree-detection-and-crown-delineation.html#cb88-21" tabindex="-1"></a>}</span></code></pre></div>
<p>what did we get?</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="validate-tree-detection-and-crown-delineation.html#cb89-1" tabindex="-1"></a>my_submission <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 9,547
## Columns: 7
## $ xmin      &lt;dbl&gt; 553118.8, 553114.0, 553114.5, 553119.0, 553102.2, 553102.5, …
## $ xmax      &lt;dbl&gt; 553120.0, 553115.5, 553115.8, 553119.8, 553103.0, 553103.2, …
## $ ymin      &lt;dbl&gt; 5065836, 5065821, 5065821, 5065819, 5065812, 5065812, 410758…
## $ ymax      &lt;dbl&gt; 5065837, 5065823, 5065823, 5065819, 5065813, 5065812, 410758…
## $ label     &lt;chr&gt; &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tree&quot;, &quot;Tre…
## $ plot_name &lt;chr&gt; &quot;ABBY_021_2019&quot;, &quot;ABBY_021_2019&quot;, &quot;ABBY_021_2019&quot;, &quot;ABBY_021…
## $ geom      &lt;POLYGON&gt; POLYGON ((553119.2 5065837,..., POLYGON ((553114.8 50658…</code></pre>
<p>trees detected by plot</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="validate-tree-detection-and-crown-delineation.html#cb91-1" tabindex="-1"></a>my_submission <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="validate-tree-detection-and-crown-delineation.html#cb91-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb91-3"><a href="validate-tree-detection-and-crown-delineation.html#cb91-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb91-4"><a href="validate-tree-detection-and-crown-delineation.html#cb91-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">14</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb91-5"><a href="validate-tree-detection-and-crown-delineation.html#cb91-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb91-6"><a href="validate-tree-detection-and-crown-delineation.html#cb91-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">caption =</span> <span class="st">&quot;cloud2trees ITD results by plot&quot;</span>, <span class="at">digits =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb91-7"><a href="validate-tree-detection-and-crown-delineation.html#cb91-7" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-76">Table 3.4: </span>cloud2trees ITD results by plot
</caption>
<thead>
<tr>
<th style="text-align:left;">
plot_name
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2018_TEAK_3_318000_4107000_image_416
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
2018_TEAK_3_318000_4107000_image_718
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU_029_2018
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC_036_2018
</td>
<td style="text-align:right;">
67
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO_017_2018
</td>
<td style="text-align:right;">
109
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_009_2018
</td>
<td style="text-align:right;">
43
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_029_2019
</td>
<td style="text-align:right;">
95
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_051_2019
</td>
<td style="text-align:right;">
15
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP_009_2019
</td>
<td style="text-align:right;">
47
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP_024_2019
</td>
<td style="text-align:right;">
45
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP_045_2019
</td>
<td style="text-align:right;">
24
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL_007_2019
</td>
<td style="text-align:right;">
47
</td>
</tr>
<tr>
<td style="text-align:left;">
TEAK_030_2018
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
YELL_051_2018
</td>
<td style="text-align:right;">
6
</td>
</tr>
</tbody>
</table>
</div>
<div id="full-evaluation" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Full evaluation<a href="validate-tree-detection-and-crown-delineation.html#full-evaluation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We compared our tree detection and crown delineation results to the three types of evaluation data (i.e. “ground truth” data) presented by Weinstein et al. (2021): field-collected stems, image-annotated crowns, and field-annotated crowns. Field-collected stems offer precise tree locations but might not align with the position of the tree crown as viewed from above (e.g. due to tree lean), image-annotated crowns outline crown boundaries but are subjective, and field-annotated crowns combine the benefits of both but are highly resource-intensive.</p>
<div id="scores-for-an-image-annotated-crowns-1" class="section level4 hasAnchor" number="3.4.3.1">
<h4><span class="header-section-number">3.4.3.1</span> Scores for an image-annotated crowns<a href="validate-tree-detection-and-crown-delineation.html#scores-for-an-image-annotated-crowns-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The main data source are image-annotated crowns, in which a single observer annotated visible trees in <em>200 40m x 40m</em> images from across the United States. Get the benchmark score image-annotated “ground truth” data.</p>
<p><em>in testing, including the <code>sf</code> polygon data did not work…switching to the bbox method with <code>sf::st_drop_geometry()</code></em></p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="validate-tree-detection-and-crown-delineation.html#cb92-1" tabindex="-1"></a>rslt_img_annttd_crwns <span class="ot">&lt;-</span> NeonTreeEvaluation<span class="sc">::</span><span class="fu">evaluate_image_crowns</span>(</span>
<span id="cb92-2"><a href="validate-tree-detection-and-crown-delineation.html#cb92-2" tabindex="-1"></a>  <span class="at">predictions =</span> my_submission <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb92-3"><a href="validate-tree-detection-and-crown-delineation.html#cb92-3" tabindex="-1"></a>  , <span class="at">show =</span> F</span>
<span id="cb92-4"><a href="validate-tree-detection-and-crown-delineation.html#cb92-4" tabindex="-1"></a>  , <span class="at">summarize =</span> T</span>
<span id="cb92-5"><a href="validate-tree-detection-and-crown-delineation.html#cb92-5" tabindex="-1"></a>)</span></code></pre></div>
<p><code>overall</code>: must be across all NEON sites, plots, and trees included for evaluation</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="validate-tree-detection-and-crown-delineation.html#cb93-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb93-2"><a href="validate-tree-detection-and-crown-delineation.html#cb93-2" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb93-3"><a href="validate-tree-detection-and-crown-delineation.html#cb93-3" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Overall: cloud2trees ITD performance versus image-annotated crowns&quot;</span></span>
<span id="cb93-4"><a href="validate-tree-detection-and-crown-delineation.html#cb93-4" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb93-5"><a href="validate-tree-detection-and-crown-delineation.html#cb93-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb93-6"><a href="validate-tree-detection-and-crown-delineation.html#cb93-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-78">Table 3.5: </span>Overall: cloud2trees ITD performance versus image-annotated crowns
</caption>
<thead>
<tr>
<th style="text-align:right;">
precision
</th>
<th style="text-align:right;">
recall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.301
</td>
<td style="text-align:right;">
0.42
</td>
</tr>
</tbody>
</table>
<p><code>by_site</code>: must be across plots, and trees included for evaluation in a NEON sites</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="validate-tree-detection-and-crown-delineation.html#cb94-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>by_site <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="validate-tree-detection-and-crown-delineation.html#cb94-2" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb94-3"><a href="validate-tree-detection-and-crown-delineation.html#cb94-3" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;NEON site-level: cloud2trees ITD performance versus image-annotated crowns&quot;</span></span>
<span id="cb94-4"><a href="validate-tree-detection-and-crown-delineation.html#cb94-4" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb94-5"><a href="validate-tree-detection-and-crown-delineation.html#cb94-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb94-6"><a href="validate-tree-detection-and-crown-delineation.html#cb94-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-79">Table 3.6: </span>NEON site-level: cloud2trees ITD performance versus image-annotated crowns
</caption>
<thead>
<tr>
<th style="text-align:left;">
Site
</th>
<th style="text-align:right;">
recall
</th>
<th style="text-align:right;">
precision
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ABBY
</td>
<td style="text-align:right;">
0.702
</td>
<td style="text-align:right;">
0.541
</td>
</tr>
<tr>
<td style="text-align:left;">
DSNY
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.250
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:right;">
0.857
</td>
<td style="text-align:right;">
0.316
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:right;">
0.274
</td>
<td style="text-align:right;">
0.353
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:right;">
0.469
</td>
<td style="text-align:right;">
0.303
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP
</td>
<td style="text-align:right;">
0.220
</td>
<td style="text-align:right;">
0.224
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:right;">
0.241
</td>
<td style="text-align:right;">
0.359
</td>
</tr>
<tr>
<td style="text-align:left;">
TEAK
</td>
<td style="text-align:right;">
0.365
</td>
<td style="text-align:right;">
0.316
</td>
</tr>
</tbody>
</table>
<p><code>plot_level</code>: must be across trees included for evaluation in a NEON site, plot combination</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="validate-tree-detection-and-crown-delineation.html#cb95-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb95-2"><a href="validate-tree-detection-and-crown-delineation.html#cb95-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb95-3"><a href="validate-tree-detection-and-crown-delineation.html#cb95-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">14</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb95-4"><a href="validate-tree-detection-and-crown-delineation.html#cb95-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb95-5"><a href="validate-tree-detection-and-crown-delineation.html#cb95-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb95-6"><a href="validate-tree-detection-and-crown-delineation.html#cb95-6" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;NEON plot-level: cloud2trees ITD performance versus image-annotated crowns&quot;</span></span>
<span id="cb95-7"><a href="validate-tree-detection-and-crown-delineation.html#cb95-7" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb95-8"><a href="validate-tree-detection-and-crown-delineation.html#cb95-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb95-9"><a href="validate-tree-detection-and-crown-delineation.html#cb95-9" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-80">Table 3.7: </span>NEON plot-level: cloud2trees ITD performance versus image-annotated crowns
</caption>
<thead>
<tr>
<th style="text-align:left;">
plot_name
</th>
<th style="text-align:right;">
recall
</th>
<th style="text-align:right;">
precision
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
2018_TEAK_3_314000_4099000_image_334
</td>
<td style="text-align:right;">
0.240
</td>
<td style="text-align:right;">
0.261
</td>
</tr>
<tr>
<td style="text-align:left;">
2018_TEAK_3_318000_4102000_image_483
</td>
<td style="text-align:right;">
0.667
</td>
<td style="text-align:right;">
0.308
</td>
</tr>
<tr>
<td style="text-align:left;">
2018_TEAK_3_318000_4107000_image_718
</td>
<td style="text-align:right;">
0.000
</td>
<td style="text-align:right;">
0.000
</td>
</tr>
<tr>
<td style="text-align:left;">
2018_TEAK_3_320000_4095000_image_616
</td>
<td style="text-align:right;">
0.302
</td>
<td style="text-align:right;">
0.381
</td>
</tr>
<tr>
<td style="text-align:left;">
2018_TEAK_3_322000_4096000_image_368
</td>
<td style="text-align:right;">
0.286
</td>
<td style="text-align:right;">
0.222
</td>
</tr>
<tr>
<td style="text-align:left;">
DSNY_005_2018
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
0.250
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_023_2019
</td>
<td style="text-align:right;">
0.500
</td>
<td style="text-align:right;">
0.105
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_029_2019
</td>
<td style="text-align:right;">
0.619
</td>
<td style="text-align:right;">
0.411
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_032_2019
</td>
<td style="text-align:right;">
0.405
</td>
<td style="text-align:right;">
0.238
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS_051_2019
</td>
<td style="text-align:right;">
0.750
</td>
<td style="text-align:right;">
0.400
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP_031_2019
</td>
<td style="text-align:right;">
0.220
</td>
<td style="text-align:right;">
0.224
</td>
</tr>
<tr>
<td style="text-align:left;">
TEAK_049_2018
</td>
<td style="text-align:right;">
0.440
</td>
<td style="text-align:right;">
0.407
</td>
</tr>
<tr>
<td style="text-align:left;">
TEAK_053_2018
</td>
<td style="text-align:right;">
0.300
</td>
<td style="text-align:right;">
0.375
</td>
</tr>
<tr>
<td style="text-align:left;">
TEAK_061_2018
</td>
<td style="text-align:right;">
0.171
</td>
<td style="text-align:right;">
0.219
</td>
</tr>
</tbody>
</table>
<p>how many plots did we evaluate that met all criteria?:</p>
<p><em>had point cloud data in the benchmark
</em>was from a NEON site with primarily conifer trees
*had image-annotated crowns for evaluation</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="validate-tree-detection-and-crown-delineation.html#cb96-1" tabindex="-1"></a><span class="co"># how many plots did we evaluate that met all criteria?</span></span>
<span id="cb96-2"><a href="validate-tree-detection-and-crown-delineation.html#cb96-2" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb96-3"><a href="validate-tree-detection-and-crown-delineation.html#cb96-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb96-4"><a href="validate-tree-detection-and-crown-delineation.html#cb96-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb96-5"><a href="validate-tree-detection-and-crown-delineation.html#cb96-5" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 31</code></pre>
<p>how many plots were evaluated using <code>cloud2trees::cloud2trees()</code> by NEON site?</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="validate-tree-detection-and-crown-delineation.html#cb98-1" tabindex="-1"></a>img_annttd_crwn_plots_temp <span class="ot">&lt;-</span> lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb98-2"><a href="validate-tree-detection-and-crown-delineation.html#cb98-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb98-3"><a href="validate-tree-detection-and-crown-delineation.html#cb98-3" tabindex="-1"></a>    rslt_img_annttd_crwns<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb98-4"><a href="validate-tree-detection-and-crown-delineation.html#cb98-4" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb98-5"><a href="validate-tree-detection-and-crown-delineation.html#cb98-5" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">distinct</span>(plot_name)</span>
<span id="cb98-6"><a href="validate-tree-detection-and-crown-delineation.html#cb98-6" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;plot_name&quot;</span></span>
<span id="cb98-7"><a href="validate-tree-detection-and-crown-delineation.html#cb98-7" tabindex="-1"></a>  )</span>
<span id="cb98-8"><a href="validate-tree-detection-and-crown-delineation.html#cb98-8" tabindex="-1"></a><span class="co"># plots evaluated by neon site</span></span>
<span id="cb98-9"><a href="validate-tree-detection-and-crown-delineation.html#cb98-9" tabindex="-1"></a>img_annttd_crwn_plots_temp <span class="sc">%&gt;%</span> </span>
<span id="cb98-10"><a href="validate-tree-detection-and-crown-delineation.html#cb98-10" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb98-11"><a href="validate-tree-detection-and-crown-delineation.html#cb98-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb98-12"><a href="validate-tree-detection-and-crown-delineation.html#cb98-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb98-13"><a href="validate-tree-detection-and-crown-delineation.html#cb98-13" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb98-14"><a href="validate-tree-detection-and-crown-delineation.html#cb98-14" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Number of 40m x 40m plots with image-annotated crowns evaluated using cloud2trees by NEON site&quot;</span></span>
<span id="cb98-15"><a href="validate-tree-detection-and-crown-delineation.html#cb98-15" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb98-16"><a href="validate-tree-detection-and-crown-delineation.html#cb98-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb98-17"><a href="validate-tree-detection-and-crown-delineation.html#cb98-17" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-82">Table 3.8: </span>Number of 40m x 40m plots with image-annotated crowns evaluated using cloud2trees by NEON site
</caption>
<thead>
<tr>
<th style="text-align:left;">
siteID
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
TEAK
</td>
<td style="text-align:right;">
17
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:right;">
6
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
ABBY
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
DSNY
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
SOAP
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>where are these NEON sites evaluated using <code>cloud2trees::cloud2trees()</code>?</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="validate-tree-detection-and-crown-delineation.html#cb99-1" tabindex="-1"></a>img_annttd_crwn_plots_temp <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="validate-tree-detection-and-crown-delineation.html#cb99-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb99-3"><a href="validate-tree-detection-and-crown-delineation.html#cb99-3" tabindex="-1"></a>  mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb99-4"><a href="validate-tree-detection-and-crown-delineation.html#cb99-4" tabindex="-1"></a>    <span class="at">cex =</span> <span class="st">&quot;n&quot;</span>, <span class="at">legend =</span> F</span>
<span id="cb99-5"><a href="validate-tree-detection-and-crown-delineation.html#cb99-5" tabindex="-1"></a>    , <span class="at">layer.name =</span> <span class="st">&quot;NEON site&quot;</span></span>
<span id="cb99-6"><a href="validate-tree-detection-and-crown-delineation.html#cb99-6" tabindex="-1"></a>  )</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-7ac9cf48a77f5ed14530" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-7ac9cf48a77f5ed14530">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[45.76170271641791,28.08222958823529,31.19748024733096,40.04172801108648,29.69109949456522,37.03389210536779,32.94875689412314,37.00258338164251],[-122.3339110559701,-81.40931664705882,-84.46601650711743,-105.5650561036585,-81.98834036801242,-119.2642730019881,-87.39915964505597,-119.0076350660226],[3,3,3,4.5,6.75,3,3,15],null,"NEON site",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>ABBY&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>DSNY&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>JERC&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>NIWO&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>OSBS&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 6&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>SOAP&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>TALL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>TEAK&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>17&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],"NEON site",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[28.08222958823529,45.76170271641791],"lng":[-122.3339110559701,-81.40931664705882]},"fitBounds":[28.08222958823529,-122.3339110559701,45.76170271641791,-81.40931664705882,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>let’s review some figures comparing the image-annotated crowns versus the bounding box of our delineated crown polygons</p>
<p><em>in the RGB plots: “red” boxes are crowns from our point cloud-based method extracted and “black” are the image annotated crowns</em></p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="validate-tree-detection-and-crown-delineation.html#cb100-1" tabindex="-1"></a>rslt_img_annttd_crwns<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb100-2"><a href="validate-tree-detection-and-crown-delineation.html#cb100-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-3"><a href="validate-tree-detection-and-crown-delineation.html#cb100-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="validate-tree-detection-and-crown-delineation.html#cb100-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb100-5"><a href="validate-tree-detection-and-crown-delineation.html#cb100-5" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x) NeonTreeEvaluation<span class="sc">::</span><span class="fu">image_crowns</span>(</span>
<span id="cb100-6"><a href="validate-tree-detection-and-crown-delineation.html#cb100-6" tabindex="-1"></a>    <span class="at">predictions =</span> my_submission <span class="sc">%&gt;%</span> </span>
<span id="cb100-7"><a href="validate-tree-detection-and-crown-delineation.html#cb100-7" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb100-8"><a href="validate-tree-detection-and-crown-delineation.html#cb100-8" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(plot_name<span class="sc">==</span>x)</span>
<span id="cb100-9"><a href="validate-tree-detection-and-crown-delineation.html#cb100-9" tabindex="-1"></a>    , <span class="at">show =</span> T</span>
<span id="cb100-10"><a href="validate-tree-detection-and-crown-delineation.html#cb100-10" tabindex="-1"></a>    , <span class="at">project_boxes =</span> F</span>
<span id="cb100-11"><a href="validate-tree-detection-and-crown-delineation.html#cb100-11" tabindex="-1"></a>  ))</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-84-1.png" width="1008" /><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-84-2.png" width="1008" /><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-84-3.png" width="1008" /><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-84-4.png" width="1008" /></p>
<p><em>in the RGB plots: “red” boxes are crowns from our point cloud-based method extracted and “black” are the image annotated crowns</em></p>
</div>
<div id="scores-for-an-field-annotated-crowns-1" class="section level4 hasAnchor" number="3.4.3.2">
<h4><span class="header-section-number">3.4.3.2</span> Scores for an field-annotated crowns<a href="validate-tree-detection-and-crown-delineation.html#scores-for-an-field-annotated-crowns-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The second data source is a small number of field-annotated crowns from two geographic sites. These crowns were drawn on a tablet while physically standing in the field, thereby reducing the uncertainty in crown segmentation.</p>
<p><em>none of the field-annotated crown sites have aerial lidar data</em></p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="validate-tree-detection-and-crown-delineation.html#cb101-1" tabindex="-1"></a><span class="co"># i did some digging around and the lidar data is here</span></span>
<span id="cb101-2"><a href="validate-tree-detection-and-crown-delineation.html#cb101-2" tabindex="-1"></a>lidar_dir_temp <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;NeonTreeEvaluation&quot;</span>, <span class="st">&quot;extdata&quot;</span>, <span class="st">&quot;NeonTreeEvaluation&quot;</span>, <span class="st">&quot;evaluation&quot;</span>, <span class="st">&quot;LiDAR&quot;</span>)</span>
<span id="cb101-3"><a href="validate-tree-detection-and-crown-delineation.html#cb101-3" tabindex="-1"></a><span class="co"># files</span></span>
<span id="cb101-4"><a href="validate-tree-detection-and-crown-delineation.html#cb101-4" tabindex="-1"></a>lidar_files_temp <span class="ot">&lt;-</span> lidar_dir_temp <span class="sc">%&gt;%</span> </span>
<span id="cb101-5"><a href="validate-tree-detection-and-crown-delineation.html#cb101-5" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">recursive =</span> T, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb101-6"><a href="validate-tree-detection-and-crown-delineation.html#cb101-6" tabindex="-1"></a>  <span class="fu">basename</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb101-7"><a href="validate-tree-detection-and-crown-delineation.html#cb101-7" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-8"><a href="validate-tree-detection-and-crown-delineation.html#cb101-8" tabindex="-1"></a>  <span class="fu">unique</span>()</span>
<span id="cb101-9"><a href="validate-tree-detection-and-crown-delineation.html#cb101-9" tabindex="-1"></a><span class="co"># what sites have field annotated crowns?</span></span>
<span id="cb101-10"><a href="validate-tree-detection-and-crown-delineation.html#cb101-10" tabindex="-1"></a>fc_temp <span class="ot">&lt;-</span> NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_field_crowns</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb101-11"><a href="validate-tree-detection-and-crown-delineation.html#cb101-11" tabindex="-1"></a>  stringr<span class="sc">::</span><span class="fu">str_match</span>(<span class="at">pattern=</span><span class="st">&quot;(</span><span class="sc">\\</span><span class="st">w+).tif&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb101-12"><a href="validate-tree-detection-and-crown-delineation.html#cb101-12" tabindex="-1"></a>  .[,<span class="dv">2</span>]</span>
<span id="cb101-13"><a href="validate-tree-detection-and-crown-delineation.html#cb101-13" tabindex="-1"></a><span class="co"># are any lidar files available for these sites?</span></span>
<span id="cb101-14"><a href="validate-tree-detection-and-crown-delineation.html#cb101-14" tabindex="-1"></a>lidar_files_temp[lidar_files_temp <span class="sc">%in%</span> fc_temp] <span class="sc">%&gt;%</span> </span>
<span id="cb101-15"><a href="validate-tree-detection-and-crown-delineation.html#cb101-15" tabindex="-1"></a>  <span class="fu">length</span>()</span></code></pre></div>
<pre><code>## [1] 0</code></pre>
<p>nope!</p>
</div>
<div id="scores-for-an-field-collected-stems-1" class="section level4 hasAnchor" number="3.4.3.3">
<h4><span class="header-section-number">3.4.3.3</span> Scores for an field-collected stems<a href="validate-tree-detection-and-crown-delineation.html#scores-for-an-field-collected-stems-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The third data source is the NEON Woody Vegetation Structure Dataset. Each tree stem is represented by a single point. This data has been filtered to represent overstory trees visible in the remote sensing imagery.</p>
<p><em>not all plots have field-collected stems</em></p>
<p><em>in testing, including the <code>sf</code> polygon data did not work…switching to the bbox method with <code>sf::st_drop_geometry()</code></em></p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="validate-tree-detection-and-crown-delineation.html#cb103-1" tabindex="-1"></a>rslt_fld_stems <span class="ot">&lt;-</span> <span class="fu">evaluate_field_stems</span>(</span>
<span id="cb103-2"><a href="validate-tree-detection-and-crown-delineation.html#cb103-2" tabindex="-1"></a>  <span class="at">predictions =</span> my_submission <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>()</span>
<span id="cb103-3"><a href="validate-tree-detection-and-crown-delineation.html#cb103-3" tabindex="-1"></a>  , <span class="at">show =</span> F</span>
<span id="cb103-4"><a href="validate-tree-detection-and-crown-delineation.html#cb103-4" tabindex="-1"></a>  , <span class="at">summarize =</span> T</span>
<span id="cb103-5"><a href="validate-tree-detection-and-crown-delineation.html#cb103-5" tabindex="-1"></a>)</span></code></pre></div>
<p><code>overall</code>: must be across all NEON sites, plots, and trees included for evaluation</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="validate-tree-detection-and-crown-delineation.html#cb104-1" tabindex="-1"></a>rslt_fld_stems<span class="sc">$</span>overall <span class="sc">%&gt;%</span> </span>
<span id="cb104-2"><a href="validate-tree-detection-and-crown-delineation.html#cb104-2" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb104-3"><a href="validate-tree-detection-and-crown-delineation.html#cb104-3" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Overall: cloud2trees ITD performance versus field-collected stems&quot;</span></span>
<span id="cb104-4"><a href="validate-tree-detection-and-crown-delineation.html#cb104-4" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb104-5"><a href="validate-tree-detection-and-crown-delineation.html#cb104-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="validate-tree-detection-and-crown-delineation.html#cb104-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-88">Table 3.9: </span>Overall: cloud2trees ITD performance versus field-collected stems
</caption>
<thead>
<tr>
<th style="text-align:right;">
recall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;">
0.776
</td>
</tr>
</tbody>
</table>
<p><code>by_site</code>: must be across plots, and trees included for evaluation in a NEON sites</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="validate-tree-detection-and-crown-delineation.html#cb105-1" tabindex="-1"></a>rslt_fld_stems<span class="sc">$</span>by_site <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="validate-tree-detection-and-crown-delineation.html#cb105-2" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb105-3"><a href="validate-tree-detection-and-crown-delineation.html#cb105-3" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;NEON site-level: cloud2trees ITD performance versus field-collected stems&quot;</span></span>
<span id="cb105-4"><a href="validate-tree-detection-and-crown-delineation.html#cb105-4" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb105-5"><a href="validate-tree-detection-and-crown-delineation.html#cb105-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb105-6"><a href="validate-tree-detection-and-crown-delineation.html#cb105-6" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-89">Table 3.10: </span>NEON site-level: cloud2trees ITD performance versus field-collected stems
</caption>
<thead>
<tr>
<th style="text-align:left;">
Site
</th>
<th style="text-align:right;">
recall
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
ABBY
</td>
<td style="text-align:right;">
0.333
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:right;">
0.885
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:right;">
0.743
</td>
</tr>
<tr>
<td style="text-align:left;">
MOAB
</td>
<td style="text-align:right;">
0.909
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:right;">
0.501
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:right;">
0.914
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:right;">
0.667
</td>
</tr>
</tbody>
</table>
<p><code>plot_level</code>: must be across trees included for evaluation in a NEON site, plot combination</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="validate-tree-detection-and-crown-delineation.html#cb106-1" tabindex="-1"></a>rslt_fld_stems<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb106-2"><a href="validate-tree-detection-and-crown-delineation.html#cb106-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb106-3"><a href="validate-tree-detection-and-crown-delineation.html#cb106-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n=</span><span class="dv">14</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb106-4"><a href="validate-tree-detection-and-crown-delineation.html#cb106-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb106-5"><a href="validate-tree-detection-and-crown-delineation.html#cb106-5" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb106-6"><a href="validate-tree-detection-and-crown-delineation.html#cb106-6" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;NEON plot-level: cloud2trees ITD performance versus field-collected stems&quot;</span></span>
<span id="cb106-7"><a href="validate-tree-detection-and-crown-delineation.html#cb106-7" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb106-8"><a href="validate-tree-detection-and-crown-delineation.html#cb106-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb106-9"><a href="validate-tree-detection-and-crown-delineation.html#cb106-9" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-90">Table 3.11: </span>NEON plot-level: cloud2trees ITD performance versus field-collected stems
</caption>
<thead>
<tr>
<th style="text-align:left;">
siteID
</th>
<th style="text-align:left;">
plot_name
</th>
<th style="text-align:right;">
recall
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:left;">
DEJU_014
</td>
<td style="text-align:right;">
0.714
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:left;">
DEJU_016
</td>
<td style="text-align:right;">
1.000
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:left;">
DEJU_062
</td>
<td style="text-align:right;">
0.667
</td>
<td style="text-align:right;">
3
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:left;">
JERC_051
</td>
<td style="text-align:right;">
0.714
</td>
<td style="text-align:right;">
7
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:left;">
NIWO_005
</td>
<td style="text-align:right;">
0.571
</td>
<td style="text-align:right;">
14
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:left;">
NIWO_007
</td>
<td style="text-align:right;">
0.407
</td>
<td style="text-align:right;">
54
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:left;">
NIWO_010
</td>
<td style="text-align:right;">
0.622
</td>
<td style="text-align:right;">
37
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:left;">
NIWO_040
</td>
<td style="text-align:right;">
0.450
</td>
<td style="text-align:right;">
40
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:left;">
OSBS_009
</td>
<td style="text-align:right;">
0.800
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:left;">
OSBS_026
</td>
<td style="text-align:right;">
0.833
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:left;">
OSBS_029
</td>
<td style="text-align:right;">
0.750
</td>
<td style="text-align:right;">
20
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:left;">
OSBS_035
</td>
<td style="text-align:right;">
1.167
</td>
<td style="text-align:right;">
12
</td>
</tr>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:left;">
OSBS_038
</td>
<td style="text-align:right;">
0.722
</td>
<td style="text-align:right;">
18
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:left;">
TALL_050
</td>
<td style="text-align:right;">
0.667
</td>
<td style="text-align:right;">
24
</td>
</tr>
</tbody>
</table>
<p>how many plots did we evaluate that met all criteria?:</p>
<p><em>had point cloud data in the benchmark
</em>was from a NEON site with primarily conifer trees
*had field-collected stems for evaluation</p>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="validate-tree-detection-and-crown-delineation.html#cb107-1" tabindex="-1"></a><span class="co"># how many plots did we evaluate that met all criteria?</span></span>
<span id="cb107-2"><a href="validate-tree-detection-and-crown-delineation.html#cb107-2" tabindex="-1"></a>rslt_fld_stems<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb107-3"><a href="validate-tree-detection-and-crown-delineation.html#cb107-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb107-4"><a href="validate-tree-detection-and-crown-delineation.html#cb107-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb107-5"><a href="validate-tree-detection-and-crown-delineation.html#cb107-5" tabindex="-1"></a>  <span class="fu">nrow</span>()</span></code></pre></div>
<pre><code>## [1] 43</code></pre>
<p>how many plots were evaluated using <code>cloud2trees::cloud2trees()</code> by NEON site?</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="validate-tree-detection-and-crown-delineation.html#cb109-1" tabindex="-1"></a>fld_stems_plots_temp <span class="ot">&lt;-</span></span>
<span id="cb109-2"><a href="validate-tree-detection-and-crown-delineation.html#cb109-2" tabindex="-1"></a>  lidar_df <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="validate-tree-detection-and-crown-delineation.html#cb109-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb109-4"><a href="validate-tree-detection-and-crown-delineation.html#cb109-4" tabindex="-1"></a>      <span class="at">sht_plt =</span> plot_name <span class="sc">%&gt;%</span> </span>
<span id="cb109-5"><a href="validate-tree-detection-and-crown-delineation.html#cb109-5" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_extract</span>(</span>
<span id="cb109-6"><a href="validate-tree-detection-and-crown-delineation.html#cb109-6" tabindex="-1"></a>          rslt_fld_stems<span class="sc">$</span>plot_level <span class="sc">%&gt;%</span> </span>
<span id="cb109-7"><a href="validate-tree-detection-and-crown-delineation.html#cb109-7" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-8"><a href="validate-tree-detection-and-crown-delineation.html#cb109-8" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">distinct</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb109-9"><a href="validate-tree-detection-and-crown-delineation.html#cb109-9" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">pull</span>(plot_name) <span class="sc">%&gt;%</span> </span>
<span id="cb109-10"><a href="validate-tree-detection-and-crown-delineation.html#cb109-10" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>)</span>
<span id="cb109-11"><a href="validate-tree-detection-and-crown-delineation.html#cb109-11" tabindex="-1"></a>        )</span>
<span id="cb109-12"><a href="validate-tree-detection-and-crown-delineation.html#cb109-12" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb109-13"><a href="validate-tree-detection-and-crown-delineation.html#cb109-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(sht_plt)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-14"><a href="validate-tree-detection-and-crown-delineation.html#cb109-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(siteID,sht_plt) <span class="sc">%&gt;%</span> </span>
<span id="cb109-15"><a href="validate-tree-detection-and-crown-delineation.html#cb109-15" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n=</span>dplyr<span class="sc">::</span><span class="fu">n</span>()) <span class="sc">%&gt;%</span> </span>
<span id="cb109-16"><a href="validate-tree-detection-and-crown-delineation.html#cb109-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-17"><a href="validate-tree-detection-and-crown-delineation.html#cb109-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">plot_name=</span>sht_plt)</span>
<span id="cb109-18"><a href="validate-tree-detection-and-crown-delineation.html#cb109-18" tabindex="-1"></a><span class="co"># plots evaluated by neon site</span></span>
<span id="cb109-19"><a href="validate-tree-detection-and-crown-delineation.html#cb109-19" tabindex="-1"></a>fld_stems_plots_temp <span class="sc">%&gt;%</span> </span>
<span id="cb109-20"><a href="validate-tree-detection-and-crown-delineation.html#cb109-20" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-21"><a href="validate-tree-detection-and-crown-delineation.html#cb109-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb109-22"><a href="validate-tree-detection-and-crown-delineation.html#cb109-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-23"><a href="validate-tree-detection-and-crown-delineation.html#cb109-23" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb109-24"><a href="validate-tree-detection-and-crown-delineation.html#cb109-24" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Number of 40m x 40m plots with field-collected stems evaluated using cloud2trees by NEON site&quot;</span></span>
<span id="cb109-25"><a href="validate-tree-detection-and-crown-delineation.html#cb109-25" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">3</span></span>
<span id="cb109-26"><a href="validate-tree-detection-and-crown-delineation.html#cb109-26" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb109-27"><a href="validate-tree-detection-and-crown-delineation.html#cb109-27" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-92">Table 3.12: </span>Number of 40m x 40m plots with field-collected stems evaluated using cloud2trees by NEON site
</caption>
<thead>
<tr>
<th style="text-align:left;">
siteID
</th>
<th style="text-align:right;">
n
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
OSBS
</td>
<td style="text-align:right;">
16
</td>
</tr>
<tr>
<td style="text-align:left;">
DEJU
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
NIWO
</td>
<td style="text-align:right;">
9
</td>
</tr>
<tr>
<td style="text-align:left;">
JERC
</td>
<td style="text-align:right;">
5
</td>
</tr>
<tr>
<td style="text-align:left;">
TALL
</td>
<td style="text-align:right;">
2
</td>
</tr>
<tr>
<td style="text-align:left;">
ABBY
</td>
<td style="text-align:right;">
1
</td>
</tr>
<tr>
<td style="text-align:left;">
MOAB
</td>
<td style="text-align:right;">
1
</td>
</tr>
</tbody>
</table>
<p>where are these NEON sites evaluated using <code>cloud2trees::cloud2trees()</code>?</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="validate-tree-detection-and-crown-delineation.html#cb110-1" tabindex="-1"></a>fld_stems_plots_temp <span class="sc">%&gt;%</span> </span>
<span id="cb110-2"><a href="validate-tree-detection-and-crown-delineation.html#cb110-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID) <span class="sc">%&gt;%</span> </span>
<span id="cb110-3"><a href="validate-tree-detection-and-crown-delineation.html#cb110-3" tabindex="-1"></a>  mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb110-4"><a href="validate-tree-detection-and-crown-delineation.html#cb110-4" tabindex="-1"></a>    <span class="at">cex =</span> <span class="st">&quot;n&quot;</span>, <span class="at">legend =</span> F</span>
<span id="cb110-5"><a href="validate-tree-detection-and-crown-delineation.html#cb110-5" tabindex="-1"></a>    , <span class="at">layer.name =</span> <span class="st">&quot;NEON site&quot;</span></span>
<span id="cb110-6"><a href="validate-tree-detection-and-crown-delineation.html#cb110-6" tabindex="-1"></a>  )</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-913026fe609adacd7796" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-913026fe609adacd7796">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[45.76170271641791,63.87034470520231,31.19748024733096,38.26231868965519,40.04172801108648,29.69109949456522,32.94875689412314],[-122.3339110559701,-145.7525825260116,-84.46601650711743,-109.3457485172414,-105.5650561036585,-81.98834036801242,-87.39915964505597],[3,9.4,6.2,3,9.4,15,3.8],null,"NEON site",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>ABBY&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>DEJU&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 9&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>JERC&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>MOAB&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>NIWO&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 9&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>OSBS&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>16&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>siteID&emsp;<\/th><td>TALL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 2&emsp;<\/td><\/tr><tr><td>3<\/td><th>geometry&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],"NEON site",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]}],"limits":{"lat":[29.69109949456522,63.87034470520231],"lng":[-145.7525825260116,-81.98834036801242]},"fitBounds":[29.69109949456522,-145.7525825260116,63.87034470520231,-81.98834036801242,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="point-cloud-processing.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

</body>

</html>
