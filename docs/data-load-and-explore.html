<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Data Load and Explore | Aerial LiDAR for Fire Model Inputs</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Data Load and Explore | Aerial LiDAR for Fire Model Inputs" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Data Load and Explore | Aerial LiDAR for Fire Model Inputs" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html"><i class="fa fa-check"></i><b>2</b> Data Load and Explore</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#neontreeevaluation"><i class="fa fa-check"></i><b>2.1</b> <code>NeonTreeEvaluation</code></a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#explore-lidar-data-from-package"><i class="fa fa-check"></i><b>2.1.1</b> Explore LiDAR data from package</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#cloud2trees"><i class="fa fa-check"></i><b>2.2</b> <code>cloud2trees</code></a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#get-tree-list-and-normalized-cloud"><i class="fa fa-check"></i><b>2.2.1</b> Get tree list and normalized cloud</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#ladderfuelsr"><i class="fa fa-check"></i><b>2.3</b> <code>LadderFuelsR</code></a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#prep-for-the-package"><i class="fa fa-check"></i><b>2.3.1</b> Prep for the package</a></li>
<li class="chapter" data-level="2.3.2" data-path="data-load-and-explore.html"><a href="data-load-and-explore.html#use-the-package"><i class="fa fa-check"></i><b>2.3.2</b> Use the package</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial LiDAR for Fire Model Inputs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-load-and-explore" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Section 2</span> Data Load and Explore<a href="data-load-and-explore.html#data-load-and-explore" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Load the standard libraries</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-load-and-explore.html#cb1-1" tabindex="-1"></a><span class="co"># bread-and-butter</span></span>
<span id="cb1-2"><a href="data-load-and-explore.html#cb1-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># the tidyverse</span></span>
<span id="cb1-3"><a href="data-load-and-explore.html#cb1-3" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># viridis colors</span></span>
<span id="cb1-4"><a href="data-load-and-explore.html#cb1-4" tabindex="-1"></a><span class="fu">library</span>(harrypotter) <span class="co"># hp colors</span></span>
<span id="cb1-5"><a href="data-load-and-explore.html#cb1-5" tabindex="-1"></a><span class="fu">library</span>(scales) <span class="co"># work with number and plot scales</span></span>
<span id="cb1-6"><a href="data-load-and-explore.html#cb1-6" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb1-7"><a href="data-load-and-explore.html#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="data-load-and-explore.html#cb1-8" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb1-9"><a href="data-load-and-explore.html#cb1-9" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># interactive html maps</span></span>
<span id="cb1-10"><a href="data-load-and-explore.html#cb1-10" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># tables</span></span>
<span id="cb1-11"><a href="data-load-and-explore.html#cb1-11" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine plots</span></span>
<span id="cb1-12"><a href="data-load-and-explore.html#cb1-12" tabindex="-1"></a><span class="fu">library</span>(ggnewscale) <span class="co"># ggnewscale</span></span>
<span id="cb1-13"><a href="data-load-and-explore.html#cb1-13" tabindex="-1"></a><span class="fu">library</span>(plot3D) <span class="co"># 3d plotting</span></span>
<span id="cb1-14"><a href="data-load-and-explore.html#cb1-14" tabindex="-1"></a><span class="fu">library</span>(rgl) <span class="co"># rgl plotting</span></span>
<span id="cb1-15"><a href="data-load-and-explore.html#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="data-load-and-explore.html#cb1-16" tabindex="-1"></a><span class="co"># spatial analysis</span></span>
<span id="cb1-17"><a href="data-load-and-explore.html#cb1-17" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co"># raster</span></span>
<span id="cb1-18"><a href="data-load-and-explore.html#cb1-18" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features</span></span>
<span id="cb1-19"><a href="data-load-and-explore.html#cb1-19" tabindex="-1"></a><span class="fu">library</span>(lidR) <span class="co"># lidar data</span></span>
<span id="cb1-20"><a href="data-load-and-explore.html#cb1-20" tabindex="-1"></a></span>
<span id="cb1-21"><a href="data-load-and-explore.html#cb1-21" tabindex="-1"></a><span class="co"># models</span></span>
<span id="cb1-22"><a href="data-load-and-explore.html#cb1-22" tabindex="-1"></a><span class="fu">library</span>(brms) <span class="co"># bayesian modelling</span></span></code></pre></div>
<p>Load the libraries from GitHub. Here we’ll load:</p>
<ul>
<li><a href="https://github.com/weecology/NeonTreeEvaluation_package"><code>NeonTreeEvaluation</code></a>: benchmark data set to evaluate lidar-based tree detection (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">Weinstein et al. 2021</a>)</li>
<li><a href="https://github.com/georgewoolsey/cloud2trees"><code>cloud2trees</code></a>: routines for processing point cloud data collected by airborne lidar to detect forest trees (Woolsey and Tinkham, 2024)</li>
<li><a href="https://github.com/olgaviedma/LadderFuelsR"><code>LadderFuelsR</code></a>: vertical fuel continuity quantification and crown base height (CBH) calculation (<a href="https://doi.org/10.1111/2041-210X.14427">Viedma et al. 2024</a>)</li>
<li><a href="https://github.com/r-lidar/lasR"><code>lasR</code></a>: complex processing pipelines on lidar data (<a href="https://r-lidar.github.io/lasR/index.html">Roussel 2024</a>)</li>
</ul>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-load-and-explore.html#cb2-1" tabindex="-1"></a><span class="fu">library</span>(pak)</span>
<span id="cb2-2"><a href="data-load-and-explore.html#cb2-2" tabindex="-1"></a><span class="co"># load them</span></span>
<span id="cb2-3"><a href="data-load-and-explore.html#cb2-3" tabindex="-1"></a><span class="fu">c</span>(<span class="st">&quot;NeonTreeEvaluation&quot;</span>, <span class="st">&quot;cloud2trees&quot;</span>, <span class="st">&quot;LadderFuelsR&quot;</span>, <span class="st">&quot;lasR&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb2-4"><a href="data-load-and-explore.html#cb2-4" tabindex="-1"></a><span class="co"># install and load</span></span>
<span id="cb2-5"><a href="data-load-and-explore.html#cb2-5" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x){</span>
<span id="cb2-6"><a href="data-load-and-explore.html#cb2-6" tabindex="-1"></a>    <span class="co"># locations</span></span>
<span id="cb2-7"><a href="data-load-and-explore.html#cb2-7" tabindex="-1"></a>    df <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">tibble</span>(</span>
<span id="cb2-8"><a href="data-load-and-explore.html#cb2-8" tabindex="-1"></a>      <span class="at">p =</span> <span class="fu">c</span>(<span class="st">&quot;NeonTreeEvaluation&quot;</span>, <span class="st">&quot;cloud2trees&quot;</span>, <span class="st">&quot;LadderFuelsR&quot;</span>, <span class="st">&quot;lasR&quot;</span>)</span>
<span id="cb2-9"><a href="data-load-and-explore.html#cb2-9" tabindex="-1"></a>      , <span class="at">l =</span> <span class="fu">c</span>(</span>
<span id="cb2-10"><a href="data-load-and-explore.html#cb2-10" tabindex="-1"></a>        <span class="st">&quot;weecology/NeonTreeEvaluation_package&quot;</span></span>
<span id="cb2-11"><a href="data-load-and-explore.html#cb2-11" tabindex="-1"></a>        , <span class="st">&quot;georgewoolsey/cloud2trees&quot;</span></span>
<span id="cb2-12"><a href="data-load-and-explore.html#cb2-12" tabindex="-1"></a>        , <span class="st">&quot;olgaviedma/LadderFuelsR&quot;</span></span>
<span id="cb2-13"><a href="data-load-and-explore.html#cb2-13" tabindex="-1"></a>        , <span class="st">&quot;r-lidar/lasR&quot;</span></span>
<span id="cb2-14"><a href="data-load-and-explore.html#cb2-14" tabindex="-1"></a>      )</span>
<span id="cb2-15"><a href="data-load-and-explore.html#cb2-15" tabindex="-1"></a>    )</span>
<span id="cb2-16"><a href="data-load-and-explore.html#cb2-16" tabindex="-1"></a>    <span class="co"># install if needed</span></span>
<span id="cb2-17"><a href="data-load-and-explore.html#cb2-17" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">require</span>(x, <span class="at">character.only =</span> T)){</span>
<span id="cb2-18"><a href="data-load-and-explore.html#cb2-18" tabindex="-1"></a>      pak<span class="sc">::</span><span class="fu">pkg_install</span>(</span>
<span id="cb2-19"><a href="data-load-and-explore.html#cb2-19" tabindex="-1"></a>        <span class="at">pkg =</span> df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">tolower</span>(p)<span class="sc">==</span><span class="fu">tolower</span>(x)) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(l)</span>
<span id="cb2-20"><a href="data-load-and-explore.html#cb2-20" tabindex="-1"></a>        , <span class="at">upgrade =</span> T</span>
<span id="cb2-21"><a href="data-load-and-explore.html#cb2-21" tabindex="-1"></a>      )</span>
<span id="cb2-22"><a href="data-load-and-explore.html#cb2-22" tabindex="-1"></a>    }</span>
<span id="cb2-23"><a href="data-load-and-explore.html#cb2-23" tabindex="-1"></a>    <span class="co"># load</span></span>
<span id="cb2-24"><a href="data-load-and-explore.html#cb2-24" tabindex="-1"></a>    <span class="fu">library</span>(x, <span class="at">character.only =</span> T)</span>
<span id="cb2-25"><a href="data-load-and-explore.html#cb2-25" tabindex="-1"></a>  })</span></code></pre></div>
<div id="neontreeevaluation" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> <code>NeonTreeEvaluation</code><a href="data-load-and-explore.html#neontreeevaluation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Weinstein et al. (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">2021</a>) developed:</p>
<blockquote>
<p>a benchmark dataset of individual canopy crowns derived from multi-sensor imagery in the National Ecological Observatory Network (Table 1) that provides: 1) co-registered remote sensing data from multiple sensors (LiDAR, RGB imagery, and hyperspectral imagery) to allow comparisons of methods based on any single sensor (e.g., for LiDAR based methods), or any combination of sensors (e.g., combining RGB and hyperspectral), and 2) three types of evaluation data to allow assessing both ‘tree detection’, defined as the identifying the location of individual trees using evaluation data with a point at the crown center , and ‘crown delineation’ defined as identifying the boundary edge of crowns across a broad range of forest types. The benchmark is designed to allow flexibility in both workflow and sensor selection. (p. 2)</p>
</blockquote>
<p><strong>Table 1.</strong> Summary of datasets included in the benchmark dataset. All sensor data has been cropped to the extent of NEON field sampling plots.</p>
<p><img src="../data/journal.pcbi.1009180.t001.PNG" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<p>The objective of the present analysis is to evaluate the use of this benchmark data set (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">Weinstein et al. 2021</a>) for a scientific publication describing a workflow to ingest raw LiDAR data and export a tabular tree list for use as an input to the QUIC-Fire physics-based fire spread model (<a href="https://scholar.google.com/scholar?cluster=5135309566348498660&amp;hl=en&amp;as_sdt=0,6">Linn et al. 2020</a>).</p>
<p>Weinstein et al. (<a href="https://scholar.google.com/scholar?cluster=4986448711981898434&amp;hl=en&amp;as_sdt=0,6">2021</a>) describe the LiDAR data in the benchmark data set:</p>
<blockquote>
<p>The LiDAR data are 3D coordinates (~5 points/m2) that provide high resolution information about canopy crown shape and height. LiDAR data are stored as 1000m x 1000m.laz files (Fig 2). These files contain the x,y,z coordinates for each return, as well as metadata on return intensity and point classification. Boundaries of individual canopy crowns are often apparent due to gaps among neighboring trees or differences in height among overlapping canopy crowns. For more information on NEON LiDAR data processing see NEON technical document NEON.DOC.001292. Due to the large spatial coverage of the collection effort, the point density of the NEON LiDAR clouds is much lower than the point density used for most studies of crown detection models ([20, 21]; point densities of 8–1000 pt/m2). (p. 4)</p>
</blockquote>
<p>what’s in this package?</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-load-and-explore.html#cb3-1" tabindex="-1"></a><span class="fu">lsf.str</span>(<span class="st">&quot;package:NeonTreeEvaluation&quot;</span>)</span></code></pre></div>
<pre><code>## boxes_to_spatial_polygons : function (boxes, raster_object, project_boxes = TRUE)  
## canopy_model : function (las, res = 0.5)  
## check_download : function ()  
## compute_precision_recall : function (ground_truth, predictions, threshold = 0.4, summarize = TRUE)  
## download : function (training = FALSE, savedir = NULL, force = F)  
## evaluate_field_crowns : function (predictions, summarize = TRUE, show = TRUE, project = FALSE)  
## evaluate_field_stems : function (predictions, project = TRUE, show = T, summarize = T)  
## evaluate_image_crowns : function (predictions, project = FALSE, show = TRUE, summarize = TRUE)  
## field_crowns : function (x, show = TRUE, project_boxes = TRUE)  
## get_data : function (plot_name, type)  
## grand_summary : function (results, threshold = 0.4)  
## image_crowns : function (predictions, show = TRUE, project_boxes = TRUE)  
## list_annotations : function ()  
## list_chm : function ()  
## list_field_crowns : function ()  
## list_field_stems : function ()  
## list_rgb : function ()  
## load_field_crown : function (plot_name, show = TRUE)  
## load_ground_truth : function (plot_name, show = TRUE)  
## xml_parse : function (path)  
## zenodo_url : function (concept_rec_id = 3723356, rec_version = &quot;latest&quot;, rec_id = NULL)  
## zenodo_versions : function (concept_rec_id, arg_checks = TRUE)</code></pre>
<p>we first have to download evaluation data from the Zenodo archive (1GB), use the download() function to place the data in the correct package location. Download the much larger training data, set <code>training=TRUE</code>.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-load-and-explore.html#cb5-1" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span><span class="fu">download</span>(<span class="at">training =</span> T, <span class="at">force =</span> F)</span></code></pre></div>
<pre><code>## NULL</code></pre>
<p>what data is in this package?</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-load-and-explore.html#cb7-1" tabindex="-1"></a><span class="co"># what/where is this data</span></span>
<span id="cb7-2"><a href="data-load-and-explore.html#cb7-2" tabindex="-1"></a><span class="fu">paste0</span>(<span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;NeonTreeEvaluation&quot;</span>),<span class="st">&quot;/extdata/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="data-load-and-explore.html#cb7-3" tabindex="-1"></a>  <span class="fu">list.files</span>(<span class="at">recursive =</span> T, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>, <span class="at">full.names =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb7-4"><a href="data-load-and-explore.html#cb7-4" tabindex="-1"></a>  <span class="fu">sample</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb7-5"><a href="data-load-and-explore.html#cb7-5" tabindex="-1"></a>  .[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;NeonTreeEvaluation/evaluation/LiDAR/SCBI_038_2019.laz&quot;   
##  [2] &quot;NeonTreeEvaluation/evaluation/LiDAR/SJER_024_2019.laz&quot;   
##  [3] &quot;NeonTreeEvaluation/evaluation/LiDAR/WREF_024_2019.laz&quot;   
##  [4] &quot;NeonTreeEvaluation/evaluation/LiDAR/unnamed_plot_101.las&quot;
##  [5] &quot;NeonTreeEvaluation/evaluation/LiDAR/UKFS_005_2020.laz&quot;   
##  [6] &quot;NeonTreeEvaluation/evaluation/LiDAR/LENO_026_2019.laz&quot;   
##  [7] &quot;NeonTreeEvaluation/evaluation/LiDAR/WREF_083_2019.laz&quot;   
##  [8] &quot;NeonTreeEvaluation/evaluation/LiDAR/NIWO_030_2019.laz&quot;   
##  [9] &quot;NeonTreeEvaluation/evaluation/LiDAR/UKFS_016_2020.laz&quot;   
## [10] &quot;NeonTreeEvaluation/evaluation/LiDAR/unnamed_plot_38.las&quot;</code></pre>
<p>For a list of NEON site abbreviations <a href="https://www.neonscience.org/field-sites/field-sites-map">https://www.neonscience.org/field-sites/field-sites-map</a></p>
<p><code>NeonTreeEvaluation::list_annotations</code> looks into package contents for ground truth annotations for the image-annotated crowns.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-load-and-explore.html#cb9-1" tabindex="-1"></a><span class="co"># list_annotations</span></span>
<span id="cb9-2"><a href="data-load-and-explore.html#cb9-2" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_annotations</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-3"><a href="data-load-and-explore.html#cb9-3" tabindex="-1"></a>  <span class="fu">sample</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb9-4"><a href="data-load-and-explore.html#cb9-4" tabindex="-1"></a>  .[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;2018_SJER_3_253000_4112000_image_581&quot;
##  [2] &quot;SJER_005_2018&quot;                       
##  [3] &quot;8&quot;                                   
##  [4] &quot;2018_SJER_3_255000_4108000_image_224&quot;
##  [5] &quot;SJER_021_2018&quot;                       
##  [6] &quot;SJER_059_2018&quot;                       
##  [7] &quot;2018_SJER_3_252000_4106000_image_326&quot;
##  [8] &quot;TEAK_045_2018&quot;                       
##  [9] &quot;SJER_062_2018&quot;                       
## [10] &quot;2018_TEAK_3_322000_4102000_image_495&quot;</code></pre>
<p>The field collected stems are individual points for each tree. They overlap with a subset of the sensor data. Use the <code>NeonTreeEvaluation::list_field_stems</code> function to determine which plots have stem data.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-load-and-explore.html#cb11-1" tabindex="-1"></a><span class="co"># list_field_stems</span></span>
<span id="cb11-2"><a href="data-load-and-explore.html#cb11-2" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_field_stems</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-3"><a href="data-load-and-explore.html#cb11-3" tabindex="-1"></a>  <span class="fu">sample</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb11-4"><a href="data-load-and-explore.html#cb11-4" tabindex="-1"></a>  .[<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>]</span></code></pre></div>
<pre><code>##  [1] &quot;SERC_006&quot; &quot;RMNP_019&quot; &quot;GUAN_054&quot; &quot;ABBY_003&quot; &quot;SERC_067&quot; &quot;STEI_008&quot;
##  [7] &quot;DELA_037&quot; &quot;TALL_005&quot; &quot;TALL_017&quot; &quot;TALL_020&quot;</code></pre>
<p>The <code>NeonTreeEvaluation::crown_polygons</code> function lists “field-annotated crowns” in which an observer annotates a polygon on the remote-sensing image on a tablet while standing in the field. From Ordway Swisher Biological Station, Florida and Mountain Lake Biological Station.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-load-and-explore.html#cb13-1" tabindex="-1"></a><span class="co"># crown_polygons</span></span>
<span id="cb13-2"><a href="data-load-and-explore.html#cb13-2" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span>crown_polygons <span class="sc">%&gt;%</span> </span>
<span id="cb13-3"><a href="data-load-and-explore.html#cb13-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 564</code></pre>
<pre><code>## Columns: 7
## $ indvdID      &lt;chr&gt; &quot;MLBSE00007&quot;, &quot;MLBSE00012&quot;, &quot;MLBSE00027&quot;, &quot;MLBSE00049&quot;, &quot;…
## $ geometry     &lt;POLYGON [m]&gt; POLYGON ((541983.5 4136174,..., POLYGON ((542127 …
## $ plotID       &lt;fct&gt; MLBS_14, MLBS_37, MLBS_42, MLBS_1, MLBS_21, MLBS_23, MLBS…
## $ siteID       &lt;fct&gt; MLBS, MLBS, MLBS, MLBS, MLBS, MLBS, MLBS, MLBS, MLBS, MLB…
## $ utmZone      &lt;fct&gt; 17N, 17N, 17N, 17N, 17N, 17N, 17N, 17N, 17N, 17N, 17N, 17…
## $ plotEasting  &lt;dbl&gt; 541986.3, 542125.7, 542267.8, 541883.4, 542053.1, 542075.…
## $ plotNorthing &lt;dbl&gt; 4136173, 4136182, 4136994, 4136586, 4136390, 4136400, 413…</code></pre>
<p>Sites with field annotated crowns</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-load-and-explore.html#cb16-1" tabindex="-1"></a><span class="co"># crown_polygons</span></span>
<span id="cb16-2"><a href="data-load-and-explore.html#cb16-2" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span>crown_polygons <span class="sc">%&gt;%</span> </span>
<span id="cb16-3"><a href="data-load-and-explore.html#cb16-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb16-4"><a href="data-load-and-explore.html#cb16-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(siteID)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   siteID     n
##   &lt;fct&gt;  &lt;int&gt;
## 1 MLBS     106
## 2 OSBS     458</code></pre>
<p>hmmm this data only exists for two NEON sites</p>
<p>The woody vegetation structure data contains information on field estimated height and maximum crown diameter for the majority of field collected stems. We annotated all trees in the 40x40 m plot, regardless of health status, provided they were visible in the image.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-load-and-explore.html#cb18-1" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span>field <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="data-load-and-explore.html#cb18-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 37,776
## Columns: 67
## $ uid                           &lt;fct&gt; 411f5c60-79c4-41ef-b3d0-4e9b5365870e, 0d…
## $ namedLocation                 &lt;fct&gt; ABBY_063.basePlot.vst, ABBY_063.basePlot…
## $ date                          &lt;fct&gt; 2015-07-23, 2015-07-23, 2015-07-23, 2015…
## $ tagEventID                    &lt;fct&gt; vst_ABBY_2015, vst_ABBY_2015, vst_ABBY_2…
## $ domainID                      &lt;fct&gt; D16, D16, D16, D16, D16, D16, D16, D16, …
## $ siteID                        &lt;fct&gt; ABBY, ABBY, ABBY, ABBY, ABBY, ABBY, ABBY…
## $ plotID                        &lt;fct&gt; ABBY_063, ABBY_063, ABBY_063, ABBY_063, …
## $ subplotID                     &lt;int&gt; 39, 21, 21, 21, 39, 39, 39, 39, 39, 39, …
## $ nestedSubplotID               &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ pointID                       &lt;int&gt; 57, 21, 21, 21, 39, 41, 41, 41, 41, 41, …
## $ stemDistance                  &lt;dbl&gt; 3.0, 23.8, 23.8, 23.8, 26.2, 16.0, 16.0,…
## $ stemAzimuth                   &lt;dbl&gt; 111.0, 50.0, 50.0, 50.0, 45.4, 346.0, 34…
## $ recordType                    &lt;fct&gt; , , , , , , , , , , , , , , , , , , , , …
## $ individualID                  &lt;fct&gt; NEON.PLA.D16.ABBY.00441, NEON.PLA.D16.AB…
## $ supportingStemIndividualID    &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ previouslyTaggedAs            &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ samplingProtocolVersion       &lt;fct&gt; NEON.DOC.000987vE, NEON.DOC.000987vE, NE…
## $ taxonID                       &lt;fct&gt; PSMEM, PSMEM, PSMEM, PSMEM, PSMEM, PSMEM…
## $ scientificName                &lt;fct&gt; &quot;Pseudotsuga menziesii (Mirb.) Franco va…
## $ taxonRank                     &lt;fct&gt; variety, variety, variety, variety, vari…
## $ identificationReferences      &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ morphospeciesID               &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ morphospeciesIDRemarks        &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ identificationQualifier       &lt;fct&gt; , , , , , , , , , , , , , , , , , , , , …
## $ remarks                       &lt;fct&gt; &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;corrected using 201…
## $ measuredBy                    &lt;fct&gt; krian@neoninc.org, krian@neoninc.org, kr…
## $ recordedBy                    &lt;fct&gt; kzias@field-ops.org, kzias@field-ops.org…
## $ dataQF                        &lt;fct&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ plotType                      &lt;fct&gt; tower, tower, tower, tower, tower, tower…
## $ subtype                       &lt;fct&gt; basePlot, basePlot, basePlot, basePlot, …
## $ plotLatitude                  &lt;dbl&gt; 45.76074, 45.76037, 45.76037, 45.76037, …
## $ plotLongitude                 &lt;dbl&gt; -122.3303, -122.3303, -122.3303, -122.33…
## $ datum                         &lt;fct&gt; WGS84, WGS84, WGS84, WGS84, WGS84, WGS84…
## $ utmZone                       &lt;fct&gt; 10N, 10N, 10N, 10N, 10N, 10N, 10N, 10N, …
## $ plotEasting                   &lt;dbl&gt; 552081.2, 552079.1, 552079.1, 552079.1, …
## $ plotNorthing                  &lt;dbl&gt; 5067683, 5067642, 5067642, 5067642, 5067…
## $ horzUncert                    &lt;dbl&gt; 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10…
## $ crdSource                     &lt;fct&gt; Geo 7X, Geo 7X, Geo 7X, Geo 7X, Geo 7X, …
## $ elevation                     &lt;dbl&gt; 363.22, 362.29, 362.29, 362.29, 362.34, …
## $ vertUncert                    &lt;dbl&gt; 0.10, 0.10, 0.10, 0.10, 0.10, 0.10, 0.10…
## $ nlcdClass                     &lt;fct&gt; evergreenForest, evergreenForest, evergr…
## $ appMods                       &lt;fct&gt; bbc|bgc|cdw|cfc|dhp|hbp|ltr|sme|vst, bbc…
## $ geometry                      &lt;fct&gt; &quot;c(-122.330278, 45.76074)&quot;, &quot;c(-122.3303…
## $ itcEasting                    &lt;dbl&gt; 552084.0, 552097.3, 552097.3, 552097.3, …
## $ itcNorthing                   &lt;dbl&gt; 5067682, 5067657, 5067657, 5067657, 5067…
## $ itcLongitude                  &lt;dbl&gt; -122.3302, -122.3301, -122.3301, -122.33…
## $ itcLatitude                   &lt;dbl&gt; 45.76073, 45.76051, 45.76051, 45.76051, …
## $ eventID                       &lt;fct&gt; vst_ABBY_2015, vst_ABBY_2016, vst_ABBY_2…
## $ tempShrubStemID               &lt;lgl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ tagStatus                     &lt;fct&gt; NA, ok, ok, ok, NA, NA, ok, ok, ok, NA, …
## $ growthForm                    &lt;fct&gt; single bole tree, single bole tree, sing…
## $ plantStatus                   &lt;fct&gt; &quot;Standing dead&quot;, &quot;Standing dead&quot;, &quot;Dead,…
## $ stemDiameter                  &lt;dbl&gt; 40.0, 90.0, 89.1, 88.3, 105.0, 28.3, 29.…
## $ measurementHeight             &lt;int&gt; 130, 130, 130, 130, 130, 130, 140, 130, …
## $ height                        &lt;dbl&gt; NA, 7.5, 6.7, 6.8, NA, NA, NA, 22.5, 21.…
## $ baseCrownHeight               &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ breakHeight                   &lt;dbl&gt; NA, NA, NA, 6.8, NA, NA, NA, NA, NA, NA,…
## $ breakDiameter                 &lt;dbl&gt; NA, NA, 61, NA, NA, NA, NA, NA, NA, NA, …
## $ maxCrownDiameter              &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ ninetyCrownDiameter           &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ canopyPosition                &lt;fct&gt; NA, , NA, NA, NA, NA, , NA, NA, NA, , NA…
## $ shape                         &lt;fct&gt; , , , , , , , , , , , , , , , , , , , , …
## $ basalStemDiameter             &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ basalStemDiameterMsrmntHeight &lt;int&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ maxBaseCrownDiameter          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ ninetyBaseCrownDiameter       &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ area                          &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
<p>Nice, there appears to be some useful data in here: <code>uid</code>, <code>siteID</code>, <code>plotID</code>, <code>stemDiameter</code>, <code>height</code>, <code>maxCrownDiameter</code>, <code>ninetyCrownDiameter</code>, <code>baseCrownHeight</code>, <code>plantStatus</code>, <code>taxonID</code></p>
<p>Also, I just found that there is a hidden function in the package to filter the field tree data</p>
<p>…except for I’m going to change the minimum diameter from 15 cm to 10 cm</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-load-and-explore.html#cb20-1" tabindex="-1"></a>clean_field_data<span class="ot">&lt;-</span><span class="cf">function</span>(field){</span>
<span id="cb20-2"><a href="data-load-and-explore.html#cb20-2" tabindex="-1"></a>  field<span class="sc">$</span>area<span class="ot">&lt;-</span>field<span class="sc">$</span>maxCrownDiameter<span class="sc">*</span>field<span class="sc">$</span>ninetyCrownDiameter</span>
<span id="cb20-3"><a href="data-load-and-explore.html#cb20-3" tabindex="-1"></a>  field<span class="ot">&lt;-</span>field <span class="sc">%&gt;%</span>  <span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(itcEasting),<span class="sc">!</span>stringr<span class="sc">::</span><span class="fu">str_detect</span>(eventID,<span class="st">&quot;2014&quot;</span>),growthForm <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;single bole tree&quot;</span>,<span class="st">&quot;multi-bole tree&quot;</span>,<span class="st">&quot;small tree&quot;</span>,<span class="st">&quot;sapling&quot;</span>),stemDiameter<span class="sc">&gt;</span><span class="dv">10</span>) <span class="sc">%&gt;%</span></span>
<span id="cb20-4"><a href="data-load-and-explore.html#cb20-4" tabindex="-1"></a>    <span class="fu">droplevels</span>() <span class="sc">%&gt;%</span></span>
<span id="cb20-5"><a href="data-load-and-explore.html#cb20-5" tabindex="-1"></a>    <span class="fu">filter</span>(height<span class="sc">&gt;</span><span class="dv">3</span><span class="sc">|</span><span class="fu">is.na</span>(height))</span>
<span id="cb20-6"><a href="data-load-and-explore.html#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="data-load-and-explore.html#cb20-7" tabindex="-1"></a>  <span class="co">#Limit difference in heights</span></span>
<span id="cb20-8"><a href="data-load-and-explore.html#cb20-8" tabindex="-1"></a>  to_remove<span class="ot">&lt;-</span>field <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(individualID) <span class="sc">%&gt;%</span></span>
<span id="cb20-9"><a href="data-load-and-explore.html#cb20-9" tabindex="-1"></a>    <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(height),<span class="at">sum_difference =</span> <span class="fu">abs</span>(<span class="fu">sum</span>(<span class="fu">diff</span>(height)))) <span class="sc">%&gt;%</span></span>
<span id="cb20-10"><a href="data-load-and-explore.html#cb20-10" tabindex="-1"></a>    <span class="fu">filter</span>(sum_difference <span class="sc">&gt;</span> <span class="dv">8</span>)</span>
<span id="cb20-11"><a href="data-load-and-explore.html#cb20-11" tabindex="-1"></a>  field<span class="ot">&lt;-</span>field <span class="sc">%&gt;%</span></span>
<span id="cb20-12"><a href="data-load-and-explore.html#cb20-12" tabindex="-1"></a>    <span class="fu">filter</span>(<span class="sc">!</span>individualID <span class="sc">%in%</span> to_remove<span class="sc">$</span>individualID)</span>
<span id="cb20-13"><a href="data-load-and-explore.html#cb20-13" tabindex="-1"></a>}</span></code></pre></div>
<p>clean this data and filter it</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-load-and-explore.html#cb21-1" tabindex="-1"></a><span class="co"># filter it</span></span>
<span id="cb21-2"><a href="data-load-and-explore.html#cb21-2" tabindex="-1"></a>field_trees <span class="ot">&lt;-</span> NeonTreeEvaluation<span class="sc">::</span>field <span class="sc">%&gt;%</span> </span>
<span id="cb21-3"><a href="data-load-and-explore.html#cb21-3" tabindex="-1"></a>  <span class="fu">clean_field_data</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-4"><a href="data-load-and-explore.html#cb21-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb21-5"><a href="data-load-and-explore.html#cb21-5" tabindex="-1"></a>    uid, siteID, plotID, stemDiameter</span>
<span id="cb21-6"><a href="data-load-and-explore.html#cb21-6" tabindex="-1"></a>    , height, maxCrownDiameter, ninetyCrownDiameter</span>
<span id="cb21-7"><a href="data-load-and-explore.html#cb21-7" tabindex="-1"></a>    , baseCrownHeight, plantStatus, taxonID</span>
<span id="cb21-8"><a href="data-load-and-explore.html#cb21-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb21-9"><a href="data-load-and-explore.html#cb21-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(maxCrownDiameter) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(height)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="data-load-and-explore.html#cb21-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">CrownRadius =</span> maxCrownDiameter<span class="sc">/</span><span class="dv">2</span>)</span>
<span id="cb21-11"><a href="data-load-and-explore.html#cb21-11" tabindex="-1"></a><span class="co"># see it</span></span>
<span id="cb21-12"><a href="data-load-and-explore.html#cb21-12" tabindex="-1"></a>field_trees <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 6,878
## Columns: 11
## $ uid                 &lt;fct&gt; b4305401-a7d9-4e79-afc4-a7f0c82e98d3, 346b66a5-cd8…
## $ siteID              &lt;fct&gt; ABBY, ABBY, ABBY, ABBY, ABBY, ABBY, ABBY, ABBY, AB…
## $ plotID              &lt;fct&gt; ABBY_007, ABBY_007, ABBY_007, ABBY_007, ABBY_007, …
## $ stemDiameter        &lt;dbl&gt; 68.2, 54.1, 54.7, 58.0, 68.1, 20.2, 15.6, 19.6, 18…
## $ height              &lt;dbl&gt; 49.6, 13.1, 22.9, 35.6, 50.2, 19.0, 10.8, 12.5, 9.…
## $ maxCrownDiameter    &lt;dbl&gt; 9.7, 3.2, 9.1, 9.5, 11.3, 8.6, 4.5, 4.7, 5.2, 4.3,…
## $ ninetyCrownDiameter &lt;dbl&gt; 8.5, 0.0, 7.8, 7.9, 6.7, 7.6, 4.2, 4.5, 4.8, 3.8, …
## $ baseCrownHeight     &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA…
## $ plantStatus         &lt;fct&gt; &quot;Live&quot;, &quot;Dead, broken bole&quot;, &quot;Live&quot;, &quot;Live&quot;, &quot;Live…
## $ taxonID             &lt;fct&gt; PSMEM, PSMEM, PSMEM, PSMEM, PSMEM, PSMEM, PSMEM, P…
## $ CrownRadius         &lt;dbl&gt; 4.85, 1.60, 4.55, 4.75, 5.65, 4.30, 2.25, 2.35, 2.…</code></pre>
<p>what are these data?</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-load-and-explore.html#cb23-1" tabindex="-1"></a>field_trees <span class="sc">%&gt;%</span> </span>
<span id="cb23-2"><a href="data-load-and-explore.html#cb23-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(dplyr<span class="sc">::</span><span class="fu">where</span>(is.numeric)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-3"><a href="data-load-and-explore.html#cb23-3" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##   stemDiameter        height      maxCrownDiameter ninetyCrownDiameter
##  Min.   : 15.10   Min.   : 3.10   Min.   : 0.100   Min.   : 0.000     
##  1st Qu.: 18.60   1st Qu.: 9.90   1st Qu.: 3.800   1st Qu.: 2.900     
##  Median : 23.30   Median :13.30   Median : 6.200   Median : 4.700     
##  Mean   : 27.44   Mean   :14.97   Mean   : 6.975   Mean   : 5.296     
##  3rd Qu.: 31.80   3rd Qu.:18.90   3rd Qu.: 9.200   3rd Qu.: 7.000     
##  Max.   :255.00   Max.   :52.90   Max.   :62.000   Max.   :31.000     
##                                                    NA&#39;s   :115        
##  baseCrownHeight  CrownRadius    
##  Min.   : NA     Min.   : 0.050  
##  1st Qu.: NA     1st Qu.: 1.900  
##  Median : NA     Median : 3.100  
##  Mean   :NaN     Mean   : 3.487  
##  3rd Qu.: NA     3rd Qu.: 4.600  
##  Max.   : NA     Max.   :31.000  
##  NA&#39;s   :6878</code></pre>
<p>status?</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="data-load-and-explore.html#cb25-1" tabindex="-1"></a>field_trees <span class="sc">%&gt;%</span> </span>
<span id="cb25-2"><a href="data-load-and-explore.html#cb25-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(plantStatus)</span></code></pre></div>
<pre><code>##                 plantStatus    n
## 1         Dead, broken bole   75
## 2                    Downed    2
## 3                      Live 5486
## 4       Live,  other damage  135
## 5         Live, broken bole   43
## 6     Live, disease damaged  199
## 7      Live, insect damaged  157
## 8  Live, physically damaged  154
## 9       No longer qualifies   12
## 10                  Removed    1
## 11            Standing dead  614</code></pre>
<p>keep only live</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-load-and-explore.html#cb27-1" tabindex="-1"></a>field_trees <span class="ot">&lt;-</span> field_trees <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="data-load-and-explore.html#cb27-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(plantStatus <span class="sc">%&gt;%</span> <span class="fu">tolower</span>() <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_starts</span>(<span class="st">&quot;live&quot;</span>))</span></code></pre></div>
<p>taxonID?</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-load-and-explore.html#cb28-1" tabindex="-1"></a>field_trees <span class="sc">%&gt;%</span> </span>
<span id="cb28-2"><a href="data-load-and-explore.html#cb28-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(taxonID) <span class="sc">%&gt;%</span> </span>
<span id="cb28-3"><a href="data-load-and-explore.html#cb28-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb28-4"><a href="data-load-and-explore.html#cb28-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n =</span> <span class="dv">20</span>)</span></code></pre></div>
<pre><code>##    taxonID   n
## 1    PICOL 535
## 2     PIEN 500
## 3     ACRU 367
## 4    ABLAL 333
## 5     LITU 270
## 6     QURU 267
## 7    LIST2 238
## 8     TSCA 211
## 9     QUAL 197
## 10   PIPA2 177
## 11   ACSA3 137
## 12   PIFL2 132
## 13   OXYDE 117
## 14   PSMEM  96
## 15    PITA  95
## 16    PSME  91
## 17   CATO6  88
## 18    PIMA  84
## 19   POTR5  81
## 20   JUNIP  80</code></pre>
<p>let’s see the height versus diameter relationship</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="data-load-and-explore.html#cb30-1" tabindex="-1"></a>field_trees <span class="sc">%&gt;%</span> </span>
<span id="cb30-2"><a href="data-load-and-explore.html#cb30-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> stemDiameter)) <span class="sc">+</span></span>
<span id="cb30-3"><a href="data-load-and-explore.html#cb30-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb30-4"><a href="data-load-and-explore.html#cb30-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb30-5"><a href="data-load-and-explore.html#cb30-5" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb30-6"><a href="data-load-and-explore.html#cb30-6" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-19-1.png" width="1008" /></p>
<p>let’s get conifer trees only???</p>
<p>….sure, i found a NEON plant list with the codes: <a href="https://data.neonscience.org/taxonomic-lists?taxonTypeCode=PLANT">https://data.neonscience.org/taxonomic-lists?taxonTypeCode=PLANT</a></p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-load-and-explore.html#cb31-1" tabindex="-1"></a>conifer_spp <span class="ot">&lt;-</span></span>
<span id="cb31-2"><a href="data-load-and-explore.html#cb31-2" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb31-3"><a href="data-load-and-explore.html#cb31-3" tabindex="-1"></a>    <span class="st">&quot;../data/OS_TAXON_PLANT-20220330T142149.csv&quot;</span></span>
<span id="cb31-4"><a href="data-load-and-explore.html#cb31-4" tabindex="-1"></a>    , <span class="at">show_col_types =</span> F</span>
<span id="cb31-5"><a href="data-load-and-explore.html#cb31-5" tabindex="-1"></a>    , <span class="at">progress =</span> F</span>
<span id="cb31-6"><a href="data-load-and-explore.html#cb31-6" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="data-load-and-explore.html#cb31-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(</span>
<span id="cb31-8"><a href="data-load-and-explore.html#cb31-8" tabindex="-1"></a>    <span class="fu">tolower</span>(family) <span class="sc">%in%</span> <span class="fu">c</span>(</span>
<span id="cb31-9"><a href="data-load-and-explore.html#cb31-9" tabindex="-1"></a>      <span class="st">&quot;pinaceae&quot;</span>, <span class="st">&quot;podocarpaceae&quot;</span>, <span class="st">&quot;araucariaceae&quot;</span></span>
<span id="cb31-10"><a href="data-load-and-explore.html#cb31-10" tabindex="-1"></a>      , <span class="st">&quot;taxaceae&quot;</span>, <span class="st">&quot;cephalotaxaceae&quot;</span>, <span class="st">&quot;taxodiaceae&quot;</span>, <span class="st">&quot;cupressaceae&quot;</span></span>
<span id="cb31-11"><a href="data-load-and-explore.html#cb31-11" tabindex="-1"></a>    )</span>
<span id="cb31-12"><a href="data-load-and-explore.html#cb31-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-13"><a href="data-load-and-explore.html#cb31-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb31-14"><a href="data-load-and-explore.html#cb31-14" tabindex="-1"></a>    <span class="at">taxonID =</span> <span class="fu">toupper</span>(taxonID)</span>
<span id="cb31-15"><a href="data-load-and-explore.html#cb31-15" tabindex="-1"></a>    , <span class="at">vernacularName =</span> <span class="fu">tolower</span>(vernacularName)</span>
<span id="cb31-16"><a href="data-load-and-explore.html#cb31-16" tabindex="-1"></a>    , <span class="at">genus =</span> stringr<span class="sc">::</span><span class="fu">str_to_title</span>(genus)</span>
<span id="cb31-17"><a href="data-load-and-explore.html#cb31-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="data-load-and-explore.html#cb31-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(taxonID, vernacularName, genus)</span>
<span id="cb31-19"><a href="data-load-and-explore.html#cb31-19" tabindex="-1"></a><span class="co"># huh?</span></span>
<span id="cb31-20"><a href="data-load-and-explore.html#cb31-20" tabindex="-1"></a>conifer_spp <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    taxonID vernacularName          genus      
##    &lt;chr&gt;   &lt;chr&gt;                   &lt;chr&gt;      
##  1 POCO3   yucca plum pine         Podocarpus 
##  2 PIST3   southwestern white pine Pinus      
##  3 TOTA    florida nutmeg          Torreya    
##  4 PIPI7   italian stone pine      Pinus      
##  5 JUVIS   southern redcedar       Juniperus  
##  6 PIST    eastern white pine      Pinus      
##  7 TABR2   pacific yew             Taxus      
##  8 PIMA    black spruce            Picea      
##  9 TSUGA   hemlock                 Tsuga      
## 10 MEGL8   dawn redwood            Metasequoia</code></pre>
<p>filter that field tree list for conifers</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="data-load-and-explore.html#cb33-1" tabindex="-1"></a>conifer_trees <span class="ot">&lt;-</span> field_trees <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="data-load-and-explore.html#cb33-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(conifer_spp, <span class="at">by =</span> <span class="st">&quot;taxonID&quot;</span>)</span></code></pre></div>
<p>check those conifers height and diameter</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="data-load-and-explore.html#cb34-1" tabindex="-1"></a>conifer_trees <span class="sc">%&gt;%</span> </span>
<span id="cb34-2"><a href="data-load-and-explore.html#cb34-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> stemDiameter, <span class="at">color =</span> genus)) <span class="sc">+</span></span>
<span id="cb34-3"><a href="data-load-and-explore.html#cb34-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb34-4"><a href="data-load-and-explore.html#cb34-4" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb34-5"><a href="data-load-and-explore.html#cb34-5" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb34-6"><a href="data-load-and-explore.html#cb34-6" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="at">facets =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(genus)) <span class="sc">+</span></span>
<span id="cb34-7"><a href="data-load-and-explore.html#cb34-7" tabindex="-1"></a>  <span class="fu">scale_color_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb34-8"><a href="data-load-and-explore.html#cb34-8" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span> </span>
<span id="cb34-9"><a href="data-load-and-explore.html#cb34-9" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-22-1.png" width="1008" /></p>
<p>what about this crown area data?</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="data-load-and-explore.html#cb35-1" tabindex="-1"></a>conifer_trees <span class="sc">%&gt;%</span> </span>
<span id="cb35-2"><a href="data-load-and-explore.html#cb35-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> CrownRadius, <span class="at">y =</span> genus, <span class="at">fill =</span> genus)) <span class="sc">+</span></span>
<span id="cb35-3"><a href="data-load-and-explore.html#cb35-3" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>(<span class="at">width =</span> <span class="fl">0.7</span>, <span class="at">outliers =</span> F) <span class="sc">+</span></span>
<span id="cb35-4"><a href="data-load-and-explore.html#cb35-4" tabindex="-1"></a>  <span class="fu">scale_fill_viridis_d</span>(<span class="at">option =</span> <span class="st">&quot;turbo&quot;</span>) <span class="sc">+</span></span>
<span id="cb35-5"><a href="data-load-and-explore.html#cb35-5" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span> </span>
<span id="cb35-6"><a href="data-load-and-explore.html#cb35-6" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-23-1.png" width="1008" /></p>
<p>radius data</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="data-load-and-explore.html#cb36-1" tabindex="-1"></a><span class="co"># height</span></span>
<span id="cb36-2"><a href="data-load-and-explore.html#cb36-2" tabindex="-1"></a>conifer_trees<span class="sc">$</span>height <span class="sc">%&gt;%</span> </span>
<span id="cb36-3"><a href="data-load-and-explore.html#cb36-3" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.5</span>,<span class="fl">0.95</span>,<span class="fl">0.99</span>))</span></code></pre></div>
<pre><code>##     1%     5%    50%    95%    99% 
##  3.500  5.600 11.500 25.210 41.753</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="data-load-and-explore.html#cb38-1" tabindex="-1"></a><span class="co"># radius</span></span>
<span id="cb38-2"><a href="data-load-and-explore.html#cb38-2" tabindex="-1"></a>conifer_trees<span class="sc">$</span>CrownRadius <span class="sc">%&gt;%</span> </span>
<span id="cb38-3"><a href="data-load-and-explore.html#cb38-3" tabindex="-1"></a>  <span class="fu">quantile</span>(<span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.01</span>,<span class="fl">0.05</span>,<span class="fl">0.5</span>,<span class="fl">0.95</span>,<span class="fl">0.99</span>))</span></code></pre></div>
<pre><code>##     1%     5%    50%    95%    99% 
## 0.8500 1.1000 2.0000 5.1000 6.6255</code></pre>
<p>let’s model crown radius based on height</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="data-load-and-explore.html#cb40-1" tabindex="-1"></a><span class="fu">lm</span>(<span class="at">formula =</span> CrownRadius <span class="sc">~</span> height, <span class="at">data =</span> conifer_trees) <span class="sc">%&gt;%</span> </span>
<span id="cb40-2"><a href="data-load-and-explore.html#cb40-2" tabindex="-1"></a>  broom<span class="sc">::</span><span class="fu">tidy</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb40-3"><a href="data-load-and-explore.html#cb40-3" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(<span class="at">digits =</span> <span class="dv">4</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb40-4"><a href="data-load-and-explore.html#cb40-4" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:left;">
term
</th>
<th style="text-align:right;">
estimate
</th>
<th style="text-align:right;">
std.error
</th>
<th style="text-align:right;">
statistic
</th>
<th style="text-align:right;">
p.value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
(Intercept)
</td>
<td style="text-align:right;">
1.0900
</td>
<td style="text-align:right;">
0.0464
</td>
<td style="text-align:right;">
23.5090
</td>
<td style="text-align:right;">
0
</td>
</tr>
<tr>
<td style="text-align:left;">
height
</td>
<td style="text-align:right;">
0.1014
</td>
<td style="text-align:right;">
0.0032
</td>
<td style="text-align:right;">
31.7895
</td>
<td style="text-align:right;">
0
</td>
</tr>
</tbody>
</table>
<p>plot this</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="data-load-and-explore.html#cb41-1" tabindex="-1"></a>conifer_trees <span class="sc">%&gt;%</span> </span>
<span id="cb41-2"><a href="data-load-and-explore.html#cb41-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> height, <span class="at">y =</span> CrownRadius)) <span class="sc">+</span></span>
<span id="cb41-3"><a href="data-load-and-explore.html#cb41-3" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb41-4"><a href="data-load-and-explore.html#cb41-4" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method =</span> <span class="st">&quot;lm&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-5"><a href="data-load-and-explore.html#cb41-5" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb41-6"><a href="data-load-and-explore.html#cb41-6" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="cn">NA</span>)) <span class="sc">+</span></span>
<span id="cb41-7"><a href="data-load-and-explore.html#cb41-7" tabindex="-1"></a>  <span class="fu">theme_light</span>() <span class="sc">+</span> </span>
<span id="cb41-8"><a href="data-load-and-explore.html#cb41-8" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-26-1.png" width="1008" /></p>
<p>what about a non-linear model?</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="data-load-and-explore.html#cb42-1" tabindex="-1"></a>crown_height_model <span class="ot">&lt;-</span> brms<span class="sc">::</span><span class="fu">brm</span>(</span>
<span id="cb42-2"><a href="data-load-and-explore.html#cb42-2" tabindex="-1"></a>  <span class="at">formula =</span> brms<span class="sc">::</span><span class="fu">bf</span>(</span>
<span id="cb42-3"><a href="data-load-and-explore.html#cb42-3" tabindex="-1"></a>    <span class="at">formula =</span> CrownRadius <span class="sc">~</span> (b1 <span class="sc">*</span> height) <span class="sc">+</span> height<span class="sc">^</span>b2</span>
<span id="cb42-4"><a href="data-load-and-explore.html#cb42-4" tabindex="-1"></a>    , b1 <span class="sc">+</span> b2 <span class="sc">~</span> <span class="dv">1</span></span>
<span id="cb42-5"><a href="data-load-and-explore.html#cb42-5" tabindex="-1"></a>    , <span class="at">nl =</span> <span class="cn">TRUE</span> <span class="co"># !! specify non-linear</span></span>
<span id="cb42-6"><a href="data-load-and-explore.html#cb42-6" tabindex="-1"></a>  )</span>
<span id="cb42-7"><a href="data-load-and-explore.html#cb42-7" tabindex="-1"></a>  , <span class="at">data =</span> conifer_trees</span>
<span id="cb42-8"><a href="data-load-and-explore.html#cb42-8" tabindex="-1"></a>  , <span class="at">family =</span> brms<span class="sc">::</span><span class="fu">brmsfamily</span>(<span class="st">&quot;Gamma&quot;</span>)</span>
<span id="cb42-9"><a href="data-load-and-explore.html#cb42-9" tabindex="-1"></a>  , <span class="at">iter =</span> <span class="dv">6000</span>, <span class="at">warmup =</span> <span class="dv">3000</span>, <span class="at">chains =</span> <span class="dv">4</span></span>
<span id="cb42-10"><a href="data-load-and-explore.html#cb42-10" tabindex="-1"></a>  , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb42-11"><a href="data-load-and-explore.html#cb42-11" tabindex="-1"></a>  , <span class="at">file =</span> <span class="st">&quot;../data/crown_height_model&quot;</span></span>
<span id="cb42-12"><a href="data-load-and-explore.html#cb42-12" tabindex="-1"></a>)</span>
<span id="cb42-13"><a href="data-load-and-explore.html#cb42-13" tabindex="-1"></a><span class="co"># plot(crown_height_model)</span></span>
<span id="cb42-14"><a href="data-load-and-explore.html#cb42-14" tabindex="-1"></a><span class="fu">summary</span>(crown_height_model)</span></code></pre></div>
<pre><code>##  Family: gamma 
##   Links: mu = log; shape = identity 
## Formula: CrownRadius ~ (b1 * height) + height^b2 
##          b1 ~ 1
##          b2 ~ 1
##    Data: conifer_trees (Number of observations: 2750) 
##   Draws: 4 chains, each with iter = 6000; warmup = 3000; thin = 1;
##          total post-warmup draws = 12000
## 
## Regression Coefficients:
##              Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## b1_Intercept     0.04      0.00     0.04     0.05 1.00     5784     6848
## b2_Intercept    -0.55      0.03    -0.61    -0.51 1.00     5397     5756
## 
## Further Distributional Parameters:
##       Estimate Est.Error l-95% CI u-95% CI Rhat Bulk_ESS Tail_ESS
## shape     5.72      0.15     5.43     6.02 1.00     6131     5494
## 
## Draws were sampled using sampling(NUTS). For each parameter, Bulk_ESS
## and Tail_ESS are effective sample size measures, and Rhat is the potential
## scale reduction factor on split chains (at convergence, Rhat = 1).</code></pre>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="data-load-and-explore.html#cb44-1" tabindex="-1"></a><span class="do">## write out model estimates to tabular file</span></span>
<span id="cb44-2"><a href="data-load-and-explore.html#cb44-2" tabindex="-1"></a><span class="do">#### extract posterior draws to a df</span></span>
<span id="cb44-3"><a href="data-load-and-explore.html#cb44-3" tabindex="-1"></a>brms<span class="sc">::</span><span class="fu">as_draws_df</span>(</span>
<span id="cb44-4"><a href="data-load-and-explore.html#cb44-4" tabindex="-1"></a>  crown_height_model</span>
<span id="cb44-5"><a href="data-load-and-explore.html#cb44-5" tabindex="-1"></a>  , <span class="at">variable =</span> <span class="fu">c</span>(<span class="st">&quot;^b_&quot;</span>, <span class="st">&quot;shape&quot;</span>)</span>
<span id="cb44-6"><a href="data-load-and-explore.html#cb44-6" tabindex="-1"></a>  , <span class="at">regex =</span> <span class="cn">TRUE</span></span>
<span id="cb44-7"><a href="data-load-and-explore.html#cb44-7" tabindex="-1"></a>) <span class="sc">%&gt;%</span> </span>
<span id="cb44-8"><a href="data-load-and-explore.html#cb44-8" tabindex="-1"></a>  <span class="co"># quick way to get a table of summary statistics and diagnostics</span></span>
<span id="cb44-9"><a href="data-load-and-explore.html#cb44-9" tabindex="-1"></a>  posterior<span class="sc">::</span><span class="fu">summarize_draws</span>(</span>
<span id="cb44-10"><a href="data-load-and-explore.html#cb44-10" tabindex="-1"></a>    <span class="st">&quot;mean&quot;</span>, <span class="st">&quot;median&quot;</span>, <span class="st">&quot;sd&quot;</span></span>
<span id="cb44-11"><a href="data-load-and-explore.html#cb44-11" tabindex="-1"></a>    ,  <span class="sc">~</span><span class="fu">quantile</span>(.x, <span class="at">probs =</span> <span class="fu">c</span>(</span>
<span id="cb44-12"><a href="data-load-and-explore.html#cb44-12" tabindex="-1"></a>      <span class="fl">0.05</span>, <span class="fl">0.95</span></span>
<span id="cb44-13"><a href="data-load-and-explore.html#cb44-13" tabindex="-1"></a>      , <span class="fl">0.025</span>, <span class="fl">0.975</span></span>
<span id="cb44-14"><a href="data-load-and-explore.html#cb44-14" tabindex="-1"></a>    ))</span>
<span id="cb44-15"><a href="data-load-and-explore.html#cb44-15" tabindex="-1"></a>    , <span class="st">&quot;rhat&quot;</span></span>
<span id="cb44-16"><a href="data-load-and-explore.html#cb44-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-17"><a href="data-load-and-explore.html#cb44-17" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb44-18"><a href="data-load-and-explore.html#cb44-18" tabindex="-1"></a>    <span class="at">variable =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(variable, <span class="st">&quot;_Intercept&quot;</span>)</span>
<span id="cb44-19"><a href="data-load-and-explore.html#cb44-19" tabindex="-1"></a>    , <span class="at">formula =</span> <span class="fu">summary</span>(crown_height_model)<span class="sc">$</span>formula <span class="sc">%&gt;%</span> </span>
<span id="cb44-20"><a href="data-load-and-explore.html#cb44-20" tabindex="-1"></a>      <span class="fu">as.character</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb44-21"><a href="data-load-and-explore.html#cb44-21" tabindex="-1"></a>      .[<span class="dv">1</span>]</span>
<span id="cb44-22"><a href="data-load-and-explore.html#cb44-22" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb44-23"><a href="data-load-and-explore.html#cb44-23" tabindex="-1"></a>  <span class="fu">write.csv</span>(</span>
<span id="cb44-24"><a href="data-load-and-explore.html#cb44-24" tabindex="-1"></a>    <span class="st">&quot;../data/crown_height_model.csv&quot;</span></span>
<span id="cb44-25"><a href="data-load-and-explore.html#cb44-25" tabindex="-1"></a>    , <span class="at">row.names =</span> F</span>
<span id="cb44-26"><a href="data-load-and-explore.html#cb44-26" tabindex="-1"></a>  )</span></code></pre></div>
<p>plot this</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="data-load-and-explore.html#cb45-1" tabindex="-1"></a><span class="fu">plot</span>(brms<span class="sc">::</span><span class="fu">conditional_effects</span>(crown_height_model), <span class="at">points =</span> T)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-28-1.png" width="1008" /></p>
<p>what if we try to plot it with a function using the regression coefficients?</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="data-load-and-explore.html#cb46-1" tabindex="-1"></a>ws_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb46-2"><a href="data-load-and-explore.html#cb46-2" tabindex="-1"></a>  y <span class="ot">=</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb46-3"><a href="data-load-and-explore.html#cb46-3" tabindex="-1"></a>    <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="fl">1e-3</span> <span class="co"># requires non-null</span></span>
<span id="cb46-4"><a href="data-load-and-explore.html#cb46-4" tabindex="-1"></a>    , x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fl">1e-3</span> <span class="co"># requires positive</span></span>
<span id="cb46-5"><a href="data-load-and-explore.html#cb46-5" tabindex="-1"></a>    , x <span class="sc">&lt;</span> <span class="fl">2.5</span> <span class="sc">~</span> <span class="dv">1</span> <span class="co"># set lower bound</span></span>
<span id="cb46-6"><a href="data-load-and-explore.html#cb46-6" tabindex="-1"></a>    , x <span class="sc">&gt;</span> <span class="dv">40</span> <span class="sc">~</span> <span class="fl">6.7</span>  <span class="co"># set upper bound</span></span>
<span id="cb46-7"><a href="data-load-and-explore.html#cb46-7" tabindex="-1"></a>    <span class="co"># , TRUE ~ 0.75 + (x * 0.14)</span></span>
<span id="cb46-8"><a href="data-load-and-explore.html#cb46-8" tabindex="-1"></a>    , <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fu">exp</span>( (<span class="fl">0.0446</span><span class="sc">*</span>x) <span class="sc">+</span> (x<span class="sc">^-</span><span class="fl">0.555</span>) ) <span class="co"># used gamma regression so exp the result</span></span>
<span id="cb46-9"><a href="data-load-and-explore.html#cb46-9" tabindex="-1"></a>  )</span>
<span id="cb46-10"><a href="data-load-and-explore.html#cb46-10" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb46-11"><a href="data-load-and-explore.html#cb46-11" tabindex="-1"></a>}</span></code></pre></div>
<p>plot it</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="data-load-and-explore.html#cb47-1" tabindex="-1"></a>ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">xlim</span>(<span class="dv">0</span>,<span class="dv">60</span>) <span class="sc">+</span> ggplot2<span class="sc">::</span><span class="fu">ylim</span>(<span class="dv">0</span>,<span class="cn">NA</span>) <span class="sc">+</span></span>
<span id="cb47-2"><a href="data-load-and-explore.html#cb47-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_point</span>(<span class="at">data =</span> conifer_trees, <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">y =</span> CrownRadius, <span class="at">x =</span> height)) <span class="sc">+</span></span>
<span id="cb47-3"><a href="data-load-and-explore.html#cb47-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_function</span>(<span class="at">fun =</span> ws_fn, <span class="at">lwd =</span> <span class="fl">1.5</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-30-1.png" width="1008" /></p>
<p><code>NeonTreeEvaluation::get_data</code> is a set of utility functions for finding the path of benchmark data on disk</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="data-load-and-explore.html#cb48-1" tabindex="-1"></a>NeonTreeEvaluation<span class="sc">::</span><span class="fu">get_data</span>(<span class="at">plot_name =</span> <span class="st">&quot;RMNP_047&quot;</span>, <span class="at">type =</span> <span class="st">&quot;lidar&quot;</span>)</span></code></pre></div>
<pre><code>## [1] &quot;C:/Program Files/R/R-4.3.0/library/NeonTreeEvaluation/extdata/NeonTreeEvaluation/evaluation/LiDAR/RMNP_047.laz&quot;</code></pre>
<p>let’s pull out all sites with <code>.laz</code> data and create a data frame for tracking purposes</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="data-load-and-explore.html#cb50-1" tabindex="-1"></a>las_df <span class="ot">&lt;-</span></span>
<span id="cb50-2"><a href="data-load-and-explore.html#cb50-2" tabindex="-1"></a>  <span class="fu">paste0</span>(<span class="fu">system.file</span>(<span class="at">package =</span> <span class="st">&quot;NeonTreeEvaluation&quot;</span>),<span class="st">&quot;/extdata/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-3"><a href="data-load-and-explore.html#cb50-3" tabindex="-1"></a>    <span class="fu">list.files</span>(<span class="at">recursive =</span> T, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>, <span class="at">full.names =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb50-4"><a href="data-load-and-explore.html#cb50-4" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-5"><a href="data-load-and-explore.html#cb50-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">as_tibble</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-6"><a href="data-load-and-explore.html#cb50-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f_path =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb50-7"><a href="data-load-and-explore.html#cb50-7" tabindex="-1"></a>    <span class="co"># create some other variables</span></span>
<span id="cb50-8"><a href="data-load-and-explore.html#cb50-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb50-9"><a href="data-load-and-explore.html#cb50-9" tabindex="-1"></a>      <span class="at">f_nm =</span> f_path <span class="sc">%&gt;%</span> <span class="fu">basename</span>() <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>)</span>
<span id="cb50-10"><a href="data-load-and-explore.html#cb50-10" tabindex="-1"></a>      , <span class="at">plot_nm =</span> f_nm <span class="sc">%&gt;%</span> <span class="co"># this matches the file name with the plot name </span></span>
<span id="cb50-11"><a href="data-load-and-explore.html#cb50-11" tabindex="-1"></a>        <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-12"><a href="data-load-and-explore.html#cb50-12" tabindex="-1"></a>        stringr<span class="sc">::</span><span class="fu">str_extract</span>(</span>
<span id="cb50-13"><a href="data-load-and-explore.html#cb50-13" tabindex="-1"></a>          <span class="at">pattern =</span> NeonTreeEvaluation<span class="sc">::</span><span class="fu">list_field_stems</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-14"><a href="data-load-and-explore.html#cb50-14" tabindex="-1"></a>            <span class="fu">toupper</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb50-15"><a href="data-load-and-explore.html#cb50-15" tabindex="-1"></a>            <span class="fu">paste</span>(<span class="at">collapse =</span> <span class="st">&quot;|&quot;</span>)</span>
<span id="cb50-16"><a href="data-load-and-explore.html#cb50-16" tabindex="-1"></a>        )</span>
<span id="cb50-17"><a href="data-load-and-explore.html#cb50-17" tabindex="-1"></a>      , <span class="at">neon_site =</span> plot_nm <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">word</span>(<span class="at">start =</span> <span class="dv">1</span>, <span class="at">sep =</span> <span class="fu">fixed</span>(<span class="st">&quot;_&quot;</span>))</span>
<span id="cb50-18"><a href="data-load-and-explore.html#cb50-18" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb50-19"><a href="data-load-and-explore.html#cb50-19" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(plot_nm)) <span class="sc">%&gt;%</span> <span class="co"># keep only las files with field stems</span></span>
<span id="cb50-20"><a href="data-load-and-explore.html#cb50-20" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(neon_site, plot_nm, f_nm, f_path)</span>
<span id="cb50-21"><a href="data-load-and-explore.html#cb50-21" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb50-22"><a href="data-load-and-explore.html#cb50-22" tabindex="-1"></a>las_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 278
## Columns: 4
## $ neon_site &lt;chr&gt; &quot;ABBY&quot;, &quot;ABBY&quot;, &quot;ABBY&quot;, &quot;ABBY&quot;, &quot;ABBY&quot;, &quot;BART&quot;, &quot;BART&quot;, &quot;BAR…
## $ plot_nm   &lt;chr&gt; &quot;ABBY_003&quot;, &quot;ABBY_008&quot;, &quot;ABBY_010&quot;, &quot;ABBY_023&quot;, &quot;ABBY_068&quot;, …
## $ f_nm      &lt;chr&gt; &quot;ABBY_003_2018&quot;, &quot;ABBY_008_2018&quot;, &quot;ABBY_010_2018&quot;, &quot;ABBY_023…
## $ f_path    &lt;chr&gt; &quot;C:/Program Files/R/R-4.3.0/library/NeonTreeEvaluation/extda…</code></pre>
<div id="explore-lidar-data-from-package" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Explore LiDAR data from package<a href="data-load-and-explore.html#explore-lidar-data-from-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>which NEON sites have data?</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="data-load-and-explore.html#cb52-1" tabindex="-1"></a>las_df <span class="sc">%&gt;%</span> </span>
<span id="cb52-2"><a href="data-load-and-explore.html#cb52-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(neon_site) <span class="sc">%&gt;%</span> </span>
<span id="cb52-3"><a href="data-load-and-explore.html#cb52-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-4"><a href="data-load-and-explore.html#cb52-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">neon_site =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(neon_site, n)) <span class="sc">%&gt;%</span> </span>
<span id="cb52-5"><a href="data-load-and-explore.html#cb52-5" tabindex="-1"></a>  <span class="co"># plot</span></span>
<span id="cb52-6"><a href="data-load-and-explore.html#cb52-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> neon_site, <span class="at">x =</span> n, <span class="at">fill =</span> n)) <span class="sc">+</span></span>
<span id="cb52-7"><a href="data-load-and-explore.html#cb52-7" tabindex="-1"></a>    <span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb52-8"><a href="data-load-and-explore.html#cb52-8" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;NEON site&quot;</span>, <span class="at">x =</span> <span class="st">&quot;lidar data plots&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-9"><a href="data-load-and-explore.html#cb52-9" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">scale_fill_continuous_tableau</span>(<span class="st">&quot;Gray&quot;</span>) <span class="sc">+</span></span>
<span id="cb52-10"><a href="data-load-and-explore.html#cb52-10" tabindex="-1"></a>    <span class="co"># paletteer::scale_fill_paletteer_c(&quot;harrypotter::gryffindor&quot;, direction = -1) +</span></span>
<span id="cb52-11"><a href="data-load-and-explore.html#cb52-11" tabindex="-1"></a>    ggthemes<span class="sc">::</span><span class="fu">theme_clean</span>() <span class="sc">+</span></span>
<span id="cb52-12"><a href="data-load-and-explore.html#cb52-12" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-33-1.png" width="1008" /></p>
<p>where is this data?</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="data-load-and-explore.html#cb53-1" tabindex="-1"></a>get_site_bbox <span class="ot">&lt;-</span> <span class="cf">function</span>(site, <span class="at">dta =</span> las_df) {</span>
<span id="cb53-2"><a href="data-load-and-explore.html#cb53-2" tabindex="-1"></a><span class="co"># read the las files for a site  </span></span>
<span id="cb53-3"><a href="data-load-and-explore.html#cb53-3" tabindex="-1"></a>  las_ctg <span class="ot">=</span> dta <span class="sc">%&gt;%</span> </span>
<span id="cb53-4"><a href="data-load-and-explore.html#cb53-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(neon_site <span class="sc">==</span> site) <span class="sc">%&gt;%</span> </span>
<span id="cb53-5"><a href="data-load-and-explore.html#cb53-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(f_path) <span class="sc">%&gt;%</span> </span>
<span id="cb53-6"><a href="data-load-and-explore.html#cb53-6" tabindex="-1"></a>    lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>()</span>
<span id="cb53-7"><a href="data-load-and-explore.html#cb53-7" tabindex="-1"></a><span class="co"># bbox that site</span></span>
<span id="cb53-8"><a href="data-load-and-explore.html#cb53-8" tabindex="-1"></a>  <span class="cf">if</span>( <span class="fu">is.na</span>( sf<span class="sc">::</span><span class="fu">st_crs</span>(las_ctg<span class="sc">@</span>data) ) ){</span>
<span id="cb53-9"><a href="data-load-and-explore.html#cb53-9" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb53-10"><a href="data-load-and-explore.html#cb53-10" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb53-11"><a href="data-load-and-explore.html#cb53-11" tabindex="-1"></a>    las_ctg<span class="sc">@</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb53-12"><a href="data-load-and-explore.html#cb53-12" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-13"><a href="data-load-and-explore.html#cb53-13" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-14"><a href="data-load-and-explore.html#cb53-14" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-15"><a href="data-load-and-explore.html#cb53-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">neon_site =</span> site)  <span class="sc">%&gt;%</span> </span>
<span id="cb53-16"><a href="data-load-and-explore.html#cb53-16" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_set_crs</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(las_ctg<span class="sc">@</span>data)) <span class="sc">%&gt;%</span> </span>
<span id="cb53-17"><a href="data-load-and-explore.html#cb53-17" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">paste0</span>(<span class="st">&quot;EPSG:&quot;</span>, <span class="dv">5070</span>))</span>
<span id="cb53-18"><a href="data-load-and-explore.html#cb53-18" tabindex="-1"></a>  }</span>
<span id="cb53-19"><a href="data-load-and-explore.html#cb53-19" tabindex="-1"></a>}</span>
<span id="cb53-20"><a href="data-load-and-explore.html#cb53-20" tabindex="-1"></a><span class="co"># take this for a spin</span></span>
<span id="cb53-21"><a href="data-load-and-explore.html#cb53-21" tabindex="-1"></a>las_df <span class="sc">%&gt;%</span></span>
<span id="cb53-22"><a href="data-load-and-explore.html#cb53-22" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(neon_site) <span class="sc">%&gt;%</span></span>
<span id="cb53-23"><a href="data-load-and-explore.html#cb53-23" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb53-24"><a href="data-load-and-explore.html#cb53-24" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(get_site_bbox) <span class="sc">%&gt;%</span> </span>
<span id="cb53-25"><a href="data-load-and-explore.html#cb53-25" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-26"><a href="data-load-and-explore.html#cb53-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">left_join</span>(</span>
<span id="cb53-27"><a href="data-load-and-explore.html#cb53-27" tabindex="-1"></a>    las_df <span class="sc">%&gt;%</span> </span>
<span id="cb53-28"><a href="data-load-and-explore.html#cb53-28" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(neon_site) <span class="sc">%&gt;%</span> </span>
<span id="cb53-29"><a href="data-load-and-explore.html#cb53-29" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">n</span>())</span>
<span id="cb53-30"><a href="data-load-and-explore.html#cb53-30" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;neon_site&quot;</span></span>
<span id="cb53-31"><a href="data-load-and-explore.html#cb53-31" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb53-32"><a href="data-load-and-explore.html#cb53-32" tabindex="-1"></a>  <span class="fu">st_centroid</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb53-33"><a href="data-load-and-explore.html#cb53-33" tabindex="-1"></a>  mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb53-34"><a href="data-load-and-explore.html#cb53-34" tabindex="-1"></a>    <span class="at">zcol =</span> <span class="st">&quot;n&quot;</span></span>
<span id="cb53-35"><a href="data-load-and-explore.html#cb53-35" tabindex="-1"></a>    , <span class="at">layer.name =</span> <span class="st">&quot;LiDAR plots&quot;</span></span>
<span id="cb53-36"><a href="data-load-and-explore.html#cb53-36" tabindex="-1"></a>    , <span class="at">label =</span> <span class="fu">c</span>(<span class="st">&quot;neon_site&quot;</span>)</span>
<span id="cb53-37"><a href="data-load-and-explore.html#cb53-37" tabindex="-1"></a>    , <span class="at">col.regions =</span> viridis<span class="sc">::</span><span class="fu">mako</span>(<span class="dv">10</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)</span>
<span id="cb53-38"><a href="data-load-and-explore.html#cb53-38" tabindex="-1"></a>  )</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-9dcf5ce44a4c9fa71fe1" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-9dcf5ce44a4c9fa71fe1">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["point",440]},{"method":"addCircleMarkers","args":[[45.7604365371426,44.05134228611964,39.08441923650567,65.15580106715423,32.53146987229301,35.63657407348276,17.97016335836158,42.48178459977508,63.8730700576182,31.19755391134177,18.03446131564425,31.83288133103487,37.39485338226996,29.69467221927716,19.55176532568917,40.21768034597346,38.88174906720172,38.88903715244572,37.03334948861171,32.93127899686993,37.00036908866564,46.23181219215382],[-122.354988357329,-71.28321396065959,-77.96444171329743,-147.5046299578157,-87.80909504367152,-83.55862176680898,-66.85011338901158,-72.21990895355928,-149.2878858987199,-84.46375895717473,-67.06682374881446,-88.18132552074428,-80.53072406777669,-81.97208079047266,-155.3177383431732,-105.5072086703649,-78.14448685530846,-76.55092900230224,-119.263296547448,-87.42350315755769,-119.0025432518736,-89.53653678808381],6,null,"LiDAR plots",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"point","stroke":true,"color":"#333333","weight":1,"opacity":[0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9,0.9],"fill":true,"fillColor":["#79D3B3","#79D3B3","#4DC1AC","#DEF5E5","#201324","#79D3B3","#40498E","#79D3B3","#DEF5E5","#DEF5E5","#DEF5E5","#38619A","#312446","#4DC1AC","#AFE4C3","#38619A","#3C3569","#0B0405","#79D3B3","#40498E","#DEF5E5","#AFE4C3"],"fillOpacity":[0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6,0.6]},null,null,["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>ABBY&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>BART&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>3&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>BLAN&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 9&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>4&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>BONA&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>5&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>DELA&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>33&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>6&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>GRSM&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 7&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>7&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>GUAN&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>25&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>8&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>HARV&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>9&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>HEAL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>10&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>JERC&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>11&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>LAJA&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>12&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>LENO&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>22&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>13&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>MLBS&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>32&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>14&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>OSBS&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 9&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>15&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>PUUM&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>16&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>RMNP&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>21&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>17&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>SCBI&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>28&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>18&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>SERC&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>36&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>19&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>SOAP&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 5&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>20&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>TALL&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td>24&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>21&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>TEAK&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 1&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>22&emsp;<\/td><\/tr><tr><td>1<\/td><th>neon_site&emsp;<\/th><td>UNDE&emsp;<\/td><\/tr><tr><td>2<\/td><th>n&emsp;<\/th><td> 3&emsp;<\/td><\/tr><tr><td>3<\/td><th>x&emsp;<\/th><td>sfc_POINT&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["ABBY","BART","BLAN","BONA","DELA","GRSM","GUAN","HARV","HEAL","JERC","LAJA","LENO","MLBS","OSBS","PUUM","RMNP","SCBI","SERC","SOAP","TALL","TEAK","UNDE"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},null]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLayersControl","args":[["Esri.WorldImagery","OpenStreetMap"],"LiDAR plots",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#DEF5E5 , #9CDEBD 11.4285714285714%, #4BBFAC 25.7142857142857%, #3697A8 40%, #376D9E 54.2857142857143%, #3F4485 68.5714285714286%, #322548 82.8571428571429%, #140A13 97.1428571428571%, #0B0405 "],"labels":["5","10","15","20","25","30","35"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"numeric","title":"LiDAR plots","extra":{"p_1":0.1142857142857143,"p_n":0.9714285714285714},"layerId":null,"className":"info legend","group":"LiDAR plots"}]}],"limits":{"lat":[17.97016335836158,65.15580106715423],"lng":[-155.3177383431732,-66.85011338901158]},"fitBounds":[17.97016335836158,-155.3177383431732,65.15580106715423,-66.85011338901158,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>load one las data</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="data-load-and-explore.html#cb54-1" tabindex="-1"></a>f_temp <span class="ot">=</span> las_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">pull</span>(f_path)</span>
<span id="cb54-2"><a href="data-load-and-explore.html#cb54-2" tabindex="-1"></a>las_temp <span class="ot">=</span> lidR<span class="sc">::</span><span class="fu">readLAS</span>(f_temp)</span>
<span id="cb54-3"><a href="data-load-and-explore.html#cb54-3" tabindex="-1"></a><span class="co"># quick summary</span></span>
<span id="cb54-4"><a href="data-load-and-explore.html#cb54-4" tabindex="-1"></a>las_temp</span></code></pre></div>
<pre><code>## class        : LAS (v1.2 format 3)
## memory       : 3.9 Mb 
## extent       : 256652, 256692, 2163715, 2163755 (xmin, xmax, ymin, ymax)
## coord. ref.  : WGS 84 / UTM zone 5N 
## area         : 1669 m²
## points       : 54 thousand points
## density      : 32.34 points/m²
## density      : 8.87 pulses/m²</code></pre>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="data-load-and-explore.html#cb56-1" tabindex="-1"></a><span class="co"># data str</span></span>
<span id="cb56-2"><a href="data-load-and-explore.html#cb56-2" tabindex="-1"></a>las_temp<span class="sc">@</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb56-3"><a href="data-load-and-explore.html#cb56-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 53,971
## Columns: 19
## $ X                 &lt;dbl&gt; 256652.4, 256652.3, 256652.7, 256653.0, 256653.4, 25…
## $ Y                 &lt;dbl&gt; 2163716, 2163716, 2163716, 2163716, 2163716, 2163715…
## $ Z                 &lt;dbl&gt; 1712.01, 1710.00, 1712.02, 1710.31, 1710.48, 1709.78…
## $ gpstime           &lt;dbl&gt; 513919.6, 513919.6, 513919.6, 513919.6, 513919.6, 51…
## $ Intensity         &lt;int&gt; 12, 2, 1, 19, 1, 5, 80, 314, 314, 265, 179, 313, 295…
## $ ReturnNumber      &lt;int&gt; 2, 3, 3, 4, 4, 4, 4, 2, 2, 2, 2, 2, 1, 1, 1, 2, 2, 3…
## $ NumberOfReturns   &lt;int&gt; 3, 3, 3, 4, 4, 4, 4, 2, 2, 2, 2, 2, 1, 1, 1, 2, 2, 3…
## $ ScanDirectionFlag &lt;int&gt; 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1…
## $ EdgeOfFlightline  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Classification    &lt;int&gt; 5, 2, 5, 1, 1, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2, 2…
## $ Synthetic_flag    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ Keypoint_flag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ Withheld_flag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ ScanAngleRank     &lt;int&gt; 0, 0, 0, 0, 0, -1, -1, -1, -1, -1, -1, -1, -1, -1, -…
## $ UserData          &lt;int&gt; 21, 0, 21, 5, 7, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…
## $ PointSourceID     &lt;int&gt; 26311, 26311, 26311, 26311, 26311, 26311, 26311, 263…
## $ R                 &lt;int&gt; 10752, 10752, 45056, 45312, 50688, 26880, 35072, 509…
## $ G                 &lt;int&gt; 14336, 14336, 49664, 49920, 52224, 32768, 35840, 527…
## $ B                 &lt;int&gt; 13056, 13056, 45568, 45056, 50688, 33792, 30208, 506…</code></pre>
<p>summarize x, y, z</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="data-load-and-explore.html#cb58-1" tabindex="-1"></a>las_temp<span class="sc">@</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb58-2"><a href="data-load-and-explore.html#cb58-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y,Z) <span class="sc">%&gt;%</span> </span>
<span id="cb58-3"><a href="data-load-and-explore.html#cb58-3" tabindex="-1"></a>  <span class="fu">summary</span>()</span></code></pre></div>
<pre><code>##        X                Y                 Z       
##  Min.   :256652   Min.   :2163716   Min.   :1704  
##  1st Qu.:256662   1st Qu.:2163726   1st Qu.:1712  
##  Median :256673   Median :2163736   Median :1721  
##  Mean   :256672   Mean   :2163736   Mean   :1720  
##  3rd Qu.:256682   3rd Qu.:2163746   3rd Qu.:1726  
##  Max.   :256692   Max.   :2163756   Max.   :1737</code></pre>
<p>plot this las</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="data-load-and-explore.html#cb60-1" tabindex="-1"></a>plot3D<span class="sc">::</span><span class="fu">scatter3D</span>(</span>
<span id="cb60-2"><a href="data-load-and-explore.html#cb60-2" tabindex="-1"></a>  <span class="at">x =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>X</span>
<span id="cb60-3"><a href="data-load-and-explore.html#cb60-3" tabindex="-1"></a>  , <span class="at">y =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>Y</span>
<span id="cb60-4"><a href="data-load-and-explore.html#cb60-4" tabindex="-1"></a>  , <span class="at">z =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>Z</span>
<span id="cb60-5"><a href="data-load-and-explore.html#cb60-5" tabindex="-1"></a>  , <span class="at">colvar =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>Z</span>
<span id="cb60-6"><a href="data-load-and-explore.html#cb60-6" tabindex="-1"></a>  , <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.3</span></span>
<span id="cb60-7"><a href="data-load-and-explore.html#cb60-7" tabindex="-1"></a>  , <span class="at">colkey =</span> F</span>
<span id="cb60-8"><a href="data-load-and-explore.html#cb60-8" tabindex="-1"></a>  , <span class="at">phi =</span> <span class="fl">0.5</span></span>
<span id="cb60-9"><a href="data-load-and-explore.html#cb60-9" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-37-1.png" width="1008" /></p>
<p>let’s look at the classification (see <a href="https://www.usgs.gov/ngp-standards-and-specifications/lidar-base-specification-tables">table 5 here</a>)</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="data-load-and-explore.html#cb61-1" tabindex="-1"></a>las_temp<span class="sc">@</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb61-2"><a href="data-load-and-explore.html#cb61-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(Classification)</span></code></pre></div>
<pre><code>##    Classification     n
##             &lt;int&gt; &lt;int&gt;
## 1:              1  2231
## 2:              2  7240
## 3:              5 44500</code></pre>
<p>plot color by classification</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="data-load-and-explore.html#cb63-1" tabindex="-1"></a>plot3D<span class="sc">::</span><span class="fu">scatter3D</span>(</span>
<span id="cb63-2"><a href="data-load-and-explore.html#cb63-2" tabindex="-1"></a>  <span class="at">x =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>X</span>
<span id="cb63-3"><a href="data-load-and-explore.html#cb63-3" tabindex="-1"></a>  , <span class="at">y =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>Y</span>
<span id="cb63-4"><a href="data-load-and-explore.html#cb63-4" tabindex="-1"></a>  , <span class="at">z =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>Z</span>
<span id="cb63-5"><a href="data-load-and-explore.html#cb63-5" tabindex="-1"></a>  , <span class="at">colvar =</span> las_temp<span class="sc">@</span>data<span class="sc">$</span>Classification</span>
<span id="cb63-6"><a href="data-load-and-explore.html#cb63-6" tabindex="-1"></a>  , <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">cex =</span> <span class="fl">0.3</span></span>
<span id="cb63-7"><a href="data-load-and-explore.html#cb63-7" tabindex="-1"></a>  , <span class="at">colkey =</span> F</span>
<span id="cb63-8"><a href="data-load-and-explore.html#cb63-8" tabindex="-1"></a>  , <span class="at">phi =</span> <span class="fl">0.5</span></span>
<span id="cb63-9"><a href="data-load-and-explore.html#cb63-9" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-39-1.png" width="1008" /></p>
</div>
</div>
<div id="cloud2trees" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> <code>cloud2trees</code><a href="data-load-and-explore.html#cloud2trees" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <a href="https://github.com/georgewoolsey/cloud2trees"><code>cloud2trees</code></a> package provides routines for processing point cloud data (.las|.laz format) to detect forest trees.</p>
<p>let’s use it for one of the data sets from a conifer forest in the <code>NeonTreeEvaluation</code> benchmark</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="data-load-and-explore.html#cb64-1" tabindex="-1"></a><span class="co"># get one file</span></span>
<span id="cb64-2"><a href="data-load-and-explore.html#cb64-2" tabindex="-1"></a>(f_temp <span class="ot">&lt;-</span> las_df <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="data-load-and-explore.html#cb64-3" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(neon_site<span class="sc">==</span><span class="st">&quot;RMNP&quot;</span>) <span class="sc">%&gt;%</span>  <span class="co"># rocky mtn national park</span></span>
<span id="cb64-4"><a href="data-load-and-explore.html#cb64-4" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">slice_sample</span>(<span class="at">n =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="data-load-and-explore.html#cb64-5" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">pull</span>(f_path))</span></code></pre></div>
<pre><code>## [1] &quot;C:/Program Files/R/R-4.3.0/library/NeonTreeEvaluation/extdata/NeonTreeEvaluation/evaluation/LiDAR/RMNP_019_2018.laz&quot;</code></pre>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="data-load-and-explore.html#cb66-1" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb66-2"><a href="data-load-and-explore.html#cb66-2" tabindex="-1"></a>las_temp <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">readLAS</span>(f_temp)</span></code></pre></div>
<p>what is this data?</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="data-load-and-explore.html#cb67-1" tabindex="-1"></a>las_temp<span class="sc">@</span>data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 37,151
## Columns: 16
## $ X                 &lt;dbl&gt; 458190.6, 458190.2, 458189.9, 458202.3, 458202.0, 45…
## $ Y                 &lt;dbl&gt; 4449607, 4449607, 4449607, 4449607, 4449607, 4449607…
## $ Z                 &lt;dbl&gt; 2651.887, 2651.754, 2651.798, 2647.305, 2647.261, 26…
## $ gpstime           &lt;dbl&gt; 424047.8, 424047.8, 424047.8, 424047.8, 424047.8, 42…
## $ Intensity         &lt;int&gt; 67, 75, 209, 239, 200, 215, 249, 25, 221, 159, 43, 3…
## $ ReturnNumber      &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 2, 1, 2, 1, 2, 3, 1, 1, 1, 1…
## $ NumberOfReturns   &lt;int&gt; 2, 2, 2, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 1, 1, 1, 1…
## $ ScanDirectionFlag &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ EdgeOfFlightline  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Classification    &lt;int&gt; 5, 5, 5, 2, 2, 2, 2, 1, 2, 5, 2, 1, 1, 2, 2, 2, 2, 2…
## $ Synthetic_flag    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ Keypoint_flag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ Withheld_flag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ ScanAngleRank     &lt;int&gt; 12, 12, 12, 13, 12, 12, 12, 12, 12, 12, 12, 12, 12, …
## $ UserData          &lt;int&gt; 48, 47, 47, 0, 0, 0, 0, 19, 0, 21, 0, 17, 11, 0, 0, …
## $ PointSourceID     &lt;int&gt; 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, …</code></pre>
<p>We can plot the point cloud with and color by the point height</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="data-load-and-explore.html#cb69-1" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb69-2"><a href="data-load-and-explore.html#cb69-2" tabindex="-1"></a>  las_temp</span>
<span id="cb69-3"><a href="data-load-and-explore.html#cb69-3" tabindex="-1"></a> , <span class="at">color =</span> <span class="st">&quot;Z&quot;</span>, <span class="at">breaks =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="at">legend =</span> T</span>
<span id="cb69-4"><a href="data-load-and-explore.html#cb69-4" tabindex="-1"></a> , <span class="at">pal =</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">house =</span> <span class="st">&quot;gryffindor&quot;</span>)</span>
<span id="cb69-5"><a href="data-load-and-explore.html#cb69-5" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-44-1.png" width="1008" /></p>
<p>notice the Z values are in meters above sea level</p>
<div id="get-tree-list-and-normalized-cloud" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Get tree list and normalized cloud<a href="data-load-and-explore.html#get-tree-list-and-normalized-cloud" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll use the <code>cloud2trees::cloud2trees()</code> function to get a tree list from the lidar data with a regional estimate of the DBH because we enabled the <code>estimate_tree_dbh</code> parameter. Also returned is a canopy height model (CHM) raster and because we enabled the <code>keep_intrmdt</code> parameter we’ll get the normalized point cloud data as well.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="data-load-and-explore.html#cb70-1" tabindex="-1"></a>cloud2trees_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2trees</span>(</span>
<span id="cb70-2"><a href="data-load-and-explore.html#cb70-2" tabindex="-1"></a>  <span class="at">input_las_dir =</span> f_temp</span>
<span id="cb70-3"><a href="data-load-and-explore.html#cb70-3" tabindex="-1"></a>  , <span class="at">output_dir =</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb70-4"><a href="data-load-and-explore.html#cb70-4" tabindex="-1"></a>  , <span class="at">estimate_tree_dbh =</span> T</span>
<span id="cb70-5"><a href="data-load-and-explore.html#cb70-5" tabindex="-1"></a>  , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb70-6"><a href="data-load-and-explore.html#cb70-6" tabindex="-1"></a>)</span></code></pre></div>
<p>let’s see what we got</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="data-load-and-explore.html#cb71-1" tabindex="-1"></a><span class="fu">names</span>(cloud2trees_ans)</span></code></pre></div>
<pre><code>## [1] &quot;crowns_sf&quot;   &quot;treetops_sf&quot; &quot;dtm_rast&quot;    &quot;chm_rast&quot;</code></pre>
<p>we got a CHM</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="data-load-and-explore.html#cb73-1" tabindex="-1"></a><span class="co"># could make an easy plot with...</span></span>
<span id="cb73-2"><a href="data-load-and-explore.html#cb73-2" tabindex="-1"></a><span class="co"># terra::plot(cloud2trees_ans$chm_rast)</span></span>
<span id="cb73-3"><a href="data-load-and-explore.html#cb73-3" tabindex="-1"></a><span class="co"># ...but we&#39;ll customize and save it as our base plot</span></span>
<span id="cb73-4"><a href="data-load-and-explore.html#cb73-4" tabindex="-1"></a>plt_chm <span class="ot">&lt;-</span> </span>
<span id="cb73-5"><a href="data-load-and-explore.html#cb73-5" tabindex="-1"></a>  <span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb73-6"><a href="data-load-and-explore.html#cb73-6" tabindex="-1"></a>    <span class="fu">geom_tile</span>(</span>
<span id="cb73-7"><a href="data-load-and-explore.html#cb73-7" tabindex="-1"></a>      <span class="at">data =</span> cloud2trees_ans<span class="sc">$</span>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb73-8"><a href="data-load-and-explore.html#cb73-8" tabindex="-1"></a>        <span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb73-9"><a href="data-load-and-explore.html#cb73-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>)</span>
<span id="cb73-10"><a href="data-load-and-explore.html#cb73-10" tabindex="-1"></a>      , <span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x=</span>x,<span class="at">y=</span>y,<span class="at">fill=</span>f)</span>
<span id="cb73-11"><a href="data-load-and-explore.html#cb73-11" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb73-12"><a href="data-load-and-explore.html#cb73-12" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp</span>(<span class="st">&quot;gryffindor&quot;</span>, <span class="at">name =</span> <span class="st">&quot;height (m)&quot;</span>) <span class="sc">+</span></span>
<span id="cb73-13"><a href="data-load-and-explore.html#cb73-13" tabindex="-1"></a>    <span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb73-14"><a href="data-load-and-explore.html#cb73-14" tabindex="-1"></a>    <span class="fu">theme</span>(</span>
<span id="cb73-15"><a href="data-load-and-explore.html#cb73-15" tabindex="-1"></a>      <span class="at">axis.text =</span> <span class="fu">element_blank</span>()</span>
<span id="cb73-16"><a href="data-load-and-explore.html#cb73-16" tabindex="-1"></a>    )</span>
<span id="cb73-17"><a href="data-load-and-explore.html#cb73-17" tabindex="-1"></a><span class="co"># view</span></span>
<span id="cb73-18"><a href="data-load-and-explore.html#cb73-18" tabindex="-1"></a>plt_chm</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-47-1.png" width="1008" /></p>
<p>we also got tree top points</p>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="data-load-and-explore.html#cb74-1" tabindex="-1"></a>plt_chm <span class="sc">+</span></span>
<span id="cb74-2"><a href="data-load-and-explore.html#cb74-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> cloud2trees_ans<span class="sc">$</span>treetops_sf, <span class="at">shape =</span> <span class="st">&quot;x&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-48-1.png" width="1008" /></p>
<p>and we got tree crowns</p>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="data-load-and-explore.html#cb75-1" tabindex="-1"></a>plt_chm <span class="sc">+</span></span>
<span id="cb75-2"><a href="data-load-and-explore.html#cb75-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> cloud2trees_ans<span class="sc">$</span>treetops_sf, <span class="at">shape =</span> <span class="st">&quot;x&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb75-3"><a href="data-load-and-explore.html#cb75-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> cloud2trees_ans<span class="sc">$</span>crowns_sf, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-49-1.png" width="1008" /></p>
<p>there is data on the individual trees in the crowns and tree tops data (which are the same data but one spaltial polygons and the other is spatial points).</p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="data-load-and-explore.html#cb76-1" tabindex="-1"></a>cloud2trees_ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb76-2"><a href="data-load-and-explore.html#cb76-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 166
## Columns: 20
## $ treeID                    &lt;chr&gt; &quot;1_458168.6_4449639.6&quot;, &quot;2_458183.1_4449639.…
## $ tree_height_m             &lt;dbl&gt; 3.519, 4.647, 3.115, 3.519, 6.586, 6.199, 6.…
## $ tree_x                    &lt;dbl&gt; 458168.6, 458183.1, 458170.4, 458169.1, 4581…
## $ tree_y                    &lt;dbl&gt; 4449640, 4449640, 4449639, 4449639, 4449639,…
## $ crown_area_m2             &lt;dbl&gt; 0.3125, 0.3750, 0.8750, 0.5625, 1.6875, 1.00…
## $ geometry                  &lt;GEOMETRY [m]&gt; POLYGON ((458168.5 4449640,..., POL…
## $ fia_est_dbh_cm            &lt;dbl&gt; 5.489898, 6.921271, 4.967770, 5.489898, 9.82…
## $ fia_est_dbh_cm_lower      &lt;dbl&gt; 3.503191, 4.484949, 3.180029, 3.503191, 6.30…
## $ fia_est_dbh_cm_upper      &lt;dbl&gt; 7.792940, 9.867350, 7.089027, 7.792940, 14.0…
## $ dbh_cm                    &lt;dbl&gt; 5.489898, 6.921271, 4.967770, 5.489898, 9.82…
## $ is_training_data          &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FA…
## $ dbh_m                     &lt;dbl&gt; 0.05489898, 0.06921271, 0.04967770, 0.054898…
## $ radius_m                  &lt;dbl&gt; 0.02744949, 0.03460636, 0.02483885, 0.027449…
## $ basal_area_m2             &lt;dbl&gt; 0.002367110, 0.003762371, 0.001938264, 0.002…
## $ basal_area_ft2            &lt;dbl&gt; 0.02547957, 0.04049816, 0.02086347, 0.025479…
## $ ptcld_extracted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ ptcld_predicted_dbh_cm    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ comp_trees_per_ha         &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ comp_relative_tree_height &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …
## $ comp_dist_to_nearest_m    &lt;dbl&gt; NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, NA, …</code></pre>
<p>let’s check the height to DBH relationship</p>
<div class="sourceCode" id="cb78"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb78-1"><a href="data-load-and-explore.html#cb78-1" tabindex="-1"></a>cloud2trees_ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb78-2"><a href="data-load-and-explore.html#cb78-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="at">mapping =</span> <span class="fu">aes</span>(<span class="at">x =</span> tree_height_m, <span class="at">y =</span> dbh_cm)) <span class="sc">+</span></span>
<span id="cb78-3"><a href="data-load-and-explore.html#cb78-3" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">color =</span> <span class="st">&quot;navy&quot;</span>) <span class="sc">+</span></span>
<span id="cb78-4"><a href="data-load-and-explore.html#cb78-4" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;height (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;DBH (cm)&quot;</span>) <span class="sc">+</span></span>
<span id="cb78-5"><a href="data-load-and-explore.html#cb78-5" tabindex="-1"></a>    <span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-51-1.png" width="1008" /></p>
<p>this all looks great.</p>
<p>let’s check the normalized point cloud. for that we’ll dig in the output directory from the <code>cloud2trees::cloud2trees()</code> function (see that <code>output_dir</code> parameter).</p>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="data-load-and-explore.html#cb79-1" tabindex="-1"></a>(n_f_temp <span class="ot">&lt;-</span> <span class="fu">list.files</span>(</span>
<span id="cb79-2"><a href="data-load-and-explore.html#cb79-2" tabindex="-1"></a>  <span class="st">&quot;../data/point_cloud_processing_temp/02_normalize/&quot;</span></span>
<span id="cb79-3"><a href="data-load-and-explore.html#cb79-3" tabindex="-1"></a>  , <span class="at">pattern =</span> <span class="st">&quot;.las&quot;</span></span>
<span id="cb79-4"><a href="data-load-and-explore.html#cb79-4" tabindex="-1"></a>  , <span class="at">full.names =</span> T</span>
<span id="cb79-5"><a href="data-load-and-explore.html#cb79-5" tabindex="-1"></a>))</span></code></pre></div>
<pre><code>## [1] &quot;../data/point_cloud_processing_temp/02_normalize/RMNP_019_2018_normalize.las&quot;</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="data-load-and-explore.html#cb81-1" tabindex="-1"></a><span class="co"># read in the data</span></span>
<span id="cb81-2"><a href="data-load-and-explore.html#cb81-2" tabindex="-1"></a>nlas_temp <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">readLAS</span>(n_f_temp)</span></code></pre></div>
<p>plot it to check that it is height normalized</p>
<div class="sourceCode" id="cb82"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb82-1"><a href="data-load-and-explore.html#cb82-1" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb82-2"><a href="data-load-and-explore.html#cb82-2" tabindex="-1"></a>  nlas_temp</span>
<span id="cb82-3"><a href="data-load-and-explore.html#cb82-3" tabindex="-1"></a> , <span class="at">color =</span> <span class="st">&quot;Z&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="at">legend =</span> T</span>
<span id="cb82-4"><a href="data-load-and-explore.html#cb82-4" tabindex="-1"></a> , <span class="at">pal =</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">house =</span> <span class="st">&quot;gryffindor&quot;</span>)</span>
<span id="cb82-5"><a href="data-load-and-explore.html#cb82-5" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-53-1.png" width="1008" /></p>
<p>nice! let’s remove the ground points to check out potential vegetation</p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="data-load-and-explore.html#cb83-1" tabindex="-1"></a>nlas_temp <span class="sc">%&gt;%</span> </span>
<span id="cb83-2"><a href="data-load-and-explore.html#cb83-2" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_poi</span>(Classification<span class="sc">!=</span><span class="dv">2</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb83-3"><a href="data-load-and-explore.html#cb83-3" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb83-4"><a href="data-load-and-explore.html#cb83-4" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;Z&quot;</span>, <span class="at">breaks =</span> <span class="st">&quot;quantile&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="at">legend =</span> T</span>
<span id="cb83-5"><a href="data-load-and-explore.html#cb83-5" tabindex="-1"></a>    , <span class="at">pal =</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">house =</span> <span class="st">&quot;gryffindor&quot;</span>)</span>
<span id="cb83-6"><a href="data-load-and-explore.html#cb83-6" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-54-1.png" width="1008" /></p>
<p>that’s a great workflow, guy.</p>
<p>i’m not your guy, buddy.</p>
</div>
</div>
<div id="ladderfuelsr" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> <code>LadderFuelsR</code><a href="data-load-and-explore.html#ladderfuelsr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>LadderFuelsR</code> package (<a href="https://doi.org/10.1111/2041-210X.14427">Viedma et al. 2024</a>) is described as enabling the use of “LiDAR data and the LadderFuelsR package…[to] provide an automated tool for analysing the vertical fuel structure of a forest and to calculate crown base height (CBH) at tree-level, among other parameters” (p.1).</p>
<p>let’s check what’s in this package</p>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="data-load-and-explore.html#cb84-1" tabindex="-1"></a><span class="fu">lsf.str</span>(<span class="st">&quot;package:LadderFuelsR&quot;</span>)</span></code></pre></div>
<pre><code>## calculate_gaps_perc : function (LAD_profiles, min_height = 1.5)  
## get_cbh_metrics : function (effective_LAD, min_height = 1.5, hdepth1_height = 2.5, verbose = TRUE)  
## get_cum_break : function (LAD_profiles, cbh_metrics, threshold = 75, min_height = 1.5, 
##     verbose = TRUE)  
## get_depths : function (LAD_profiles, distance_metrics, step = 1, min_height = 1.5, verbose = TRUE)  
## get_distance : function (gap_cbh_metrics, gaps_perc, step = 1, min_height = 1.5, verbose = TRUE)  
## get_effective_gap : function (effective_depth, number_steps = 1, min_height = 1.5, verbose = TRUE)  
## get_gaps_fbhs : function (LAD_profiles, step = 1, min_height = 1.5, perc_gap = 25, perc_base = 25, 
##     verbose = TRUE)  
## get_layers_lad : function (LAD_profiles, effective_distances, threshold = 10, step = 1, 
##     min_height = 1.5, verbose = TRUE)  
## get_plots_cbh_bp : function (LAD_profiles, cummulative_LAD, min_height = 1.5)  
## get_plots_cbh_LAD : function (LAD_profiles, cbh_metrics, min_height = 1.5)  
## get_plots_cbh_lastdist : function (LAD_profiles, cbh_metrics, min_height = 1.5)  
## get_plots_cbh_maxdist : function (LAD_profiles, cbh_metrics, min_height = 1.5)  
## get_plots_effective : function (LAD_profiles, effective_LAD, min_height = 1.5)  
## get_plots_gap_fbh : function (LAD_profiles, gap_cbh_metrics, min_height = 1.5)  
## get_real_depths : function (effective_fbh, step = 1, min_height = 1.5, verbose = TRUE)  
## get_real_fbh : function (depth_metrics, step = 1, number_steps = 1, min_height = 1.5, 
##     verbose = TRUE)  
## get_renamed_df : function (df)  
## get_renamed0_df : function (df)</code></pre>
<div id="prep-for-the-package" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Prep for the package<a href="data-load-and-explore.html#prep-for-the-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>For this package we need to do some cleaning of our las data and our polygon crown data. We need to attach the <code>treeID</code> column from our spatial crowns to the las data using <code>lidR::merge_spatial()</code>. This function allows for only polygons so we need to get rid of the multipolygons in the crown data. We’ll keep the largest part of the multipolygon as the smaller part is usually residual pixels from the CHM. We also generate a <code>tree_index</code> as a numeric id which is needed by the <code>LadderFuelsR</code> package since <code>treeID</code> is character.</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="data-load-and-explore.html#cb86-1" tabindex="-1"></a><span class="co"># the lidR::merge_spatial requires only polygons so we need to rid the multipolygons</span></span>
<span id="cb86-2"><a href="data-load-and-explore.html#cb86-2" tabindex="-1"></a>crowns_sf_poly <span class="ot">&lt;-</span></span>
<span id="cb86-3"><a href="data-load-and-explore.html#cb86-3" tabindex="-1"></a>  <span class="co"># start with only polygons</span></span>
<span id="cb86-4"><a href="data-load-and-explore.html#cb86-4" tabindex="-1"></a>  cloud2trees_ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb86-5"><a href="data-load-and-explore.html#cb86-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(geometry)<span class="sc">==</span><span class="st">&quot;POLYGON&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-6"><a href="data-load-and-explore.html#cb86-6" tabindex="-1"></a>  <span class="co"># union on cleaned multipolygons</span></span>
<span id="cb86-7"><a href="data-load-and-explore.html#cb86-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>(</span>
<span id="cb86-8"><a href="data-load-and-explore.html#cb86-8" tabindex="-1"></a>    cloud2trees_ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb86-9"><a href="data-load-and-explore.html#cb86-9" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(sf<span class="sc">::</span><span class="fu">st_geometry_type</span>(geometry)<span class="sc">==</span><span class="st">&quot;MULTIPOLYGON&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb86-10"><a href="data-load-and-explore.html#cb86-10" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_cast</span>(<span class="at">to =</span> <span class="st">&quot;POLYGON&quot;</span>, <span class="at">do_split =</span> T, <span class="at">warn =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb86-11"><a href="data-load-and-explore.html#cb86-11" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">axxx =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(geometry)) <span class="sc">%&gt;%</span> <span class="co"># axxx is so we don&#39;t overwrite a column</span></span>
<span id="cb86-12"><a href="data-load-and-explore.html#cb86-12" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">group_by</span>(treeID) <span class="sc">%&gt;%</span> </span>
<span id="cb86-13"><a href="data-load-and-explore.html#cb86-13" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(axxx <span class="sc">==</span> <span class="fu">max</span>(axxx)) <span class="sc">%&gt;%</span> </span>
<span id="cb86-14"><a href="data-load-and-explore.html#cb86-14" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-15"><a href="data-load-and-explore.html#cb86-15" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>axxx)</span>
<span id="cb86-16"><a href="data-load-and-explore.html#cb86-16" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb86-17"><a href="data-load-and-explore.html#cb86-17" tabindex="-1"></a>  <span class="co"># generate a treeID index because it needs to be numeric</span></span>
<span id="cb86-18"><a href="data-load-and-explore.html#cb86-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb86-19"><a href="data-load-and-explore.html#cb86-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">tree_index =</span> dplyr<span class="sc">::</span><span class="fu">row_number</span>())</span></code></pre></div>
<p>does it look good?</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="data-load-and-explore.html#cb87-1" tabindex="-1"></a>plt_chm <span class="sc">+</span></span>
<span id="cb87-2"><a href="data-load-and-explore.html#cb87-2" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> cloud2trees_ans<span class="sc">$</span>treetops_sf, <span class="at">shape =</span> <span class="st">&quot;x&quot;</span>, <span class="at">color =</span> <span class="st">&quot;blue&quot;</span>) <span class="sc">+</span></span>
<span id="cb87-3"><a href="data-load-and-explore.html#cb87-3" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> crowns_sf_poly, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">color =</span> <span class="st">&quot;steelblue&quot;</span>)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-57-1.png" width="1008" /></p>
<p>now we’ll attach the <code>treeID</code> column to the normalized las file and keep only the points that fall within a tree crown.</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="data-load-and-explore.html#cb88-1" tabindex="-1"></a>m_nlas_temp <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">merge_spatial</span>(</span>
<span id="cb88-2"><a href="data-load-and-explore.html#cb88-2" tabindex="-1"></a>    <span class="at">las =</span> nlas_temp</span>
<span id="cb88-3"><a href="data-load-and-explore.html#cb88-3" tabindex="-1"></a>    , <span class="at">source =</span> crowns_sf_poly</span>
<span id="cb88-4"><a href="data-load-and-explore.html#cb88-4" tabindex="-1"></a>    , <span class="at">attribute =</span> <span class="st">&quot;tree_index&quot;</span></span>
<span id="cb88-5"><a href="data-load-and-explore.html#cb88-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb88-6"><a href="data-load-and-explore.html#cb88-6" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_poi</span>(<span class="sc">!</span><span class="fu">is.na</span>(tree_index)) <span class="sc">%&gt;%</span> </span>
<span id="cb88-7"><a href="data-load-and-explore.html#cb88-7" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_poi</span>(Classification<span class="sc">!=</span><span class="dv">2</span>)</span>
<span id="cb88-8"><a href="data-load-and-explore.html#cb88-8" tabindex="-1"></a><span class="co"># what is this data?</span></span>
<span id="cb88-9"><a href="data-load-and-explore.html#cb88-9" tabindex="-1"></a>m_nlas_temp<span class="sc">@</span>data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 10,514
## Columns: 17
## $ X                 &lt;dbl&gt; 458190.2, 458189.9, 458200.0, 458199.7, 458199.9, 45…
## $ Y                 &lt;dbl&gt; 4449607, 4449607, 4449606, 4449607, 4449607, 4449607…
## $ Z                 &lt;dbl&gt; 4.685, 4.739, 2.126, 1.725, 1.123, 2.091, 1.882, 1.2…
## $ gpstime           &lt;dbl&gt; 424047.8, 424047.8, 424047.8, 424047.8, 424047.8, 42…
## $ Intensity         &lt;int&gt; 75, 209, 159, 33, 47, 160, 133, 14, 19, 152, 130, 41…
## $ ReturnNumber      &lt;int&gt; 1, 1, 1, 1, 2, 1, 1, 1, 1, 2, 1, 1, 1, 1, 1, 1, 1, 2…
## $ NumberOfReturns   &lt;int&gt; 2, 2, 2, 3, 3, 2, 2, 2, 3, 3, 1, 4, 2, 2, 2, 2, 3, 3…
## $ ScanDirectionFlag &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ EdgeOfFlightline  &lt;int&gt; 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0…
## $ Classification    &lt;int&gt; 5, 5, 5, 1, 1, 5, 1, 1, 5, 5, 5, 5, 5, 5, 5, 5, 5, 5…
## $ Synthetic_flag    &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ Keypoint_flag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ Withheld_flag     &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FAL…
## $ ScanAngleRank     &lt;int&gt; 12, 12, 12, 12, 12, 12, 12, 12, 11, 11, 11, 11, 12, …
## $ UserData          &lt;int&gt; 47, 47, 21, 17, 11, 21, 19, 13, 66, 53, 53, 60, 48, …
## $ PointSourceID     &lt;int&gt; 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, 26, …
## $ tree_index        &lt;int&gt; 104, 104, 101, 101, 101, 97, 101, 101, 110, 110, 93,…</code></pre>
<p>plot the las data colored by <code>tree_index</code></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="data-load-and-explore.html#cb90-1" tabindex="-1"></a>m_nlas_temp <span class="sc">%&gt;%</span> </span>
<span id="cb90-2"><a href="data-load-and-explore.html#cb90-2" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb90-3"><a href="data-load-and-explore.html#cb90-3" tabindex="-1"></a>    <span class="at">color =</span> <span class="st">&quot;tree_index&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="at">legend =</span> F</span>
<span id="cb90-4"><a href="data-load-and-explore.html#cb90-4" tabindex="-1"></a>    , <span class="at">pal =</span> viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n =</span> m_nlas_temp<span class="sc">@</span>data<span class="sc">$</span>tree_index <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">length</span>()) <span class="sc">%&gt;%</span> <span class="fu">sample</span>()</span>
<span id="cb90-5"><a href="data-load-and-explore.html#cb90-5" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-59-1.png" width="1008" /></p>
<p>check it for one tree</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="data-load-and-explore.html#cb91-1" tabindex="-1"></a>m_nlas_temp <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="data-load-and-explore.html#cb91-2" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_poi</span>(</span>
<span id="cb91-3"><a href="data-load-and-explore.html#cb91-3" tabindex="-1"></a>    tree_index <span class="sc">==</span> </span>
<span id="cb91-4"><a href="data-load-and-explore.html#cb91-4" tabindex="-1"></a>      <span class="co"># get the tree with the most points</span></span>
<span id="cb91-5"><a href="data-load-and-explore.html#cb91-5" tabindex="-1"></a>      m_nlas_temp<span class="sc">@</span>data <span class="sc">%&gt;%</span> </span>
<span id="cb91-6"><a href="data-load-and-explore.html#cb91-6" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">count</span>(tree_index) <span class="sc">%&gt;%</span> </span>
<span id="cb91-7"><a href="data-load-and-explore.html#cb91-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(n <span class="sc">==</span> <span class="fu">max</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb91-8"><a href="data-load-and-explore.html#cb91-8" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice_head</span>(<span class="at">n=</span><span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb91-9"><a href="data-load-and-explore.html#cb91-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(tree_index)</span>
<span id="cb91-10"><a href="data-load-and-explore.html#cb91-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb91-11"><a href="data-load-and-explore.html#cb91-11" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">plot</span>(<span class="at">color =</span> <span class="st">&quot;tree_index&quot;</span>, <span class="at">bg =</span> <span class="st">&quot;white&quot;</span>, <span class="at">legend =</span> F)</span></code></pre></div>
<p><img src="uas_sfm_tree_detection_files/figure-html/unnamed-chunk-60-1.png" width="1008" /></p>
</div>
<div id="use-the-package" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Use the package<a href="data-load-and-explore.html#use-the-package" class="anchor-section" aria-label="Anchor link to header"></a></h3>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
