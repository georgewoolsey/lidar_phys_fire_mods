<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 2 Point Cloud Processing | Aerial LiDAR for Fire Model Inputs</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 2 Point Cloud Processing | Aerial LiDAR for Fire Model Inputs" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 2 Point Cloud Processing | Aerial LiDAR for Fire Model Inputs" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="validate-tree-detection-and-crown-delineation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html"><i class="fa fa-check"></i><b>2</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#lidar-data-location"><i class="fa fa-check"></i><b>2.1</b> Lidar Data Location</a></li>
<li class="chapter" data-level="2.2" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#individial-tree-detection-tuning-itd_tuning"><i class="fa fa-check"></i><b>2.2</b> Individial Tree Detection Tuning: <code>itd_tuning()</code></a></li>
<li class="chapter" data-level="2.3" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#point-cloud-tree-extraction-cloud2trees"><i class="fa fa-check"></i><b>2.3</b> Point Cloud Tree Extraction: <code>cloud2trees()</code></a></li>
<li class="chapter" data-level="2.4" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#dbh-modeling-trees_dbh"><i class="fa fa-check"></i><b>2.4</b> DBH Modeling: <code>trees_dbh()</code></a></li>
<li class="chapter" data-level="2.5" data-path="point-cloud-processing.html"><a href="point-cloud-processing.html#cbh-modeling-trees_cbh"><i class="fa fa-check"></i><b>2.5</b> CBH Modeling: <code>trees_cbh()</code></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html"><i class="fa fa-check"></i><b>3</b> Validate Tree Detection and Crown Delineation</a>
<ul>
<li class="chapter" data-level="3.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#neontreeevaluation-overview"><i class="fa fa-check"></i><b>3.1</b> <code>NeonTreeEvaluation</code> overview</a></li>
<li class="chapter" data-level="3.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#lidar-data-in-neontreeevaluation"><i class="fa fa-check"></i><b>3.2</b> lidar data in <code>NeonTreeEvaluation</code></a></li>
<li class="chapter" data-level="3.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#example-validation-process"><i class="fa fa-check"></i><b>3.3</b> Example validation process</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial LiDAR for Fire Model Inputs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="point-cloud-processing" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">Section 2</span> Point Cloud Processing<a href="point-cloud-processing.html#point-cloud-processing" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section we’ll process the <a href="index.html#data_desc">raw point cloud data</a> using the <a href="https://github.com/georgewoolsey/cloud2trees"><code>cloud2trees</code> R package</a> developed to provide accessible routines for processing point cloud data collected by airborne lidar or generated using UAS imagery and photogrammetry (e.g. structure from motion).</p>
<p>The <code>cloud2trees</code> package can be installed by following the directions listed in the <a href="https://github.com/georgewoolsey/cloud2trees">README file on GitHub</a>. If one is still experiencing difficulties installing the package, see the <a href="https://github.com/georgewoolsey/cloud2trees/blob/main/inst/examples/example.R">example.R file</a> which details how to install the package using a virgin R instance.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="point-cloud-processing.html#cb1-1" tabindex="-1"></a><span class="do">## remotes helps us get packages hosted on github</span></span>
<span id="cb1-2"><a href="point-cloud-processing.html#cb1-2" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb1-3"><a href="point-cloud-processing.html#cb1-3" tabindex="-1"></a><span class="do">## get cloud2trees</span></span>
<span id="cb1-4"><a href="point-cloud-processing.html#cb1-4" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="at">repo =</span> <span class="st">&quot;georgewoolsey/cloud2trees&quot;</span>, <span class="at">upgrade =</span> F)</span></code></pre></div>
<p>Load the standard libraries we use to do work</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="point-cloud-processing.html#cb2-1" tabindex="-1"></a><span class="co"># bread-and-butter</span></span>
<span id="cb2-2"><a href="point-cloud-processing.html#cb2-2" tabindex="-1"></a><span class="fu">library</span>(tidyverse) <span class="co"># the tidyverse</span></span>
<span id="cb2-3"><a href="point-cloud-processing.html#cb2-3" tabindex="-1"></a><span class="fu">library</span>(viridis) <span class="co"># viridis colors</span></span>
<span id="cb2-4"><a href="point-cloud-processing.html#cb2-4" tabindex="-1"></a><span class="fu">library</span>(harrypotter) <span class="co"># hp colors</span></span>
<span id="cb2-5"><a href="point-cloud-processing.html#cb2-5" tabindex="-1"></a><span class="fu">library</span>(RColorBrewer) <span class="co"># brewer colors</span></span>
<span id="cb2-6"><a href="point-cloud-processing.html#cb2-6" tabindex="-1"></a><span class="fu">library</span>(scales) <span class="co"># work with number and plot scales</span></span>
<span id="cb2-7"><a href="point-cloud-processing.html#cb2-7" tabindex="-1"></a><span class="fu">library</span>(latex2exp)</span>
<span id="cb2-8"><a href="point-cloud-processing.html#cb2-8" tabindex="-1"></a></span>
<span id="cb2-9"><a href="point-cloud-processing.html#cb2-9" tabindex="-1"></a><span class="co"># visualization</span></span>
<span id="cb2-10"><a href="point-cloud-processing.html#cb2-10" tabindex="-1"></a><span class="fu">library</span>(mapview) <span class="co"># interactive html maps</span></span>
<span id="cb2-11"><a href="point-cloud-processing.html#cb2-11" tabindex="-1"></a><span class="fu">library</span>(kableExtra) <span class="co"># tables</span></span>
<span id="cb2-12"><a href="point-cloud-processing.html#cb2-12" tabindex="-1"></a><span class="fu">library</span>(patchwork) <span class="co"># combine plots</span></span>
<span id="cb2-13"><a href="point-cloud-processing.html#cb2-13" tabindex="-1"></a></span>
<span id="cb2-14"><a href="point-cloud-processing.html#cb2-14" tabindex="-1"></a><span class="co"># spatial analysis</span></span>
<span id="cb2-15"><a href="point-cloud-processing.html#cb2-15" tabindex="-1"></a><span class="fu">library</span>(terra) <span class="co"># raster</span></span>
<span id="cb2-16"><a href="point-cloud-processing.html#cb2-16" tabindex="-1"></a><span class="fu">library</span>(sf) <span class="co"># simple features</span></span>
<span id="cb2-17"><a href="point-cloud-processing.html#cb2-17" tabindex="-1"></a><span class="fu">library</span>(lidR) <span class="co"># lidar data</span></span>
<span id="cb2-18"><a href="point-cloud-processing.html#cb2-18" tabindex="-1"></a><span class="fu">library</span>(cloud2trees) <span class="co"># the cloud2trees</span></span></code></pre></div>
<div id="lidar-data-location" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Lidar Data Location<a href="point-cloud-processing.html#lidar-data-location" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s check out the lidar data we got from the Mogollon Rim area of the Coconino National Forest about 20 km north of Payson, Arizona, USA using the <a href="https://www.usgs.gov/tools/lidarexplorer">USGS LidarExplorer</a>.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="point-cloud-processing.html#cb3-1" tabindex="-1"></a><span class="co"># directory with the downloaded .las|.laz files</span></span>
<span id="cb3-2"><a href="point-cloud-processing.html#cb3-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="st">&quot;e:/lidar_phys_fire_mods/data/mogollon_rim_az_lidar/&quot;</span></span>
<span id="cb3-3"><a href="point-cloud-processing.html#cb3-3" tabindex="-1"></a><span class="co"># is there data?</span></span>
<span id="cb3-4"><a href="point-cloud-processing.html#cb3-4" tabindex="-1"></a><span class="fu">list.files</span>(f, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">length</span>()</span></code></pre></div>
<pre><code>## [1] 42</code></pre>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="point-cloud-processing.html#cb5-1" tabindex="-1"></a><span class="co"># what files are in here?</span></span>
<span id="cb5-2"><a href="point-cloud-processing.html#cb5-2" tabindex="-1"></a><span class="fu">list.files</span>(f, <span class="at">pattern =</span> <span class="st">&quot;.*</span><span class="sc">\\</span><span class="st">.(laz|las)$&quot;</span>)[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code></pre></div>
<pre><code>## [1] &quot;USGS_LPC_AZ_USFS_3DEP_Processing_2019_D20_w0467n3808.laz&quot;
## [2] &quot;USGS_LPC_AZ_USFS_3DEP_Processing_2019_D20_w0467n3809.laz&quot;
## [3] &quot;USGS_LPC_AZ_USFS_3DEP_Processing_2019_D20_w0467n3810.laz&quot;</code></pre>
<p>We’ll plot our point cloud data tiles real quick to orient ourselves</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="point-cloud-processing.html#cb7-1" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(f) <span class="sc">%&gt;%</span> </span>
<span id="cb7-2"><a href="point-cloud-processing.html#cb7-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb7-3"><a href="point-cloud-processing.html#cb7-3" tabindex="-1"></a>  mapview<span class="sc">::</span><span class="fu">mapview</span>(<span class="at">popup =</span> F, <span class="at">layer.name =</span> <span class="st">&quot;point cloud tile&quot;</span>)</span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-b70979e94dc01bb9895d" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-b70979e94dc01bb9895d">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-111.3590906056137,-111.359129155935,-111.348246743088,-111.3482093608689,-111.3590906056137],"lat":[34.41292258064113,34.42194061826054,34.42197208713579,34.41295403895751,34.41292258064113]}]],[[{"lng":[-111.3591291563206,-111.3591677237781,-111.3482841422981,-111.3482467434619,-111.3591291563206],"lat":[34.42194070844174,34.43095873270235,34.4309902121388,34.42197217731709,34.42194070844174]}]],[[{"lng":[-111.3591677241639,-111.359206308765,-111.3483215581326,-111.3482841426722,-111.3591677241639],"lat":[34.43095882288343,34.43997683378363,34.44000832378353,34.43099030231999,34.43095882288343]}]],[[{"lng":[-111.359206309151,-111.3592449109032,-111.3483589905986,-111.3483215585068,-111.359206309151],"lat":[34.43997692396457,34.44899492150276,34.44902642206831,34.44000841396457,34.43997692396457]}]],[[{"lng":[-111.3592449112893,-111.3592835302,-111.3483964397033,-111.348358990973,-111.3592449112893],"lat":[34.44899501168356,34.45801299585812,34.45804450699157,34.44902651224923,34.44899501168356]}]],[[{"lng":[-111.3592835305862,-111.3593221666628,-111.348433905454,-111.3483964400779,-111.3592835305862],"lat":[34.4580130860388,34.46703105684811,34.46706257855168,34.45804459717235,34.4580130860388]}]],[[{"lng":[-111.3593221670492,-111.3593608202991,-111.3484713878578,-111.3484339058287,-111.3593221670492],"lat":[34.46703114702865,34.4760491044711,34.47608063674702,34.46706266873232,34.46703114702865]}]],[[{"lng":[-111.3482092520552,-111.3482466342627,-111.3373642047988,-111.3373279907006,-111.3482092520552],"lat":[34.41295403926727,34.42197208744565,34.42200258809902,34.41298452968665,34.41295403926727]}]],[[{"lng":[-111.3482466346366,-111.3482840334612,-111.337400435357,-111.337364205161,-111.3482466346366],"lat":[34.42197217762695,34.43099021244876,34.43102072333842,34.42200267828045,34.42197217762695]}]],[[{"lng":[-111.3482840338352,-111.3483214492839,-111.3374366820201,-111.3374004357194,-111.3482840338352],"lat":[34.43099030262995,34.44000832409359,34.44003884522166,34.4310208135197,34.43099030262995]}]],[[{"lng":[-111.3483214496582,-111.3483588817382,-111.3374729447951,-111.3374366823827,-111.3483214496582],"lat":[34.44000841427463,34.44902642237847,34.44905695374714,34.44003893540282,34.44000841427463]}]],[[{"lng":[-111.3483588821126,-111.3483963308312,-111.3375092236889,-111.3374729451578,-111.3483588821126],"lat":[34.44902651255938,34.45804450730184,34.45807504891326,34.44905704392816,34.44902651255938]}]],[[{"lng":[-111.3483963312058,-111.3484337965702,-111.3375455187084,-111.3375092240517,-111.3483963312058],"lat":[34.45804459748261,34.46706257886205,34.46709313071839,34.45807513909414,34.45804459748261]}]],[[{"lng":[-111.3484337969449,-111.3484712789623,-111.3375818298608,-111.3375455190715,-111.3484337969449],"lat":[34.4670626690427,34.4760806370575,34.47611119916091,34.46709322089914,34.4670626690427]}]],[[{"lng":[-111.3373278818868,-111.3373640959733,-111.3264816504116,-111.3264466044413,-111.3373278818868],"lat":[34.41298452998672,34.42200258839919,34.42203212082592,34.41301405250429,34.41298452998672]}]],[[{"lng":[-111.3373640963356,-111.3374003265199,-111.326516712311,-111.3264816507622,-111.3373640963356],"lat":[34.42200267858061,34.43102072363869,34.43105026597675,34.42203221100743,34.42200267858061]}]],[[{"lng":[-111.3374003268822,-111.3374365731713,-111.3265517897958,-111.3265167126617,-111.3374003268822],"lat":[34.43102081381996,34.44003884552204,34.44006839777352,34.43105035615814,34.43102081381996]}]],[[{"lng":[-111.3374365735338,-111.3374728359345,-111.3265868828727,-111.3265517901466,-111.3374365735338],"lat":[34.44003893570318,34.44905695404761,34.44908651621461,34.44006848795475,34.44003893570318]}]],[[{"lng":[-111.3374728362973,-111.3375091148166,-111.3266219915486,-111.3265868832237,-111.3374728362973],"lat":[34.44905704422863,34.45807504921383,34.45810462129843,34.44908660639572,34.44905704422863]}]],[[{"lng":[-111.3375091151795,-111.3375454098245,-111.3266571158301,-111.3266219918998,-111.3375091151795],"lat":[34.45807513939471,34.46709313101906,34.46712271302336,34.45810471147941,34.45807513939471]}]],[[{"lng":[-111.3375454101875,-111.3375817209651,-111.326692255724,-111.3266571161814,-111.3375454101875],"lat":[34.4670932211998,34.47611119946169,34.47614079138779,34.4671228032042,34.4670932211998]}]],[[{"lng":[-111.3264464956274,-111.326481541586,-111.3155990804458,-111.3155652026101,-111.3264464956274],"lat":[34.41301405279468,34.4220321211164,34.42206068531185,34.41304260740583,34.41301405279468]}]],[[{"lng":[-111.3264815419365,-111.3265166034737,-111.3156329736795,-111.3155990807846,-111.3264815419365],"lat":[34.42203221129792,34.43105026626733,34.43107884004917,34.42206077549345,34.42203221129792]}]],[[{"lng":[-111.3265166038244,-111.3265516809468,-111.3156668819793,-111.3156329740186,-111.3265166038244],"lat":[34.43105035644871,34.44006839806421,34.44009698143444,34.43107893023063,34.43105035644871]}]],[[{"lng":[-111.3265516812976,-111.326586774012,-111.3157008053515,-111.3156668823184,-111.3265516812976],"lat":[34.44006848824544,34.4490865165054,34.44911510946607,34.44009707161578,34.44006848824544]}]],[[{"lng":[-111.326586774363,-111.3266218826762,-111.3157347438027,-111.3157008056908,-111.326586774363],"lat":[34.44908660668651,34.4581046215893,34.45813322414245,34.44911519964729,34.44908660668651]}]],[[{"lng":[-111.3266218830274,-111.326657006946,-111.3157686973394,-111.3157347441421,-111.3266218830274],"lat":[34.45810471177029,34.46712271331433,34.46715132546196,34.45813331432353,34.45810471177029]}]],[[{"lng":[-111.3266570072973,-111.3266921468282,-111.3158026659681,-111.315768697679,-111.3266570072973],"lat":[34.46712280349517,34.47614079167885,34.476169413423,34.4671514156429,34.46712280349517]}]],[[{"lng":[-111.3155650937961,-111.31559897162,-111.3047164954205,-111.304683785726,-111.3155650937961],"lat":[34.41304260768655,34.42206068559265,34.42208828155231,34.4130701943868,34.41304260768655]}]],[[{"lng":[-111.3155989719588,-111.3156328648421,-111.3047492199821,-111.3047164957476,-111.3155989719588],"lat":[34.42206077577426,34.43107884033005,34.43110644555117,34.422088371734,34.42206077577426]}]],[[{"lng":[-111.3156328651811,-111.3156667731301,-111.3047819590903,-111.3047492203094,-111.3156328651811],"lat":[34.43107893051153,34.44009698171543,34.44012459619995,34.43110653573274,34.43107893051153]}]],[[{"lng":[-111.3156667734693,-111.3157006964906,-111.3048147127513,-111.3047819594178,-111.3156667734693],"lat":[34.44009707189678,34.44911510974716,34.44914273349703,34.44012468638138,34.44009707189678]}]],[[{"lng":[-111.3157006968299,-111.3157346349301,-111.3048474809712,-111.3048147130789,-111.3157006968299],"lat":[34.44911519992836,34.45813322442364,34.45816085744082,34.44914282367834,34.44911519992836]}]],[[{"lng":[-111.3157346352696,-111.3157685884551,-111.3048802637566,-111.304847481299,-111.3157346352696],"lat":[34.45813331460471,34.46715132574324,34.46717896802971,34.45816094762199,34.45813331460471]}]],[[{"lng":[-111.3157685887947,-111.3158025570721,-111.3049130611136,-111.3048802640845,-111.3157685887947],"lat":[34.46715141592418,34.47616941370438,34.47619706526206,34.46717905821072,34.46715141592418]}]],[[{"lng":[-111.3046836769118,-111.3047163865945,-111.2938338958549,-111.2938023543079,-111.3046836769118],"lat":[34.41307019465783,34.42208828182342,34.42211490954298,34.41309681344286,34.41307019465783]}]],[[{"lng":[-111.3047163869217,-111.3047491111445,-111.2938654517383,-111.2938338961704,-111.3047163869217],"lat":[34.42208837200513,34.43110644582238,34.43113308247844,34.42211499972477,34.42208837200513]}]],[[{"lng":[-111.3047491114718,-111.304781850241,-111.2938970216486,-111.2938654520539,-111.3047491114718],"lat":[34.43110653600394,34.44012459647125,34.44015124206571,34.43113317266009,34.43110653600394]}]],[[{"lng":[-111.3047818505685,-111.3048146038903,-111.2939286055919,-111.2938970219643,-111.3047818505685],"lat":[34.44012468665269,34.44914273376843,34.44916938830315,34.44015133224722,34.44012468665269]}]],[[{"lng":[-111.3048146042179,-111.3048473720985,-111.2939602035745,-111.2939286059079,-111.3048146042179],"lat":[34.44914282394973,34.4581608577123,34.45818752118919,34.44916947848454,34.44914282394973]}]],[[{"lng":[-111.3048473724263,-111.3048801548722,-111.2939918156022,-111.2939602038905,-111.3048473724263],"lat":[34.45816094789348,34.46717896830127,34.46720564072221,34.45818761137045,34.45816094789348]}]],[[{"lng":[-111.3048801552001,-111.3049129522175,-111.2940234416812,-111.2939918159184,-111.3048801552001],"lat":[34.46717905848231,34.47619706553372,34.4762237469006,34.46720573090333,34.46717905848231]}]]],null,"point cloud tile",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0.6,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.84,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],"point cloud tile",{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#6666FF"],"labels":["point cloud tile"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"","extra":null,"layerId":null,"className":"info legend","group":"point cloud tile"}]}],"limits":{"lat":[34.41292258064113,34.4762237469006],"lng":[-111.3593608202991,-111.2938023543079]},"fitBounds":[34.41292258064113,-111.3593608202991,34.4762237469006,-111.2938023543079,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
</div>
<div id="individial-tree-detection-tuning-itd_tuning" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Individial Tree Detection Tuning: <code>itd_tuning()</code><a href="point-cloud-processing.html#individial-tree-detection-tuning-itd_tuning" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>cloud2trees</code> package performs individual tree detection using <code>lidR::locate_trees()</code> with the <code>lidR::lmf()</code> algorithm. The local maximum filter algorithm allows for a constant window size or a variable window size defined by a function. See the <code>lidR</code> <a href="https://r-lidar.github.io/lidRbook/itd.html">package book section</a> by point cloud processing expert <a href="https://github.com/Jean-Romain">Jean-Romain Roussel</a> for excellent detail on ITD and defining window size.</p>
<p>The <code>itd_tuning()</code> function is used to visually assess tree crown delineation results from different window size functions used for the detection of individual trees. <code>itd_tuning()</code> allows users to test different window size functions on a sample of data to determine which function is most suitable for the area being analyzed. The preferred function can then be used in the <code>ws</code> parameter in <code>raster2trees()</code> and <code>cloud2trees()</code>.</p>
<p>Let’s run <code>itd_tuning()</code> on our data starting with default window size functions</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="point-cloud-processing.html#cb8-1" tabindex="-1"></a><span class="co"># run itd_tuning()</span></span>
<span id="cb8-2"><a href="point-cloud-processing.html#cb8-2" tabindex="-1"></a>itd_tuning_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">itd_tuning</span>(f)</span>
<span id="cb8-3"><a href="point-cloud-processing.html#cb8-3" tabindex="-1"></a><span class="co"># what did we get?</span></span>
<span id="cb8-4"><a href="point-cloud-processing.html#cb8-4" tabindex="-1"></a>itd_tuning_ans <span class="sc">%&gt;%</span> <span class="fu">names</span>()</span></code></pre></div>
<pre><code>## [1] &quot;plot_samples&quot; &quot;ws_fn_list&quot;</code></pre>
<p>check the <code>ws_fn_list</code> return which includes the different window size functions tested</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="point-cloud-processing.html#cb10-1" tabindex="-1"></a><span class="co"># what ws_fn_list</span></span>
<span id="cb10-2"><a href="point-cloud-processing.html#cb10-2" tabindex="-1"></a>itd_tuning_ans<span class="sc">$</span>ws_fn_list <span class="sc">%&gt;%</span> <span class="fu">str</span>()</span></code></pre></div>
<pre><code>## List of 3
##  $ lin_fn:function (x)  
##  $ exp_fn:function (x)  
##  $ log_fn:function (x)</code></pre>
<p>let’s look at the function definition for the linear function (<code>lin_fn</code>)</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="point-cloud-processing.html#cb12-1" tabindex="-1"></a><span class="co"># the linear function</span></span>
<span id="cb12-2"><a href="point-cloud-processing.html#cb12-2" tabindex="-1"></a>itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>lin_fn</span></code></pre></div>
<pre><code>## function (x) 
## {
##     y &lt;- dplyr::case_when(is.na(x) ~ 0.001, x &lt; 0 ~ 0.001, x &lt; 
##         2 ~ 1, x &gt; 30 ~ 5, TRUE ~ 0.75 + (x * 0.14))
##     return(y)
## }
## &lt;bytecode: 0x000001fde3a9a5a8&gt;
## &lt;environment: 0x000001fde3aacd38&gt;</code></pre>
<p>let’s plot all of the functions we tested with our call to <code>itd_tuning()</code> using the defaults</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="point-cloud-processing.html#cb14-1" tabindex="-1"></a><span class="co"># shape of the ws functions</span></span>
<span id="cb14-2"><a href="point-cloud-processing.html#cb14-2" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb14-3"><a href="point-cloud-processing.html#cb14-3" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;lin_fn&quot;</span>),<span class="at">fun=</span>itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>lin_fn, <span class="at">lwd=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb14-4"><a href="point-cloud-processing.html#cb14-4" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;nonlin_fn&quot;</span>),<span class="at">fun=</span>itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>nonlin_fn, <span class="at">lwd=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb14-5"><a href="point-cloud-processing.html#cb14-5" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;exp_fn&quot;</span>),<span class="at">fun=</span>itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>exp_fn, <span class="at">lwd=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb14-6"><a href="point-cloud-processing.html#cb14-6" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb14-7"><a href="point-cloud-processing.html#cb14-7" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-8"><a href="point-cloud-processing.html#cb14-8" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;heights&quot;</span>, <span class="at">y =</span> <span class="st">&quot;ws&quot;</span>, <span class="at">color =</span> <span class="st">&quot;ws function&quot;</span>) <span class="sc">+</span></span>
<span id="cb14-9"><a href="point-cloud-processing.html#cb14-9" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-9-1.png" width="1008" /></p>
<p>now, let’s see how those window size functions impacted individual tree detection by checking the <code>plot_samples</code> return</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="point-cloud-processing.html#cb15-1" tabindex="-1"></a><span class="co"># tuning plot</span></span>
<span id="cb15-2"><a href="point-cloud-processing.html#cb15-2" tabindex="-1"></a>itd_tuning_ans<span class="sc">$</span>plot_samples</span></code></pre></div>
<p><img src="e:/lidar_phys_fire_mods/data/itd_tuning1.jpg" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<p>Looking at the first sample, the exponential function (<code>exp_fn</code>) resulted in too few trees detected in the overstory class. The clearest evidence of this is in the center of the left-hand side of the plot in the first sample. There is a clear “valley” in the CHM which the linear (<code>lin_fn</code>) and non-linear (<code>nonlin_fn</code>) correctly split into two trees but the exponential function misses this split. Furthermore, the exponential function results in too many tree splits for short trees as can be seen in the second sample plot in the lower-left corner small tree group. The linear and the non-linear function are very similar in detecting overstory trees but the linear function perhaps does a better job splitting up clumps of smaller trees. In the third sample plot the linear function does a better job splitting up the short tree group in the upper-right corner small tree group compared to the non-linear function (there is no way that a tree that short [3-6 m tall] would have such a large crown area as in the non-linear split).</p>
<p>If we had one gripe about the linear function, it’s maybe that it results in too many trees in small-tree patches. Let’s define our own custom linear function that slightly increases the window size for shorter trees compared to the default linear function.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="point-cloud-processing.html#cb16-1" tabindex="-1"></a><span class="co"># custom linear function</span></span>
<span id="cb16-2"><a href="point-cloud-processing.html#cb16-2" tabindex="-1"></a>custom_lin <span class="ot">&lt;-</span> <span class="cf">function</span> (x){</span>
<span id="cb16-3"><a href="point-cloud-processing.html#cb16-3" tabindex="-1"></a>  y <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb16-4"><a href="point-cloud-processing.html#cb16-4" tabindex="-1"></a>    <span class="fu">is.na</span>(x) <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb16-5"><a href="point-cloud-processing.html#cb16-5" tabindex="-1"></a>    , x <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="fl">0.001</span></span>
<span id="cb16-6"><a href="point-cloud-processing.html#cb16-6" tabindex="-1"></a>    , x <span class="sc">&lt;</span> <span class="dv">2</span> <span class="sc">~</span> <span class="fl">1.2</span></span>
<span id="cb16-7"><a href="point-cloud-processing.html#cb16-7" tabindex="-1"></a>    , x <span class="sc">&gt;</span> <span class="dv">30</span> <span class="sc">~</span> <span class="dv">5</span></span>
<span id="cb16-8"><a href="point-cloud-processing.html#cb16-8" tabindex="-1"></a>    , <span class="cn">TRUE</span> <span class="sc">~</span> <span class="fl">0.9</span> <span class="sc">+</span> (x <span class="sc">*</span> <span class="fl">0.139</span>)</span>
<span id="cb16-9"><a href="point-cloud-processing.html#cb16-9" tabindex="-1"></a>  )</span>
<span id="cb16-10"><a href="point-cloud-processing.html#cb16-10" tabindex="-1"></a>  <span class="fu">return</span>(y)</span>
<span id="cb16-11"><a href="point-cloud-processing.html#cb16-11" tabindex="-1"></a>}</span>
<span id="cb16-12"><a href="point-cloud-processing.html#cb16-12" tabindex="-1"></a><span class="co"># shape of the ws functions</span></span>
<span id="cb16-13"><a href="point-cloud-processing.html#cb16-13" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb16-14"><a href="point-cloud-processing.html#cb16-14" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;lin_fn&quot;</span>),<span class="at">fun=</span>itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>lin_fn, <span class="at">lwd=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb16-15"><a href="point-cloud-processing.html#cb16-15" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;nonlin_fn&quot;</span>),<span class="at">fun=</span>itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>nonlin_fn, <span class="at">lwd=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb16-16"><a href="point-cloud-processing.html#cb16-16" tabindex="-1"></a>  <span class="fu">geom_function</span>(<span class="fu">aes</span>(<span class="at">color =</span> <span class="st">&quot;custom_lin&quot;</span>),<span class="at">fun=</span>custom_lin, <span class="at">lwd=</span><span class="fl">1.2</span>) <span class="sc">+</span></span>
<span id="cb16-17"><a href="point-cloud-processing.html#cb16-17" tabindex="-1"></a>  <span class="fu">xlim</span>(<span class="sc">-</span><span class="dv">5</span>,<span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb16-18"><a href="point-cloud-processing.html#cb16-18" tabindex="-1"></a>  harrypotter<span class="sc">::</span><span class="fu">scale_color_hp_d</span>(<span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-19"><a href="point-cloud-processing.html#cb16-19" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;heights&quot;</span>, <span class="at">y =</span> <span class="st">&quot;ws&quot;</span>, <span class="at">color =</span> <span class="st">&quot;ws function&quot;</span>) <span class="sc">+</span></span>
<span id="cb16-20"><a href="point-cloud-processing.html#cb16-20" tabindex="-1"></a>  <span class="fu">theme_light</span>()</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-12-1.png" width="1008" /></p>
<p>We’ll run another sample test using <code>itd_tuning()</code>with our new function (call it “my_custom_lin” for extra clarity) compared to the default linear and non-linear functions and this time we’ll ask for four sample plots of 0.1 ha.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="point-cloud-processing.html#cb17-1" tabindex="-1"></a>itd_tuning_ans2 <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">itd_tuning</span>(</span>
<span id="cb17-2"><a href="point-cloud-processing.html#cb17-2" tabindex="-1"></a>  f</span>
<span id="cb17-3"><a href="point-cloud-processing.html#cb17-3" tabindex="-1"></a>  , <span class="at">ws_fn_list =</span> <span class="fu">list</span>(</span>
<span id="cb17-4"><a href="point-cloud-processing.html#cb17-4" tabindex="-1"></a>    <span class="at">my_custom_lin =</span> custom_lin</span>
<span id="cb17-5"><a href="point-cloud-processing.html#cb17-5" tabindex="-1"></a>    , <span class="at">lin_fn =</span> itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>lin_fn</span>
<span id="cb17-6"><a href="point-cloud-processing.html#cb17-6" tabindex="-1"></a>    , <span class="at">nonlin_fn =</span> itd_tuning_ans<span class="sc">$</span>ws_fn_list<span class="sc">$</span>nonlin_fn</span>
<span id="cb17-7"><a href="point-cloud-processing.html#cb17-7" tabindex="-1"></a>  )</span>
<span id="cb17-8"><a href="point-cloud-processing.html#cb17-8" tabindex="-1"></a>  , <span class="at">n_samples =</span> <span class="dv">4</span></span>
<span id="cb17-9"><a href="point-cloud-processing.html#cb17-9" tabindex="-1"></a>)</span></code></pre></div>
<p>now, let’s see how those window size functions impacted individual tree detection by checking the <code>plot_samples</code> return</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="point-cloud-processing.html#cb18-1" tabindex="-1"></a><span class="co"># tuning plot</span></span>
<span id="cb18-2"><a href="point-cloud-processing.html#cb18-2" tabindex="-1"></a>itd_tuning_ans2<span class="sc">$</span>plot_samples</span></code></pre></div>
<p><img src="e:/lidar_phys_fire_mods/data/itd_tuning2.jpg" width="100%" height="100%" style="display: block; margin: auto;" /></p>
<p>Our custom linear function (<code>my_custom_lin</code>) strikes a good balance between detection of lower canopy trees (e.g. &lt;10 m in height) without improperly subdividing dominant canopy trees based on the areas sampled. Let’s move forward with our custom linear function in the <code>raster2trees()</code> and <code>cloud2trees()</code> functions.</p>
</div>
<div id="point-cloud-tree-extraction-cloud2trees" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Point Cloud Tree Extraction: <code>cloud2trees()</code><a href="point-cloud-processing.html#point-cloud-tree-extraction-cloud2trees" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>cloud2trees()</code> function combines methods in the <code>cloud2trees</code> package for an all-in-one approach. We’ll call this function without estimating any of the additional tree components (the <code>estimate_*</code> parameters) which we will do separately to show the full process. With all other options turned off, <code>cloud2trees()</code> will: 1) generate a CHM from the point cloud using <code>cloud2raster()</code>; and 2) perform individual tree detection using <code>raster2trees()</code>.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="point-cloud-processing.html#cb19-1" tabindex="-1"></a>cloud2trees_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">cloud2trees</span>(</span>
<span id="cb19-2"><a href="point-cloud-processing.html#cb19-2" tabindex="-1"></a>  <span class="at">output_dir =</span> <span class="st">&quot;../data&quot;</span></span>
<span id="cb19-3"><a href="point-cloud-processing.html#cb19-3" tabindex="-1"></a>  , <span class="at">input_las_dir =</span> f <span class="co"># we defined this above</span></span>
<span id="cb19-4"><a href="point-cloud-processing.html#cb19-4" tabindex="-1"></a>  , <span class="at">accuracy_level =</span> <span class="dv">2</span></span>
<span id="cb19-5"><a href="point-cloud-processing.html#cb19-5" tabindex="-1"></a>  , <span class="at">dtm_res_m =</span> <span class="dv">1</span></span>
<span id="cb19-6"><a href="point-cloud-processing.html#cb19-6" tabindex="-1"></a>  , <span class="at">chm_res_m =</span> <span class="fl">0.25</span></span>
<span id="cb19-7"><a href="point-cloud-processing.html#cb19-7" tabindex="-1"></a>  , <span class="at">min_height =</span> <span class="dv">2</span></span>
<span id="cb19-8"><a href="point-cloud-processing.html#cb19-8" tabindex="-1"></a>  , <span class="at">ws =</span> custom_lin <span class="co"># here it is</span></span>
<span id="cb19-9"><a href="point-cloud-processing.html#cb19-9" tabindex="-1"></a>  , <span class="at">keep_intrmdt =</span> T</span>
<span id="cb19-10"><a href="point-cloud-processing.html#cb19-10" tabindex="-1"></a>  <span class="co"># these are turned off by default but we&#39;ll be explicit</span></span>
<span id="cb19-11"><a href="point-cloud-processing.html#cb19-11" tabindex="-1"></a>  , <span class="at">estimate_tree_dbh =</span> F</span>
<span id="cb19-12"><a href="point-cloud-processing.html#cb19-12" tabindex="-1"></a>  , <span class="at">estimate_tree_competition =</span> F</span>
<span id="cb19-13"><a href="point-cloud-processing.html#cb19-13" tabindex="-1"></a>  , <span class="at">estimate_tree_type =</span> F</span>
<span id="cb19-14"><a href="point-cloud-processing.html#cb19-14" tabindex="-1"></a>  , <span class="at">estimate_tree_hmd =</span> F</span>
<span id="cb19-15"><a href="point-cloud-processing.html#cb19-15" tabindex="-1"></a>  , <span class="at">estimate_tree_cbh =</span> F</span>
<span id="cb19-16"><a href="point-cloud-processing.html#cb19-16" tabindex="-1"></a>)</span></code></pre></div>
<p>we should have a spatial tree list with tree height attached</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="point-cloud-processing.html#cb20-1" tabindex="-1"></a>cloud2trees_ans<span class="sc">$</span>crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="point-cloud-processing.html#cb20-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(treeID, tree_x, tree_y, tree_height_m, crown_area_m2) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="point-cloud-processing.html#cb20-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 2,629,495
## Columns: 6
## $ treeID        &lt;chr&gt; &quot;1877144&quot;, &quot;1876803&quot;, &quot;1876566&quot;, &quot;1875427&quot;, &quot;1872834&quot;, &quot;…
## $ tree_x        &lt;dbl&gt; 467000.1, 467000.1, 467000.1, 467000.1, 467000.1, 467000…
## $ tree_y        &lt;dbl&gt; 3808063, 3808065, 3808067, 3808074, 3808091, 3808124, 38…
## $ tree_height_m &lt;dbl&gt; 2.15, 2.34, 2.02, 2.11, 3.66, 4.37, 2.03, 5.60, 17.72, 2…
## $ crown_area_m2 &lt;dbl&gt; 0.3750, 0.7500, 0.2500, 0.3750, 1.2500, 0.9375, 0.3750, …
## $ geom          &lt;MULTIPOLYGON [m]&gt; MULTIPOLYGON (((467000 3808..., MULTIPOLYGO…</code></pre>
<p>That’s a lot of trees!</p>
<p>The <code>cloud2trees()</code> function dropped off a lot of additional data in a folder titled “point_cloud_processing_delivery” which is nested where we told the command to write the data (<code>output_dir = "../data"</code> parameter setting). Let’s load in the “processed_tracking_data.csv” file to see how long that <code>cloud2trees()</code> process took to run. Run times are, of course, dependent on computer processing and I am working on a laptop typical of a spatial analyst (especially outside of the US Federal Government) running Windows with an Intel i7-10750H 6-core computer processor unit and 32 gigabytes of random-access memory.</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="point-cloud-processing.html#cb22-1" tabindex="-1"></a><span class="co"># load processed_tracking_data.csv</span></span>
<span id="cb22-2"><a href="point-cloud-processing.html#cb22-2" tabindex="-1"></a>processing_data <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(</span>
<span id="cb22-3"><a href="point-cloud-processing.html#cb22-3" tabindex="-1"></a>    <span class="at">file =</span> <span class="st">&quot;../data/point_cloud_processing_delivery/processed_tracking_data.csv&quot;</span></span>
<span id="cb22-4"><a href="point-cloud-processing.html#cb22-4" tabindex="-1"></a>    , <span class="at">progress =</span> F</span>
<span id="cb22-5"><a href="point-cloud-processing.html#cb22-5" tabindex="-1"></a>    , <span class="at">show_col_types =</span> F</span>
<span id="cb22-6"><a href="point-cloud-processing.html#cb22-6" tabindex="-1"></a>  )</span>
<span id="cb22-7"><a href="point-cloud-processing.html#cb22-7" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb22-8"><a href="point-cloud-processing.html#cb22-8" tabindex="-1"></a>processing_data <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 1
## Columns: 4
## $ number_of_points        &lt;dbl&gt; 571949084
## $ las_area_m2             &lt;dbl&gt; 41999160
## $ timer_cloud2raster_mins &lt;dbl&gt; 135.4638
## $ timer_raster2trees_mins &lt;dbl&gt; 93.28212</code></pre>
<p>let’s do some math</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="point-cloud-processing.html#cb24-1" tabindex="-1"></a><span class="co"># total tree extraction time</span></span>
<span id="cb24-2"><a href="point-cloud-processing.html#cb24-2" tabindex="-1"></a>trees_mins_temp <span class="ot">&lt;-</span> processing_data<span class="sc">$</span>timer_cloud2raster_mins[<span class="dv">1</span>] <span class="sc">+</span> </span>
<span id="cb24-3"><a href="point-cloud-processing.html#cb24-3" tabindex="-1"></a>  processing_data<span class="sc">$</span>timer_raster2trees_mins[<span class="dv">1</span>]</span>
<span id="cb24-4"><a href="point-cloud-processing.html#cb24-4" tabindex="-1"></a><span class="co"># ha</span></span>
<span id="cb24-5"><a href="point-cloud-processing.html#cb24-5" tabindex="-1"></a>ha_temp <span class="ot">&lt;-</span> <span class="fu">round</span>(processing_data<span class="sc">$</span>las_area_m2[<span class="dv">1</span>]<span class="sc">/</span><span class="dv">10000</span>)</span>
<span id="cb24-6"><a href="point-cloud-processing.html#cb24-6" tabindex="-1"></a><span class="co"># secs per ha</span></span>
<span id="cb24-7"><a href="point-cloud-processing.html#cb24-7" tabindex="-1"></a>rate_temp <span class="ot">&lt;-</span> (trees_mins_temp<span class="sc">*</span><span class="dv">60</span>) <span class="sc">/</span> ha_temp</span>
<span id="cb24-8"><a href="point-cloud-processing.html#cb24-8" tabindex="-1"></a><span class="co"># point density</span></span>
<span id="cb24-9"><a href="point-cloud-processing.html#cb24-9" tabindex="-1"></a>dens_temp <span class="ot">&lt;-</span> processing_data<span class="sc">$</span>number_of_points[<span class="dv">1</span>] <span class="sc">/</span> processing_data<span class="sc">$</span>las_area_m2[<span class="dv">1</span>]</span></code></pre></div>
<p>Tree extraction over <strong>4,200</strong> hectares took a total of <strong>228.7</strong> minutes at processing rate of <strong>3.27</strong> seconds per hectare on lidar data with a point density of <strong>13.6</strong> points per square meter.</p>
</div>
<div id="dbh-modeling-trees_dbh" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> DBH Modeling: <code>trees_dbh()</code><a href="point-cloud-processing.html#dbh-modeling-trees_dbh" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>trees_dbh()</code> function uses the <a href="https://www.fs.usda.gov/rds/archive/catalog/RDS-2021-0074">TreeMap</a> FIA plot data in the area of the tree list to estimate the height-DBH allometry relationship. The height predicting DBH model built from the FIA data is then used to predict DBH based on tree height in the tree list.</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="point-cloud-processing.html#cb25-1" tabindex="-1"></a>trees_dbh_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">trees_dbh</span>()</span></code></pre></div>
</div>
<div id="cbh-modeling-trees_cbh" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> CBH Modeling: <code>trees_cbh()</code><a href="point-cloud-processing.html#cbh-modeling-trees_cbh" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The <code>trees_cbh()</code> function does work</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="point-cloud-processing.html#cb26-1" tabindex="-1"></a><span class="co"># where should we save the file?</span></span>
<span id="cb26-2"><a href="point-cloud-processing.html#cb26-2" tabindex="-1"></a>cbh_fn <span class="ot">&lt;-</span> <span class="st">&quot;../data/point_cloud_processing_delivery/cbh_data.csv&quot;</span></span>
<span id="cb26-3"><a href="point-cloud-processing.html#cb26-3" tabindex="-1"></a><span class="co"># if we don&#39;t already have the data, run it</span></span>
<span id="cb26-4"><a href="point-cloud-processing.html#cb26-4" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">file.exists</span>(cbh_fn)){</span>
<span id="cb26-5"><a href="point-cloud-processing.html#cb26-5" tabindex="-1"></a>  <span class="co"># sample size</span></span>
<span id="cb26-6"><a href="point-cloud-processing.html#cb26-6" tabindex="-1"></a>  nsamp_temp <span class="ot">&lt;-</span> <span class="dv">100000</span></span>
<span id="cb26-7"><a href="point-cloud-processing.html#cb26-7" tabindex="-1"></a>  <span class="co"># time it</span></span>
<span id="cb26-8"><a href="point-cloud-processing.html#cb26-8" tabindex="-1"></a>  st_temp <span class="ot">&lt;-</span> <span class="fu">Sys.time</span>()</span>
<span id="cb26-9"><a href="point-cloud-processing.html#cb26-9" tabindex="-1"></a>  <span class="co"># run it</span></span>
<span id="cb26-10"><a href="point-cloud-processing.html#cb26-10" tabindex="-1"></a>  trees_cbh_ans <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">trees_cbh</span>(</span>
<span id="cb26-11"><a href="point-cloud-processing.html#cb26-11" tabindex="-1"></a>    <span class="at">trees_poly =</span> cloud2trees_ans<span class="sc">$</span>crowns_sf</span>
<span id="cb26-12"><a href="point-cloud-processing.html#cb26-12" tabindex="-1"></a>    , <span class="at">norm_las =</span> <span class="st">&quot;../data/point_cloud_processing_delivery/norm_las/&quot;</span></span>
<span id="cb26-13"><a href="point-cloud-processing.html#cb26-13" tabindex="-1"></a>    , <span class="at">tree_sample_n =</span> nsamp_temp</span>
<span id="cb26-14"><a href="point-cloud-processing.html#cb26-14" tabindex="-1"></a>    <span class="co"># , tree_sample_prop = 0.08</span></span>
<span id="cb26-15"><a href="point-cloud-processing.html#cb26-15" tabindex="-1"></a>    , <span class="at">which_cbh =</span> <span class="st">&quot;lowest&quot;</span></span>
<span id="cb26-16"><a href="point-cloud-processing.html#cb26-16" tabindex="-1"></a>    , <span class="at">estimate_missing_cbh =</span> <span class="cn">TRUE</span></span>
<span id="cb26-17"><a href="point-cloud-processing.html#cb26-17" tabindex="-1"></a>    , <span class="at">min_vhp_n =</span> <span class="dv">3</span></span>
<span id="cb26-18"><a href="point-cloud-processing.html#cb26-18" tabindex="-1"></a>    , <span class="at">voxel_grain_size_m =</span> <span class="dv">1</span></span>
<span id="cb26-19"><a href="point-cloud-processing.html#cb26-19" tabindex="-1"></a>    , <span class="at">dist_btwn_bins_m =</span> <span class="dv">1</span></span>
<span id="cb26-20"><a href="point-cloud-processing.html#cb26-20" tabindex="-1"></a>    , <span class="at">min_fuel_layer_ht_m =</span> <span class="dv">1</span></span>
<span id="cb26-21"><a href="point-cloud-processing.html#cb26-21" tabindex="-1"></a>    , <span class="at">lad_pct_gap =</span> <span class="dv">25</span></span>
<span id="cb26-22"><a href="point-cloud-processing.html#cb26-22" tabindex="-1"></a>    , <span class="at">lad_pct_base =</span> <span class="dv">25</span></span>
<span id="cb26-23"><a href="point-cloud-processing.html#cb26-23" tabindex="-1"></a>    , <span class="at">num_jump_steps =</span> <span class="dv">1</span></span>
<span id="cb26-24"><a href="point-cloud-processing.html#cb26-24" tabindex="-1"></a>    , <span class="at">min_lad_pct =</span> <span class="dv">10</span></span>
<span id="cb26-25"><a href="point-cloud-processing.html#cb26-25" tabindex="-1"></a>    , <span class="at">frst_layer_min_ht_m =</span> <span class="dv">1</span></span>
<span id="cb26-26"><a href="point-cloud-processing.html#cb26-26" tabindex="-1"></a>    , <span class="at">force_same_crs =</span> T</span>
<span id="cb26-27"><a href="point-cloud-processing.html#cb26-27" tabindex="-1"></a>  )</span>
<span id="cb26-28"><a href="point-cloud-processing.html#cb26-28" tabindex="-1"></a>  <span class="co"># timer</span></span>
<span id="cb26-29"><a href="point-cloud-processing.html#cb26-29" tabindex="-1"></a>  <span class="do">## author note: test 1 with 20k sample took 58.56778 mins</span></span>
<span id="cb26-30"><a href="point-cloud-processing.html#cb26-30" tabindex="-1"></a>  mins_temp <span class="ot">&lt;-</span> <span class="fu">difftime</span>(<span class="fu">Sys.time</span>(),st_temp,<span class="at">units =</span> <span class="st">&quot;mins&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb26-31"><a href="point-cloud-processing.html#cb26-31" tabindex="-1"></a>  processing_data<span class="sc">$</span>timer_trees_cbh_mins <span class="ot">&lt;-</span> mins_temp</span>
<span id="cb26-32"><a href="point-cloud-processing.html#cb26-32" tabindex="-1"></a>  processing_data<span class="sc">$</span>sttng_cbh_tree_sample_n <span class="ot">&lt;-</span> nsamp_temp</span>
<span id="cb26-33"><a href="point-cloud-processing.html#cb26-33" tabindex="-1"></a>  processing_data<span class="sc">$</span>sttng_cbh_tree_sample_prop <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb26-34"><a href="point-cloud-processing.html#cb26-34" tabindex="-1"></a>  <span class="co"># save cbh</span></span>
<span id="cb26-35"><a href="point-cloud-processing.html#cb26-35" tabindex="-1"></a>  trees_cbh_ans <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb26-36"><a href="point-cloud-processing.html#cb26-36" tabindex="-1"></a>    <span class="fu">write.csv</span>(<span class="at">file =</span> cbh_fn, <span class="at">row.names =</span> F, <span class="at">append =</span> F)</span>
<span id="cb26-37"><a href="point-cloud-processing.html#cb26-37" tabindex="-1"></a>  <span class="co"># save tracking</span></span>
<span id="cb26-38"><a href="point-cloud-processing.html#cb26-38" tabindex="-1"></a>  processing_data <span class="sc">%&gt;%</span> </span>
<span id="cb26-39"><a href="point-cloud-processing.html#cb26-39" tabindex="-1"></a>    <span class="fu">write.csv</span>(</span>
<span id="cb26-40"><a href="point-cloud-processing.html#cb26-40" tabindex="-1"></a>      <span class="at">file =</span> <span class="st">&quot;../data/point_cloud_processing_delivery/processed_tracking_data.csv&quot;</span></span>
<span id="cb26-41"><a href="point-cloud-processing.html#cb26-41" tabindex="-1"></a>      , <span class="at">row.names =</span> F, <span class="at">append =</span> F</span>
<span id="cb26-42"><a href="point-cloud-processing.html#cb26-42" tabindex="-1"></a>    )</span>
<span id="cb26-43"><a href="point-cloud-processing.html#cb26-43" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb26-44"><a href="point-cloud-processing.html#cb26-44" tabindex="-1"></a>  <span class="co"># cbh data</span></span>
<span id="cb26-45"><a href="point-cloud-processing.html#cb26-45" tabindex="-1"></a>  trees_cbh_ans <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_csv</span>(cbh_fn, <span class="at">progress =</span> F, <span class="at">show_col_types =</span> F)</span>
<span id="cb26-46"><a href="point-cloud-processing.html#cb26-46" tabindex="-1"></a>  <span class="co"># re-cast treeID if needed</span></span>
<span id="cb26-47"><a href="point-cloud-processing.html#cb26-47" tabindex="-1"></a>  <span class="cf">if</span>(</span>
<span id="cb26-48"><a href="point-cloud-processing.html#cb26-48" tabindex="-1"></a>    <span class="sc">!</span><span class="fu">inherits</span>(</span>
<span id="cb26-49"><a href="point-cloud-processing.html#cb26-49" tabindex="-1"></a>      trees_cbh_ans<span class="sc">$</span>treeID</span>
<span id="cb26-50"><a href="point-cloud-processing.html#cb26-50" tabindex="-1"></a>      , <span class="fu">class</span>(cloud2trees_ans<span class="sc">$</span>crowns_sf<span class="sc">$</span>treeID)</span>
<span id="cb26-51"><a href="point-cloud-processing.html#cb26-51" tabindex="-1"></a>    )</span>
<span id="cb26-52"><a href="point-cloud-processing.html#cb26-52" tabindex="-1"></a>  ){</span>
<span id="cb26-53"><a href="point-cloud-processing.html#cb26-53" tabindex="-1"></a>    <span class="cf">if</span>(<span class="fu">inherits</span>(cloud2trees_ans<span class="sc">$</span>crowns_sf<span class="sc">$</span>treeID, <span class="st">&quot;character&quot;</span>)){</span>
<span id="cb26-54"><a href="point-cloud-processing.html#cb26-54" tabindex="-1"></a>      trees_cbh_ans<span class="sc">$</span>treeID <span class="ot">&lt;-</span> <span class="fu">as.character</span>(trees_cbh_ans<span class="sc">$</span>treeID)</span>
<span id="cb26-55"><a href="point-cloud-processing.html#cb26-55" tabindex="-1"></a>    }<span class="cf">else</span> <span class="cf">if</span>(<span class="fu">inherits</span>(cloud2trees_ans<span class="sc">$</span>crowns_sf<span class="sc">$</span>treeID, <span class="st">&quot;numeric&quot;</span>)){</span>
<span id="cb26-56"><a href="point-cloud-processing.html#cb26-56" tabindex="-1"></a>      trees_cbh_ans<span class="sc">$</span>treeID <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(trees_cbh_ans<span class="sc">$</span>treeID)</span>
<span id="cb26-57"><a href="point-cloud-processing.html#cb26-57" tabindex="-1"></a>    }</span>
<span id="cb26-58"><a href="point-cloud-processing.html#cb26-58" tabindex="-1"></a>  }  </span>
<span id="cb26-59"><a href="point-cloud-processing.html#cb26-59" tabindex="-1"></a>}</span></code></pre></div>
<p>CBH extraction for <strong>50,000</strong> trees took a total of <strong>159.4</strong> minutes at processing rate of <strong>3.19</strong> minutes per 1,000 trees…this is not fast and mostly a limitation of the <code>LadderFuelsR</code> which only allows for processing one tree at a time. Perhaps the author of <code>cloud2trees</code> will enable parallel processing at some point in the <a href="https://future.futureverse.org/index.html"><code>future</code></a>???</p>
<p>Let’s see what we got back from <code>trees_cbh()</code></p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="point-cloud-processing.html#cb27-1" tabindex="-1"></a>trees_cbh_ans <span class="sc">%&gt;%</span> </span>
<span id="cb27-2"><a href="point-cloud-processing.html#cb27-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(treeID, tree_cbh_m, is_training_cbh) <span class="sc">%&gt;%</span></span>
<span id="cb27-3"><a href="point-cloud-processing.html#cb27-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 2,629,495
## Columns: 3
## $ treeID          &lt;chr&gt; &quot;1877144&quot;, &quot;1876803&quot;, &quot;1876566&quot;, &quot;1875427&quot;, &quot;1872834&quot;,…
## $ tree_cbh_m      &lt;dbl&gt; 2.001330, 2.178191, 1.880319, 1.964096, 3.193244, 3.20…
## $ is_training_cbh &lt;lgl&gt; FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE, FALSE…</code></pre>
<p>We requested CBH extraction for <strong>50,000</strong> trees. For how many trees was CBH successfully extracted from the point cloud?</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="point-cloud-processing.html#cb29-1" tabindex="-1"></a>trees_cbh_ans <span class="sc">%&gt;%</span> </span>
<span id="cb29-2"><a href="point-cloud-processing.html#cb29-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(is_training_cbh)</span></code></pre></div>
<pre><code>## # A tibble: 2 × 2
##   is_training_cbh       n
##   &lt;lgl&gt;             &lt;int&gt;
## 1 FALSE           2615015
## 2 TRUE              14480</code></pre>
<p>That’s not a great success ;( … Someone should do something (or should they?)</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="validate-tree-detection-and-crown-delineation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
