<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Forest Stand Summary | Aerial LiDAR for Fire Model Inputs</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Forest Stand Summary | Aerial LiDAR for Fire Model Inputs" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Forest Stand Summary | Aerial LiDAR for Fire Model Inputs" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="processing.html"/>
<link rel="next" href="validate-tree-detection-and-crown-delineation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>2</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="processing.html"><a href="processing.html#lidar-data-location"><i class="fa fa-check"></i><b>2.1</b> Lidar Data Location</a></li>
<li class="chapter" data-level="2.2" data-path="processing.html"><a href="processing.html#individial-tree-detection-tuning-itd_tuning"><i class="fa fa-check"></i><b>2.2</b> Individial Tree Detection Tuning: <code id="itd">itd_tuning()</code></a></li>
<li class="chapter" data-level="2.3" data-path="processing.html"><a href="processing.html#point-cloud-tree-extraction-cloud2trees"><i class="fa fa-check"></i><b>2.3</b> Point Cloud Tree Extraction: <code id="trees">cloud2trees()</code></a></li>
<li class="chapter" data-level="2.4" data-path="processing.html"><a href="processing.html#dbh-modeling-trees_dbh"><i class="fa fa-check"></i><b>2.4</b> DBH Modeling: <code>trees_dbh()</code></a></li>
<li class="chapter" data-level="2.5" data-path="processing.html"><a href="processing.html#hmd-modeling-trees_hmd"><i class="fa fa-check"></i><b>2.5</b> HMD Modeling: <code>trees_hmd()</code></a></li>
<li class="chapter" data-level="2.6" data-path="processing.html"><a href="processing.html#cbh-modeling-trees_cbh"><i class="fa fa-check"></i><b>2.6</b> CBH Modeling: <code>trees_cbh()</code></a></li>
<li class="chapter" data-level="2.7" data-path="processing.html"><a href="processing.html#forest-type-trees_type"><i class="fa fa-check"></i><b>2.7</b> Forest Type: <code id="trees_type">trees_type()</code></a></li>
<li class="chapter" data-level="2.8" data-path="processing.html"><a href="processing.html#combine-data"><i class="fa fa-check"></i><b>2.8</b> Combine data</a></li>
<li class="chapter" data-level="2.9" data-path="processing.html"><a href="processing.html#crown-biomass-trees_biomass"><i class="fa fa-check"></i><b>2.9</b> Crown Biomass: <code id="trees_biomass">trees_biomass()</code></a></li>
<li class="chapter" data-level="2.10" data-path="processing.html"><a href="processing.html#processing-time-summary"><i class="fa fa-check"></i><b>2.10</b> Processing Time Summary</a></li>
<li class="chapter" data-level="2.11" data-path="processing.html"><a href="processing.html#data-export"><i class="fa fa-check"></i><b>2.11</b> Data Export</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html"><i class="fa fa-check"></i><b>3</b> Forest Stand Summary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#load-data"><i class="fa fa-check"></i><b>3.1</b> Load data</a></li>
<li class="chapter" data-level="3.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#silvicultural-metrics"><i class="fa fa-check"></i><b>3.2</b> Silvicultural metrics</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#height-distribution"><i class="fa fa-check"></i><b>3.2.1</b> Height Distribution</a></li>
<li class="chapter" data-level="3.2.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#dbh-distribution"><i class="fa fa-check"></i><b>3.2.2</b> DBH Distribution</a></li>
<li class="chapter" data-level="3.2.3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#forest-type"><i class="fa fa-check"></i><b>3.2.3</b> Forest Type</a></li>
<li class="chapter" data-level="3.2.4" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#crown-biomass"><i class="fa fa-check"></i><b>3.2.4</b> Crown Biomass</a></li>
<li class="chapter" data-level="3.2.5" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#summary-statistics"><i class="fa fa-check"></i><b>3.2.5</b> Summary Statistics</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#spatial-forest-structure"><i class="fa fa-check"></i><b>3.3</b> Spatial Forest Structure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#chm_plt"><i class="fa fa-check"></i><b>3.3.1</b> CHM</a></li>
<li class="chapter" data-level="3.3.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#function-to-rasterize"><i class="fa fa-check"></i><b>3.3.2</b> Function to Rasterize</a></li>
<li class="chapter" data-level="3.3.3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#mean-dbh"><i class="fa fa-check"></i><b>3.3.3</b> Mean DBH</a></li>
<li class="chapter" data-level="3.3.4" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#mean-height"><i class="fa fa-check"></i><b>3.3.4</b> Mean Height</a></li>
<li class="chapter" data-level="3.3.5" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#qmd"><i class="fa fa-check"></i><b>3.3.5</b> QMD</a></li>
<li class="chapter" data-level="3.3.6" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#basal-area"><i class="fa fa-check"></i><b>3.3.6</b> Basal Area</a></li>
<li class="chapter" data-level="3.3.7" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#tph"><i class="fa fa-check"></i><b>3.3.7</b> TPH</a></li>
<li class="chapter" data-level="3.3.8" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#cfl-cruz"><i class="fa fa-check"></i><b>3.3.8</b> CFL Cruz</a></li>
<li class="chapter" data-level="3.3.9" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#cfl-landfire"><i class="fa fa-check"></i><b>3.3.9</b> CFL LANDFIRE</a></li>
<li class="chapter" data-level="3.3.10" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#fia-forest-type-group"><i class="fa fa-check"></i><b>3.3.10</b> FIA Forest Type Group</a></li>
<li class="chapter" data-level="3.3.11" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#combine-by-stand-unit"><i class="fa fa-check"></i><b>3.3.11</b> Combine by stand unit</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#canopy-cover"><i class="fa fa-check"></i><b>3.4</b> Canopy Cover</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#entire-area"><i class="fa fa-check"></i><b>3.4.1</b> Entire Area</a></li>
<li class="chapter" data-level="3.4.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#stands"><i class="fa fa-check"></i><b>3.4.2</b> Stands</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#write-data"><i class="fa fa-check"></i><b>3.5</b> Write Data</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html"><i class="fa fa-check"></i><b>4</b> Validate Tree Detection and Crown Delineation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#neontreeevaluation-benchmark-overview"><i class="fa fa-check"></i><b>4.1</b> <code>NeonTreeEvaluation</code> benchmark overview</a></li>
<li class="chapter" data-level="4.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#lidar-data-in-neontreeevaluation"><i class="fa fa-check"></i><b>4.2</b> lidar data in <code id="neon_lidar">NeonTreeEvaluation</code></a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#training-data"><i class="fa fa-check"></i><b>4.2.1</b> Training data</a></li>
<li class="chapter" data-level="4.2.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#evaluation-data"><i class="fa fa-check"></i><b>4.2.2</b> Evaluation data</a></li>
<li class="chapter" data-level="4.2.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#filter-for-ground-truth-data"><i class="fa fa-check"></i><b>4.2.3</b> Filter for ground truth data</a></li>
<li class="chapter" data-level="4.2.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#filter-for-conifer-sites"><i class="fa fa-check"></i><b>4.2.4</b> Filter for conifer sites</a></li>
<li class="chapter" data-level="4.2.5" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#trn_dta"><i class="fa fa-check"></i><b>4.2.5</b> Augment training data</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#ht_filter"><i class="fa fa-check"></i><b>4.3</b> Height threshold for “canopy” trees</a></li>
<li class="chapter" data-level="4.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#ex_valid"><i class="fa fa-check"></i><b>4.4</b> Example validation process</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#preliminaries"><i class="fa fa-check"></i><b>4.4.1</b> Preliminaries</a></li>
<li class="chapter" data-level="4.4.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#cloud2treescloud2trees"><i class="fa fa-check"></i><b>4.4.2</b> <code>cloud2trees::cloud2trees()</code></a></li>
<li class="chapter" data-level="4.4.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#format-extracted-tree-polygons"><i class="fa fa-check"></i><b>4.4.3</b> Format extracted tree polygons</a></li>
<li class="chapter" data-level="4.4.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#test-evaluation"><i class="fa fa-check"></i><b>4.4.4</b> Test evaluation</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#itd_more"><i class="fa fa-check"></i><b>4.5</b> ITD tuning</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#default-variable-window-functions"><i class="fa fa-check"></i><b>4.5.1</b> Default variable window functions</a></li>
<li class="chapter" data-level="4.5.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#augmented-variable-window-functions"><i class="fa fa-check"></i><b>4.5.2</b> Augmented variable window functions</a></li>
</ul></li>
<li class="chapter" data-level="4.6" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#training-validation-process"><i class="fa fa-check"></i><b>4.6</b> Training validation process</a>
<ul>
<li class="chapter" data-level="4.6.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#summary-of-training-lidar-data"><i class="fa fa-check"></i><b>4.6.1</b> Summary of training lidar data</a></li>
<li class="chapter" data-level="4.6.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#function-to-extract-trees"><i class="fa fa-check"></i><b>4.6.2</b> Function to extract trees</a></li>
<li class="chapter" data-level="4.6.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#extract-trees-for-training-data"><i class="fa fa-check"></i><b>4.6.3</b> Extract trees for training data</a></li>
<li class="chapter" data-level="4.6.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#training-validation-against-ground-truth"><i class="fa fa-check"></i><b>4.6.4</b> Training: validation against ground truth</a></li>
<li class="chapter" data-level="4.6.5" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#best-variable-window-function"><i class="fa fa-check"></i><b>4.6.5</b> Best variable window function</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#evaluation-validation-process"><i class="fa fa-check"></i><b>4.7</b> Evaluation validation process</a>
<ul>
<li class="chapter" data-level="4.7.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#extract-trees-for-evaluation-data"><i class="fa fa-check"></i><b>4.7.1</b> Extract trees for evaluation data</a></li>
<li class="chapter" data-level="4.7.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#evaluation-validation-against-ground-truth"><i class="fa fa-check"></i><b>4.7.2</b> Evaluation: validation against ground truth</a></li>
</ul></li>
<li class="chapter" data-level="4.8" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#valid_sum"><i class="fa fa-check"></i><b>4.8</b> Summary of validation against ground truth</a>
<ul>
<li class="chapter" data-level="4.8.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#overall"><i class="fa fa-check"></i><b>4.8.1</b> Overall</a></li>
<li class="chapter" data-level="4.8.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#neon-site"><i class="fa fa-check"></i><b>4.8.2</b> NEON site</a></li>
</ul></li>
<li class="chapter" data-level="4.9" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#for-instance"><i class="fa fa-check"></i><b>4.9</b> FOR-instance</a>
<ul>
<li class="chapter" data-level="4.9.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#lidar-data-in-for-instance"><i class="fa fa-check"></i><b>4.9.1</b> lidar data in <strong>FOR-instance</strong></a></li>
<li class="chapter" data-level="4.9.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#example-validation-process"><i class="fa fa-check"></i><b>4.9.2</b> Example validation process</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="appendix.html"><a href="appendix.html"><i class="fa fa-check"></i><b>5</b> Appendix</a>
<ul>
<li class="chapter" data-level="5.1" data-path="appendix.html"><a href="appendix.html#data_ex"><i class="fa fa-check"></i><b>5.1</b> Example lidar data</a></li>
<li class="chapter" data-level="5.2" data-path="appendix.html"><a href="appendix.html#cbh"><i class="fa fa-check"></i><b>5.2</b> CBH Process</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="appendix.html"><a href="appendix.html#return-cbh-metrics"><i class="fa fa-check"></i><b>5.2.1</b> Return CBH Metrics</a></li>
<li class="chapter" data-level="5.2.2" data-path="appendix.html"><a href="appendix.html#cbh-on-the-point-cloud"><i class="fa fa-check"></i><b>5.2.2</b> CBH on the point cloud</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="appendix.html"><a href="appendix.html#hmd"><i class="fa fa-check"></i><b>5.3</b> HMD Process</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="appendix.html"><a href="appendix.html#one-tree-example"><i class="fa fa-check"></i><b>5.3.1</b> One Tree Example</a></li>
<li class="chapter" data-level="5.3.2" data-path="appendix.html"><a href="appendix.html#tree-list-example"><i class="fa fa-check"></i><b>5.3.2</b> Tree List Example</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial LiDAR for Fire Model Inputs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="forest-stand-summary" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Forest Stand Summary<a href="forest-stand-summary.html#forest-stand-summary" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section we’ll process the point cloud-extracted <a href="processing.html#processing">tree list data</a> given stand boundaries that fall within the extent of the original point cloud data. When processing point cloud data with the objective for summarizing data within a forest stand, it is imperative to ensure that the point cloud extent completely covers and extends beyond the stand extent to avoid edge effects and tree artifacts.</p>
<p>create a directory for saving our analysis output</p>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="forest-stand-summary.html#cb88-1" tabindex="-1"></a><span class="co"># make a dir for saving this stand-level data to</span></span>
<span id="cb88-2"><a href="forest-stand-summary.html#cb88-2" tabindex="-1"></a>outdir <span class="ot">&lt;-</span> <span class="st">&quot;../data/mogollon_rim_fire_unit_trees&quot;</span></span>
<span id="cb88-3"><a href="forest-stand-summary.html#cb88-3" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(outdir)){<span class="fu">dir.create</span>(outdir, <span class="at">showWarnings =</span> F)}</span></code></pre></div>
<div id="load-data" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Load data<a href="forest-stand-summary.html#load-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>first, we’ll load our stand data and the boundary data of the point cloud that we processed</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="forest-stand-summary.html#cb89-1" tabindex="-1"></a><span class="co"># las data bounds</span></span>
<span id="cb89-2"><a href="forest-stand-summary.html#cb89-2" tabindex="-1"></a>las_ctg_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/raw_las_ctg_info.gpkg&quot;</span>, <span class="at">quiet =</span> T)</span>
<span id="cb89-3"><a href="forest-stand-summary.html#cb89-3" tabindex="-1"></a><span class="co"># get our proj crs</span></span>
<span id="cb89-4"><a href="forest-stand-summary.html#cb89-4" tabindex="-1"></a>proj_crs <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(las_ctg_sf)</span>
<span id="cb89-5"><a href="forest-stand-summary.html#cb89-5" tabindex="-1"></a><span class="co"># stands</span></span>
<span id="cb89-6"><a href="forest-stand-summary.html#cb89-6" tabindex="-1"></a>stand_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/QUIK-Fire_Boundary/QUIK-Fire_Boundary.shp&quot;</span>, <span class="at">quiet =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb89-7"><a href="forest-stand-summary.html#cb89-7" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(proj_crs) <span class="sc">%&gt;%</span> </span>
<span id="cb89-8"><a href="forest-stand-summary.html#cb89-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">tolower</span>(stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(.x,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;_&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb89-9"><a href="forest-stand-summary.html#cb89-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">unit_id =</span> id) <span class="sc">%&gt;%</span> </span>
<span id="cb89-10"><a href="forest-stand-summary.html#cb89-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb89-11"><a href="forest-stand-summary.html#cb89-11" tabindex="-1"></a>    <span class="at">stand_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb89-12"><a href="forest-stand-summary.html#cb89-12" tabindex="-1"></a>    , <span class="at">stand_area_ha =</span> stand_area_m2<span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb89-13"><a href="forest-stand-summary.html#cb89-13" tabindex="-1"></a>  )</span>
<span id="cb89-14"><a href="forest-stand-summary.html#cb89-14" tabindex="-1"></a><span class="co"># set our colors for the units</span></span>
<span id="cb89-15"><a href="forest-stand-summary.html#cb89-15" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(stand_sf)<span class="sc">&lt;</span><span class="fu">length</span>(harrypotter<span class="sc">::</span>hp_palettes<span class="sc">$</span>hermionegranger)){</span>
<span id="cb89-16"><a href="forest-stand-summary.html#cb89-16" tabindex="-1"></a>  my_pal <span class="ot">&lt;-</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="fu">nrow</span>(stand_sf), <span class="at">option =</span> <span class="st">&quot;hermionegranger&quot;</span>)</span>
<span id="cb89-17"><a href="forest-stand-summary.html#cb89-17" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb89-18"><a href="forest-stand-summary.html#cb89-18" tabindex="-1"></a>  my_pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n=</span><span class="fu">nrow</span>(stand_sf))</span>
<span id="cb89-19"><a href="forest-stand-summary.html#cb89-19" tabindex="-1"></a>}</span></code></pre></div>
<p>what is the stand data?</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="forest-stand-summary.html#cb90-1" tabindex="-1"></a>stand_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 2
## Columns: 7
## $ unit_id       &lt;dbl&gt; 1, 2
## $ unit_name     &lt;chr&gt; &quot;300 RD to Rim&quot;, &quot;Middle Kehl Canyon&quot;
## $ hectares      &lt;dbl&gt; 119.658, 200.666
## $ acres         &lt;dbl&gt; 295.555, 495.645
## $ geometry      &lt;POLYGON [m]&gt; POLYGON ((470742 3810364, 4..., POLYGON ((469974.3 38112…
## $ stand_area_m2 &lt;dbl&gt; 1195649, 2005096
## $ stand_area_ha &lt;dbl&gt; 119.5649, 200.5096</code></pre>
<p>let’s look at these bounds on a map</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="forest-stand-summary.html#cb92-1" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb92-2"><a href="forest-stand-summary.html#cb92-2" tabindex="-1"></a>  las_ctg_sf</span>
<span id="cb92-3"><a href="forest-stand-summary.html#cb92-3" tabindex="-1"></a>  , <span class="at">layer.name =</span> <span class="st">&quot;point cloud tile&quot;</span></span>
<span id="cb92-4"><a href="forest-stand-summary.html#cb92-4" tabindex="-1"></a>  , <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb92-5"><a href="forest-stand-summary.html#cb92-5" tabindex="-1"></a>  , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb92-6"><a href="forest-stand-summary.html#cb92-6" tabindex="-1"></a>  , <span class="at">alpha.regions =</span> <span class="dv">0</span></span>
<span id="cb92-7"><a href="forest-stand-summary.html#cb92-7" tabindex="-1"></a>  , <span class="at">label =</span> <span class="cn">FALSE</span></span>
<span id="cb92-8"><a href="forest-stand-summary.html#cb92-8" tabindex="-1"></a>  , <span class="at">legend =</span> <span class="cn">FALSE</span></span>
<span id="cb92-9"><a href="forest-stand-summary.html#cb92-9" tabindex="-1"></a>  , <span class="at">popup =</span> <span class="cn">FALSE</span></span>
<span id="cb92-10"><a href="forest-stand-summary.html#cb92-10" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb92-11"><a href="forest-stand-summary.html#cb92-11" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb92-12"><a href="forest-stand-summary.html#cb92-12" tabindex="-1"></a>  stand_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(unit_name)</span>
<span id="cb92-13"><a href="forest-stand-summary.html#cb92-13" tabindex="-1"></a>  , <span class="at">zcol =</span> <span class="st">&quot;unit_name&quot;</span></span>
<span id="cb92-14"><a href="forest-stand-summary.html#cb92-14" tabindex="-1"></a>  , <span class="at">col.regions =</span> my_pal</span>
<span id="cb92-15"><a href="forest-stand-summary.html#cb92-15" tabindex="-1"></a>  , <span class="at">layer.name =</span> <span class="st">&quot;stand bounds&quot;</span></span>
<span id="cb92-16"><a href="forest-stand-summary.html#cb92-16" tabindex="-1"></a>  , <span class="at">alpha.regions =</span> <span class="fl">0.8</span></span>
<span id="cb92-17"><a href="forest-stand-summary.html#cb92-17" tabindex="-1"></a>) </span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-4a9d52fcad2925336d84" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-4a9d52fcad2925336d84">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-111.3590906056137,-111.359129155935,-111.348246743088,-111.3482093608689,-111.3590906056137],"lat":[34.41292258064113,34.42194061826054,34.42197208713579,34.41295403895751,34.41292258064113]}]],[[{"lng":[-111.3591291563206,-111.3591677237781,-111.3482841422981,-111.3482467434619,-111.3591291563206],"lat":[34.42194070844174,34.43095873270235,34.4309902121388,34.42197217731709,34.42194070844174]}]],[[{"lng":[-111.3591677241639,-111.359206308765,-111.3483215581326,-111.3482841426722,-111.3591677241639],"lat":[34.43095882288343,34.43997683378363,34.44000832378353,34.43099030231999,34.43095882288343]}]],[[{"lng":[-111.359206309151,-111.3592449109032,-111.3483589905986,-111.3483215585068,-111.359206309151],"lat":[34.43997692396457,34.44899492150276,34.44902642206831,34.44000841396457,34.43997692396457]}]],[[{"lng":[-111.3592449112893,-111.3592835302,-111.3483964397033,-111.348358990973,-111.3592449112893],"lat":[34.44899501168356,34.45801299585812,34.45804450699157,34.44902651224923,34.44899501168356]}]],[[{"lng":[-111.3592835305862,-111.3593221666628,-111.348433905454,-111.3483964400779,-111.3592835305862],"lat":[34.4580130860388,34.46703105684811,34.46706257855168,34.45804459717235,34.4580130860388]}]],[[{"lng":[-111.3593221670492,-111.3593608202991,-111.3484713878578,-111.3484339058287,-111.3593221670492],"lat":[34.46703114702865,34.4760491044711,34.47608063674702,34.46706266873232,34.46703114702865]}]],[[{"lng":[-111.3482092520552,-111.3482466342627,-111.3373642047988,-111.3373279907006,-111.3482092520552],"lat":[34.41295403926727,34.42197208744565,34.42200258809902,34.41298452968665,34.41295403926727]}]],[[{"lng":[-111.3482466346366,-111.3482840334612,-111.337400435357,-111.337364205161,-111.3482466346366],"lat":[34.42197217762695,34.43099021244876,34.43102072333842,34.42200267828045,34.42197217762695]}]],[[{"lng":[-111.3482840338352,-111.3483214492839,-111.3374366820201,-111.3374004357194,-111.3482840338352],"lat":[34.43099030262995,34.44000832409359,34.44003884522166,34.4310208135197,34.43099030262995]}]],[[{"lng":[-111.3483214496582,-111.3483588817382,-111.3374729447951,-111.3374366823827,-111.3483214496582],"lat":[34.44000841427463,34.44902642237847,34.44905695374714,34.44003893540282,34.44000841427463]}]],[[{"lng":[-111.3483588821126,-111.3483963308312,-111.3375092236889,-111.3374729451578,-111.3483588821126],"lat":[34.44902651255938,34.45804450730184,34.45807504891326,34.44905704392816,34.44902651255938]}]],[[{"lng":[-111.3483963312058,-111.3484337965702,-111.3375455187084,-111.3375092240517,-111.3483963312058],"lat":[34.45804459748261,34.46706257886205,34.46709313071839,34.45807513909414,34.45804459748261]}]],[[{"lng":[-111.3484337969449,-111.3484712789623,-111.3375818298608,-111.3375455190715,-111.3484337969449],"lat":[34.4670626690427,34.4760806370575,34.47611119916091,34.46709322089914,34.4670626690427]}]],[[{"lng":[-111.3373278818868,-111.3373640959733,-111.3264816504116,-111.3264466044413,-111.3373278818868],"lat":[34.41298452998672,34.42200258839919,34.42203212082592,34.41301405250429,34.41298452998672]}]],[[{"lng":[-111.3373640963356,-111.3374003265199,-111.326516712311,-111.3264816507622,-111.3373640963356],"lat":[34.42200267858061,34.43102072363869,34.43105026597675,34.42203221100743,34.42200267858061]}]],[[{"lng":[-111.3374003268822,-111.3374365731713,-111.3265517897958,-111.3265167126617,-111.3374003268822],"lat":[34.43102081381996,34.44003884552204,34.44006839777352,34.43105035615814,34.43102081381996]}]],[[{"lng":[-111.3374365735338,-111.3374728359345,-111.3265868828727,-111.3265517901466,-111.3374365735338],"lat":[34.44003893570318,34.44905695404761,34.44908651621461,34.44006848795475,34.44003893570318]}]],[[{"lng":[-111.3374728362973,-111.3375091148166,-111.3266219915486,-111.3265868832237,-111.3374728362973],"lat":[34.44905704422863,34.45807504921383,34.45810462129843,34.44908660639572,34.44905704422863]}]],[[{"lng":[-111.3375091151795,-111.3375454098245,-111.3266571158301,-111.3266219918998,-111.3375091151795],"lat":[34.45807513939471,34.46709313101906,34.46712271302336,34.45810471147941,34.45807513939471]}]],[[{"lng":[-111.3375454101875,-111.3375817209651,-111.326692255724,-111.3266571161814,-111.3375454101875],"lat":[34.4670932211998,34.47611119946169,34.47614079138779,34.4671228032042,34.4670932211998]}]],[[{"lng":[-111.3264464956274,-111.326481541586,-111.3155990804458,-111.3155652026101,-111.3264464956274],"lat":[34.41301405279468,34.4220321211164,34.42206068531185,34.41304260740583,34.41301405279468]}]],[[{"lng":[-111.3264815419365,-111.3265166034737,-111.3156329736795,-111.3155990807846,-111.3264815419365],"lat":[34.42203221129792,34.43105026626733,34.43107884004917,34.42206077549345,34.42203221129792]}]],[[{"lng":[-111.3265166038244,-111.3265516809468,-111.3156668819793,-111.3156329740186,-111.3265166038244],"lat":[34.43105035644871,34.44006839806421,34.44009698143444,34.43107893023063,34.43105035644871]}]],[[{"lng":[-111.3265516812976,-111.326586774012,-111.3157008053515,-111.3156668823184,-111.3265516812976],"lat":[34.44006848824544,34.4490865165054,34.44911510946607,34.44009707161578,34.44006848824544]}]],[[{"lng":[-111.326586774363,-111.3266218826762,-111.3157347438027,-111.3157008056908,-111.326586774363],"lat":[34.44908660668651,34.4581046215893,34.45813322414245,34.44911519964729,34.44908660668651]}]],[[{"lng":[-111.3266218830274,-111.326657006946,-111.3157686973394,-111.3157347441421,-111.3266218830274],"lat":[34.45810471177029,34.46712271331433,34.46715132546196,34.45813331432353,34.45810471177029]}]],[[{"lng":[-111.3266570072973,-111.3266921468282,-111.3158026659681,-111.315768697679,-111.3266570072973],"lat":[34.46712280349517,34.47614079167885,34.476169413423,34.4671514156429,34.46712280349517]}]],[[{"lng":[-111.3155650937961,-111.31559897162,-111.3047164954205,-111.304683785726,-111.3155650937961],"lat":[34.41304260768655,34.42206068559265,34.42208828155231,34.4130701943868,34.41304260768655]}]],[[{"lng":[-111.3155989719588,-111.3156328648421,-111.3047492199821,-111.3047164957476,-111.3155989719588],"lat":[34.42206077577426,34.43107884033005,34.43110644555117,34.422088371734,34.42206077577426]}]],[[{"lng":[-111.3156328651811,-111.3156667731301,-111.3047819590903,-111.3047492203094,-111.3156328651811],"lat":[34.43107893051153,34.44009698171543,34.44012459619995,34.43110653573274,34.43107893051153]}]],[[{"lng":[-111.3156667734693,-111.3157006964906,-111.3048147127513,-111.3047819594178,-111.3156667734693],"lat":[34.44009707189678,34.44911510974716,34.44914273349703,34.44012468638138,34.44009707189678]}]],[[{"lng":[-111.3157006968299,-111.3157346349301,-111.3048474809712,-111.3048147130789,-111.3157006968299],"lat":[34.44911519992836,34.45813322442364,34.45816085744082,34.44914282367834,34.44911519992836]}]],[[{"lng":[-111.3157346352696,-111.3157685884551,-111.3048802637566,-111.304847481299,-111.3157346352696],"lat":[34.45813331460471,34.46715132574324,34.46717896802971,34.45816094762199,34.45813331460471]}]],[[{"lng":[-111.3157685887947,-111.3158025570721,-111.3049130611136,-111.3048802640845,-111.3157685887947],"lat":[34.46715141592418,34.47616941370438,34.47619706526206,34.46717905821072,34.46715141592418]}]],[[{"lng":[-111.3046836769118,-111.3047163865945,-111.2938338958549,-111.2938023543079,-111.3046836769118],"lat":[34.41307019465783,34.42208828182342,34.42211490954298,34.41309681344286,34.41307019465783]}]],[[{"lng":[-111.3047163869217,-111.3047491111445,-111.2938654517383,-111.2938338961704,-111.3047163869217],"lat":[34.42208837200513,34.43110644582238,34.43113308247844,34.42211499972477,34.42208837200513]}]],[[{"lng":[-111.3047491114718,-111.304781850241,-111.2938970216486,-111.2938654520539,-111.3047491114718],"lat":[34.43110653600394,34.44012459647125,34.44015124206571,34.43113317266009,34.43110653600394]}]],[[{"lng":[-111.3047818505685,-111.3048146038903,-111.2939286055919,-111.2938970219643,-111.3047818505685],"lat":[34.44012468665269,34.44914273376843,34.44916938830315,34.44015133224722,34.44012468665269]}]],[[{"lng":[-111.3048146042179,-111.3048473720985,-111.2939602035745,-111.2939286059079,-111.3048146042179],"lat":[34.44914282394973,34.4581608577123,34.45818752118919,34.44916947848454,34.44914282394973]}]],[[{"lng":[-111.3048473724263,-111.3048801548722,-111.2939918156022,-111.2939602038905,-111.3048473724263],"lat":[34.45816094789348,34.46717896830127,34.46720564072221,34.45818761137045,34.45816094789348]}]],[[{"lng":[-111.3048801552001,-111.3049129522175,-111.2940234416812,-111.2939918159184,-111.3048801552001],"lat":[34.46717905848231,34.47619706553372,34.4762237469006,34.46720573090333,34.46717905848231]}]]],null,"point cloud tile",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#000000","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":2,"opacity":0.9,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addPolygons","args":[[[[{"lng":[-111.318453650637,-111.3182866480628,-111.317772884706,-111.3170343318785,-111.3165523730136,-111.3160133220289,-111.3152818887629,-111.3147299218832,-111.3143122984769,-111.3134699780787,-111.3129760932394,-111.3124952677317,-111.3122831263404,-111.311684782949,-111.3111829703959,-111.3107074412939,-111.3101614851318,-111.3098016045367,-111.3093819816423,-111.309033122576,-111.3086649884428,-111.3083521870997,-111.3081391681285,-111.3078542779671,-111.3074415219401,-111.306977601141,-111.3075034947721,-111.3078622667358,-111.3081949144087,-111.3084632736794,-111.3084096612568,-111.3087432009792,-111.309205815998,-111.3097184328307,-111.3100113643522,-111.3100747020982,-111.3102540543142,-111.3106780238355,-111.3110113893694,-111.3111648515436,-111.3113572609858,-111.3117303216926,-111.3121810428968,-111.3123494667637,-111.3122861763335,-111.3127627896504,-111.3136117138048,-111.3142163354694,-111.3147822443388,-111.3155015227932,-111.3158342288637,-111.315975052801,-111.3163856207979,-111.3168980926859,-111.3173219604144,-111.317487620429,-111.3175633930894,-111.3177818366606,-111.3181684790509,-111.3183750285075,-111.3187742546873,-111.3190708944468,-111.319354752721,-111.3197033384362,-111.320115190813,-111.320821776613,-111.3212318345467,-111.3215510249601,-111.3219094964817,-111.3221522726,-111.3228065599685,-111.3231780467556,-111.323575051641,-111.3237032347619,-111.3236627957221,-111.3237773747401,-111.3241118222639,-111.3243559792155,-111.3247556912324,-111.3249496731771,-111.3253487699412,-111.3256965376764,-111.3259931420752,-111.3260703230257,-111.3266104238422,-111.3271002741323,-111.3273968831595,-111.3277325002532,-111.3273348920163,-111.3268346618033,-111.3262570789151,-111.3256928513428,-111.3253853998881,-111.3250908512052,-111.3248739376451,-111.3247472351174,-111.3245691980895,-111.3241479727192,-111.3238168309001,-111.3233181968221,-111.3228955934634,-111.3221515720253,-111.3216385353475,-111.3208943748134,-111.3195327286205,-111.318530678885,-111.318453650637,-111.318453650637],"lat":[34.43435202505595,34.43441641670445,34.43463893699578,34.43495530853816,34.43508447080644,34.43542696829488,34.43592985171716,34.43626171735374,34.43639603494018,34.43649413233342,34.43687913853807,34.43731740674717,34.43735525684711,34.43733013469084,34.43731542347684,34.43744987610071,34.43767511107797,34.43777195863075,34.43736796087115,34.43696378282475,34.43656498213999,34.43546784482916,34.43526585162689,34.43476024375153,34.43446814635165,34.43425612211031,34.43382575664231,34.43343045305491,34.43292861938403,34.43243760643713,34.43185146987606,34.43159480058365,34.4314550584641,34.43092078691267,34.43012058302378,34.42985393520309,34.42965095002525,34.42950064087165,34.42920132781996,34.42895576916635,34.42880604659024,34.42880509626344,34.42893186048207,34.42925121517001,34.42952852354204,34.42969785742843,34.42966370499575,34.42966215305967,34.42962871931638,34.42932840017124,34.42885852388291,34.42867694880039,34.42838808112946,34.42783246079589,34.42766080990745,34.42724465980141,34.42687138084656,34.42680685650003,34.42699772213228,34.42718905547788,34.42730526997572,34.42750702677165,34.42773013519395,34.42805966865864,34.42811188880159,34.42786486905618,34.42744807259498,34.42681832385926,34.42636968222127,34.42594266329503,34.42548257995318,34.42507653815868,34.42461713024027,34.42449953661312,34.42401996636492,34.42371053773025,34.4237096519137,34.42364504768914,34.42388915540894,34.4241551275575,34.4242393425288,34.42435567137307,34.42454675205832,34.42454654631772,34.42450246723953,34.42476764547452,34.42495872271606,34.42525628962435,34.42555582017938,34.42593024015156,34.42626222647711,34.42672208838555,34.42705335092074,34.42739523786513,34.42785417225866,34.42835550468357,34.42888895164696,34.42974282767767,34.43060712315841,34.43140790366825,34.43191001586236,34.43246627109196,34.43287268175865,34.43339695122818,34.43393349060743,34.43430918652738,34.43435202505595,34.43435202505595]}]],[[{"lng":[-111.3268397729984,-111.324957358767,-111.3247532678549,-111.324589217805,-111.3240253862377,-111.323564029901,-111.3232206472068,-111.3228498400423,-111.3225189199106,-111.322083518372,-111.321930868375,-111.3218811160641,-111.3215869606315,-111.3215495425583,-111.3218342663583,-111.3225183448806,-111.3225456377526,-111.3219575616375,-111.3213681648128,-111.3211549295494,-111.320983146138,-111.3212821785884,-111.321270351223,-111.3210147159719,-111.3207465354655,-111.3207543556577,-111.3208855501223,-111.3207581873699,-111.320470207148,-111.3200407064801,-111.3199112216265,-111.319822896801,-111.319736366013,-111.3196333424714,-111.3194519069659,-111.319254792461,-111.3190064161332,-111.3183624227598,-111.318021002265,-111.3178851818559,-111.317916162157,-111.3181466993185,-111.3183485634185,-111.3185699825866,-111.3186049262061,-111.3185237074302,-111.3183977219174,-111.3182012019315,-111.3177623858106,-111.3172723006296,-111.3169917852182,-111.316830062988,-111.3167744460419,-111.3167174509903,-111.3167097189148,-111.3164917818521,-111.3163738976113,-111.3162246082552,-111.3159791311611,-111.3157664625152,-111.315510209457,-111.3154263323503,-111.3154630723167,-111.3155829265334,-111.3157705015339,-111.3158394853437,-111.3159019599289,-111.3158984770834,-111.315857999452,-111.3157307749377,-111.3155331588174,-111.3152748361077,-111.3150073867902,-111.3142894261145,-111.3134079811258,-111.3129778200328,-111.3134631691185,-111.3140436462076,-111.3141328098383,-111.3142823439588,-111.3144869316145,-111.3144888000602,-111.3145910678479,-111.3144191605765,-111.3145338254021,-111.3144751847972,-111.3146283096824,-111.3145890994708,-111.3143148392145,-111.3142336129567,-111.3142782277295,-111.3147020633985,-111.3150873667372,-111.315298807245,-111.3155093849634,-111.3153214166312,-111.3153457679593,-111.3154212244682,-111.3152584715578,-111.3152186913106,-111.3155398890671,-111.3158155323534,-111.3161366273706,-111.3159934931538,-111.3159782993858,-111.3161049129795,-111.3164506075557,-111.316964440464,-111.3175296536145,-111.3177341761155,-111.3177446208685,-111.3177682943048,-111.3179852335243,-111.3184211668607,-111.3188582297949,-111.3193329149521,-111.3201282145037,-111.3209626686051,-111.3215030916138,-111.321851802625,-111.3220203603428,-111.3222520189943,-111.3228040826745,-111.3234198528361,-111.3240482345626,-111.3248431123392,-111.3255096575813,-111.3262155743885,-111.3271531341884,-111.3271540895342,-111.3272477585034,-111.3274182048851,-111.3279891440535,-111.3286112285867,-111.329064822778,-111.3287984021072,-111.3283257451251,-111.3276089145989,-111.3268397729984],"lat":[34.44211397694168,34.44442143764614,34.44488033660615,34.44571220992324,34.44631063498294,34.44679153225881,34.44783706705263,34.44844563558654,34.44938987047622,34.44993465023739,34.45039340863766,34.45084123651525,34.451311026334,34.45162024875006,34.45204587749917,34.45258770662865,34.45299269356251,34.45399623140117,34.45465866759908,34.45526148642221,34.45576826102926,34.45656693356912,34.45683878035304,34.45729247801631,34.45783148353547,34.45819388388343,34.45884909492694,34.45919586081723,34.45960700432128,34.46002917713681,34.46024270472977,34.4607039563246,34.46079212299594,34.46077373840167,34.46044110536855,34.46021510733136,34.46004520477315,34.45990298120149,34.45979994036546,34.459616418356,34.45930188443869,34.45901081506244,34.45879443596994,34.45864462706446,34.45852728219356,34.45831963480671,34.45818405516387,34.45811261562513,34.45777531983187,34.45749145269676,34.4573269590574,34.45709820032032,34.45685317731157,34.45624307196544,34.4558993249877,34.45526565251011,34.4547169962538,34.45437095052778,34.45411042880004,34.45401904053988,34.45388645903756,34.45339634091415,34.45290058180347,34.45269241324927,34.45252803991047,34.45247989420351,34.45241177880992,34.45234116896027,34.45227065469,34.4522296779385,34.45229014750902,34.45246136510318,34.45277251092822,34.45261979665483,34.45262205936164,34.45200491319313,34.45103365972111,34.44969707360096,34.44945434196094,34.44901159029801,34.4486672968,34.44830753534885,34.44812872636219,34.44775075782363,34.44744666836044,34.4472496192218,34.4469081226176,34.44674566675803,34.44652252344533,34.44630687816012,34.44619483916181,34.44598855441772,34.44580102156117,34.44557129810322,34.44511239807944,34.44473980179058,34.44437198752794,34.44390810624504,34.443396871689,34.44308252002801,34.44295910773335,34.44269723920834,34.44254717694593,34.44212116827013,34.44150295843416,34.44095899831156,34.44051040647502,34.44029588625804,34.44005991153367,34.43970761776848,34.43906802238147,34.43852432780305,34.4380547470748,34.43765921220119,34.43756213808125,34.43720913679058,34.43658880788428,34.43611760367265,34.43613750300653,34.4364883483846,34.43682900780094,34.43684971649582,34.43654979518026,34.43608981078473,34.43556583300591,34.43484953925413,34.4342188577663,34.43379059766494,34.43338303296945,34.43362819839495,34.43455532222225,34.43537564554993,34.43662127389128,34.43778148607671,34.43862236432463,34.43958243300774,34.4404471197182,34.44138707518518,34.44211397694168]}]]],null,"stand bounds",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":[0.9,0.9],"fill":true,"fillColor":["#660012","#E59950"],"fillOpacity":[0.8,0.8],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>unit_name&emsp;<\/th><td>300 RD to Rim&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>unit_name&emsp;<\/th><td>Middle Kehl Canyon&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["300 RD to Rim","Middle Kehl Canyon"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.6400000000000001,"bringToFront":false,"sendToBack":false}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],["point cloud tile","stand bounds"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#660012","#E59950"],"labels":["300 RD to Rim","Middle Kehl Canyon"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"stand bounds","extra":null,"layerId":null,"className":"info legend","group":"stand bounds"}]},{"method":"addHomeButton","args":[-111.3593608202991,34.41292258064113,-111.2938023543079,34.4762237469006,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[34.41292258064113,34.4762237469006],"lng":[-111.3593608202991,-111.2938023543079]},"fitBounds":[34.41292258064113,-111.3593608202991,34.4762237469006,-111.2938023543079,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>we processed point cloud data well outside these stand bounds (it is not necessary to process data <em>this</em> far outside of our stands, a one tile buffer in this situation would have sufficed)</p>
<p>load in the tree top points data from <code>cloud2trees::cloud2trees()</code></p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="forest-stand-summary.html#cb93-1" tabindex="-1"></a><span class="co"># get the data from already run</span></span>
<span id="cb93-2"><a href="forest-stand-summary.html#cb93-2" tabindex="-1"></a>treetops_sf <span class="ot">&lt;-</span></span>
<span id="cb93-3"><a href="forest-stand-summary.html#cb93-3" tabindex="-1"></a>  <span class="fu">list.files</span>(</span>
<span id="cb93-4"><a href="forest-stand-summary.html#cb93-4" tabindex="-1"></a>    <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span></span>
<span id="cb93-5"><a href="forest-stand-summary.html#cb93-5" tabindex="-1"></a>    , <span class="at">pattern =</span> <span class="st">&quot;final_detected_tree_tops.*</span><span class="sc">\\</span><span class="st">.gpkg$&quot;</span></span>
<span id="cb93-6"><a href="forest-stand-summary.html#cb93-6" tabindex="-1"></a>    , <span class="at">full.names =</span> T</span>
<span id="cb93-7"><a href="forest-stand-summary.html#cb93-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb93-8"><a href="forest-stand-summary.html#cb93-8" tabindex="-1"></a>  <span class="fu">normalizePath</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb93-9"><a href="forest-stand-summary.html#cb93-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb93-10"><a href="forest-stand-summary.html#cb93-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb93-11"><a href="forest-stand-summary.html#cb93-11" tabindex="-1"></a>      <span class="at">dsn =</span> x</span>
<span id="cb93-12"><a href="forest-stand-summary.html#cb93-12" tabindex="-1"></a>      , <span class="at">quiet =</span> T</span>
<span id="cb93-13"><a href="forest-stand-summary.html#cb93-13" tabindex="-1"></a>    )</span>
<span id="cb93-14"><a href="forest-stand-summary.html#cb93-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb93-15"><a href="forest-stand-summary.html#cb93-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span></code></pre></div>
<p>we’ll keep only trees where the tree top point falls within one of our stands and then use this tree list to filter our crown data so that we get the full crown polygon even if it extends outside of the stand boundary</p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="forest-stand-summary.html#cb94-1" tabindex="-1"></a>treetops_sf <span class="ot">&lt;-</span> treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb94-2"><a href="forest-stand-summary.html#cb94-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(stand_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(unit_id,unit_name,tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;stand_area_&quot;</span>)))</span></code></pre></div>
<p>The tree top point data is easier to work with for analysis since it takes less memory to load into our session and has the exact same structure as the crown polygons. At the end, we’ll bring in our crown polygon data, filter it with this tree list, and save it for sharing.</p>
<p>load in the DTM, aggregate to 2 m resolution, and write it</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="forest-stand-summary.html#cb95-1" tabindex="-1"></a>dtm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/dtm_1m.tif&quot;</span>)</span>
<span id="cb95-2"><a href="forest-stand-summary.html#cb95-2" tabindex="-1"></a><span class="co"># quick plot</span></span>
<span id="cb95-3"><a href="forest-stand-summary.html#cb95-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(dtm_rast, <span class="at">axes =</span> F, <span class="at">main =</span> <span class="st">&quot;DTM (m)&quot;</span>)</span>
<span id="cb95-4"><a href="forest-stand-summary.html#cb95-4" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">vect</span>(stand_sf), <span class="at">add =</span> T, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-81-1.png" width="1008" /></p>
<p>aggregate to 2 m</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="forest-stand-summary.html#cb96-1" tabindex="-1"></a>res_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(dtm_rast)[<span class="dv">1</span>]</span>
<span id="cb96-2"><a href="forest-stand-summary.html#cb96-2" tabindex="-1"></a>des_res_temp <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb96-3"><a href="forest-stand-summary.html#cb96-3" tabindex="-1"></a><span class="cf">if</span>(res_temp<span class="sc">&lt;</span>des_res_temp){</span>
<span id="cb96-4"><a href="forest-stand-summary.html#cb96-4" tabindex="-1"></a>  dtm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb96-5"><a href="forest-stand-summary.html#cb96-5" tabindex="-1"></a>    dtm_rast</span>
<span id="cb96-6"><a href="forest-stand-summary.html#cb96-6" tabindex="-1"></a>    , <span class="at">fact =</span> <span class="fu">round</span>(des_res_temp<span class="sc">/</span>res_temp)</span>
<span id="cb96-7"><a href="forest-stand-summary.html#cb96-7" tabindex="-1"></a>    , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb96-8"><a href="forest-stand-summary.html#cb96-8" tabindex="-1"></a>    , <span class="at">na.rm =</span> T</span>
<span id="cb96-9"><a href="forest-stand-summary.html#cb96-9" tabindex="-1"></a>    , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb96-10"><a href="forest-stand-summary.html#cb96-10" tabindex="-1"></a>    , <span class="at">filename =</span> <span class="fu">file.path</span>(outdir, <span class="fu">paste0</span>(<span class="st">&quot;dtm_&quot;</span>,des_res_temp, <span class="st">&quot;m.tif&quot;</span>))</span>
<span id="cb96-11"><a href="forest-stand-summary.html#cb96-11" tabindex="-1"></a>    , <span class="at">overwrite =</span> T</span>
<span id="cb96-12"><a href="forest-stand-summary.html#cb96-12" tabindex="-1"></a>  )</span>
<span id="cb96-13"><a href="forest-stand-summary.html#cb96-13" tabindex="-1"></a>}</span>
<span id="cb96-14"><a href="forest-stand-summary.html#cb96-14" tabindex="-1"></a><span class="co"># what is the res?</span></span>
<span id="cb96-15"><a href="forest-stand-summary.html#cb96-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(dtm_rast)</span></code></pre></div>
<p>we can also load in the CHM raster and look at that quickly</p>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb97-1"><a href="forest-stand-summary.html#cb97-1" tabindex="-1"></a>chm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/chm_0.25m.tif&quot;</span>)</span>
<span id="cb97-2"><a href="forest-stand-summary.html#cb97-2" tabindex="-1"></a><span class="co"># quick plot</span></span>
<span id="cb97-3"><a href="forest-stand-summary.html#cb97-3" tabindex="-1"></a>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb97-4"><a href="forest-stand-summary.html#cb97-4" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb97-5"><a href="forest-stand-summary.html#cb97-5" tabindex="-1"></a>    <span class="at">fact =</span> <span class="dv">1</span><span class="sc">/</span>terra<span class="sc">::</span><span class="fu">res</span>(chm_rast)[<span class="dv">1</span>]</span>
<span id="cb97-6"><a href="forest-stand-summary.html#cb97-6" tabindex="-1"></a>    , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb97-7"><a href="forest-stand-summary.html#cb97-7" tabindex="-1"></a>    , <span class="at">na.rm =</span> T</span>
<span id="cb97-8"><a href="forest-stand-summary.html#cb97-8" tabindex="-1"></a>    , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb97-9"><a href="forest-stand-summary.html#cb97-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb97-10"><a href="forest-stand-summary.html#cb97-10" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb97-11"><a href="forest-stand-summary.html#cb97-11" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>)</span>
<span id="cb97-12"><a href="forest-stand-summary.html#cb97-12" tabindex="-1"></a>    , <span class="at">axes =</span> F, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb97-13"><a href="forest-stand-summary.html#cb97-13" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb97-14"><a href="forest-stand-summary.html#cb97-14" tabindex="-1"></a>  )</span>
<span id="cb97-15"><a href="forest-stand-summary.html#cb97-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">vect</span>(stand_sf), <span class="at">add =</span> T, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-84-1.png" width="1008" /></p>
</div>
<div id="silvicultural-metrics" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Silvicultural metrics<a href="forest-stand-summary.html#silvicultural-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s look at some common stand-level forestry metrics</p>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="forest-stand-summary.html#cb98-1" tabindex="-1"></a><span class="do">### stand-level summaries</span></span>
<span id="cb98-2"><a href="forest-stand-summary.html#cb98-2" tabindex="-1"></a>silv_metrics <span class="ot">&lt;-</span></span>
<span id="cb98-3"><a href="forest-stand-summary.html#cb98-3" tabindex="-1"></a>  treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb98-4"><a href="forest-stand-summary.html#cb98-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb98-5"><a href="forest-stand-summary.html#cb98-5" tabindex="-1"></a>    <span class="co"># dplyr::filter(dbh_cm &gt;= ostory_dbh_cm) %&gt;% </span></span>
<span id="cb98-6"><a href="forest-stand-summary.html#cb98-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-7"><a href="forest-stand-summary.html#cb98-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_id, unit_name, stand_area_ha) <span class="sc">%&gt;%</span></span>
<span id="cb98-8"><a href="forest-stand-summary.html#cb98-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb98-9"><a href="forest-stand-summary.html#cb98-9" tabindex="-1"></a>      <span class="at">n_trees =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(treeID)</span>
<span id="cb98-10"><a href="forest-stand-summary.html#cb98-10" tabindex="-1"></a>      , <span class="at">mean_dbh_cm =</span> <span class="fu">mean</span>(dbh_cm, <span class="at">na.rm =</span> T)</span>
<span id="cb98-11"><a href="forest-stand-summary.html#cb98-11" tabindex="-1"></a>      , <span class="at">mean_tree_height_m =</span> <span class="fu">mean</span>(tree_height_m, <span class="at">na.rm =</span> T)</span>
<span id="cb98-12"><a href="forest-stand-summary.html#cb98-12" tabindex="-1"></a>      , <span class="at">loreys_height_m =</span> <span class="fu">sum</span>(basal_area_m2<span class="sc">*</span>tree_height_m, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">sum</span>(basal_area_m2, <span class="at">na.rm =</span> T)</span>
<span id="cb98-13"><a href="forest-stand-summary.html#cb98-13" tabindex="-1"></a>      , <span class="at">basal_area_m2 =</span> <span class="fu">sum</span>(basal_area_m2, <span class="at">na.rm =</span> T)</span>
<span id="cb98-14"><a href="forest-stand-summary.html#cb98-14" tabindex="-1"></a>      , <span class="at">sum_dbh_cm_sq =</span> <span class="fu">sum</span>(dbh_cm<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb98-15"><a href="forest-stand-summary.html#cb98-15" tabindex="-1"></a>      , <span class="at">landfire_crown_biomass_kg =</span> <span class="fu">sum</span>(landfire_crown_biomass_kg, <span class="at">na.rm =</span> T)</span>
<span id="cb98-16"><a href="forest-stand-summary.html#cb98-16" tabindex="-1"></a>      , <span class="at">cruz_crown_biomass_kg =</span> <span class="fu">sum</span>(cruz_crown_biomass_kg, <span class="at">na.rm =</span> T)</span>
<span id="cb98-17"><a href="forest-stand-summary.html#cb98-17" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb98-18"><a href="forest-stand-summary.html#cb98-18" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb98-19"><a href="forest-stand-summary.html#cb98-19" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb98-20"><a href="forest-stand-summary.html#cb98-20" tabindex="-1"></a>      <span class="at">trees_per_ha =</span> (n_trees<span class="sc">/</span>stand_area_ha)</span>
<span id="cb98-21"><a href="forest-stand-summary.html#cb98-21" tabindex="-1"></a>      , <span class="at">basal_area_m2_per_ha =</span> (basal_area_m2<span class="sc">/</span>stand_area_ha)</span>
<span id="cb98-22"><a href="forest-stand-summary.html#cb98-22" tabindex="-1"></a>      , <span class="at">qmd_cm =</span> <span class="fu">sqrt</span>(sum_dbh_cm_sq<span class="sc">/</span>n_trees)</span>
<span id="cb98-23"><a href="forest-stand-summary.html#cb98-23" tabindex="-1"></a>      , <span class="at">landfire_cfl_kg_m2 =</span> landfire_crown_biomass_kg<span class="sc">/</span>(stand_area_ha<span class="sc">*</span><span class="dv">10000</span>)</span>
<span id="cb98-24"><a href="forest-stand-summary.html#cb98-24" tabindex="-1"></a>      , <span class="at">cruz_cfl_kg_m2 =</span> cruz_crown_biomass_kg<span class="sc">/</span>(stand_area_ha<span class="sc">*</span><span class="dv">10000</span>)</span>
<span id="cb98-25"><a href="forest-stand-summary.html#cb98-25" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb98-26"><a href="forest-stand-summary.html#cb98-26" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(sum_dbh_cm_sq,landfire_crown_biomass_kg,cruz_crown_biomass_kg))</span>
<span id="cb98-27"><a href="forest-stand-summary.html#cb98-27" tabindex="-1"></a></span>
<span id="cb98-28"><a href="forest-stand-summary.html#cb98-28" tabindex="-1"></a><span class="do">### export tabular</span></span>
<span id="cb98-29"><a href="forest-stand-summary.html#cb98-29" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb98-30"><a href="forest-stand-summary.html#cb98-30" tabindex="-1"></a>    silv_metrics</span>
<span id="cb98-31"><a href="forest-stand-summary.html#cb98-31" tabindex="-1"></a>    , <span class="fu">file.path</span>(outdir, <span class="st">&quot;stand_silv_metrics.csv&quot;</span>)</span>
<span id="cb98-32"><a href="forest-stand-summary.html#cb98-32" tabindex="-1"></a>    , <span class="at">row.names =</span> F</span>
<span id="cb98-33"><a href="forest-stand-summary.html#cb98-33" tabindex="-1"></a>    , <span class="at">append =</span> F</span>
<span id="cb98-34"><a href="forest-stand-summary.html#cb98-34" tabindex="-1"></a>  )</span></code></pre></div>
<p>stand-level silvicultural summary</p>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb99-1"><a href="forest-stand-summary.html#cb99-1" tabindex="-1"></a>silv_metrics <span class="sc">%&gt;%</span> </span>
<span id="cb99-2"><a href="forest-stand-summary.html#cb99-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb99-3"><a href="forest-stand-summary.html#cb99-3" tabindex="-1"></a>    unit_name</span>
<span id="cb99-4"><a href="forest-stand-summary.html#cb99-4" tabindex="-1"></a>    , stand_area_ha</span>
<span id="cb99-5"><a href="forest-stand-summary.html#cb99-5" tabindex="-1"></a>    , n_trees</span>
<span id="cb99-6"><a href="forest-stand-summary.html#cb99-6" tabindex="-1"></a>    , mean_dbh_cm</span>
<span id="cb99-7"><a href="forest-stand-summary.html#cb99-7" tabindex="-1"></a>    , qmd_cm</span>
<span id="cb99-8"><a href="forest-stand-summary.html#cb99-8" tabindex="-1"></a>    , mean_tree_height_m</span>
<span id="cb99-9"><a href="forest-stand-summary.html#cb99-9" tabindex="-1"></a>    , loreys_height_m</span>
<span id="cb99-10"><a href="forest-stand-summary.html#cb99-10" tabindex="-1"></a>    , trees_per_ha</span>
<span id="cb99-11"><a href="forest-stand-summary.html#cb99-11" tabindex="-1"></a>    , basal_area_m2_per_ha</span>
<span id="cb99-12"><a href="forest-stand-summary.html#cb99-12" tabindex="-1"></a>    , landfire_cfl_kg_m2</span>
<span id="cb99-13"><a href="forest-stand-summary.html#cb99-13" tabindex="-1"></a>    , cruz_cfl_kg_m2</span>
<span id="cb99-14"><a href="forest-stand-summary.html#cb99-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb99-15"><a href="forest-stand-summary.html#cb99-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb99-16"><a href="forest-stand-summary.html#cb99-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb99-17"><a href="forest-stand-summary.html#cb99-17" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(stand_area_ha, n_trees) </span>
<span id="cb99-18"><a href="forest-stand-summary.html#cb99-18" tabindex="-1"></a>      , <span class="at">.fns =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb99-19"><a href="forest-stand-summary.html#cb99-19" tabindex="-1"></a>    )</span>
<span id="cb99-20"><a href="forest-stand-summary.html#cb99-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb99-21"><a href="forest-stand-summary.html#cb99-21" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb99-22"><a href="forest-stand-summary.html#cb99-22" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">1</span></span>
<span id="cb99-23"><a href="forest-stand-summary.html#cb99-23" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb99-24"><a href="forest-stand-summary.html#cb99-24" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;Silvicultral metrics by stand unit&quot;</span></span>
<span id="cb99-25"><a href="forest-stand-summary.html#cb99-25" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb99-26"><a href="forest-stand-summary.html#cb99-26" tabindex="-1"></a>      <span class="st">&quot;Unit Name&quot;</span></span>
<span id="cb99-27"><a href="forest-stand-summary.html#cb99-27" tabindex="-1"></a>      , <span class="st">&quot;area (ha)&quot;</span></span>
<span id="cb99-28"><a href="forest-stand-summary.html#cb99-28" tabindex="-1"></a>      , <span class="st">&quot;trees&quot;</span></span>
<span id="cb99-29"><a href="forest-stand-summary.html#cb99-29" tabindex="-1"></a>      , <span class="st">&quot;mean&lt;br&gt;DBH (cm)&quot;</span></span>
<span id="cb99-30"><a href="forest-stand-summary.html#cb99-30" tabindex="-1"></a>      , <span class="st">&quot;QMD (cm)&quot;</span></span>
<span id="cb99-31"><a href="forest-stand-summary.html#cb99-31" tabindex="-1"></a>      , <span class="st">&quot;mean&lt;br&gt;Ht. (m)&quot;</span></span>
<span id="cb99-32"><a href="forest-stand-summary.html#cb99-32" tabindex="-1"></a>      , <span class="st">&quot;Loreys&lt;br&gt;Ht. (m)&quot;</span></span>
<span id="cb99-33"><a href="forest-stand-summary.html#cb99-33" tabindex="-1"></a>      , <span class="st">&quot;TPH&quot;</span></span>
<span id="cb99-34"><a href="forest-stand-summary.html#cb99-34" tabindex="-1"></a>      , <span class="st">&quot;BA&lt;br&gt;m&lt;sup&gt;2&lt;/sup&gt; ha&lt;sup&gt;-1&lt;/sup&gt;&quot;</span></span>
<span id="cb99-35"><a href="forest-stand-summary.html#cb99-35" tabindex="-1"></a>      , <span class="st">&quot;LANDFIRE CFL&lt;br&gt;kg m&lt;sup&gt;-2&lt;/sup&gt;&quot;</span></span>
<span id="cb99-36"><a href="forest-stand-summary.html#cb99-36" tabindex="-1"></a>      , <span class="st">&quot;Cruz CFL&lt;br&gt;kg m&lt;sup&gt;-2&lt;/sup&gt;&quot;</span></span>
<span id="cb99-37"><a href="forest-stand-summary.html#cb99-37" tabindex="-1"></a>      )</span>
<span id="cb99-38"><a href="forest-stand-summary.html#cb99-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb99-39"><a href="forest-stand-summary.html#cb99-39" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">12</span>)</span></code></pre></div>
<table class="table" style="font-size: 12px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-86">Table 3.1: </span>Silvicultral metrics by stand unit
</caption>
<thead>
<tr>
<th style="text-align:left;">
Unit Name
</th>
<th style="text-align:left;">
area (ha)
</th>
<th style="text-align:left;">
trees
</th>
<th style="text-align:right;">
mean<br>DBH (cm)
</th>
<th style="text-align:right;">
QMD (cm)
</th>
<th style="text-align:right;">
mean<br>Ht. (m)
</th>
<th style="text-align:right;">
Loreys<br>Ht. (m)
</th>
<th style="text-align:right;">
TPH
</th>
<th style="text-align:right;">
BA<br>m<sup>2</sup> ha<sup>-1</sup>
</th>
<th style="text-align:right;">
LANDFIRE CFL<br>kg m<sup>-2</sup>
</th>
<th style="text-align:right;">
Cruz CFL<br>kg m<sup>-2</sup>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
300 RD to Rim
</td>
<td style="text-align:left;">
120
</td>
<td style="text-align:left;">
47,940
</td>
<td style="text-align:right;">
24.2
</td>
<td style="text-align:right;">
31.9
</td>
<td style="text-align:right;">
12.0
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
401.0
</td>
<td style="text-align:right;">
32.0
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1.6
</td>
</tr>
<tr>
<td style="text-align:left;">
Middle Kehl Canyon
</td>
<td style="text-align:left;">
201
</td>
<td style="text-align:left;">
107,684
</td>
<td style="text-align:right;">
20.7
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
10.6
</td>
<td style="text-align:right;">
22.4
</td>
<td style="text-align:right;">
537.1
</td>
<td style="text-align:right;">
33.3
</td>
<td style="text-align:right;">
0.8
</td>
<td style="text-align:right;">
1.6
</td>
</tr>
</tbody>
</table>
<div id="height-distribution" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Height Distribution<a href="forest-stand-summary.html#height-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="forest-stand-summary.html#cb100-1" tabindex="-1"></a><span class="co"># there are always tree heights</span></span>
<span id="cb100-2"><a href="forest-stand-summary.html#cb100-2" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb100-3"><a href="forest-stand-summary.html#cb100-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> tree_height_m, <span class="at">color =</span> unit_name, <span class="at">fill =</span> unit_name)) <span class="sc">+</span></span>
<span id="cb100-4"><a href="forest-stand-summary.html#cb100-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb100-5"><a href="forest-stand-summary.html#cb100-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name)) <span class="sc">+</span></span>
<span id="cb100-6"><a href="forest-stand-summary.html#cb100-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb100-7"><a href="forest-stand-summary.html#cb100-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb100-8"><a href="forest-stand-summary.html#cb100-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb100-9"><a href="forest-stand-summary.html#cb100-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;tree ht. (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Distribution of tree height by stand&quot;</span>) <span class="sc">+</span></span>
<span id="cb100-10"><a href="forest-stand-summary.html#cb100-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb100-11"><a href="forest-stand-summary.html#cb100-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb100-12"><a href="forest-stand-summary.html#cb100-12" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb100-13"><a href="forest-stand-summary.html#cb100-13" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb100-14"><a href="forest-stand-summary.html#cb100-14" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb100-15"><a href="forest-stand-summary.html#cb100-15" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb100-16"><a href="forest-stand-summary.html#cb100-16" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-87-1.png" width="1008" /></p>
</div>
<div id="dbh-distribution" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> DBH Distribution<a href="forest-stand-summary.html#dbh-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="forest-stand-summary.html#cb101-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb101-2"><a href="forest-stand-summary.html#cb101-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> dbh_cm, <span class="at">color =</span> unit_name, <span class="at">fill =</span> unit_name)) <span class="sc">+</span></span>
<span id="cb101-3"><a href="forest-stand-summary.html#cb101-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb101-4"><a href="forest-stand-summary.html#cb101-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name)) <span class="sc">+</span></span>
<span id="cb101-5"><a href="forest-stand-summary.html#cb101-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb101-6"><a href="forest-stand-summary.html#cb101-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb101-7"><a href="forest-stand-summary.html#cb101-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb101-8"><a href="forest-stand-summary.html#cb101-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;tree DBH (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Distribution of tree DBH by stand&quot;</span>) <span class="sc">+</span></span>
<span id="cb101-9"><a href="forest-stand-summary.html#cb101-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb101-10"><a href="forest-stand-summary.html#cb101-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb101-11"><a href="forest-stand-summary.html#cb101-11" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb101-12"><a href="forest-stand-summary.html#cb101-12" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb101-13"><a href="forest-stand-summary.html#cb101-13" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb101-14"><a href="forest-stand-summary.html#cb101-14" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb101-15"><a href="forest-stand-summary.html#cb101-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-88-1.png" width="1008" /></p>
</div>
<div id="forest-type" class="section level3 hasAnchor" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Forest Type<a href="forest-stand-summary.html#forest-type" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>cloud2trees::trees_type()</code> function was used in our <a href="processing.html#trees_type">point cloud processing</a> pipeline to attach FIA Forest Type Group Code information using the <a href="https://www.arcgis.com/home/item.html?id=10760c83b9e44923bd3c18efdaa7319d">Forest Type Groups of the Continental United States</a> data (Wilson 2023).</p>
<p>let’s check out the distribution of forest type groups overall across units</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="forest-stand-summary.html#cb102-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="forest-stand-summary.html#cb102-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb102-3"><a href="forest-stand-summary.html#cb102-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(forest_type_group) <span class="sc">%&gt;%</span> </span>
<span id="cb102-4"><a href="forest-stand-summary.html#cb102-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-5"><a href="forest-stand-summary.html#cb102-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb102-6"><a href="forest-stand-summary.html#cb102-6" tabindex="-1"></a>    <span class="at">pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">accuracy =</span> <span class="fl">0.1</span>) </span>
<span id="cb102-7"><a href="forest-stand-summary.html#cb102-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-8"><a href="forest-stand-summary.html#cb102-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb102-9"><a href="forest-stand-summary.html#cb102-9" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb102-10"><a href="forest-stand-summary.html#cb102-10" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Count of trees by FIA Forest Type Group overall&quot;</span></span>
<span id="cb102-11"><a href="forest-stand-summary.html#cb102-11" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb102-12"><a href="forest-stand-summary.html#cb102-12" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb102-13"><a href="forest-stand-summary.html#cb102-13" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb102-14"><a href="forest-stand-summary.html#cb102-14" tabindex="-1"></a>      , <span class="st">&quot;# trees&quot;</span></span>
<span id="cb102-15"><a href="forest-stand-summary.html#cb102-15" tabindex="-1"></a>      , <span class="st">&quot;% trees&quot;</span></span>
<span id="cb102-16"><a href="forest-stand-summary.html#cb102-16" tabindex="-1"></a>    )</span>
<span id="cb102-17"><a href="forest-stand-summary.html#cb102-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-18"><a href="forest-stand-summary.html#cb102-18" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-89">Table 3.2: </span>Count of trees by FIA Forest Type Group overall
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
# trees
</th>
<th style="text-align:left;">
% trees
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
Ponderosa pine group
</td>
<td style="text-align:left;">
153,061
</td>
<td style="text-align:left;">
98.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
Pinyon / juniper group
</td>
<td style="text-align:left;">
779
</td>
<td style="text-align:left;">
0.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
Woodland hardwoods group
</td>
<td style="text-align:left;">
767
</td>
<td style="text-align:left;">
0.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
Douglas-fir group
</td>
<td style="text-align:left;">
589
</td>
<td style="text-align:left;">
0.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
Fir / spruce / mountain hemlock group
</td>
<td style="text-align:left;">
413
</td>
<td style="text-align:left;">
0.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspen / birch group
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
0.0%
</td>
</tr>
</tbody>
</table>
<p>let’s check out the distribution of forest type groups for each unit</p>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="forest-stand-summary.html#cb103-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb103-2"><a href="forest-stand-summary.html#cb103-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb103-3"><a href="forest-stand-summary.html#cb103-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(unit_name, forest_type_group) <span class="sc">%&gt;%</span> </span>
<span id="cb103-4"><a href="forest-stand-summary.html#cb103-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(unit_name, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-5"><a href="forest-stand-summary.html#cb103-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_name) <span class="sc">%&gt;%</span> </span>
<span id="cb103-6"><a href="forest-stand-summary.html#cb103-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb103-7"><a href="forest-stand-summary.html#cb103-7" tabindex="-1"></a>    <span class="at">pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">accuracy =</span> <span class="fl">0.1</span>) </span>
<span id="cb103-8"><a href="forest-stand-summary.html#cb103-8" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb103-9"><a href="forest-stand-summary.html#cb103-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb103-10"><a href="forest-stand-summary.html#cb103-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb103-11"><a href="forest-stand-summary.html#cb103-11" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb103-12"><a href="forest-stand-summary.html#cb103-12" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Count of trees by FIA Forest Type Group by stand&quot;</span></span>
<span id="cb103-13"><a href="forest-stand-summary.html#cb103-13" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb103-14"><a href="forest-stand-summary.html#cb103-14" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb103-15"><a href="forest-stand-summary.html#cb103-15" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span></span>
<span id="cb103-16"><a href="forest-stand-summary.html#cb103-16" tabindex="-1"></a>      , <span class="st">&quot;&quot;</span></span>
<span id="cb103-17"><a href="forest-stand-summary.html#cb103-17" tabindex="-1"></a>      , <span class="st">&quot;# trees&quot;</span></span>
<span id="cb103-18"><a href="forest-stand-summary.html#cb103-18" tabindex="-1"></a>      , <span class="st">&quot;% trees&quot;</span></span>
<span id="cb103-19"><a href="forest-stand-summary.html#cb103-19" tabindex="-1"></a>    )</span>
<span id="cb103-20"><a href="forest-stand-summary.html#cb103-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb103-21"><a href="forest-stand-summary.html#cb103-21" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb103-22"><a href="forest-stand-summary.html#cb103-22" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-90">Table 3.3: </span>Count of trees by FIA Forest Type Group by stand
</caption>
<thead>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
# trees
</th>
<th style="text-align:left;">
% trees
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
300 RD to Rim
</td>
<td style="text-align:left;">
Ponderosa pine group
</td>
<td style="text-align:left;">
46,637
</td>
<td style="text-align:left;">
97.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
Pinyon / juniper group
</td>
<td style="text-align:left;">
673
</td>
<td style="text-align:left;">
1.4%
</td>
</tr>
<tr>
<td style="text-align:left;">
Woodland hardwoods group
</td>
<td style="text-align:left;">
521
</td>
<td style="text-align:left;">
1.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
Douglas-fir group
</td>
<td style="text-align:left;">
67
</td>
<td style="text-align:left;">
0.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
Fir / spruce / mountain hemlock group
</td>
<td style="text-align:left;">
42
</td>
<td style="text-align:left;">
0.1%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="6">
Middle Kehl Canyon
</td>
<td style="text-align:left;">
Ponderosa pine group
</td>
<td style="text-align:left;">
106,424
</td>
<td style="text-align:left;">
98.8%
</td>
</tr>
<tr>
<td style="text-align:left;">
Douglas-fir group
</td>
<td style="text-align:left;">
522
</td>
<td style="text-align:left;">
0.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
Fir / spruce / mountain hemlock group
</td>
<td style="text-align:left;">
371
</td>
<td style="text-align:left;">
0.3%
</td>
</tr>
<tr>
<td style="text-align:left;">
Woodland hardwoods group
</td>
<td style="text-align:left;">
246
</td>
<td style="text-align:left;">
0.2%
</td>
</tr>
<tr>
<td style="text-align:left;">
Pinyon / juniper group
</td>
<td style="text-align:left;">
106
</td>
<td style="text-align:left;">
0.1%
</td>
</tr>
<tr>
<td style="text-align:left;">
Aspen / birch group
</td>
<td style="text-align:left;">
15
</td>
<td style="text-align:left;">
0.0%
</td>
</tr>
</tbody>
</table>
<p>plot it with a custom palette to ensure the colors are the same for forest type across unit plots</p>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="forest-stand-summary.html#cb104-1" tabindex="-1"></a><span class="co"># It&#39;s recommended to use a named vector</span></span>
<span id="cb104-2"><a href="forest-stand-summary.html#cb104-2" tabindex="-1"></a>lab_list_temp <span class="ot">&lt;-</span> treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb104-3"><a href="forest-stand-summary.html#cb104-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb104-4"><a href="forest-stand-summary.html#cb104-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(forest_type_group)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-5"><a href="forest-stand-summary.html#cb104-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(forest_type_group) <span class="sc">%&gt;%</span> </span>
<span id="cb104-6"><a href="forest-stand-summary.html#cb104-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forest_type_group =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(forest_type_group, <span class="st">&quot; group&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb104-7"><a href="forest-stand-summary.html#cb104-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">pull</span>(forest_type_group)</span>
<span id="cb104-8"><a href="forest-stand-summary.html#cb104-8" tabindex="-1"></a><span class="co"># set our colors for the units</span></span>
<span id="cb104-9"><a href="forest-stand-summary.html#cb104-9" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">length</span>(lab_list_temp)<span class="sc">&lt;=</span><span class="fu">length</span>(harrypotter<span class="sc">::</span>hp_palettes<span class="sc">$</span>lunalovegood)){</span>
<span id="cb104-10"><a href="forest-stand-summary.html#cb104-10" tabindex="-1"></a>  col_list_temp <span class="ot">&lt;-</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="fu">length</span>(lab_list_temp), <span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>)</span>
<span id="cb104-11"><a href="forest-stand-summary.html#cb104-11" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb104-12"><a href="forest-stand-summary.html#cb104-12" tabindex="-1"></a>  col_list_temp <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n=</span><span class="fu">length</span>(lab_list_temp))</span>
<span id="cb104-13"><a href="forest-stand-summary.html#cb104-13" tabindex="-1"></a>}</span>
<span id="cb104-14"><a href="forest-stand-summary.html#cb104-14" tabindex="-1"></a><span class="co"># palette</span></span>
<span id="cb104-15"><a href="forest-stand-summary.html#cb104-15" tabindex="-1"></a>ftype_pal <span class="ot">&lt;-</span> <span class="fu">setNames</span>(col_list_temp,lab_list_temp)</span></code></pre></div>
<p>plot</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="forest-stand-summary.html#cb105-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb105-2"><a href="forest-stand-summary.html#cb105-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-3"><a href="forest-stand-summary.html#cb105-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forest_type_group =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(forest_type_group, <span class="st">&quot; group&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-4"><a href="forest-stand-summary.html#cb105-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(unit_name, forest_type_group) <span class="sc">%&gt;%</span> </span>
<span id="cb105-5"><a href="forest-stand-summary.html#cb105-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(unit_name, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-6"><a href="forest-stand-summary.html#cb105-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_name) <span class="sc">%&gt;%</span> </span>
<span id="cb105-7"><a href="forest-stand-summary.html#cb105-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb105-8"><a href="forest-stand-summary.html#cb105-8" tabindex="-1"></a>    <span class="at">pct =</span> n<span class="sc">/</span><span class="fu">sum</span>(n)</span>
<span id="cb105-9"><a href="forest-stand-summary.html#cb105-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb105-10"><a href="forest-stand-summary.html#cb105-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-11"><a href="forest-stand-summary.html#cb105-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forest_type_group =</span> forcats<span class="sc">::</span><span class="fu">fct_reorder</span>(forest_type_group, pct)) <span class="sc">%&gt;%</span> </span>
<span id="cb105-12"><a href="forest-stand-summary.html#cb105-12" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(</span>
<span id="cb105-13"><a href="forest-stand-summary.html#cb105-13" tabindex="-1"></a>    <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(</span>
<span id="cb105-14"><a href="forest-stand-summary.html#cb105-14" tabindex="-1"></a>      <span class="at">x =</span> pct, <span class="at">y =</span> forest_type_group</span>
<span id="cb105-15"><a href="forest-stand-summary.html#cb105-15" tabindex="-1"></a>      , <span class="at">fill =</span> forest_type_group</span>
<span id="cb105-16"><a href="forest-stand-summary.html#cb105-16" tabindex="-1"></a>      , <span class="at">label =</span> <span class="fu">paste0</span>(</span>
<span id="cb105-17"><a href="forest-stand-summary.html#cb105-17" tabindex="-1"></a>        scales<span class="sc">::</span><span class="fu">percent</span>(pct, <span class="at">accuracy =</span> <span class="fl">0.1</span>)</span>
<span id="cb105-18"><a href="forest-stand-summary.html#cb105-18" tabindex="-1"></a>        <span class="co"># , &quot;\n&quot;</span></span>
<span id="cb105-19"><a href="forest-stand-summary.html#cb105-19" tabindex="-1"></a>        <span class="co"># , scales::comma(n, accuracy = 0.1)</span></span>
<span id="cb105-20"><a href="forest-stand-summary.html#cb105-20" tabindex="-1"></a>      )</span>
<span id="cb105-21"><a href="forest-stand-summary.html#cb105-21" tabindex="-1"></a>    )</span>
<span id="cb105-22"><a href="forest-stand-summary.html#cb105-22" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb105-23"><a href="forest-stand-summary.html#cb105-23" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_col</span>(<span class="at">width =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb105-24"><a href="forest-stand-summary.html#cb105-24" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">hjust =</span> <span class="sc">-</span><span class="fl">0.2</span>) <span class="sc">+</span></span>
<span id="cb105-25"><a href="forest-stand-summary.html#cb105-25" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ftype_pal) <span class="sc">+</span></span>
<span id="cb105-26"><a href="forest-stand-summary.html#cb105-26" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(</span>
<span id="cb105-27"><a href="forest-stand-summary.html#cb105-27" tabindex="-1"></a>      <span class="at">labels =</span> scales<span class="sc">::</span><span class="fu">percent_format</span>(<span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb105-28"><a href="forest-stand-summary.html#cb105-28" tabindex="-1"></a>      ,<span class="at">expand =</span> <span class="fu">expansion</span>(<span class="at">mult =</span> <span class="fu">c</span>(<span class="dv">0</span>, .<span class="dv">08</span>))</span>
<span id="cb105-29"><a href="forest-stand-summary.html#cb105-29" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb105-30"><a href="forest-stand-summary.html#cb105-30" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">rows =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name), <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>) <span class="sc">+</span></span>
<span id="cb105-31"><a href="forest-stand-summary.html#cb105-31" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb105-32"><a href="forest-stand-summary.html#cb105-32" tabindex="-1"></a>      <span class="at">x =</span> <span class="st">&quot;% trees&quot;</span></span>
<span id="cb105-33"><a href="forest-stand-summary.html#cb105-33" tabindex="-1"></a>      , <span class="at">y =</span> <span class="st">&quot;&quot;</span> <span class="co"># &quot;Forest Type Group&quot;</span></span>
<span id="cb105-34"><a href="forest-stand-summary.html#cb105-34" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb105-35"><a href="forest-stand-summary.html#cb105-35" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb105-36"><a href="forest-stand-summary.html#cb105-36" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb105-37"><a href="forest-stand-summary.html#cb105-37" tabindex="-1"></a>      <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb105-38"><a href="forest-stand-summary.html#cb105-38" tabindex="-1"></a>      , <span class="at">axis.text.x =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb105-39"><a href="forest-stand-summary.html#cb105-39" tabindex="-1"></a>      , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb105-40"><a href="forest-stand-summary.html#cb105-40" tabindex="-1"></a>    )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-92-1.png" width="1008" /></p>
</div>
<div id="crown-biomass" class="section level3 hasAnchor" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Crown Biomass<a href="forest-stand-summary.html#crown-biomass" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The <code>cloud2trees::trees_biomass()</code> function was used in our <a href="processing.html#trees_biomass">point cloud processing</a> pipeline to estimate tree crown biomass in kilograms. We estimated biomass based on: 1) LANDFIRE’s <a href="https://landfire.gov/fuel/cbd">Forest Canopy Bulk Density (CBD) data</a>; and 2) based on the <a href="https://scholar.google.com/scholar?cluster=316241498622221569&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,5">Cruz et al. (2003)</a> equations and the FIA forest type group we got above</p>
<p>the fire science community is likely more familiar with crown bulk density (CBD) values which represent the mass of flammable material per unit volume of the tree crown and are typically expressed in units of mass per unit volume (e.g., kilograms per cubic meter). We’ll look at distributions of CBD.</p>
<div id="cruz-cbd" class="section level4 hasAnchor" number="3.2.4.1">
<h4><span class="header-section-number">3.2.4.1</span> Cruz CBD<a href="forest-stand-summary.html#cruz-cbd" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="forest-stand-summary.html#cb106-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb106-2"><a href="forest-stand-summary.html#cb106-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> cruz_tree_kg_per_m3, <span class="at">color =</span> unit_name, <span class="at">fill =</span> unit_name)) <span class="sc">+</span></span>
<span id="cb106-3"><a href="forest-stand-summary.html#cb106-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb106-4"><a href="forest-stand-summary.html#cb106-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name)) <span class="sc">+</span></span>
<span id="cb106-5"><a href="forest-stand-summary.html#cb106-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb106-6"><a href="forest-stand-summary.html#cb106-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb106-7"><a href="forest-stand-summary.html#cb106-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb106-8"><a href="forest-stand-summary.html#cb106-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb106-9"><a href="forest-stand-summary.html#cb106-9" tabindex="-1"></a>    <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;CBD ($kg </span><span class="sc">\\</span><span class="st">cdot m^{-3}$)&quot;</span>)</span>
<span id="cb106-10"><a href="forest-stand-summary.html#cb106-10" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb106-11"><a href="forest-stand-summary.html#cb106-11" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;Cruz estimated tree Crown Bulk Density by stand&quot;</span></span>
<span id="cb106-12"><a href="forest-stand-summary.html#cb106-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb106-13"><a href="forest-stand-summary.html#cb106-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb106-14"><a href="forest-stand-summary.html#cb106-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb106-15"><a href="forest-stand-summary.html#cb106-15" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb106-16"><a href="forest-stand-summary.html#cb106-16" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb106-17"><a href="forest-stand-summary.html#cb106-17" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb106-18"><a href="forest-stand-summary.html#cb106-18" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb106-19"><a href="forest-stand-summary.html#cb106-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-93-1.png" width="1008" /></p>
</div>
<div id="landfire-cbd" class="section level4 hasAnchor" number="3.2.4.2">
<h4><span class="header-section-number">3.2.4.2</span> LANDFIRE CBD<a href="forest-stand-summary.html#landfire-cbd" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb107"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb107-1"><a href="forest-stand-summary.html#cb107-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb107-2"><a href="forest-stand-summary.html#cb107-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> landfire_tree_kg_per_m3, <span class="at">color =</span> unit_name, <span class="at">fill =</span> unit_name)) <span class="sc">+</span></span>
<span id="cb107-3"><a href="forest-stand-summary.html#cb107-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.7</span>) <span class="sc">+</span></span>
<span id="cb107-4"><a href="forest-stand-summary.html#cb107-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name)) <span class="sc">+</span></span>
<span id="cb107-5"><a href="forest-stand-summary.html#cb107-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb107-6"><a href="forest-stand-summary.html#cb107-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb107-7"><a href="forest-stand-summary.html#cb107-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb107-8"><a href="forest-stand-summary.html#cb107-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(</span>
<span id="cb107-9"><a href="forest-stand-summary.html#cb107-9" tabindex="-1"></a>    <span class="at">x =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;CBD ($kg </span><span class="sc">\\</span><span class="st">cdot m^{-3}$)&quot;</span>)</span>
<span id="cb107-10"><a href="forest-stand-summary.html#cb107-10" tabindex="-1"></a>    , <span class="at">y =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb107-11"><a href="forest-stand-summary.html#cb107-11" tabindex="-1"></a>    , <span class="at">subtitle =</span> <span class="st">&quot;LANDFIRE estimated tree Crown Bulk Density by stand&quot;</span></span>
<span id="cb107-12"><a href="forest-stand-summary.html#cb107-12" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb107-13"><a href="forest-stand-summary.html#cb107-13" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb107-14"><a href="forest-stand-summary.html#cb107-14" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb107-15"><a href="forest-stand-summary.html#cb107-15" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb107-16"><a href="forest-stand-summary.html#cb107-16" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb107-17"><a href="forest-stand-summary.html#cb107-17" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb107-18"><a href="forest-stand-summary.html#cb107-18" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb107-19"><a href="forest-stand-summary.html#cb107-19" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-94-1.png" width="1008" /></p>
</div>
<div id="missing-cruz-estimates" class="section level4 hasAnchor" number="3.2.4.3">
<h4><span class="header-section-number">3.2.4.3</span> Missing Cruz Estimates<a href="forest-stand-summary.html#missing-cruz-estimates" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The Cruz et al. (2003) study developed models to predict canopy fuel stratum at the stand level for <em>four</em> coniferous forest types common in the western US: Douglas-fir, ponderosa pine, lodgepole pine, and mixed conifer. Models for other forests types are currently lacking which limits the scope of this methodology. If the tree list has trees that are in a FIA forest type group not represented in the list above, then we will fill the values with LANDFIRE estimates which have complete coverage at the CONUS level</p>
<p>How many trees overall across the two units have missing crown fuel load estimates?</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="forest-stand-summary.html#cb108-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb108-2"><a href="forest-stand-summary.html#cb108-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb108-3"><a href="forest-stand-summary.html#cb108-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb108-4"><a href="forest-stand-summary.html#cb108-4" tabindex="-1"></a>    <span class="at">missing_cruz =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(cruz_crown_biomass_kg), <span class="st">&quot;missing Cruz&quot;</span>, <span class="st">&quot;not missing Cruz&quot;</span>)</span>
<span id="cb108-5"><a href="forest-stand-summary.html#cb108-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb108-6"><a href="forest-stand-summary.html#cb108-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(missing_cruz) <span class="sc">%&gt;%</span> </span>
<span id="cb108-7"><a href="forest-stand-summary.html#cb108-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(<span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-8"><a href="forest-stand-summary.html#cb108-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb108-9"><a href="forest-stand-summary.html#cb108-9" tabindex="-1"></a>    <span class="at">pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">accuracy =</span> <span class="fl">0.1</span>) </span>
<span id="cb108-10"><a href="forest-stand-summary.html#cb108-10" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb108-11"><a href="forest-stand-summary.html#cb108-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb108-12"><a href="forest-stand-summary.html#cb108-12" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb108-13"><a href="forest-stand-summary.html#cb108-13" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Count of trees missing Cruz fuel load estimate overall&quot;</span></span>
<span id="cb108-14"><a href="forest-stand-summary.html#cb108-14" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb108-15"><a href="forest-stand-summary.html#cb108-15" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb108-16"><a href="forest-stand-summary.html#cb108-16" tabindex="-1"></a>      <span class="st">&quot;&quot;</span></span>
<span id="cb108-17"><a href="forest-stand-summary.html#cb108-17" tabindex="-1"></a>      , <span class="st">&quot;# trees&quot;</span></span>
<span id="cb108-18"><a href="forest-stand-summary.html#cb108-18" tabindex="-1"></a>      , <span class="st">&quot;% trees&quot;</span></span>
<span id="cb108-19"><a href="forest-stand-summary.html#cb108-19" tabindex="-1"></a>    )</span>
<span id="cb108-20"><a href="forest-stand-summary.html#cb108-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb108-21"><a href="forest-stand-summary.html#cb108-21" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-95">Table 3.4: </span>Count of trees missing Cruz fuel load estimate overall
</caption>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
# trees
</th>
<th style="text-align:left;">
% trees
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
not missing Cruz
</td>
<td style="text-align:left;">
154,063
</td>
<td style="text-align:left;">
99.0%
</td>
</tr>
<tr>
<td style="text-align:left;">
missing Cruz
</td>
<td style="text-align:left;">
1,561
</td>
<td style="text-align:left;">
1.0%
</td>
</tr>
</tbody>
</table>
<p>How many trees within each unit have missing crown fuel load estimates?</p>
<div class="sourceCode" id="cb109"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb109-1"><a href="forest-stand-summary.html#cb109-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb109-2"><a href="forest-stand-summary.html#cb109-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-3"><a href="forest-stand-summary.html#cb109-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb109-4"><a href="forest-stand-summary.html#cb109-4" tabindex="-1"></a>    <span class="at">missing_cruz =</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(cruz_crown_biomass_kg), <span class="st">&quot;missing Cruz&quot;</span>, <span class="st">&quot;not missing Cruz&quot;</span>)</span>
<span id="cb109-5"><a href="forest-stand-summary.html#cb109-5" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb109-6"><a href="forest-stand-summary.html#cb109-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">count</span>(unit_name, missing_cruz) <span class="sc">%&gt;%</span> </span>
<span id="cb109-7"><a href="forest-stand-summary.html#cb109-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(unit_name, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-8"><a href="forest-stand-summary.html#cb109-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_name) <span class="sc">%&gt;%</span> </span>
<span id="cb109-9"><a href="forest-stand-summary.html#cb109-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb109-10"><a href="forest-stand-summary.html#cb109-10" tabindex="-1"></a>    <span class="at">pct =</span> scales<span class="sc">::</span><span class="fu">percent</span>(n<span class="sc">/</span><span class="fu">sum</span>(n), <span class="at">accuracy =</span> <span class="fl">0.1</span>) </span>
<span id="cb109-11"><a href="forest-stand-summary.html#cb109-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb109-12"><a href="forest-stand-summary.html#cb109-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-13"><a href="forest-stand-summary.html#cb109-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">n =</span> scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb109-14"><a href="forest-stand-summary.html#cb109-14" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb109-15"><a href="forest-stand-summary.html#cb109-15" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Count of trees missing Cruz fuel load estimate by stand&quot;</span></span>
<span id="cb109-16"><a href="forest-stand-summary.html#cb109-16" tabindex="-1"></a>    , <span class="at">digits =</span> <span class="dv">2</span></span>
<span id="cb109-17"><a href="forest-stand-summary.html#cb109-17" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb109-18"><a href="forest-stand-summary.html#cb109-18" tabindex="-1"></a>      <span class="st">&quot;.&quot;</span></span>
<span id="cb109-19"><a href="forest-stand-summary.html#cb109-19" tabindex="-1"></a>      , <span class="st">&quot;&quot;</span></span>
<span id="cb109-20"><a href="forest-stand-summary.html#cb109-20" tabindex="-1"></a>      , <span class="st">&quot;# trees&quot;</span></span>
<span id="cb109-21"><a href="forest-stand-summary.html#cb109-21" tabindex="-1"></a>      , <span class="st">&quot;% trees&quot;</span></span>
<span id="cb109-22"><a href="forest-stand-summary.html#cb109-22" tabindex="-1"></a>    )</span>
<span id="cb109-23"><a href="forest-stand-summary.html#cb109-23" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb109-24"><a href="forest-stand-summary.html#cb109-24" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb109-25"><a href="forest-stand-summary.html#cb109-25" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-96">Table 3.5: </span>Count of trees missing Cruz fuel load estimate by stand
</caption>
<thead>
<tr>
<th style="text-align:left;">
.
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
# trees
</th>
<th style="text-align:left;">
% trees
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
300 RD to Rim
</td>
<td style="text-align:left;">
not missing Cruz
</td>
<td style="text-align:left;">
46,746
</td>
<td style="text-align:left;">
97.5%
</td>
</tr>
<tr>
<td style="text-align:left;">
missing Cruz
</td>
<td style="text-align:left;">
1,194
</td>
<td style="text-align:left;">
2.5%
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="2">
Middle Kehl Canyon
</td>
<td style="text-align:left;">
not missing Cruz
</td>
<td style="text-align:left;">
107,317
</td>
<td style="text-align:left;">
99.7%
</td>
</tr>
<tr>
<td style="text-align:left;">
missing Cruz
</td>
<td style="text-align:left;">
367
</td>
<td style="text-align:left;">
0.3%
</td>
</tr>
</tbody>
</table>
<p>let’s fill in these estimates with the LANDFIRE value</p>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb110-1"><a href="forest-stand-summary.html#cb110-1" tabindex="-1"></a>treetops_sf <span class="ot">&lt;-</span> </span>
<span id="cb110-2"><a href="forest-stand-summary.html#cb110-2" tabindex="-1"></a>  treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb110-3"><a href="forest-stand-summary.html#cb110-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb110-4"><a href="forest-stand-summary.html#cb110-4" tabindex="-1"></a>    <span class="at">is_missing_cruz =</span> <span class="fu">is.na</span>(cruz_crown_biomass_kg)</span>
<span id="cb110-5"><a href="forest-stand-summary.html#cb110-5" tabindex="-1"></a>    , <span class="at">cruz_tree_kg_per_m3 =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(cruz_tree_kg_per_m3, landfire_tree_kg_per_m3)</span>
<span id="cb110-6"><a href="forest-stand-summary.html#cb110-6" tabindex="-1"></a>    , <span class="at">cruz_stand_kg_per_m3 =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(cruz_stand_kg_per_m3, landfire_stand_kg_per_m3)</span>
<span id="cb110-7"><a href="forest-stand-summary.html#cb110-7" tabindex="-1"></a>    , <span class="at">cruz_crown_biomass_kg =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(cruz_crown_biomass_kg, landfire_crown_biomass_kg)</span>
<span id="cb110-8"><a href="forest-stand-summary.html#cb110-8" tabindex="-1"></a>  )</span></code></pre></div>
</div>
</div>
<div id="summary-statistics" class="section level3 hasAnchor" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Summary Statistics<a href="forest-stand-summary.html#summary-statistics" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s get summary statistics for selected metrics by stand unit</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="forest-stand-summary.html#cb111-1" tabindex="-1"></a><span class="co"># table_temp =</span></span>
<span id="cb111-2"><a href="forest-stand-summary.html#cb111-2" tabindex="-1"></a>  treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb111-3"><a href="forest-stand-summary.html#cb111-3" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-4"><a href="forest-stand-summary.html#cb111-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_id, unit_name) <span class="sc">%&gt;%</span></span>
<span id="cb111-5"><a href="forest-stand-summary.html#cb111-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb111-6"><a href="forest-stand-summary.html#cb111-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb111-7"><a href="forest-stand-summary.html#cb111-7" tabindex="-1"></a>      <span class="fu">c</span>(tree_height_m, dbh_cm, tree_cbh_m, cruz_tree_kg_per_m3, landfire_tree_kg_per_m3)</span>
<span id="cb111-8"><a href="forest-stand-summary.html#cb111-8" tabindex="-1"></a>      , <span class="at">.fns =</span> <span class="fu">list</span>(<span class="at">mean =</span> mean, <span class="at">median =</span> median, <span class="at">sd =</span> sd, <span class="at">min =</span> min, <span class="at">max =</span> max)</span>
<span id="cb111-9"><a href="forest-stand-summary.html#cb111-9" tabindex="-1"></a>    )</span>
<span id="cb111-10"><a href="forest-stand-summary.html#cb111-10" tabindex="-1"></a>    , <span class="at">n =</span> dplyr<span class="sc">::</span><span class="fu">n</span>()</span>
<span id="cb111-11"><a href="forest-stand-summary.html#cb111-11" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb111-12"><a href="forest-stand-summary.html#cb111-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-13"><a href="forest-stand-summary.html#cb111-13" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="sc">-</span><span class="fu">c</span>(unit_id, unit_name,n)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-14"><a href="forest-stand-summary.html#cb111-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb111-15"><a href="forest-stand-summary.html#cb111-15" tabindex="-1"></a>    <span class="at">agg =</span> stringr<span class="sc">::</span><span class="fu">word</span>(name,<span class="sc">-</span><span class="dv">1</span>,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)</span>
<span id="cb111-16"><a href="forest-stand-summary.html#cb111-16" tabindex="-1"></a>    , <span class="at">metric =</span> stringr<span class="sc">::</span><span class="fu">str_remove_all</span>(name, <span class="fu">paste0</span>(<span class="st">&quot;_&quot;</span>,agg))</span>
<span id="cb111-17"><a href="forest-stand-summary.html#cb111-17" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb111-18"><a href="forest-stand-summary.html#cb111-18" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>name) <span class="sc">%&gt;%</span> </span>
<span id="cb111-19"><a href="forest-stand-summary.html#cb111-19" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb111-20"><a href="forest-stand-summary.html#cb111-20" tabindex="-1"></a>    <span class="at">value =</span> dplyr<span class="sc">::</span><span class="fu">case_when</span>(</span>
<span id="cb111-21"><a href="forest-stand-summary.html#cb111-21" tabindex="-1"></a>      metric <span class="sc">==</span> <span class="st">&quot;tree_height_m&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb111-22"><a href="forest-stand-summary.html#cb111-22" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;dbh_cm&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb111-23"><a href="forest-stand-summary.html#cb111-23" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;tree_cbh_m&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb111-24"><a href="forest-stand-summary.html#cb111-24" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;cruz_tree_kg_per_m3&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.001</span>)</span>
<span id="cb111-25"><a href="forest-stand-summary.html#cb111-25" tabindex="-1"></a>      , metric <span class="sc">==</span> <span class="st">&quot;landfire_tree_kg_per_m3&quot;</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.001</span>)</span>
<span id="cb111-26"><a href="forest-stand-summary.html#cb111-26" tabindex="-1"></a>      , T <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(value,<span class="at">accuracy=</span><span class="fl">0.1</span>)</span>
<span id="cb111-27"><a href="forest-stand-summary.html#cb111-27" tabindex="-1"></a>    )</span>
<span id="cb111-28"><a href="forest-stand-summary.html#cb111-28" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb111-29"><a href="forest-stand-summary.html#cb111-29" tabindex="-1"></a>  tidyr<span class="sc">::</span><span class="fu">pivot_wider</span>(<span class="at">names_from =</span> agg, <span class="at">values_from =</span> value) <span class="sc">%&gt;%</span> </span>
<span id="cb111-30"><a href="forest-stand-summary.html#cb111-30" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb111-31"><a href="forest-stand-summary.html#cb111-31" tabindex="-1"></a>    <span class="at">unit_lab =</span> <span class="fu">paste0</span>(</span>
<span id="cb111-32"><a href="forest-stand-summary.html#cb111-32" tabindex="-1"></a>      unit_name</span>
<span id="cb111-33"><a href="forest-stand-summary.html#cb111-33" tabindex="-1"></a>      ,<span class="st">&quot;&lt;br&gt;(&quot;</span></span>
<span id="cb111-34"><a href="forest-stand-summary.html#cb111-34" tabindex="-1"></a>      , scales<span class="sc">::</span><span class="fu">comma</span>(n,<span class="at">accuracy=</span><span class="dv">1</span>)</span>
<span id="cb111-35"><a href="forest-stand-summary.html#cb111-35" tabindex="-1"></a>      ,<span class="st">&quot; trees)&quot;</span></span>
<span id="cb111-36"><a href="forest-stand-summary.html#cb111-36" tabindex="-1"></a>    )</span>
<span id="cb111-37"><a href="forest-stand-summary.html#cb111-37" tabindex="-1"></a>    , <span class="at">range =</span> <span class="fu">paste0</span>(min, <span class="st">&quot;—&quot;</span>, max)</span>
<span id="cb111-38"><a href="forest-stand-summary.html#cb111-38" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb111-39"><a href="forest-stand-summary.html#cb111-39" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">arrange</span>(unit_id, unit_name, <span class="fu">desc</span>(n)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-40"><a href="forest-stand-summary.html#cb111-40" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(unit_id,unit_name,n,min,max)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-41"><a href="forest-stand-summary.html#cb111-41" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">relocate</span>(unit_lab) <span class="sc">%&gt;%</span> </span>
<span id="cb111-42"><a href="forest-stand-summary.html#cb111-42" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb111-43"><a href="forest-stand-summary.html#cb111-43" tabindex="-1"></a>    <span class="at">metric =</span> <span class="fu">factor</span>(</span>
<span id="cb111-44"><a href="forest-stand-summary.html#cb111-44" tabindex="-1"></a>      metric</span>
<span id="cb111-45"><a href="forest-stand-summary.html#cb111-45" tabindex="-1"></a>      , <span class="at">ordered =</span> T</span>
<span id="cb111-46"><a href="forest-stand-summary.html#cb111-46" tabindex="-1"></a>      , <span class="at">levels =</span> <span class="fu">c</span>(</span>
<span id="cb111-47"><a href="forest-stand-summary.html#cb111-47" tabindex="-1"></a>          <span class="st">&quot;tree_height_m&quot;</span></span>
<span id="cb111-48"><a href="forest-stand-summary.html#cb111-48" tabindex="-1"></a>          , <span class="st">&quot;tree_cbh_m&quot;</span></span>
<span id="cb111-49"><a href="forest-stand-summary.html#cb111-49" tabindex="-1"></a>          , <span class="st">&quot;dbh_cm&quot;</span></span>
<span id="cb111-50"><a href="forest-stand-summary.html#cb111-50" tabindex="-1"></a>          , <span class="st">&quot;cruz_tree_kg_per_m3&quot;</span></span>
<span id="cb111-51"><a href="forest-stand-summary.html#cb111-51" tabindex="-1"></a>          , <span class="st">&quot;landfire_tree_kg_per_m3&quot;</span></span>
<span id="cb111-52"><a href="forest-stand-summary.html#cb111-52" tabindex="-1"></a>        )</span>
<span id="cb111-53"><a href="forest-stand-summary.html#cb111-53" tabindex="-1"></a>      , <span class="at">labels =</span> <span class="fu">c</span>(</span>
<span id="cb111-54"><a href="forest-stand-summary.html#cb111-54" tabindex="-1"></a>          <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb111-55"><a href="forest-stand-summary.html#cb111-55" tabindex="-1"></a>          , <span class="st">&quot;Crown Base Ht. (m)&quot;</span></span>
<span id="cb111-56"><a href="forest-stand-summary.html#cb111-56" tabindex="-1"></a>          , <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb111-57"><a href="forest-stand-summary.html#cb111-57" tabindex="-1"></a>          , <span class="st">&quot;Cruz CBD&lt;br&gt;kg m&lt;sup&gt;-3&lt;/sup&gt;&quot;</span></span>
<span id="cb111-58"><a href="forest-stand-summary.html#cb111-58" tabindex="-1"></a>          , <span class="st">&quot;LANDFIRE CBD&lt;br&gt;kg m&lt;sup&gt;-3&lt;/sup&gt;&quot;</span></span>
<span id="cb111-59"><a href="forest-stand-summary.html#cb111-59" tabindex="-1"></a>        )</span>
<span id="cb111-60"><a href="forest-stand-summary.html#cb111-60" tabindex="-1"></a>    )</span>
<span id="cb111-61"><a href="forest-stand-summary.html#cb111-61" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb111-62"><a href="forest-stand-summary.html#cb111-62" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb111-63"><a href="forest-stand-summary.html#cb111-63" tabindex="-1"></a>    <span class="at">caption =</span> <span class="st">&quot;Summary statistics for selected metrics by stand&quot;</span></span>
<span id="cb111-64"><a href="forest-stand-summary.html#cb111-64" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb111-65"><a href="forest-stand-summary.html#cb111-65" tabindex="-1"></a>      <span class="st">&quot;Unit Name&quot;</span>, <span class="st">&quot;Metric&quot;</span></span>
<span id="cb111-66"><a href="forest-stand-summary.html#cb111-66" tabindex="-1"></a>      , <span class="st">&quot;Mean&quot;</span>, <span class="st">&quot;Median&quot;</span></span>
<span id="cb111-67"><a href="forest-stand-summary.html#cb111-67" tabindex="-1"></a>      , <span class="st">&quot;Std Dev&quot;</span>, <span class="st">&quot;Range&quot;</span></span>
<span id="cb111-68"><a href="forest-stand-summary.html#cb111-68" tabindex="-1"></a>    )</span>
<span id="cb111-69"><a href="forest-stand-summary.html#cb111-69" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb111-70"><a href="forest-stand-summary.html#cb111-70" tabindex="-1"></a>    <span class="co"># , digits = 2</span></span>
<span id="cb111-71"><a href="forest-stand-summary.html#cb111-71" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb111-72"><a href="forest-stand-summary.html#cb111-72" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>(<span class="at">font_size =</span> <span class="dv">13</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb111-73"><a href="forest-stand-summary.html#cb111-73" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">collapse_rows</span>(<span class="at">columns =</span> <span class="dv">1</span>, <span class="at">valign =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<table class="table" style="font-size: 13px; margin-left: auto; margin-right: auto;">
<caption style="font-size: initial !important;">
<span id="tab:unnamed-chunk-98">Table 3.6: </span>Summary statistics for selected metrics by stand
</caption>
<thead>
<tr>
<th style="text-align:left;">
Unit Name
</th>
<th style="text-align:left;">
Metric
</th>
<th style="text-align:left;">
Mean
</th>
<th style="text-align:left;">
Median
</th>
<th style="text-align:left;">
Std Dev
</th>
<th style="text-align:left;">
Range
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
300 RD to Rim<br>(47,940 trees)
</td>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
12.0
</td>
<td style="text-align:left;">
9.8
</td>
<td style="text-align:left;">
8.9
</td>
<td style="text-align:left;">
2.0—43.0
</td>
</tr>
<tr>
<td style="text-align:left;">
DBH (cm)
</td>
<td style="text-align:left;">
24.2
</td>
<td style="text-align:left;">
16.3
</td>
<td style="text-align:left;">
20.8
</td>
<td style="text-align:left;">
3.7—113.1
</td>
</tr>
<tr>
<td style="text-align:left;">
Crown Base Ht. (m)
</td>
<td style="text-align:left;">
4.2
</td>
<td style="text-align:left;">
3.8
</td>
<td style="text-align:left;">
2.0
</td>
<td style="text-align:left;">
1.5—23.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Cruz CBD<br>kg m<sup>-3</sup>
</td>
<td style="text-align:left;">
0.255
</td>
<td style="text-align:left;">
0.240
</td>
<td style="text-align:left;">
0.124
</td>
<td style="text-align:left;">
0.009—1.894
</td>
</tr>
<tr>
<td style="text-align:left;">
LANDFIRE CBD<br>kg m<sup>-3</sup>
</td>
<td style="text-align:left;">
0.126
</td>
<td style="text-align:left;">
0.109
</td>
<td style="text-align:left;">
0.123
</td>
<td style="text-align:left;">
0.009—1.868
</td>
</tr>
<tr>
<td style="text-align:left;vertical-align: top !important;" rowspan="5">
Middle Kehl Canyon<br>(107,684 trees)
</td>
<td style="text-align:left;">
Height (m)
</td>
<td style="text-align:left;">
10.6
</td>
<td style="text-align:left;">
7.1
</td>
<td style="text-align:left;">
8.2
</td>
<td style="text-align:left;">
2.0—44.9
</td>
</tr>
<tr>
<td style="text-align:left;">
DBH (cm)
</td>
<td style="text-align:left;">
20.7
</td>
<td style="text-align:left;">
11.2
</td>
<td style="text-align:left;">
19.0
</td>
<td style="text-align:left;">
3.7—118.2
</td>
</tr>
<tr>
<td style="text-align:left;">
Crown Base Ht. (m)
</td>
<td style="text-align:left;">
4.2
</td>
<td style="text-align:left;">
3.6
</td>
<td style="text-align:left;">
2.0
</td>
<td style="text-align:left;">
1.5—23.5
</td>
</tr>
<tr>
<td style="text-align:left;">
Cruz CBD<br>kg m<sup>-3</sup>
</td>
<td style="text-align:left;">
0.237
</td>
<td style="text-align:left;">
0.232
</td>
<td style="text-align:left;">
0.064
</td>
<td style="text-align:left;">
0.059—1.981
</td>
</tr>
<tr>
<td style="text-align:left;">
LANDFIRE CBD<br>kg m<sup>-3</sup>
</td>
<td style="text-align:left;">
0.103
</td>
<td style="text-align:left;">
0.098
</td>
<td style="text-align:left;">
0.057
</td>
<td style="text-align:left;">
0.019—1.981
</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="spatial-forest-structure" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Spatial Forest Structure<a href="forest-stand-summary.html#spatial-forest-structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Because we have a spatial tree list, we can look at the spatial arrangement of forest structural metrics</p>
<p>first, let’s make a function to crop the raster to a stand and plot the raster and stand together</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="forest-stand-summary.html#cb112-1" tabindex="-1"></a><span class="co"># function to crop and plot a raster data for a stand</span></span>
<span id="cb112-2"><a href="forest-stand-summary.html#cb112-2" tabindex="-1"></a>plot_raster_stand_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb112-3"><a href="forest-stand-summary.html#cb112-3" tabindex="-1"></a>    rast</span>
<span id="cb112-4"><a href="forest-stand-summary.html#cb112-4" tabindex="-1"></a>    , stand</span>
<span id="cb112-5"><a href="forest-stand-summary.html#cb112-5" tabindex="-1"></a>    , <span class="at">buffer=</span><span class="dv">5</span></span>
<span id="cb112-6"><a href="forest-stand-summary.html#cb112-6" tabindex="-1"></a>    , <span class="at">des_res=</span><span class="dv">1</span></span>
<span id="cb112-7"><a href="forest-stand-summary.html#cb112-7" tabindex="-1"></a>    , <span class="at">agg_fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb112-8"><a href="forest-stand-summary.html#cb112-8" tabindex="-1"></a>    , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb112-9"><a href="forest-stand-summary.html#cb112-9" tabindex="-1"></a>    , <span class="at">my_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-10"><a href="forest-stand-summary.html#cb112-10" tabindex="-1"></a>    , <span class="at">scale_name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-11"><a href="forest-stand-summary.html#cb112-11" tabindex="-1"></a>    , <span class="at">bbox =</span> F</span>
<span id="cb112-12"><a href="forest-stand-summary.html#cb112-12" tabindex="-1"></a>    , <span class="at">lookup =</span> <span class="cn">NA</span></span>
<span id="cb112-13"><a href="forest-stand-summary.html#cb112-13" tabindex="-1"></a>    , <span class="at">lookup_code =</span> <span class="cn">NA</span></span>
<span id="cb112-14"><a href="forest-stand-summary.html#cb112-14" tabindex="-1"></a>    , <span class="at">lookup_lab =</span> <span class="cn">NA</span></span>
<span id="cb112-15"><a href="forest-stand-summary.html#cb112-15" tabindex="-1"></a>) {</span>
<span id="cb112-16"><a href="forest-stand-summary.html#cb112-16" tabindex="-1"></a>  <span class="co"># crop the raster</span></span>
<span id="cb112-17"><a href="forest-stand-summary.html#cb112-17" tabindex="-1"></a>  crop_rast <span class="ot">&lt;-</span> rast <span class="sc">%&gt;%</span> </span>
<span id="cb112-18"><a href="forest-stand-summary.html#cb112-18" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb112-19"><a href="forest-stand-summary.html#cb112-19" tabindex="-1"></a>      stand <span class="sc">%&gt;%</span> </span>
<span id="cb112-20"><a href="forest-stand-summary.html#cb112-20" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-21"><a href="forest-stand-summary.html#cb112-21" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-22"><a href="forest-stand-summary.html#cb112-22" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb112-23"><a href="forest-stand-summary.html#cb112-23" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-24"><a href="forest-stand-summary.html#cb112-24" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb112-25"><a href="forest-stand-summary.html#cb112-25" tabindex="-1"></a>    )</span>
<span id="cb112-26"><a href="forest-stand-summary.html#cb112-26" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>bbox){</span>
<span id="cb112-27"><a href="forest-stand-summary.html#cb112-27" tabindex="-1"></a>    crop_rast <span class="ot">&lt;-</span> crop_rast <span class="sc">%&gt;%</span> </span>
<span id="cb112-28"><a href="forest-stand-summary.html#cb112-28" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb112-29"><a href="forest-stand-summary.html#cb112-29" tabindex="-1"></a>        stand <span class="sc">%&gt;%</span> </span>
<span id="cb112-30"><a href="forest-stand-summary.html#cb112-30" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb112-31"><a href="forest-stand-summary.html#cb112-31" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb112-32"><a href="forest-stand-summary.html#cb112-32" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb112-33"><a href="forest-stand-summary.html#cb112-33" tabindex="-1"></a>      )</span>
<span id="cb112-34"><a href="forest-stand-summary.html#cb112-34" tabindex="-1"></a>  }</span>
<span id="cb112-35"><a href="forest-stand-summary.html#cb112-35" tabindex="-1"></a>  <span class="co"># aggregate the raster</span></span>
<span id="cb112-36"><a href="forest-stand-summary.html#cb112-36" tabindex="-1"></a>  res_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(rast)[<span class="dv">1</span>]</span>
<span id="cb112-37"><a href="forest-stand-summary.html#cb112-37" tabindex="-1"></a>  <span class="cf">if</span>(res_temp<span class="sc">&lt;</span>des_res){</span>
<span id="cb112-38"><a href="forest-stand-summary.html#cb112-38" tabindex="-1"></a>    crop_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb112-39"><a href="forest-stand-summary.html#cb112-39" tabindex="-1"></a>      crop_rast</span>
<span id="cb112-40"><a href="forest-stand-summary.html#cb112-40" tabindex="-1"></a>      , <span class="at">fact =</span> <span class="fu">round</span>(des_res<span class="sc">/</span>res_temp)</span>
<span id="cb112-41"><a href="forest-stand-summary.html#cb112-41" tabindex="-1"></a>      , <span class="at">fun =</span> agg_fun</span>
<span id="cb112-42"><a href="forest-stand-summary.html#cb112-42" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb112-43"><a href="forest-stand-summary.html#cb112-43" tabindex="-1"></a>      , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb112-44"><a href="forest-stand-summary.html#cb112-44" tabindex="-1"></a>    )</span>
<span id="cb112-45"><a href="forest-stand-summary.html#cb112-45" tabindex="-1"></a>  }</span>
<span id="cb112-46"><a href="forest-stand-summary.html#cb112-46" tabindex="-1"></a>  <span class="co"># plot it</span></span>
<span id="cb112-47"><a href="forest-stand-summary.html#cb112-47" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">inherits</span>(lookup,<span class="st">&quot;data.frame&quot;</span>) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(lookup_code) <span class="sc">&amp;&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(lookup_lab)){</span>
<span id="cb112-48"><a href="forest-stand-summary.html#cb112-48" tabindex="-1"></a>    <span class="co"># create col to join</span></span>
<span id="cb112-49"><a href="forest-stand-summary.html#cb112-49" tabindex="-1"></a>    lookup <span class="ot">&lt;-</span> lookup <span class="sc">%&gt;%</span> </span>
<span id="cb112-50"><a href="forest-stand-summary.html#cb112-50" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb112-51"><a href="forest-stand-summary.html#cb112-51" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">all_of</span>(lookup_code[<span class="dv">1</span>]) <span class="co"># only one allowed</span></span>
<span id="cb112-52"><a href="forest-stand-summary.html#cb112-52" tabindex="-1"></a>        , <span class="at">.fns =</span> <span class="fu">list</span>(<span class="at">cccc =</span> as.character, <span class="at">nnnn =</span> as.numeric)</span>
<span id="cb112-53"><a href="forest-stand-summary.html#cb112-53" tabindex="-1"></a>      )) <span class="sc">%&gt;%</span> </span>
<span id="cb112-54"><a href="forest-stand-summary.html#cb112-54" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(</span>
<span id="cb112-55"><a href="forest-stand-summary.html#cb112-55" tabindex="-1"></a>        <span class="at">.fn =</span> <span class="cf">function</span>(x){<span class="st">&quot;f&quot;</span>}</span>
<span id="cb112-56"><a href="forest-stand-summary.html#cb112-56" tabindex="-1"></a>        , <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(<span class="st">&quot;_cccc&quot;</span>)</span>
<span id="cb112-57"><a href="forest-stand-summary.html#cb112-57" tabindex="-1"></a>      ) <span class="sc">%&gt;%</span> </span>
<span id="cb112-58"><a href="forest-stand-summary.html#cb112-58" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename_with</span>(</span>
<span id="cb112-59"><a href="forest-stand-summary.html#cb112-59" tabindex="-1"></a>        <span class="at">.fn =</span> <span class="cf">function</span>(x){<span class="st">&quot;f_lab&quot;</span>}</span>
<span id="cb112-60"><a href="forest-stand-summary.html#cb112-60" tabindex="-1"></a>        , <span class="at">.cols =</span> tidyselect<span class="sc">::</span><span class="fu">ends_with</span>(lookup_lab[<span class="dv">1</span>])</span>
<span id="cb112-61"><a href="forest-stand-summary.html#cb112-61" tabindex="-1"></a>      )</span>
<span id="cb112-62"><a href="forest-stand-summary.html#cb112-62" tabindex="-1"></a>    <span class="co"># rast to df and plot</span></span>
<span id="cb112-63"><a href="forest-stand-summary.html#cb112-63" tabindex="-1"></a>    crop_rast <span class="sc">%&gt;%</span> </span>
<span id="cb112-64"><a href="forest-stand-summary.html#cb112-64" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb112-65"><a href="forest-stand-summary.html#cb112-65" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb112-66"><a href="forest-stand-summary.html#cb112-66" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">f =</span> <span class="fu">as.character</span>(f)) <span class="sc">%&gt;%</span> </span>
<span id="cb112-67"><a href="forest-stand-summary.html#cb112-67" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">left_join</span>(lookup, <span class="at">by =</span> <span class="st">&quot;f&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb112-68"><a href="forest-stand-summary.html#cb112-68" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb112-69"><a href="forest-stand-summary.html#cb112-69" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb112-70"><a href="forest-stand-summary.html#cb112-70" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">fill =</span> f_lab)</span>
<span id="cb112-71"><a href="forest-stand-summary.html#cb112-71" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb112-72"><a href="forest-stand-summary.html#cb112-72" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb112-73"><a href="forest-stand-summary.html#cb112-73" tabindex="-1"></a>        <span class="at">data =</span> stand <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb112-74"><a href="forest-stand-summary.html#cb112-74" tabindex="-1"></a>        , <span class="at">color =</span> stand_color, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb112-75"><a href="forest-stand-summary.html#cb112-75" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb112-76"><a href="forest-stand-summary.html#cb112-76" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> my_title, <span class="at">fill =</span> scale_name) <span class="sc">+</span> </span>
<span id="cb112-77"><a href="forest-stand-summary.html#cb112-77" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb112-78"><a href="forest-stand-summary.html#cb112-78" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb112-79"><a href="forest-stand-summary.html#cb112-79" tabindex="-1"></a>        <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>)</span>
<span id="cb112-80"><a href="forest-stand-summary.html#cb112-80" tabindex="-1"></a>        , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb112-81"><a href="forest-stand-summary.html#cb112-81" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb112-82"><a href="forest-stand-summary.html#cb112-82" tabindex="-1"></a>      )</span>
<span id="cb112-83"><a href="forest-stand-summary.html#cb112-83" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb112-84"><a href="forest-stand-summary.html#cb112-84" tabindex="-1"></a>    crop_rast <span class="sc">%&gt;%</span> </span>
<span id="cb112-85"><a href="forest-stand-summary.html#cb112-85" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb112-86"><a href="forest-stand-summary.html#cb112-86" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb112-87"><a href="forest-stand-summary.html#cb112-87" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb112-88"><a href="forest-stand-summary.html#cb112-88" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb112-89"><a href="forest-stand-summary.html#cb112-89" tabindex="-1"></a>        <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">fill =</span> f)</span>
<span id="cb112-90"><a href="forest-stand-summary.html#cb112-90" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb112-91"><a href="forest-stand-summary.html#cb112-91" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb112-92"><a href="forest-stand-summary.html#cb112-92" tabindex="-1"></a>        <span class="at">data =</span> stand <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb112-93"><a href="forest-stand-summary.html#cb112-93" tabindex="-1"></a>        , <span class="at">color =</span> stand_color, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb112-94"><a href="forest-stand-summary.html#cb112-94" tabindex="-1"></a>      ) <span class="sc">+</span></span>
<span id="cb112-95"><a href="forest-stand-summary.html#cb112-95" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> my_title, <span class="at">fill =</span> scale_name) <span class="sc">+</span> </span>
<span id="cb112-96"><a href="forest-stand-summary.html#cb112-96" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme_void</span>() <span class="sc">+</span></span>
<span id="cb112-97"><a href="forest-stand-summary.html#cb112-97" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb112-98"><a href="forest-stand-summary.html#cb112-98" tabindex="-1"></a>        <span class="at">legend.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">7</span>)</span>
<span id="cb112-99"><a href="forest-stand-summary.html#cb112-99" tabindex="-1"></a>        , <span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb112-100"><a href="forest-stand-summary.html#cb112-100" tabindex="-1"></a>        , <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>)</span>
<span id="cb112-101"><a href="forest-stand-summary.html#cb112-101" tabindex="-1"></a>      )</span>
<span id="cb112-102"><a href="forest-stand-summary.html#cb112-102" tabindex="-1"></a>  }</span>
<span id="cb112-103"><a href="forest-stand-summary.html#cb112-103" tabindex="-1"></a>}</span>
<span id="cb112-104"><a href="forest-stand-summary.html#cb112-104" tabindex="-1"></a><span class="co"># plot_raster_stand_fn(</span></span>
<span id="cb112-105"><a href="forest-stand-summary.html#cb112-105" tabindex="-1"></a><span class="co">#   dtm_rast</span></span>
<span id="cb112-106"><a href="forest-stand-summary.html#cb112-106" tabindex="-1"></a><span class="co">#   , stand = stand_sf[1,]</span></span>
<span id="cb112-107"><a href="forest-stand-summary.html#cb112-107" tabindex="-1"></a><span class="co">#   , buffer = 5</span></span>
<span id="cb112-108"><a href="forest-stand-summary.html#cb112-108" tabindex="-1"></a><span class="co">#   , des_res = 1</span></span>
<span id="cb112-109"><a href="forest-stand-summary.html#cb112-109" tabindex="-1"></a><span class="co">#   , stand_color = my_pal[1]</span></span>
<span id="cb112-110"><a href="forest-stand-summary.html#cb112-110" tabindex="-1"></a><span class="co">#   , my_title = &quot;DTM&quot;</span></span>
<span id="cb112-111"><a href="forest-stand-summary.html#cb112-111" tabindex="-1"></a><span class="co">#   , scale_name = &quot;DTM (m)&quot;</span></span>
<span id="cb112-112"><a href="forest-stand-summary.html#cb112-112" tabindex="-1"></a><span class="co"># )</span></span></code></pre></div>
<div id="chm_plt" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> CHM<a href="forest-stand-summary.html#chm_plt" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the canopy height model is a raster dataset that represents the height of objects above the ground, we set the minimum height at 2 m</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="forest-stand-summary.html#cb113-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb113-2"><a href="forest-stand-summary.html#cb113-2" tabindex="-1"></a>plt_chm <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb113-3"><a href="forest-stand-summary.html#cb113-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">max</span>(terra<span class="sc">::</span><span class="fu">values</span>(chm_rast), <span class="at">na.rm =</span> T), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb113-4"><a href="forest-stand-summary.html#cb113-4" tabindex="-1"></a>    <span class="fu">plot_raster_stand_fn</span>(</span>
<span id="cb113-5"><a href="forest-stand-summary.html#cb113-5" tabindex="-1"></a>      chm_rast</span>
<span id="cb113-6"><a href="forest-stand-summary.html#cb113-6" tabindex="-1"></a>      , <span class="at">stand =</span> stand_sf[x,]</span>
<span id="cb113-7"><a href="forest-stand-summary.html#cb113-7" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb113-8"><a href="forest-stand-summary.html#cb113-8" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">2</span></span>
<span id="cb113-9"><a href="forest-stand-summary.html#cb113-9" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb113-10"><a href="forest-stand-summary.html#cb113-10" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Canopy Height Model&quot;</span></span>
<span id="cb113-11"><a href="forest-stand-summary.html#cb113-11" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb113-12"><a href="forest-stand-summary.html#cb113-12" tabindex="-1"></a>      , <span class="at">agg_fun =</span> <span class="st">&quot;max&quot;</span></span>
<span id="cb113-13"><a href="forest-stand-summary.html#cb113-13" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb113-14"><a href="forest-stand-summary.html#cb113-14" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb113-15"><a href="forest-stand-summary.html#cb113-15" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>,<span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb113-16"><a href="forest-stand-summary.html#cb113-16" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="forest-stand-summary.html#cb114-1" tabindex="-1"></a>plt_chm</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-101-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-101-2.png" width="1008" /></p>
</div>
<div id="function-to-rasterize" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Function to Rasterize<a href="forest-stand-summary.html#function-to-rasterize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the CHM was easy to plot because it was already a raster dataset; what if we want to plot a raster of a metric based on our vector tree data?</p>
<p>we need to define a function to rasterize our spatial tree list by aggregating a selected metric within a raster cell</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="forest-stand-summary.html#cb117-1" tabindex="-1"></a>vect_to_rast_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb117-2"><a href="forest-stand-summary.html#cb117-2" tabindex="-1"></a>  vect</span>
<span id="cb117-3"><a href="forest-stand-summary.html#cb117-3" tabindex="-1"></a>  , <span class="at">des_res =</span> <span class="dv">1</span></span>
<span id="cb117-4"><a href="forest-stand-summary.html#cb117-4" tabindex="-1"></a>  , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb117-5"><a href="forest-stand-summary.html#cb117-5" tabindex="-1"></a>  , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span> <span class="co"># function(x){mean(x, na.rm=T)}</span></span>
<span id="cb117-6"><a href="forest-stand-summary.html#cb117-6" tabindex="-1"></a>  , <span class="at">field =</span> <span class="st">&quot;your_vector_attribute&quot;</span></span>
<span id="cb117-7"><a href="forest-stand-summary.html#cb117-7" tabindex="-1"></a>  , <span class="at">zero_na =</span> F</span>
<span id="cb117-8"><a href="forest-stand-summary.html#cb117-8" tabindex="-1"></a>) {</span>
<span id="cb117-9"><a href="forest-stand-summary.html#cb117-9" tabindex="-1"></a>  <span class="co"># sample sf object with a bounding box + buffer</span></span>
<span id="cb117-10"><a href="forest-stand-summary.html#cb117-10" tabindex="-1"></a>  my_sf <span class="ot">&lt;-</span> vect <span class="sc">%&gt;%</span> </span>
<span id="cb117-11"><a href="forest-stand-summary.html#cb117-11" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb117-12"><a href="forest-stand-summary.html#cb117-12" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(vect)) <span class="sc">%&gt;%</span> </span>
<span id="cb117-13"><a href="forest-stand-summary.html#cb117-13" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer)</span>
<span id="cb117-14"><a href="forest-stand-summary.html#cb117-14" tabindex="-1"></a>  <span class="co"># extract bbox coordinates</span></span>
<span id="cb117-15"><a href="forest-stand-summary.html#cb117-15" tabindex="-1"></a>  bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(my_sf)</span>
<span id="cb117-16"><a href="forest-stand-summary.html#cb117-16" tabindex="-1"></a>  <span class="co"># create a terra raster using the bbox</span></span>
<span id="cb117-17"><a href="forest-stand-summary.html#cb117-17" tabindex="-1"></a>  my_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb117-18"><a href="forest-stand-summary.html#cb117-18" tabindex="-1"></a>    <span class="at">xmin =</span> bbox[<span class="dv">1</span>], <span class="at">ymin =</span> bbox[<span class="dv">2</span>], <span class="at">xmax =</span> bbox[<span class="dv">3</span>], <span class="at">ymax =</span> bbox[<span class="dv">4</span>]</span>
<span id="cb117-19"><a href="forest-stand-summary.html#cb117-19" tabindex="-1"></a>    , <span class="at">resolution =</span> des_res</span>
<span id="cb117-20"><a href="forest-stand-summary.html#cb117-20" tabindex="-1"></a>    , <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(vect)</span>
<span id="cb117-21"><a href="forest-stand-summary.html#cb117-21" tabindex="-1"></a>  )</span>
<span id="cb117-22"><a href="forest-stand-summary.html#cb117-22" tabindex="-1"></a>  <span class="co"># rasterize the vector data onto the grid, using a desired aggregation function (e.g., &quot;mean&quot;)</span></span>
<span id="cb117-23"><a href="forest-stand-summary.html#cb117-23" tabindex="-1"></a>  rasterized_data <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(</span>
<span id="cb117-24"><a href="forest-stand-summary.html#cb117-24" tabindex="-1"></a>    <span class="at">x =</span> vect</span>
<span id="cb117-25"><a href="forest-stand-summary.html#cb117-25" tabindex="-1"></a>    , <span class="at">y =</span> my_raster</span>
<span id="cb117-26"><a href="forest-stand-summary.html#cb117-26" tabindex="-1"></a>    , <span class="at">fun =</span> fun</span>
<span id="cb117-27"><a href="forest-stand-summary.html#cb117-27" tabindex="-1"></a>    , <span class="at">field =</span> field</span>
<span id="cb117-28"><a href="forest-stand-summary.html#cb117-28" tabindex="-1"></a>  )</span>
<span id="cb117-29"><a href="forest-stand-summary.html#cb117-29" tabindex="-1"></a>  <span class="cf">if</span>(zero_na){rasterized_data <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">subst</span>(rasterized_data,<span class="cn">NA</span>,<span class="dv">0</span>)}</span>
<span id="cb117-30"><a href="forest-stand-summary.html#cb117-30" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crs</span>(rasterized_data) <span class="ot">&lt;-</span> vect <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">crs</span>()</span>
<span id="cb117-31"><a href="forest-stand-summary.html#cb117-31" tabindex="-1"></a>  <span class="fu">return</span>(rasterized_data)</span>
<span id="cb117-32"><a href="forest-stand-summary.html#cb117-32" tabindex="-1"></a>}</span>
<span id="cb117-33"><a href="forest-stand-summary.html#cb117-33" tabindex="-1"></a><span class="co"># vect_to_rast_fn(</span></span>
<span id="cb117-34"><a href="forest-stand-summary.html#cb117-34" tabindex="-1"></a><span class="co">#   treetops_sf %&gt;% dplyr::filter(unit_id==treetops_sf$unit_id[2])</span></span>
<span id="cb117-35"><a href="forest-stand-summary.html#cb117-35" tabindex="-1"></a><span class="co">#   , des_res = 10</span></span>
<span id="cb117-36"><a href="forest-stand-summary.html#cb117-36" tabindex="-1"></a><span class="co">#   , field = &quot;dbh_cm&quot;</span></span>
<span id="cb117-37"><a href="forest-stand-summary.html#cb117-37" tabindex="-1"></a><span class="co">#   , fun = &quot;mean&quot; #function(x){mean(x, na.rm=T)}</span></span>
<span id="cb117-38"><a href="forest-stand-summary.html#cb117-38" tabindex="-1"></a><span class="co">#   , zero_na = F</span></span>
<span id="cb117-39"><a href="forest-stand-summary.html#cb117-39" tabindex="-1"></a><span class="co"># ) %&gt;%</span></span>
<span id="cb117-40"><a href="forest-stand-summary.html#cb117-40" tabindex="-1"></a><span class="co"># # terra::plot()</span></span>
<span id="cb117-41"><a href="forest-stand-summary.html#cb117-41" tabindex="-1"></a><span class="co"># terra::summary()</span></span></code></pre></div>
<p>we can combine our create a raster and plot it function</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="forest-stand-summary.html#cb118-1" tabindex="-1"></a><span class="co"># we can combine our create a raster and plot it function</span></span>
<span id="cb118-2"><a href="forest-stand-summary.html#cb118-2" tabindex="-1"></a>vect_to_rast_plot_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb118-3"><a href="forest-stand-summary.html#cb118-3" tabindex="-1"></a>  trees_vect</span>
<span id="cb118-4"><a href="forest-stand-summary.html#cb118-4" tabindex="-1"></a>  , stand_vect</span>
<span id="cb118-5"><a href="forest-stand-summary.html#cb118-5" tabindex="-1"></a>  , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span> <span class="co"># function(x){mean(x, na.rm=T)}</span></span>
<span id="cb118-6"><a href="forest-stand-summary.html#cb118-6" tabindex="-1"></a>  , <span class="at">field =</span> <span class="st">&quot;your_vector_attribute&quot;</span></span>
<span id="cb118-7"><a href="forest-stand-summary.html#cb118-7" tabindex="-1"></a>  , <span class="at">zero_na =</span> F </span>
<span id="cb118-8"><a href="forest-stand-summary.html#cb118-8" tabindex="-1"></a>  , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb118-9"><a href="forest-stand-summary.html#cb118-9" tabindex="-1"></a>  , <span class="at">des_res =</span> <span class="dv">10</span></span>
<span id="cb118-10"><a href="forest-stand-summary.html#cb118-10" tabindex="-1"></a>  , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb118-11"><a href="forest-stand-summary.html#cb118-11" tabindex="-1"></a>  , <span class="at">my_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb118-12"><a href="forest-stand-summary.html#cb118-12" tabindex="-1"></a>  , <span class="at">scale_name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb118-13"><a href="forest-stand-summary.html#cb118-13" tabindex="-1"></a>) {</span>
<span id="cb118-14"><a href="forest-stand-summary.html#cb118-14" tabindex="-1"></a>  <span class="co"># get the raster</span></span>
<span id="cb118-15"><a href="forest-stand-summary.html#cb118-15" tabindex="-1"></a>  rast <span class="ot">&lt;-</span> <span class="fu">vect_to_rast_fn</span>(</span>
<span id="cb118-16"><a href="forest-stand-summary.html#cb118-16" tabindex="-1"></a>    <span class="at">vect =</span> trees_vect</span>
<span id="cb118-17"><a href="forest-stand-summary.html#cb118-17" tabindex="-1"></a>    , <span class="at">des_res =</span> des_res</span>
<span id="cb118-18"><a href="forest-stand-summary.html#cb118-18" tabindex="-1"></a>    , <span class="at">buffer =</span> buffer</span>
<span id="cb118-19"><a href="forest-stand-summary.html#cb118-19" tabindex="-1"></a>    , <span class="at">fun =</span> fun</span>
<span id="cb118-20"><a href="forest-stand-summary.html#cb118-20" tabindex="-1"></a>    , <span class="at">field =</span> field</span>
<span id="cb118-21"><a href="forest-stand-summary.html#cb118-21" tabindex="-1"></a>    , <span class="at">zero_na =</span> zero_na</span>
<span id="cb118-22"><a href="forest-stand-summary.html#cb118-22" tabindex="-1"></a>  )</span>
<span id="cb118-23"><a href="forest-stand-summary.html#cb118-23" tabindex="-1"></a>  <span class="co"># plot it</span></span>
<span id="cb118-24"><a href="forest-stand-summary.html#cb118-24" tabindex="-1"></a>  <span class="fu">plot_raster_stand_fn</span>(</span>
<span id="cb118-25"><a href="forest-stand-summary.html#cb118-25" tabindex="-1"></a>      <span class="at">rast =</span> rast</span>
<span id="cb118-26"><a href="forest-stand-summary.html#cb118-26" tabindex="-1"></a>      , <span class="at">stand =</span> stand_vect</span>
<span id="cb118-27"><a href="forest-stand-summary.html#cb118-27" tabindex="-1"></a>      , <span class="at">buffer =</span> buffer</span>
<span id="cb118-28"><a href="forest-stand-summary.html#cb118-28" tabindex="-1"></a>      , <span class="at">des_res =</span> des_res</span>
<span id="cb118-29"><a href="forest-stand-summary.html#cb118-29" tabindex="-1"></a>      , <span class="at">stand_color =</span> stand_color</span>
<span id="cb118-30"><a href="forest-stand-summary.html#cb118-30" tabindex="-1"></a>      , <span class="at">my_title =</span> my_title</span>
<span id="cb118-31"><a href="forest-stand-summary.html#cb118-31" tabindex="-1"></a>      , <span class="at">scale_name =</span> scale_name</span>
<span id="cb118-32"><a href="forest-stand-summary.html#cb118-32" tabindex="-1"></a>  )</span>
<span id="cb118-33"><a href="forest-stand-summary.html#cb118-33" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mean-dbh" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Mean DBH<a href="forest-stand-summary.html#mean-dbh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>take this for a spin to get a raster of mean DBH plotted with our stand boundary</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="forest-stand-summary.html#cb119-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb119-2"><a href="forest-stand-summary.html#cb119-2" tabindex="-1"></a>plt_dbh <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb119-3"><a href="forest-stand-summary.html#cb119-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">max</span>(treetops_sf<span class="sc">$</span>dbh_cm,<span class="at">na.rm =</span> T), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb119-4"><a href="forest-stand-summary.html#cb119-4" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb119-5"><a href="forest-stand-summary.html#cb119-5" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb119-6"><a href="forest-stand-summary.html#cb119-6" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb119-7"><a href="forest-stand-summary.html#cb119-7" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb119-8"><a href="forest-stand-summary.html#cb119-8" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;dbh_cm&quot;</span></span>
<span id="cb119-9"><a href="forest-stand-summary.html#cb119-9" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb119-10"><a href="forest-stand-summary.html#cb119-10" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb119-11"><a href="forest-stand-summary.html#cb119-11" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">30</span></span>
<span id="cb119-12"><a href="forest-stand-summary.html#cb119-12" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb119-13"><a href="forest-stand-summary.html#cb119-13" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Mean DBH&quot;</span></span>
<span id="cb119-14"><a href="forest-stand-summary.html#cb119-14" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb119-15"><a href="forest-stand-summary.html#cb119-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb119-16"><a href="forest-stand-summary.html#cb119-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb119-17"><a href="forest-stand-summary.html#cb119-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Oranges&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb119-18"><a href="forest-stand-summary.html#cb119-18" tabindex="-1"></a>    <span class="co"># ggplot2::scale_fill_viridis_c(option = &quot;mako&quot;, direction = -1, limits = c(ll,ul))</span></span>
<span id="cb119-19"><a href="forest-stand-summary.html#cb119-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="forest-stand-summary.html#cb120-1" tabindex="-1"></a>plt_dbh</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-107-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-107-2.png" width="1008" /></p>
</div>
<div id="mean-height" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> Mean Height<a href="forest-stand-summary.html#mean-height" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>now get a raster of mean tree height plotted with our stand boundary which will be similar to the CHM but aggregated as if at the inventory plot level</p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="forest-stand-summary.html#cb123-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb123-2"><a href="forest-stand-summary.html#cb123-2" tabindex="-1"></a>plt_height <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb123-3"><a href="forest-stand-summary.html#cb123-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">max</span>(treetops_sf<span class="sc">$</span>tree_height_m,<span class="at">na.rm =</span> T), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb123-4"><a href="forest-stand-summary.html#cb123-4" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb123-5"><a href="forest-stand-summary.html#cb123-5" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb123-6"><a href="forest-stand-summary.html#cb123-6" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb123-7"><a href="forest-stand-summary.html#cb123-7" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb123-8"><a href="forest-stand-summary.html#cb123-8" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;tree_height_m&quot;</span></span>
<span id="cb123-9"><a href="forest-stand-summary.html#cb123-9" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb123-10"><a href="forest-stand-summary.html#cb123-10" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb123-11"><a href="forest-stand-summary.html#cb123-11" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">30</span></span>
<span id="cb123-12"><a href="forest-stand-summary.html#cb123-12" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb123-13"><a href="forest-stand-summary.html#cb123-13" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Mean Height&quot;</span></span>
<span id="cb123-14"><a href="forest-stand-summary.html#cb123-14" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;Height (m)&quot;</span></span>
<span id="cb123-15"><a href="forest-stand-summary.html#cb123-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb123-16"><a href="forest-stand-summary.html#cb123-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb123-17"><a href="forest-stand-summary.html#cb123-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;YlOrBr&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb123-18"><a href="forest-stand-summary.html#cb123-18" tabindex="-1"></a>    <span class="co"># ggplot2::scale_fill_viridis_c(option = &quot;mako&quot;, direction = -1, limits = c(ll,ul))</span></span>
<span id="cb123-19"><a href="forest-stand-summary.html#cb123-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="forest-stand-summary.html#cb124-1" tabindex="-1"></a>plt_height</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-110-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-110-2.png" width="1008" /></p>
</div>
<div id="qmd" class="section level3 hasAnchor" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> QMD<a href="forest-stand-summary.html#qmd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get the quadratic mean diameter (QMD) we are going to have to create a custom function that takes a list of DBH values and returns a single value</p>
<p>QMD is a measure of the diameter of the tree of mean basal area:</p>
<p><span class="math display">\[
\textrm{quadratic mean diameter (QMD)} = \sqrt{\frac{\sum{d_{i}^{2}}}{n}}
\]</span></p>
<p>, where <span class="math inline">\(d_{i}\)</span> is the diameter at breast height of an individual tree, and <span class="math inline">\(n\)</span> is the total number of trees.</p>
<div class="sourceCode" id="cb127"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb127-1"><a href="forest-stand-summary.html#cb127-1" tabindex="-1"></a>qmd_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb127-2"><a href="forest-stand-summary.html#cb127-2" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm=</span>T)<span class="sc">/</span><span class="fu">length</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)]))</span>
<span id="cb127-3"><a href="forest-stand-summary.html#cb127-3" tabindex="-1"></a>}</span>
<span id="cb127-4"><a href="forest-stand-summary.html#cb127-4" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb127-5"><a href="forest-stand-summary.html#cb127-5" tabindex="-1"></a>plt_qmd <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb127-6"><a href="forest-stand-summary.html#cb127-6" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">round</span>(<span class="fu">qmd_fn</span>(<span class="fu">max</span>(treetops_sf<span class="sc">$</span>dbh_cm,<span class="at">na.rm =</span> T))<span class="sc">*</span>.<span class="dv">95</span>), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb127-7"><a href="forest-stand-summary.html#cb127-7" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb127-8"><a href="forest-stand-summary.html#cb127-8" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb127-9"><a href="forest-stand-summary.html#cb127-9" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb127-10"><a href="forest-stand-summary.html#cb127-10" tabindex="-1"></a>      , <span class="at">fun =</span> qmd_fn</span>
<span id="cb127-11"><a href="forest-stand-summary.html#cb127-11" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;dbh_cm&quot;</span></span>
<span id="cb127-12"><a href="forest-stand-summary.html#cb127-12" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb127-13"><a href="forest-stand-summary.html#cb127-13" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb127-14"><a href="forest-stand-summary.html#cb127-14" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">30</span></span>
<span id="cb127-15"><a href="forest-stand-summary.html#cb127-15" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb127-16"><a href="forest-stand-summary.html#cb127-16" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Quadratic Mean Diameter&quot;</span></span>
<span id="cb127-17"><a href="forest-stand-summary.html#cb127-17" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;QMD (cm)&quot;</span></span>
<span id="cb127-18"><a href="forest-stand-summary.html#cb127-18" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb127-19"><a href="forest-stand-summary.html#cb127-19" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb127-20"><a href="forest-stand-summary.html#cb127-20" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Blues&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb127-21"><a href="forest-stand-summary.html#cb127-21" tabindex="-1"></a>    <span class="co"># ggplot2::scale_fill_viridis_c(option = &quot;cividis&quot;, begin = 0.55, limits = c(ll,ul))</span></span>
<span id="cb127-22"><a href="forest-stand-summary.html#cb127-22" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb128-1"><a href="forest-stand-summary.html#cb128-1" tabindex="-1"></a>plt_qmd</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-113-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-113-2.png" width="1008" /></p>
</div>
<div id="basal-area" class="section level3 hasAnchor" number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> Basal Area<a href="forest-stand-summary.html#basal-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get Basal Area (BA) in square meters per hectare we will also need to create a function that uses the area of the raster cell</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="forest-stand-summary.html#cb131-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb131-2"><a href="forest-stand-summary.html#cb131-2" tabindex="-1"></a><span class="co"># max(silv_metrics$basal_area_m2_per_ha)*2</span></span>
<span id="cb131-3"><a href="forest-stand-summary.html#cb131-3" tabindex="-1"></a>plt_ba <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb131-4"><a href="forest-stand-summary.html#cb131-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">my_res =</span> <span class="dv">30</span>, <span class="at">ul =</span> <span class="cn">NA</span>, <span class="at">ll =</span> <span class="cn">NA</span>){</span>
<span id="cb131-5"><a href="forest-stand-summary.html#cb131-5" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb131-6"><a href="forest-stand-summary.html#cb131-6" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb131-7"><a href="forest-stand-summary.html#cb131-7" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb131-8"><a href="forest-stand-summary.html#cb131-8" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x, <span class="at">na.rm=</span>T)<span class="sc">/</span>((my_res<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">10000</span>)}</span>
<span id="cb131-9"><a href="forest-stand-summary.html#cb131-9" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;basal_area_m2&quot;</span></span>
<span id="cb131-10"><a href="forest-stand-summary.html#cb131-10" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb131-11"><a href="forest-stand-summary.html#cb131-11" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb131-12"><a href="forest-stand-summary.html#cb131-12" tabindex="-1"></a>      , <span class="at">des_res =</span> my_res</span>
<span id="cb131-13"><a href="forest-stand-summary.html#cb131-13" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb131-14"><a href="forest-stand-summary.html#cb131-14" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Basal Area&quot;</span></span>
<span id="cb131-15"><a href="forest-stand-summary.html#cb131-15" tabindex="-1"></a>      , <span class="at">scale_name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;BA ($m ^ 2 </span><span class="sc">\\</span><span class="st">cdot ha^{-1}$)&quot;</span>)</span>
<span id="cb131-16"><a href="forest-stand-summary.html#cb131-16" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb131-17"><a href="forest-stand-summary.html#cb131-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb131-18"><a href="forest-stand-summary.html#cb131-18" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Purples&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb131-19"><a href="forest-stand-summary.html#cb131-19" tabindex="-1"></a>    <span class="co"># harrypotter::scale_fill_hp(option = &quot;slytherin&quot;, limits = c(ll,ul))</span></span>
<span id="cb131-20"><a href="forest-stand-summary.html#cb131-20" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb132-1"><a href="forest-stand-summary.html#cb132-1" tabindex="-1"></a>plt_ba</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-116-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-116-2.png" width="1008" /></p>
</div>
<div id="tph" class="section level3 hasAnchor" number="3.3.7">
<h3><span class="header-section-number">3.3.7</span> TPH<a href="forest-stand-summary.html#tph" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get trees per hectare (TPH) we will also need to create a function that uses the area of the raster cell</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="forest-stand-summary.html#cb135-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb135-2"><a href="forest-stand-summary.html#cb135-2" tabindex="-1"></a>plt_tph <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb135-3"><a href="forest-stand-summary.html#cb135-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">my_res =</span> <span class="dv">30</span>, <span class="at">ul =</span> <span class="dv">2444</span>, <span class="at">ll =</span> <span class="cn">NA</span>){</span>
<span id="cb135-4"><a href="forest-stand-summary.html#cb135-4" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb135-5"><a href="forest-stand-summary.html#cb135-5" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb135-6"><a href="forest-stand-summary.html#cb135-6" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb135-7"><a href="forest-stand-summary.html#cb135-7" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">length</span>(x)<span class="sc">/</span>((my_res<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">10000</span>)}</span>
<span id="cb135-8"><a href="forest-stand-summary.html#cb135-8" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;tree_height_m&quot;</span> <span class="co"># just need something to count </span></span>
<span id="cb135-9"><a href="forest-stand-summary.html#cb135-9" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb135-10"><a href="forest-stand-summary.html#cb135-10" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb135-11"><a href="forest-stand-summary.html#cb135-11" tabindex="-1"></a>      , <span class="at">des_res =</span> my_res</span>
<span id="cb135-12"><a href="forest-stand-summary.html#cb135-12" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb135-13"><a href="forest-stand-summary.html#cb135-13" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Trees per Hectare&quot;</span></span>
<span id="cb135-14"><a href="forest-stand-summary.html#cb135-14" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;TPH&quot;</span></span>
<span id="cb135-15"><a href="forest-stand-summary.html#cb135-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb135-16"><a href="forest-stand-summary.html#cb135-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb135-17"><a href="forest-stand-summary.html#cb135-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Greys&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb135-18"><a href="forest-stand-summary.html#cb135-18" tabindex="-1"></a>    <span class="co"># harrypotter::scale_fill_hp(option = &quot;mischief&quot;, limits = c(ll,ul))</span></span>
<span id="cb135-19"><a href="forest-stand-summary.html#cb135-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb136-1"><a href="forest-stand-summary.html#cb136-1" tabindex="-1"></a>plt_tph</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-119-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-119-2.png" width="1008" /></p>
</div>
<div id="cfl-cruz" class="section level3 hasAnchor" number="3.3.8">
<h3><span class="header-section-number">3.3.8</span> CFL Cruz<a href="forest-stand-summary.html#cfl-cruz" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get canopy fuel load (CFL) we will also need to create a function that uses the area of the raster cell</p>
<p>CFL is the total amount of flammable material (like leaves, needles, branches) within the tree crowns in a given area and expressed in units of mass per unit area (e.g., kilograms per square meter).</p>
<p>First, we’ll look at CFL based on the <a href="https://scholar.google.com/scholar?cluster=316241498622221569&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,5">Cruz et al. (2003)</a> equations and the FIA forest type group</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="forest-stand-summary.html#cb139-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb139-2"><a href="forest-stand-summary.html#cb139-2" tabindex="-1"></a>plt_cfl_cruz <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb139-3"><a href="forest-stand-summary.html#cb139-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">my_res =</span> <span class="dv">30</span>, <span class="at">ul =</span> <span class="fl">6.2</span>, <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb139-4"><a href="forest-stand-summary.html#cb139-4" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb139-5"><a href="forest-stand-summary.html#cb139-5" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb139-6"><a href="forest-stand-summary.html#cb139-6" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb139-7"><a href="forest-stand-summary.html#cb139-7" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x,<span class="at">na.rm =</span> T)<span class="sc">/</span>(my_res<span class="sc">^</span><span class="dv">2</span>)}</span>
<span id="cb139-8"><a href="forest-stand-summary.html#cb139-8" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;cruz_crown_biomass_kg&quot;</span></span>
<span id="cb139-9"><a href="forest-stand-summary.html#cb139-9" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb139-10"><a href="forest-stand-summary.html#cb139-10" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb139-11"><a href="forest-stand-summary.html#cb139-11" tabindex="-1"></a>      , <span class="at">des_res =</span> my_res</span>
<span id="cb139-12"><a href="forest-stand-summary.html#cb139-12" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb139-13"><a href="forest-stand-summary.html#cb139-13" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Cruz estimated Canopy Fuel Load&quot;</span></span>
<span id="cb139-14"><a href="forest-stand-summary.html#cb139-14" tabindex="-1"></a>      , <span class="at">scale_name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;Cruz CFL ($kg </span><span class="sc">\\</span><span class="st">cdot m^{-2}$)&quot;</span>)</span>
<span id="cb139-15"><a href="forest-stand-summary.html#cb139-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb139-16"><a href="forest-stand-summary.html#cb139-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb139-17"><a href="forest-stand-summary.html#cb139-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb139-18"><a href="forest-stand-summary.html#cb139-18" tabindex="-1"></a>    <span class="co"># ggplot2::scale_fill_viridis_c(option = &quot;rocket&quot;, begin = 0.5, direction = -1, limits = c(ll,ul))</span></span>
<span id="cb139-19"><a href="forest-stand-summary.html#cb139-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb140-1"><a href="forest-stand-summary.html#cb140-1" tabindex="-1"></a>plt_cfl_cruz</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-122-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-122-2.png" width="1008" /></p>
</div>
<div id="cfl-landfire" class="section level3 hasAnchor" number="3.3.9">
<h3><span class="header-section-number">3.3.9</span> CFL LANDFIRE<a href="forest-stand-summary.html#cfl-landfire" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get canopy fuel load (CFL) we will also need to create a function that uses the area of the raster cell</p>
<p>CFL is the total amount of flammable material (like leaves, needles, branches) within the tree crowns in a given area and expressed in units of mass per unit area (e.g., kilograms per square meter).</p>
<p>First, we’ll look at CFL based on the <a href="https://scholar.google.com/scholar?cluster=316241498622221569&amp;oi=gsb&amp;hl=en&amp;as_sdt=0,5">Cruz et al. (2003)</a> equations and the FIA forest type group</p>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="forest-stand-summary.html#cb143-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb143-2"><a href="forest-stand-summary.html#cb143-2" tabindex="-1"></a>plt_cfl_landfire <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb143-3"><a href="forest-stand-summary.html#cb143-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">my_res =</span> <span class="dv">30</span>, <span class="at">ul =</span> <span class="fl">6.2</span>, <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb143-4"><a href="forest-stand-summary.html#cb143-4" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb143-5"><a href="forest-stand-summary.html#cb143-5" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb143-6"><a href="forest-stand-summary.html#cb143-6" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb143-7"><a href="forest-stand-summary.html#cb143-7" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x,<span class="at">na.rm =</span> T)<span class="sc">/</span>(my_res<span class="sc">^</span><span class="dv">2</span>)}</span>
<span id="cb143-8"><a href="forest-stand-summary.html#cb143-8" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;landfire_crown_biomass_kg&quot;</span></span>
<span id="cb143-9"><a href="forest-stand-summary.html#cb143-9" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb143-10"><a href="forest-stand-summary.html#cb143-10" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb143-11"><a href="forest-stand-summary.html#cb143-11" tabindex="-1"></a>      , <span class="at">des_res =</span> my_res</span>
<span id="cb143-12"><a href="forest-stand-summary.html#cb143-12" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb143-13"><a href="forest-stand-summary.html#cb143-13" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;LANDFIRE estimated Canopy Fuel Load&quot;</span></span>
<span id="cb143-14"><a href="forest-stand-summary.html#cb143-14" tabindex="-1"></a>      , <span class="at">scale_name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;LANDFIRE CFL ($kg </span><span class="sc">\\</span><span class="st">cdot m^{-2}$)&quot;</span>)</span>
<span id="cb143-15"><a href="forest-stand-summary.html#cb143-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb143-16"><a href="forest-stand-summary.html#cb143-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb143-17"><a href="forest-stand-summary.html#cb143-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(<span class="at">palette =</span> <span class="st">&quot;Reds&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb143-18"><a href="forest-stand-summary.html#cb143-18" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="forest-stand-summary.html#cb144-1" tabindex="-1"></a>plt_cfl_landfire</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-125-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-125-2.png" width="1008" /></p>
</div>
<div id="fia-forest-type-group" class="section level3 hasAnchor" number="3.3.10">
<h3><span class="header-section-number">3.3.10</span> FIA Forest Type Group<a href="forest-stand-summary.html#fia-forest-type-group" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We’ll load the FIA Forest Type Group raster data written to the output directory during the processing as well as the lookup table that gets downloaded during <code>cloud2trees</code> setup (<code>cloud2trees::get_data()</code>)</p>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb147-1"><a href="forest-stand-summary.html#cb147-1" tabindex="-1"></a><span class="co"># load raster</span></span>
<span id="cb147-2"><a href="forest-stand-summary.html#cb147-2" tabindex="-1"></a>foresttype_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/type_rast.tif&quot;</span>)</span>
<span id="cb147-3"><a href="forest-stand-summary.html#cb147-3" tabindex="-1"></a><span class="co"># load lookup</span></span>
<span id="cb147-4"><a href="forest-stand-summary.html#cb147-4" tabindex="-1"></a>foresttype_lookup <span class="ot">&lt;-</span> <span class="fu">file.path</span>(cloud2trees<span class="sc">::</span><span class="fu">find_ext_data</span>()[[<span class="st">&quot;foresttype_dir&quot;</span>]], <span class="st">&quot;foresttype_lookup.csv&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb147-5"><a href="forest-stand-summary.html#cb147-5" tabindex="-1"></a>  readr<span class="sc">::</span><span class="fu">read_csv</span>(<span class="at">progress =</span> F, <span class="at">show_col_types =</span> F) <span class="sc">%&gt;%</span> </span>
<span id="cb147-6"><a href="forest-stand-summary.html#cb147-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">distinct</span>(forest_type_group_code, forest_type_group, hardwood_softwood) <span class="sc">%&gt;%</span> </span>
<span id="cb147-7"><a href="forest-stand-summary.html#cb147-7" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">forest_type_group =</span> stringr<span class="sc">::</span><span class="fu">str_remove</span>(forest_type_group, <span class="st">&quot; group&quot;</span>))</span>
<span id="cb147-8"><a href="forest-stand-summary.html#cb147-8" tabindex="-1"></a><span class="co"># what?</span></span>
<span id="cb147-9"><a href="forest-stand-summary.html#cb147-9" tabindex="-1"></a>foresttype_lookup <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 35
## Columns: 3
## $ forest_type_group_code &lt;dbl&gt; 100, 120, 140, 150, 160, 170, 180, 200, 220, 24…
## $ forest_type_group      &lt;chr&gt; &quot;White / red / jack pine&quot;, &quot;Spruce / fir&quot;, &quot;Lon…
## $ hardwood_softwood      &lt;chr&gt; &quot;Softwood&quot;, &quot;Softwood&quot;, &quot;Softwood&quot;, &quot;Softwood&quot;,…</code></pre>
<p>plot with our <code>plot_raster_stand_fn()</code> function</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb149-1"><a href="forest-stand-summary.html#cb149-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb149-2"><a href="forest-stand-summary.html#cb149-2" tabindex="-1"></a>plt_ftype <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb149-3"><a href="forest-stand-summary.html#cb149-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(</span>
<span id="cb149-4"><a href="forest-stand-summary.html#cb149-4" tabindex="-1"></a>    x</span>
<span id="cb149-5"><a href="forest-stand-summary.html#cb149-5" tabindex="-1"></a>    , <span class="at">my_lookup =</span> foresttype_lookup</span>
<span id="cb149-6"><a href="forest-stand-summary.html#cb149-6" tabindex="-1"></a>    , <span class="at">my_code =</span> <span class="st">&quot;forest_type_group_code&quot;</span></span>
<span id="cb149-7"><a href="forest-stand-summary.html#cb149-7" tabindex="-1"></a>    , <span class="at">my_lab =</span> <span class="st">&quot;forest_type_group&quot;</span></span>
<span id="cb149-8"><a href="forest-stand-summary.html#cb149-8" tabindex="-1"></a>  ){</span>
<span id="cb149-9"><a href="forest-stand-summary.html#cb149-9" tabindex="-1"></a>    <span class="fu">plot_raster_stand_fn</span>(</span>
<span id="cb149-10"><a href="forest-stand-summary.html#cb149-10" tabindex="-1"></a>      foresttype_rast</span>
<span id="cb149-11"><a href="forest-stand-summary.html#cb149-11" tabindex="-1"></a>      , <span class="at">stand =</span> stand_sf[x,]</span>
<span id="cb149-12"><a href="forest-stand-summary.html#cb149-12" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">10</span></span>
<span id="cb149-13"><a href="forest-stand-summary.html#cb149-13" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">30</span></span>
<span id="cb149-14"><a href="forest-stand-summary.html#cb149-14" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb149-15"><a href="forest-stand-summary.html#cb149-15" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;FIA Forest Type Group&quot;</span></span>
<span id="cb149-16"><a href="forest-stand-summary.html#cb149-16" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb149-17"><a href="forest-stand-summary.html#cb149-17" tabindex="-1"></a>      , <span class="at">agg_fun =</span> <span class="st">&quot;modal&quot;</span></span>
<span id="cb149-18"><a href="forest-stand-summary.html#cb149-18" tabindex="-1"></a>      , <span class="at">lookup =</span> my_lookup</span>
<span id="cb149-19"><a href="forest-stand-summary.html#cb149-19" tabindex="-1"></a>      , <span class="at">lookup_code =</span> my_code</span>
<span id="cb149-20"><a href="forest-stand-summary.html#cb149-20" tabindex="-1"></a>      , <span class="at">lookup_lab =</span> my_lab</span>
<span id="cb149-21"><a href="forest-stand-summary.html#cb149-21" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb149-22"><a href="forest-stand-summary.html#cb149-22" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb149-23"><a href="forest-stand-summary.html#cb149-23" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> ftype_pal)</span>
<span id="cb149-24"><a href="forest-stand-summary.html#cb149-24" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb150"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb150-1"><a href="forest-stand-summary.html#cb150-1" tabindex="-1"></a>plt_ftype</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-129-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-129-2.png" width="1008" /></p>
</div>
<div id="combine-by-stand-unit" class="section level3 hasAnchor" number="3.3.11">
<h3><span class="header-section-number">3.3.11</span> Combine by stand unit<a href="forest-stand-summary.html#combine-by-stand-unit" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>put all desired plots into a list to combine by stand unit</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb153-1"><a href="forest-stand-summary.html#cb153-1" tabindex="-1"></a>plt_list <span class="ot">&lt;-</span> <span class="fu">list</span>(plt_ftype, plt_ba, plt_qmd, plt_height, plt_tph, plt_cfl_landfire)</span></code></pre></div>
<p>combine the plots by stand unit</p>
<div class="sourceCode" id="cb154"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb154-1"><a href="forest-stand-summary.html#cb154-1" tabindex="-1"></a>plt_stands <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb154-2"><a href="forest-stand-summary.html#cb154-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x,<span class="at">my_stand_sf=</span>stand_sf,<span class="at">my_plt_list=</span>plt_list){</span>
<span id="cb154-3"><a href="forest-stand-summary.html#cb154-3" tabindex="-1"></a>    <span class="co"># get just this stand plots</span></span>
<span id="cb154-4"><a href="forest-stand-summary.html#cb154-4" tabindex="-1"></a>    plts <span class="ot">&lt;-</span> my_plt_list <span class="sc">%&gt;%</span></span>
<span id="cb154-5"><a href="forest-stand-summary.html#cb154-5" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">transpose</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb154-6"><a href="forest-stand-summary.html#cb154-6" tabindex="-1"></a>      purrr<span class="sc">::</span><span class="fu">pluck</span>(x)</span>
<span id="cb154-7"><a href="forest-stand-summary.html#cb154-7" tabindex="-1"></a>    <span class="co"># patchwork them</span></span>
<span id="cb154-8"><a href="forest-stand-summary.html#cb154-8" tabindex="-1"></a>    patchwork<span class="sc">::</span><span class="fu">wrap_plots</span>(plts) <span class="sc">+</span></span>
<span id="cb154-9"><a href="forest-stand-summary.html#cb154-9" tabindex="-1"></a>      patchwork<span class="sc">::</span><span class="fu">plot_annotation</span>(</span>
<span id="cb154-10"><a href="forest-stand-summary.html#cb154-10" tabindex="-1"></a>        <span class="at">title =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,my_stand_sf[x,]<span class="sc">$</span>unit_name)</span>
<span id="cb154-11"><a href="forest-stand-summary.html#cb154-11" tabindex="-1"></a>        , <span class="at">theme =</span> ggplot2<span class="sc">::</span><span class="fu">theme</span>(<span class="at">plot.title =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">18</span>, <span class="at">hjust =</span> <span class="fl">0.5</span>))</span>
<span id="cb154-12"><a href="forest-stand-summary.html#cb154-12" tabindex="-1"></a>      ) <span class="sc">&amp;</span></span>
<span id="cb154-13"><a href="forest-stand-summary.html#cb154-13" tabindex="-1"></a>      ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb154-14"><a href="forest-stand-summary.html#cb154-14" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb154-15"><a href="forest-stand-summary.html#cb154-15" tabindex="-1"></a>        , <span class="at">legend.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">size=</span><span class="fl">6.5</span>)</span>
<span id="cb154-16"><a href="forest-stand-summary.html#cb154-16" tabindex="-1"></a>        <span class="co"># , plot.background = ggplot2::element_rect(colour = &quot;gray77&quot;, fill=NA, linewidth=1)</span></span>
<span id="cb154-17"><a href="forest-stand-summary.html#cb154-17" tabindex="-1"></a>      )</span>
<span id="cb154-18"><a href="forest-stand-summary.html#cb154-18" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb155-1"><a href="forest-stand-summary.html#cb155-1" tabindex="-1"></a>plt_stands</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-133-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-133-2.png" width="1008" /></p>
</div>
</div>
<div id="canopy-cover" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Canopy Cover<a href="forest-stand-summary.html#canopy-cover" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To get a raster of canopy cover, which refers to the proportional area of the ground covered by tree crowns, it is more straightforward (and computationally efficient) to use the <a href="forest-stand-summary.html#chm_plt">CHM</a> and not the tree crown polygons. As a reminder, the canopy height model is a raster dataset that represents the height of objects above the ground, we set the minimum height at 2 m</p>
<p>we’ll first define a function to filter our CHM for cells over a certain height threshold so that users can determine what height constitutes the “canopy”</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb158-1"><a href="forest-stand-summary.html#cb158-1" tabindex="-1"></a><span class="co"># filter our CHM for cells over a certain height threshold</span></span>
<span id="cb158-2"><a href="forest-stand-summary.html#cb158-2" tabindex="-1"></a>chm_threshold_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(chm_rast, <span class="at">min_ht_m =</span> <span class="dv">2</span>) {</span>
<span id="cb158-3"><a href="forest-stand-summary.html#cb158-3" tabindex="-1"></a>  <span class="co">#option 1</span></span>
<span id="cb158-4"><a href="forest-stand-summary.html#cb158-4" tabindex="-1"></a>  new_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">clamp</span>(chm_rast, <span class="at">lower =</span> <span class="fu">as.numeric</span>(min_ht_m), <span class="at">values =</span> F)</span>
<span id="cb158-5"><a href="forest-stand-summary.html#cb158-5" tabindex="-1"></a>  <span class="co"># #option 3</span></span>
<span id="cb158-6"><a href="forest-stand-summary.html#cb158-6" tabindex="-1"></a>  <span class="co"># new_rast &lt;- terra::ifel(chm_rast &lt; as.numeric(min_ht_m), NA, chm_rast)</span></span>
<span id="cb158-7"><a href="forest-stand-summary.html#cb158-7" tabindex="-1"></a>  </span>
<span id="cb158-8"><a href="forest-stand-summary.html#cb158-8" tabindex="-1"></a>  <span class="fu">return</span>(new_rast)</span>
<span id="cb158-9"><a href="forest-stand-summary.html#cb158-9" tabindex="-1"></a>}</span>
<span id="cb158-10"><a href="forest-stand-summary.html#cb158-10" tabindex="-1"></a><span class="co"># chm_threshold_fn(chm_rast, 11) %&gt;% terra::plot()</span></span></code></pre></div>
<p>now we can use our filtered CHM to calculate canopy cover at a coarser resolution by determining the proportion of cells in the aggregated cell that were originally non-NA (i.e. &gt; height threshold)</p>
<div class="sourceCode" id="cb159"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb159-1"><a href="forest-stand-summary.html#cb159-1" tabindex="-1"></a>agg_propotion_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb159-2"><a href="forest-stand-summary.html#cb159-2" tabindex="-1"></a>  <span class="cf">if</span>(<span class="fu">any</span>(<span class="fu">is.na</span>(x))){</span>
<span id="cb159-3"><a href="forest-stand-summary.html#cb159-3" tabindex="-1"></a>    <span class="co"># return proportion of non-na cells</span></span>
<span id="cb159-4"><a href="forest-stand-summary.html#cb159-4" tabindex="-1"></a>    <span class="fu">return</span>(<span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)) <span class="sc">/</span> <span class="fu">length</span>(x))  </span>
<span id="cb159-5"><a href="forest-stand-summary.html#cb159-5" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb159-6"><a href="forest-stand-summary.html#cb159-6" tabindex="-1"></a>    <span class="co"># return 1 if all cells are non-na</span></span>
<span id="cb159-7"><a href="forest-stand-summary.html#cb159-7" tabindex="-1"></a>    <span class="fu">return</span>(<span class="dv">1</span>)</span>
<span id="cb159-8"><a href="forest-stand-summary.html#cb159-8" tabindex="-1"></a>  }</span>
<span id="cb159-9"><a href="forest-stand-summary.html#cb159-9" tabindex="-1"></a>}</span>
<span id="cb159-10"><a href="forest-stand-summary.html#cb159-10" tabindex="-1"></a><span class="co"># put all of this together to create a canopy cover function</span></span>
<span id="cb159-11"><a href="forest-stand-summary.html#cb159-11" tabindex="-1"></a>chm_to_canopy_cov_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(chm_rast, <span class="at">min_ht_m =</span> <span class="dv">2</span>, des_res) {</span>
<span id="cb159-12"><a href="forest-stand-summary.html#cb159-12" tabindex="-1"></a>  <span class="co"># filter our CHM for cells over a certain height threshold</span></span>
<span id="cb159-13"><a href="forest-stand-summary.html#cb159-13" tabindex="-1"></a>  rast <span class="ot">&lt;-</span> <span class="fu">chm_threshold_fn</span>(<span class="at">chm_rast=</span>chm_rast, <span class="at">min_ht_m=</span>min_ht_m)</span>
<span id="cb159-14"><a href="forest-stand-summary.html#cb159-14" tabindex="-1"></a>  <span class="co"># aggregate the raster</span></span>
<span id="cb159-15"><a href="forest-stand-summary.html#cb159-15" tabindex="-1"></a>  res_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(rast)[<span class="dv">1</span>]</span>
<span id="cb159-16"><a href="forest-stand-summary.html#cb159-16" tabindex="-1"></a>  <span class="cf">if</span>(res_temp<span class="sc">&lt;</span>des_res){</span>
<span id="cb159-17"><a href="forest-stand-summary.html#cb159-17" tabindex="-1"></a>    rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb159-18"><a href="forest-stand-summary.html#cb159-18" tabindex="-1"></a>      rast</span>
<span id="cb159-19"><a href="forest-stand-summary.html#cb159-19" tabindex="-1"></a>      , <span class="at">fact =</span> <span class="fu">round</span>(des_res<span class="sc">/</span>res_temp)</span>
<span id="cb159-20"><a href="forest-stand-summary.html#cb159-20" tabindex="-1"></a>      , <span class="at">fun =</span> agg_propotion_fn</span>
<span id="cb159-21"><a href="forest-stand-summary.html#cb159-21" tabindex="-1"></a>      , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb159-22"><a href="forest-stand-summary.html#cb159-22" tabindex="-1"></a>    )</span>
<span id="cb159-23"><a href="forest-stand-summary.html#cb159-23" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb159-24"><a href="forest-stand-summary.html#cb159-24" tabindex="-1"></a>    rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">subst</span>(rast, <span class="at">from =</span> <span class="cn">NA</span>, <span class="at">to =</span> <span class="cn">NA</span>, <span class="at">others =</span> <span class="dv">1</span>)</span>
<span id="cb159-25"><a href="forest-stand-summary.html#cb159-25" tabindex="-1"></a>  }</span>
<span id="cb159-26"><a href="forest-stand-summary.html#cb159-26" tabindex="-1"></a>  <span class="fu">return</span>(rast)</span>
<span id="cb159-27"><a href="forest-stand-summary.html#cb159-27" tabindex="-1"></a>}</span></code></pre></div>
<div id="entire-area" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Entire Area<a href="forest-stand-summary.html#entire-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>let’s get canopy cover for a canopy defined as heights &gt; 6 m and raster cells aggregated to 100 x 100 m (1 ha cells) and make a quick plot</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb160-1"><a href="forest-stand-summary.html#cb160-1" tabindex="-1"></a><span class="co"># get our canopy cover raster</span></span>
<span id="cb160-2"><a href="forest-stand-summary.html#cb160-2" tabindex="-1"></a>cc_rast <span class="ot">&lt;-</span> <span class="fu">chm_to_canopy_cov_fn</span>(<span class="at">chm_rast =</span> chm_rast, <span class="at">min_ht_m =</span> <span class="dv">6</span>, <span class="at">des_res =</span> <span class="dv">100</span>)</span></code></pre></div>
<p>plot it</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb161-1"><a href="forest-stand-summary.html#cb161-1" tabindex="-1"></a>cc_rast <span class="sc">%&gt;%</span> </span>
<span id="cb161-2"><a href="forest-stand-summary.html#cb161-2" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb161-3"><a href="forest-stand-summary.html#cb161-3" tabindex="-1"></a>    <span class="at">col =</span> <span class="co"># viridis::mako(100, direction = -1)</span></span>
<span id="cb161-4"><a href="forest-stand-summary.html#cb161-4" tabindex="-1"></a>      scales<span class="sc">::</span><span class="fu">pal_gradient_n</span>(</span>
<span id="cb161-5"><a href="forest-stand-summary.html#cb161-5" tabindex="-1"></a>        RColorBrewer<span class="sc">::</span><span class="fu">brewer.pal</span>(<span class="at">n=</span><span class="dv">9</span>,<span class="at">name =</span> <span class="st">&quot;Greens&quot;</span>) <span class="co"># max is 9</span></span>
<span id="cb161-6"><a href="forest-stand-summary.html#cb161-6" tabindex="-1"></a>      )(<span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">1</span>, <span class="at">length.out =</span> <span class="dv">100</span>))</span>
<span id="cb161-7"><a href="forest-stand-summary.html#cb161-7" tabindex="-1"></a>    , <span class="at">axes =</span> F, <span class="at">alpha =</span> <span class="fl">0.9</span></span>
<span id="cb161-8"><a href="forest-stand-summary.html#cb161-8" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;Canopy Cover (%)&quot;</span></span>
<span id="cb161-9"><a href="forest-stand-summary.html#cb161-9" tabindex="-1"></a>  )</span>
<span id="cb161-10"><a href="forest-stand-summary.html#cb161-10" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">vect</span>(stand_sf), <span class="at">add =</span> T, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-138-1.png" width="1008" /></p>
</div>
<div id="stands" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Stands<a href="forest-stand-summary.html#stands" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>we can use our canopy cover raster to get a plot for each stand</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb162-1"><a href="forest-stand-summary.html#cb162-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb162-2"><a href="forest-stand-summary.html#cb162-2" tabindex="-1"></a>plt_cc <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb162-3"><a href="forest-stand-summary.html#cb162-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="dv">1</span>, <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb162-4"><a href="forest-stand-summary.html#cb162-4" tabindex="-1"></a>    <span class="fu">plot_raster_stand_fn</span>(</span>
<span id="cb162-5"><a href="forest-stand-summary.html#cb162-5" tabindex="-1"></a>      cc_rast</span>
<span id="cb162-6"><a href="forest-stand-summary.html#cb162-6" tabindex="-1"></a>      , <span class="at">stand =</span> stand_sf[x,]</span>
<span id="cb162-7"><a href="forest-stand-summary.html#cb162-7" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">50</span></span>
<span id="cb162-8"><a href="forest-stand-summary.html#cb162-8" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">100</span></span>
<span id="cb162-9"><a href="forest-stand-summary.html#cb162-9" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb162-10"><a href="forest-stand-summary.html#cb162-10" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Canopy Cover&quot;</span></span>
<span id="cb162-11"><a href="forest-stand-summary.html#cb162-11" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;Canopy Cover&quot;</span></span>
<span id="cb162-12"><a href="forest-stand-summary.html#cb162-12" tabindex="-1"></a>      , <span class="at">agg_fun =</span> <span class="st">&quot;max&quot;</span></span>
<span id="cb162-13"><a href="forest-stand-summary.html#cb162-13" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb162-14"><a href="forest-stand-summary.html#cb162-14" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb162-15"><a href="forest-stand-summary.html#cb162-15" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_distiller</span>(</span>
<span id="cb162-16"><a href="forest-stand-summary.html#cb162-16" tabindex="-1"></a>      <span class="at">palette =</span> <span class="st">&quot;Greens&quot;</span>, <span class="at">direction =</span> <span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul)</span>
<span id="cb162-17"><a href="forest-stand-summary.html#cb162-17" tabindex="-1"></a>      , <span class="at">labels =</span> scales<span class="sc">::</span>percent</span>
<span id="cb162-18"><a href="forest-stand-summary.html#cb162-18" tabindex="-1"></a>    )</span>
<span id="cb162-19"><a href="forest-stand-summary.html#cb162-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb163-1"><a href="forest-stand-summary.html#cb163-1" tabindex="-1"></a>plt_cc</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-140-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-140-2.png" width="1008" /></p>
</div>
</div>
<div id="write-data" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Write Data<a href="forest-stand-summary.html#write-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>if we want to extend the buffer on our stand polygons to include trees outside of the unit for exporting data, then we will need to read in the tree list again since we filtered it above for only trees within unit boundaries to quantify the stand structure properly</p>
<div class="sourceCode" id="cb166"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb166-1"><a href="forest-stand-summary.html#cb166-1" tabindex="-1"></a>use_bbox_temp <span class="ot">&lt;-</span> F <span class="co"># use a bbox of the stand polygon or not?</span></span>
<span id="cb166-2"><a href="forest-stand-summary.html#cb166-2" tabindex="-1"></a>buffer_temp <span class="ot">&lt;-</span> <span class="dv">0</span> <span class="co"># buffer either the polygon or the bbox by this much</span></span>
<span id="cb166-3"><a href="forest-stand-summary.html#cb166-3" tabindex="-1"></a></span>
<span id="cb166-4"><a href="forest-stand-summary.html#cb166-4" tabindex="-1"></a><span class="co"># quick function to ingest a sf data.frame with geometry features for each row</span></span>
<span id="cb166-5"><a href="forest-stand-summary.html#cb166-5" tabindex="-1"></a><span class="co"># and return a bbox for each row-level geometry</span></span>
<span id="cb166-6"><a href="forest-stand-summary.html#cb166-6" tabindex="-1"></a>sf_bbox_by_row <span class="ot">&lt;-</span> <span class="cf">function</span>(df) {</span>
<span id="cb166-7"><a href="forest-stand-summary.html#cb166-7" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">inherits</span>(df,<span class="st">&quot;sf&quot;</span>)){<span class="fu">stop</span>(<span class="st">&quot;must be sf class object&quot;</span>)}</span>
<span id="cb166-8"><a href="forest-stand-summary.html#cb166-8" tabindex="-1"></a>  df <span class="sc">%&gt;%</span> </span>
<span id="cb166-9"><a href="forest-stand-summary.html#cb166-9" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb166-10"><a href="forest-stand-summary.html#cb166-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rowwise</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb166-11"><a href="forest-stand-summary.html#cb166-11" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb166-12"><a href="forest-stand-summary.html#cb166-12" tabindex="-1"></a>      <span class="at">xmin_temp =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">1</span>]</span>
<span id="cb166-13"><a href="forest-stand-summary.html#cb166-13" tabindex="-1"></a>      , <span class="at">ymin_temp =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">2</span>]</span>
<span id="cb166-14"><a href="forest-stand-summary.html#cb166-14" tabindex="-1"></a>      , <span class="at">xmax_temp =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">3</span>]</span>
<span id="cb166-15"><a href="forest-stand-summary.html#cb166-15" tabindex="-1"></a>      , <span class="at">ymax_temp =</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(geometry)[<span class="dv">4</span>]</span>
<span id="cb166-16"><a href="forest-stand-summary.html#cb166-16" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb166-17"><a href="forest-stand-summary.html#cb166-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb166-18"><a href="forest-stand-summary.html#cb166-18" tabindex="-1"></a>      <span class="at">geometry =</span> sf<span class="sc">::</span><span class="fu">st_sfc</span>(</span>
<span id="cb166-19"><a href="forest-stand-summary.html#cb166-19" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(xmin_temp,ymin_temp)) <span class="co"># lower_left_pt</span></span>
<span id="cb166-20"><a href="forest-stand-summary.html#cb166-20" tabindex="-1"></a>          , sf<span class="sc">::</span><span class="fu">st_point</span>(<span class="fu">c</span>(xmax_temp,ymax_temp)) <span class="co"># upper_right_pt</span></span>
<span id="cb166-21"><a href="forest-stand-summary.html#cb166-21" tabindex="-1"></a>        ) <span class="sc">%&gt;%</span> </span>
<span id="cb166-22"><a href="forest-stand-summary.html#cb166-22" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb166-23"><a href="forest-stand-summary.html#cb166-23" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_as_sfc</span>()</span>
<span id="cb166-24"><a href="forest-stand-summary.html#cb166-24" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb166-25"><a href="forest-stand-summary.html#cb166-25" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb166-26"><a href="forest-stand-summary.html#cb166-26" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_geometry</span>(<span class="st">&quot;geometry&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb166-27"><a href="forest-stand-summary.html#cb166-27" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_set_crs</span>(sf<span class="sc">::</span><span class="fu">st_crs</span>(df)) <span class="sc">%&gt;%</span> </span>
<span id="cb166-28"><a href="forest-stand-summary.html#cb166-28" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(xmin_temp,ymin_temp,xmax_temp,ymax_temp))</span>
<span id="cb166-29"><a href="forest-stand-summary.html#cb166-29" tabindex="-1"></a>}</span>
<span id="cb166-30"><a href="forest-stand-summary.html#cb166-30" tabindex="-1"></a></span>
<span id="cb166-31"><a href="forest-stand-summary.html#cb166-31" tabindex="-1"></a><span class="co">#checks and run</span></span>
<span id="cb166-32"><a href="forest-stand-summary.html#cb166-32" tabindex="-1"></a><span class="cf">if</span>(buffer_temp<span class="sc">&gt;</span><span class="dv">0</span> <span class="sc">||</span> use_bbox_temp <span class="sc">==</span> T){</span>
<span id="cb166-33"><a href="forest-stand-summary.html#cb166-33" tabindex="-1"></a>  <span class="co"># get the data from already run</span></span>
<span id="cb166-34"><a href="forest-stand-summary.html#cb166-34" tabindex="-1"></a>  treetops_sf <span class="ot">&lt;-</span></span>
<span id="cb166-35"><a href="forest-stand-summary.html#cb166-35" tabindex="-1"></a>    <span class="fu">list.files</span>(</span>
<span id="cb166-36"><a href="forest-stand-summary.html#cb166-36" tabindex="-1"></a>      <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span></span>
<span id="cb166-37"><a href="forest-stand-summary.html#cb166-37" tabindex="-1"></a>      , <span class="at">pattern =</span> <span class="st">&quot;final_detected_tree_tops.*</span><span class="sc">\\</span><span class="st">.gpkg$&quot;</span></span>
<span id="cb166-38"><a href="forest-stand-summary.html#cb166-38" tabindex="-1"></a>      , <span class="at">full.names =</span> T</span>
<span id="cb166-39"><a href="forest-stand-summary.html#cb166-39" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb166-40"><a href="forest-stand-summary.html#cb166-40" tabindex="-1"></a>    <span class="fu">normalizePath</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb166-41"><a href="forest-stand-summary.html#cb166-41" tabindex="-1"></a>    purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb166-42"><a href="forest-stand-summary.html#cb166-42" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb166-43"><a href="forest-stand-summary.html#cb166-43" tabindex="-1"></a>        <span class="at">dsn =</span> x</span>
<span id="cb166-44"><a href="forest-stand-summary.html#cb166-44" tabindex="-1"></a>        , <span class="at">quiet =</span> T</span>
<span id="cb166-45"><a href="forest-stand-summary.html#cb166-45" tabindex="-1"></a>      )</span>
<span id="cb166-46"><a href="forest-stand-summary.html#cb166-46" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb166-47"><a href="forest-stand-summary.html#cb166-47" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span>
<span id="cb166-48"><a href="forest-stand-summary.html#cb166-48" tabindex="-1"></a>  <span class="co"># bbox or not?</span></span>
<span id="cb166-49"><a href="forest-stand-summary.html#cb166-49" tabindex="-1"></a>    <span class="cf">if</span>(use_bbox_temp){</span>
<span id="cb166-50"><a href="forest-stand-summary.html#cb166-50" tabindex="-1"></a>      stand_sf_temp <span class="ot">&lt;-</span> stand_sf <span class="sc">%&gt;%</span> </span>
<span id="cb166-51"><a href="forest-stand-summary.html#cb166-51" tabindex="-1"></a>        <span class="fu">sf_bbox_by_row</span>()</span>
<span id="cb166-52"><a href="forest-stand-summary.html#cb166-52" tabindex="-1"></a>    }<span class="cf">else</span>{stand_sf_temp <span class="ot">&lt;-</span> stand_sf}</span>
<span id="cb166-53"><a href="forest-stand-summary.html#cb166-53" tabindex="-1"></a>    <span class="co"># stand_sf %&gt;%</span></span>
<span id="cb166-54"><a href="forest-stand-summary.html#cb166-54" tabindex="-1"></a>    <span class="co"># dplyr::select(unit_id,unit_name,tidyselect::starts_with(&quot;stand_area_&quot;)) %&gt;%</span></span>
<span id="cb166-55"><a href="forest-stand-summary.html#cb166-55" tabindex="-1"></a>    <span class="co"># sf_bbox_by_row() %&gt;%</span></span>
<span id="cb166-56"><a href="forest-stand-summary.html#cb166-56" tabindex="-1"></a>    <span class="co"># sf::st_buffer(buffer_temp) %&gt;%</span></span>
<span id="cb166-57"><a href="forest-stand-summary.html#cb166-57" tabindex="-1"></a>    <span class="co"># ggplot() + geom_sf(alpha=0.7) + geom_sf(data=stand_sf,color=&quot;red&quot;,fill=NA,lwd=2)</span></span>
<span id="cb166-58"><a href="forest-stand-summary.html#cb166-58" tabindex="-1"></a>  <span class="co"># trees clip</span></span>
<span id="cb166-59"><a href="forest-stand-summary.html#cb166-59" tabindex="-1"></a>  <span class="cf">if</span>(buffer_temp<span class="sc">&gt;</span><span class="dv">0</span>){</span>
<span id="cb166-60"><a href="forest-stand-summary.html#cb166-60" tabindex="-1"></a>    treetops_sf <span class="ot">&lt;-</span> treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb166-61"><a href="forest-stand-summary.html#cb166-61" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb166-62"><a href="forest-stand-summary.html#cb166-62" tabindex="-1"></a>        stand_sf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb166-63"><a href="forest-stand-summary.html#cb166-63" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(unit_id,unit_name,tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;stand_area_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb166-64"><a href="forest-stand-summary.html#cb166-64" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer_temp)</span>
<span id="cb166-65"><a href="forest-stand-summary.html#cb166-65" tabindex="-1"></a>      ) </span>
<span id="cb166-66"><a href="forest-stand-summary.html#cb166-66" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb166-67"><a href="forest-stand-summary.html#cb166-67" tabindex="-1"></a>    treetops_sf <span class="ot">&lt;-</span> treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb166-68"><a href="forest-stand-summary.html#cb166-68" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_intersection</span>(</span>
<span id="cb166-69"><a href="forest-stand-summary.html#cb166-69" tabindex="-1"></a>        stand_sf_temp <span class="sc">%&gt;%</span> </span>
<span id="cb166-70"><a href="forest-stand-summary.html#cb166-70" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(unit_id,unit_name,tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;stand_area_&quot;</span>))</span>
<span id="cb166-71"><a href="forest-stand-summary.html#cb166-71" tabindex="-1"></a>      ) </span>
<span id="cb166-72"><a href="forest-stand-summary.html#cb166-72" tabindex="-1"></a>  }</span>
<span id="cb166-73"><a href="forest-stand-summary.html#cb166-73" tabindex="-1"></a>  <span class="co"># treetops_sf %&gt;% nrow()</span></span>
<span id="cb166-74"><a href="forest-stand-summary.html#cb166-74" tabindex="-1"></a>  <span class="co"># treetops_sf %&gt;% sf::st_drop_geometry() %&gt;% dplyr::distinct(treeID) %&gt;% nrow()</span></span>
<span id="cb166-75"><a href="forest-stand-summary.html#cb166-75" tabindex="-1"></a>  <span class="co"># treetops_sf %&gt;% sf::st_drop_geometry() %&gt;% dplyr::distinct(treeID, unit_id) %&gt;% nrow()</span></span>
<span id="cb166-76"><a href="forest-stand-summary.html#cb166-76" tabindex="-1"></a>  </span>
<span id="cb166-77"><a href="forest-stand-summary.html#cb166-77" tabindex="-1"></a>  <span class="do">## fill in missing cruz </span></span>
<span id="cb166-78"><a href="forest-stand-summary.html#cb166-78" tabindex="-1"></a>  treetops_sf <span class="ot">&lt;-</span> </span>
<span id="cb166-79"><a href="forest-stand-summary.html#cb166-79" tabindex="-1"></a>    treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb166-80"><a href="forest-stand-summary.html#cb166-80" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb166-81"><a href="forest-stand-summary.html#cb166-81" tabindex="-1"></a>      <span class="at">is_missing_cruz =</span> <span class="fu">is.na</span>(cruz_crown_biomass_kg)</span>
<span id="cb166-82"><a href="forest-stand-summary.html#cb166-82" tabindex="-1"></a>      , <span class="at">cruz_tree_kg_per_m3 =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(cruz_tree_kg_per_m3, landfire_tree_kg_per_m3)</span>
<span id="cb166-83"><a href="forest-stand-summary.html#cb166-83" tabindex="-1"></a>      , <span class="at">cruz_stand_kg_per_m3 =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(cruz_stand_kg_per_m3, landfire_stand_kg_per_m3)</span>
<span id="cb166-84"><a href="forest-stand-summary.html#cb166-84" tabindex="-1"></a>      , <span class="at">cruz_crown_biomass_kg =</span> dplyr<span class="sc">::</span><span class="fu">coalesce</span>(cruz_crown_biomass_kg, landfire_crown_biomass_kg)</span>
<span id="cb166-85"><a href="forest-stand-summary.html#cb166-85" tabindex="-1"></a>    )</span>
<span id="cb166-86"><a href="forest-stand-summary.html#cb166-86" tabindex="-1"></a>  </span>
<span id="cb166-87"><a href="forest-stand-summary.html#cb166-87" tabindex="-1"></a>}</span></code></pre></div>
<p>load in the tree crown polygon data from <code>cloud2trees::cloud2trees()</code> and filter based on the tree list</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb167-1"><a href="forest-stand-summary.html#cb167-1" tabindex="-1"></a><span class="co"># get the data from already run</span></span>
<span id="cb167-2"><a href="forest-stand-summary.html#cb167-2" tabindex="-1"></a>crowns_sf <span class="ot">&lt;-</span></span>
<span id="cb167-3"><a href="forest-stand-summary.html#cb167-3" tabindex="-1"></a>  <span class="fu">list.files</span>(</span>
<span id="cb167-4"><a href="forest-stand-summary.html#cb167-4" tabindex="-1"></a>    <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span></span>
<span id="cb167-5"><a href="forest-stand-summary.html#cb167-5" tabindex="-1"></a>    , <span class="at">pattern =</span> <span class="st">&quot;final_detected_crowns.*</span><span class="sc">\\</span><span class="st">.gpkg$&quot;</span></span>
<span id="cb167-6"><a href="forest-stand-summary.html#cb167-6" tabindex="-1"></a>    , <span class="at">full.names =</span> T</span>
<span id="cb167-7"><a href="forest-stand-summary.html#cb167-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb167-8"><a href="forest-stand-summary.html#cb167-8" tabindex="-1"></a>  <span class="fu">normalizePath</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-9"><a href="forest-stand-summary.html#cb167-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb167-10"><a href="forest-stand-summary.html#cb167-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb167-11"><a href="forest-stand-summary.html#cb167-11" tabindex="-1"></a>      <span class="at">dsn =</span> x</span>
<span id="cb167-12"><a href="forest-stand-summary.html#cb167-12" tabindex="-1"></a>      , <span class="at">quiet =</span> T</span>
<span id="cb167-13"><a href="forest-stand-summary.html#cb167-13" tabindex="-1"></a>    )</span>
<span id="cb167-14"><a href="forest-stand-summary.html#cb167-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb167-15"><a href="forest-stand-summary.html#cb167-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-16"><a href="forest-stand-summary.html#cb167-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>( <span class="sc">-</span>dplyr<span class="sc">::</span><span class="fu">any_of</span>(<span class="fu">c</span>(</span>
<span id="cb167-17"><a href="forest-stand-summary.html#cb167-17" tabindex="-1"></a>    <span class="st">&quot;cruz_tree_kg_per_m3&quot;</span></span>
<span id="cb167-18"><a href="forest-stand-summary.html#cb167-18" tabindex="-1"></a>    , <span class="st">&quot;cruz_stand_kg_per_m3&quot;</span></span>
<span id="cb167-19"><a href="forest-stand-summary.html#cb167-19" tabindex="-1"></a>    , <span class="st">&quot;cruz_crown_biomass_kg&quot;</span></span>
<span id="cb167-20"><a href="forest-stand-summary.html#cb167-20" tabindex="-1"></a>  ))) <span class="sc">%&gt;%</span> </span>
<span id="cb167-21"><a href="forest-stand-summary.html#cb167-21" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb167-22"><a href="forest-stand-summary.html#cb167-22" tabindex="-1"></a>    treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb167-23"><a href="forest-stand-summary.html#cb167-23" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb167-24"><a href="forest-stand-summary.html#cb167-24" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb167-25"><a href="forest-stand-summary.html#cb167-25" tabindex="-1"></a>        treeID,unit_id,unit_name,tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;stand_area_&quot;</span>)</span>
<span id="cb167-26"><a href="forest-stand-summary.html#cb167-26" tabindex="-1"></a>        , is_missing_cruz</span>
<span id="cb167-27"><a href="forest-stand-summary.html#cb167-27" tabindex="-1"></a>        , cruz_tree_kg_per_m3</span>
<span id="cb167-28"><a href="forest-stand-summary.html#cb167-28" tabindex="-1"></a>        , cruz_stand_kg_per_m3</span>
<span id="cb167-29"><a href="forest-stand-summary.html#cb167-29" tabindex="-1"></a>        , cruz_crown_biomass_kg</span>
<span id="cb167-30"><a href="forest-stand-summary.html#cb167-30" tabindex="-1"></a>      )</span>
<span id="cb167-31"><a href="forest-stand-summary.html#cb167-31" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;treeID&quot;</span></span>
<span id="cb167-32"><a href="forest-stand-summary.html#cb167-32" tabindex="-1"></a>    , <span class="at">relationship =</span> <span class="st">&quot;one-to-many&quot;</span> <span class="co"># allows for one tree to be in multiple units (e.g. if we buffered units)</span></span>
<span id="cb167-33"><a href="forest-stand-summary.html#cb167-33" tabindex="-1"></a>  )</span>
<span id="cb167-34"><a href="forest-stand-summary.html#cb167-34" tabindex="-1"></a><span class="co"># the records are the same</span></span>
<span id="cb167-35"><a href="forest-stand-summary.html#cb167-35" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">nrow</span>(treetops_sf), <span class="fu">nrow</span>(crowns_sf))</span>
<span id="cb167-36"><a href="forest-stand-summary.html#cb167-36" tabindex="-1"></a><span class="co"># crowns_sf %&gt;% dplyr::filter(is.na(cruz_crown_biomass_kg)) %&gt;% nrow()</span></span></code></pre></div>
<p>save the data by unit for sharing with a boss, coworker, friend, etc.</p>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb168-1"><a href="forest-stand-summary.html#cb168-1" tabindex="-1"></a><span class="co"># write crowns and tree tops</span></span>
<span id="cb168-2"><a href="forest-stand-summary.html#cb168-2" tabindex="-1"></a>write_temp <span class="ot">&lt;-</span> crowns_sf<span class="sc">$</span>unit_id <span class="sc">%&gt;%</span></span>
<span id="cb168-3"><a href="forest-stand-summary.html#cb168-3" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-4"><a href="forest-stand-summary.html#cb168-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">new_crs =</span> proj_crs, <span class="at">my_outdir =</span> outdir){</span>
<span id="cb168-5"><a href="forest-stand-summary.html#cb168-5" tabindex="-1"></a>    <span class="co"># dsn&#39;s</span></span>
<span id="cb168-6"><a href="forest-stand-summary.html#cb168-6" tabindex="-1"></a>    cf <span class="ot">&lt;-</span> <span class="fu">file.path</span>( my_outdir, <span class="fu">paste0</span>(<span class="st">&quot;final_detected_crowns_unit_&quot;</span>,x,<span class="st">&quot;.gpkg&quot;</span>) )</span>
<span id="cb168-7"><a href="forest-stand-summary.html#cb168-7" tabindex="-1"></a>    tf <span class="ot">&lt;-</span> <span class="fu">file.path</span>( my_outdir, <span class="fu">paste0</span>(<span class="st">&quot;final_detected_tree_tops_unit_&quot;</span>,x,<span class="st">&quot;.gpkg&quot;</span>) )</span>
<span id="cb168-8"><a href="forest-stand-summary.html#cb168-8" tabindex="-1"></a>    <span class="do">### write the data to the disk</span></span>
<span id="cb168-9"><a href="forest-stand-summary.html#cb168-9" tabindex="-1"></a>    <span class="co"># crown vector polygons</span></span>
<span id="cb168-10"><a href="forest-stand-summary.html#cb168-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_write</span>(</span>
<span id="cb168-11"><a href="forest-stand-summary.html#cb168-11" tabindex="-1"></a>      crowns_sf <span class="sc">%&gt;%</span></span>
<span id="cb168-12"><a href="forest-stand-summary.html#cb168-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb168-13"><a href="forest-stand-summary.html#cb168-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(new_crs)</span>
<span id="cb168-14"><a href="forest-stand-summary.html#cb168-14" tabindex="-1"></a>      , <span class="at">dsn =</span> cf</span>
<span id="cb168-15"><a href="forest-stand-summary.html#cb168-15" tabindex="-1"></a>      , <span class="at">append =</span> <span class="cn">FALSE</span></span>
<span id="cb168-16"><a href="forest-stand-summary.html#cb168-16" tabindex="-1"></a>      , <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb168-17"><a href="forest-stand-summary.html#cb168-17" tabindex="-1"></a>    )</span>
<span id="cb168-18"><a href="forest-stand-summary.html#cb168-18" tabindex="-1"></a>    <span class="co"># tree top vector points</span></span>
<span id="cb168-19"><a href="forest-stand-summary.html#cb168-19" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_write</span>(</span>
<span id="cb168-20"><a href="forest-stand-summary.html#cb168-20" tabindex="-1"></a>      <span class="co"># get tree points</span></span>
<span id="cb168-21"><a href="forest-stand-summary.html#cb168-21" tabindex="-1"></a>      crowns_sf <span class="sc">%&gt;%</span></span>
<span id="cb168-22"><a href="forest-stand-summary.html#cb168-22" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> x) <span class="sc">%&gt;%</span></span>
<span id="cb168-23"><a href="forest-stand-summary.html#cb168-23" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb168-24"><a href="forest-stand-summary.html#cb168-24" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;tree_x&quot;</span>, <span class="st">&quot;tree_y&quot;</span>), <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(crowns_sf)) <span class="sc">%&gt;%</span> </span>
<span id="cb168-25"><a href="forest-stand-summary.html#cb168-25" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(new_crs) <span class="sc">%&gt;%</span> </span>
<span id="cb168-26"><a href="forest-stand-summary.html#cb168-26" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb168-27"><a href="forest-stand-summary.html#cb168-27" tabindex="-1"></a>          <span class="at">tree_x =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>]</span>
<span id="cb168-28"><a href="forest-stand-summary.html#cb168-28" tabindex="-1"></a>          , <span class="at">tree_y =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>]</span>
<span id="cb168-29"><a href="forest-stand-summary.html#cb168-29" tabindex="-1"></a>        )</span>
<span id="cb168-30"><a href="forest-stand-summary.html#cb168-30" tabindex="-1"></a>      , <span class="at">dsn =</span> tf</span>
<span id="cb168-31"><a href="forest-stand-summary.html#cb168-31" tabindex="-1"></a>      , <span class="at">append =</span> <span class="cn">FALSE</span></span>
<span id="cb168-32"><a href="forest-stand-summary.html#cb168-32" tabindex="-1"></a>      , <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb168-33"><a href="forest-stand-summary.html#cb168-33" tabindex="-1"></a>    )</span>
<span id="cb168-34"><a href="forest-stand-summary.html#cb168-34" tabindex="-1"></a>  })</span></code></pre></div>
<p>we now need to attach the <code>treeID</code> to the point cloud for use in performing tree species classification based on the three-dimensional data based on the methods developed within our study area by <a href="https://scholar.google.com/scholar?cluster=12483518836038968271&amp;hl=en&amp;as_sdt=0,6">Blackburn (2022)</a></p>
<p>we’ll use the height normalized point cloud data dropped off by <code>cloud2trees::cloud2trees()</code> during our <a href="processing.html#processing">point cloud processing</a> by loading the data in as a LAScatalog via <code>lidR::readLAScatalog()</code> and attaching the <code>treeID</code> attribute with <code>cloud2trees::polygon_attribute_to_las()</code></p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb169-1"><a href="forest-stand-summary.html#cb169-1" tabindex="-1"></a><span class="co"># use the height normalized las files dropped off by cloud2trees::cloud2trees()</span></span>
<span id="cb169-2"><a href="forest-stand-summary.html#cb169-2" tabindex="-1"></a>las_ctg <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">readLAScatalog</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/norm_las/&quot;</span>)</span>
<span id="cb169-3"><a href="forest-stand-summary.html#cb169-3" tabindex="-1"></a><span class="co"># set the lascatalog options</span></span>
<span id="cb169-4"><a href="forest-stand-summary.html#cb169-4" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">opt_progress</span>(las_ctg) <span class="ot">&lt;-</span> F</span>
<span id="cb169-5"><a href="forest-stand-summary.html#cb169-5" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">opt_filter</span>(las_ctg) <span class="ot">&lt;-</span> <span class="st">&quot;-drop_duplicates -drop_class 2 9 18&quot;</span> <span class="do">## 2 = ground; 9 = water; 18 = noise</span></span>
<span id="cb169-6"><a href="forest-stand-summary.html#cb169-6" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">opt_select</span>(las_ctg) <span class="ot">&lt;-</span> <span class="st">&quot;xyz0&quot;</span> <span class="co"># 0 enables all extra bytes to be loaded...possibly treeID</span></span>
<span id="cb169-7"><a href="forest-stand-summary.html#cb169-7" tabindex="-1"></a><span class="co"># lidR::opt_output_files(las_ctg) &lt;- paste0(tempdir(), &quot;/{*}_treed&quot;)</span></span>
<span id="cb169-8"><a href="forest-stand-summary.html#cb169-8" tabindex="-1"></a><span class="co"># define a function to attach treeID to the point cloud and return only points with a treeID</span></span>
<span id="cb169-9"><a href="forest-stand-summary.html#cb169-9" tabindex="-1"></a><span class="co"># this will get used in our lidR::catalog_apply()</span></span>
<span id="cb169-10"><a href="forest-stand-summary.html#cb169-10" tabindex="-1"></a>ctg_polygon_attribute_to_las <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb169-11"><a href="forest-stand-summary.html#cb169-11" tabindex="-1"></a>  chunk</span>
<span id="cb169-12"><a href="forest-stand-summary.html#cb169-12" tabindex="-1"></a>  , poly_df</span>
<span id="cb169-13"><a href="forest-stand-summary.html#cb169-13" tabindex="-1"></a>  , <span class="at">attribute =</span> <span class="st">&quot;treeID&quot;</span></span>
<span id="cb169-14"><a href="forest-stand-summary.html#cb169-14" tabindex="-1"></a>  , <span class="at">force_crs =</span> F</span>
<span id="cb169-15"><a href="forest-stand-summary.html#cb169-15" tabindex="-1"></a>){</span>
<span id="cb169-16"><a href="forest-stand-summary.html#cb169-16" tabindex="-1"></a>  las <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">readLAS</span>(chunk)</span>
<span id="cb169-17"><a href="forest-stand-summary.html#cb169-17" tabindex="-1"></a>  <span class="cf">if</span>(lidR<span class="sc">::</span><span class="fu">is.empty</span>(las)){<span class="fu">return</span>(<span class="cn">NULL</span>)}</span>
<span id="cb169-18"><a href="forest-stand-summary.html#cb169-18" tabindex="-1"></a>  <span class="co"># attach treeID</span></span>
<span id="cb169-19"><a href="forest-stand-summary.html#cb169-19" tabindex="-1"></a>    nlas_tree <span class="ot">&lt;-</span> cloud2trees<span class="sc">::</span><span class="fu">polygon_attribute_to_las</span>(</span>
<span id="cb169-20"><a href="forest-stand-summary.html#cb169-20" tabindex="-1"></a>      las</span>
<span id="cb169-21"><a href="forest-stand-summary.html#cb169-21" tabindex="-1"></a>      , cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>(poly_df) <span class="co"># if already simplified, does nothing</span></span>
<span id="cb169-22"><a href="forest-stand-summary.html#cb169-22" tabindex="-1"></a>      , <span class="at">attribute =</span> attribute</span>
<span id="cb169-23"><a href="forest-stand-summary.html#cb169-23" tabindex="-1"></a>      , <span class="at">force_crs =</span> force_crs</span>
<span id="cb169-24"><a href="forest-stand-summary.html#cb169-24" tabindex="-1"></a>    )</span>
<span id="cb169-25"><a href="forest-stand-summary.html#cb169-25" tabindex="-1"></a>  <span class="co"># filter for only points with trees</span></span>
<span id="cb169-26"><a href="forest-stand-summary.html#cb169-26" tabindex="-1"></a>  nlas_tree <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">filter_poi</span>(nlas_tree, <span class="sc">!</span><span class="fu">is.na</span>(treeID))</span>
<span id="cb169-27"><a href="forest-stand-summary.html#cb169-27" tabindex="-1"></a>  <span class="cf">if</span>(lidR<span class="sc">::</span><span class="fu">is.empty</span>(nlas_tree)){</span>
<span id="cb169-28"><a href="forest-stand-summary.html#cb169-28" tabindex="-1"></a>    <span class="fu">return</span>(<span class="cn">NULL</span>)</span>
<span id="cb169-29"><a href="forest-stand-summary.html#cb169-29" tabindex="-1"></a>  }<span class="cf">else</span>{</span>
<span id="cb169-30"><a href="forest-stand-summary.html#cb169-30" tabindex="-1"></a>    <span class="fu">return</span>(nlas_tree)</span>
<span id="cb169-31"><a href="forest-stand-summary.html#cb169-31" tabindex="-1"></a>  }</span>
<span id="cb169-32"><a href="forest-stand-summary.html#cb169-32" tabindex="-1"></a>}</span></code></pre></div>
<p>now we’ll simplify the multipolygon crowns using <code>cloud2trees::simplify_multipolygon_crowns()</code> and attach the <code>treeID</code> attribute to the point cloud by applying our <code>ctg_polygon_attribute_to_las()</code> function defined above with <code>lidR::catalog_apply()</code></p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb170-1"><a href="forest-stand-summary.html#cb170-1" tabindex="-1"></a><span class="co"># simplify multipolygon crowns</span></span>
<span id="cb170-2"><a href="forest-stand-summary.html#cb170-2" tabindex="-1"></a>simp_crowns_sf <span class="ot">&lt;-</span> crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb170-3"><a href="forest-stand-summary.html#cb170-3" tabindex="-1"></a>    cloud2trees<span class="sc">::</span><span class="fu">simplify_multipolygon_crowns</span>()</span>
<span id="cb170-4"><a href="forest-stand-summary.html#cb170-4" tabindex="-1"></a><span class="co"># make the treeID numeric</span></span>
<span id="cb170-5"><a href="forest-stand-summary.html#cb170-5" tabindex="-1"></a><span class="co"># !!!!! this only works because our treeID is already numeric and can be cast as such</span></span>
<span id="cb170-6"><a href="forest-stand-summary.html#cb170-6" tabindex="-1"></a><span class="co"># !!!!! if you have a treeID that cannot be cast to numeric then you will need to make a unique treeID</span></span>
<span id="cb170-7"><a href="forest-stand-summary.html#cb170-7" tabindex="-1"></a><span class="co"># !!!!! and save it as a backup numeric treeID so that your numeric treeID can be tied to the character treeID</span></span>
<span id="cb170-8"><a href="forest-stand-summary.html#cb170-8" tabindex="-1"></a>simp_crowns_sf <span class="ot">&lt;-</span> simp_crowns_sf <span class="sc">%&gt;%</span> </span>
<span id="cb170-9"><a href="forest-stand-summary.html#cb170-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">treeID =</span> <span class="fu">as.numeric</span>(treeID))</span>
<span id="cb170-10"><a href="forest-stand-summary.html#cb170-10" tabindex="-1"></a><span class="co"># get the attribute attached to the las</span></span>
<span id="cb170-11"><a href="forest-stand-summary.html#cb170-11" tabindex="-1"></a><span class="co"># apply it</span></span>
<span id="cb170-12"><a href="forest-stand-summary.html#cb170-12" tabindex="-1"></a>las <span class="ot">&lt;-</span> lidR<span class="sc">::</span><span class="fu">catalog_apply</span>(</span>
<span id="cb170-13"><a href="forest-stand-summary.html#cb170-13" tabindex="-1"></a>    <span class="at">ctg =</span> las_ctg</span>
<span id="cb170-14"><a href="forest-stand-summary.html#cb170-14" tabindex="-1"></a>    , <span class="at">FUN =</span> ctg_polygon_attribute_to_las</span>
<span id="cb170-15"><a href="forest-stand-summary.html#cb170-15" tabindex="-1"></a>    , <span class="at">.options =</span> <span class="fu">list</span>(<span class="at">automerge =</span> <span class="cn">TRUE</span>)</span>
<span id="cb170-16"><a href="forest-stand-summary.html#cb170-16" tabindex="-1"></a>    <span class="co"># ctg_polygon_attribute_to_las options</span></span>
<span id="cb170-17"><a href="forest-stand-summary.html#cb170-17" tabindex="-1"></a>    , <span class="at">poly_df =</span> simp_crowns_sf</span>
<span id="cb170-18"><a href="forest-stand-summary.html#cb170-18" tabindex="-1"></a>    , <span class="at">attribute =</span> <span class="st">&quot;treeID&quot;</span></span>
<span id="cb170-19"><a href="forest-stand-summary.html#cb170-19" tabindex="-1"></a>    , <span class="at">force_crs =</span> T</span>
<span id="cb170-20"><a href="forest-stand-summary.html#cb170-20" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb170-21"><a href="forest-stand-summary.html#cb170-21" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_duplicates</span>() <span class="sc">%&gt;%</span></span>
<span id="cb170-22"><a href="forest-stand-summary.html#cb170-22" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">remove_lasattribute</span>(<span class="st">&quot;buffer&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-23"><a href="forest-stand-summary.html#cb170-23" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_poi</span>(<span class="sc">!</span><span class="fu">is.na</span>(treeID) <span class="sc">&amp;</span> Z<span class="sc">&gt;</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb170-24"><a href="forest-stand-summary.html#cb170-24" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">add_lasattribute</span>(<span class="at">name =</span> <span class="st">&quot;treeID&quot;</span>, <span class="at">desc =</span> <span class="st">&quot;treeID&quot;</span>)</span></code></pre></div>
<p>check that we have treeID</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb171-1"><a href="forest-stand-summary.html#cb171-1" tabindex="-1"></a>las <span class="sc">%&gt;%</span> </span>
<span id="cb171-2"><a href="forest-stand-summary.html#cb171-2" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">pluck</span>(<span class="st">&quot;data&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb171-3"><a href="forest-stand-summary.html#cb171-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 26,405,551
## Columns: 4
## $ X      &lt;dbl&gt; 470000.0, 469999.6, 469999.7, 469999.5, 469999.6, 469999.6, 469…
## $ Y      &lt;dbl&gt; 3809318, 3809314, 3809315, 3809315, 3809315, 3809316, 3809316, …
## $ Z      &lt;dbl&gt; 1.01, 1.63, 2.34, 1.62, 2.09, 2.26, 2.38, 2.49, 2.84, 1.76, 2.0…
## $ treeID &lt;dbl&gt; 1329405, 1329915, 1329915, 1334574, 1334574, 1334574, 1329405, …</code></pre>
<p>let’s look at our point cloud for a single tree (the tallest tree)</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb173-1"><a href="forest-stand-summary.html#cb173-1" tabindex="-1"></a><span class="co"># get the tallest tree cloud</span></span>
<span id="cb173-2"><a href="forest-stand-summary.html#cb173-2" tabindex="-1"></a>one_tree_las_temp <span class="ot">&lt;-</span> las <span class="sc">%&gt;%</span> </span>
<span id="cb173-3"><a href="forest-stand-summary.html#cb173-3" tabindex="-1"></a>  lidR<span class="sc">::</span><span class="fu">filter_poi</span>(</span>
<span id="cb173-4"><a href="forest-stand-summary.html#cb173-4" tabindex="-1"></a>    treeID<span class="sc">==</span>( </span>
<span id="cb173-5"><a href="forest-stand-summary.html#cb173-5" tabindex="-1"></a>        treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb173-6"><a href="forest-stand-summary.html#cb173-6" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb173-7"><a href="forest-stand-summary.html#cb173-7" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(tree_height_m<span class="sc">==</span><span class="fu">max</span>(tree_height_m)) <span class="sc">%&gt;%</span>  </span>
<span id="cb173-8"><a href="forest-stand-summary.html#cb173-8" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb173-9"><a href="forest-stand-summary.html#cb173-9" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">pull</span>(treeID) <span class="sc">%&gt;%</span> </span>
<span id="cb173-10"><a href="forest-stand-summary.html#cb173-10" tabindex="-1"></a>        <span class="fu">as.numeric</span>() <span class="co"># because we converted to numeric for our las</span></span>
<span id="cb173-11"><a href="forest-stand-summary.html#cb173-11" tabindex="-1"></a>      )</span>
<span id="cb173-12"><a href="forest-stand-summary.html#cb173-12" tabindex="-1"></a>    )</span>
<span id="cb173-13"><a href="forest-stand-summary.html#cb173-13" tabindex="-1"></a><span class="co"># plot it</span></span>
<span id="cb173-14"><a href="forest-stand-summary.html#cb173-14" tabindex="-1"></a>plot3D<span class="sc">::</span><span class="fu">scatter3D</span>(</span>
<span id="cb173-15"><a href="forest-stand-summary.html#cb173-15" tabindex="-1"></a>  <span class="at">x =</span> one_tree_las_temp<span class="sc">@</span>data<span class="sc">$</span>X</span>
<span id="cb173-16"><a href="forest-stand-summary.html#cb173-16" tabindex="-1"></a>  , <span class="at">y =</span> one_tree_las_temp<span class="sc">@</span>data<span class="sc">$</span>Y</span>
<span id="cb173-17"><a href="forest-stand-summary.html#cb173-17" tabindex="-1"></a>  , <span class="at">z =</span> one_tree_las_temp<span class="sc">@</span>data<span class="sc">$</span>Z</span>
<span id="cb173-18"><a href="forest-stand-summary.html#cb173-18" tabindex="-1"></a>  , <span class="at">colvar =</span> one_tree_las_temp<span class="sc">@</span>data<span class="sc">$</span>Z</span>
<span id="cb173-19"><a href="forest-stand-summary.html#cb173-19" tabindex="-1"></a>  , <span class="at">cex =</span> <span class="fl">0.6</span>, <span class="at">pch =</span> <span class="dv">19</span></span>
<span id="cb173-20"><a href="forest-stand-summary.html#cb173-20" tabindex="-1"></a>  , <span class="at">colkey =</span> T</span>
<span id="cb173-21"><a href="forest-stand-summary.html#cb173-21" tabindex="-1"></a>  , <span class="at">phi =</span> <span class="dv">6</span></span>
<span id="cb173-22"><a href="forest-stand-summary.html#cb173-22" tabindex="-1"></a>  , <span class="at">col =</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="dv">50</span>, <span class="at">house =</span> <span class="st">&quot;gryffindor&quot;</span>)</span>
<span id="cb173-23"><a href="forest-stand-summary.html#cb173-23" tabindex="-1"></a>  , <span class="at">main =</span><span class="st">&quot;single tree point cloud&quot;</span></span>
<span id="cb173-24"><a href="forest-stand-summary.html#cb173-24" tabindex="-1"></a>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-150-1.png" width="1008" /></p>
<p>finally, we’ll save this point cloud data to our output folder for sharing</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb174-1"><a href="forest-stand-summary.html#cb174-1" tabindex="-1"></a>lidR<span class="sc">::</span><span class="fu">writeLAS</span>(</span>
<span id="cb174-2"><a href="forest-stand-summary.html#cb174-2" tabindex="-1"></a>  <span class="at">las =</span> las</span>
<span id="cb174-3"><a href="forest-stand-summary.html#cb174-3" tabindex="-1"></a>  , <span class="at">file =</span> <span class="fu">file.path</span>(outdir, <span class="st">&quot;norm_las_trees.las&quot;</span>)</span>
<span id="cb174-4"><a href="forest-stand-summary.html#cb174-4" tabindex="-1"></a>  , <span class="at">index =</span> T</span>
<span id="cb174-5"><a href="forest-stand-summary.html#cb174-5" tabindex="-1"></a>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="processing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="validate-tree-detection-and-crown-delineation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
