<!DOCTYPE html>
<html lang="en-US" xml:lang="en-US">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 3 Forest Stand Summary | Aerial LiDAR for Fire Model Inputs</title>
  <meta name="description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  <meta name="generator" content="bookdown 0.34 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 3 Forest Stand Summary | Aerial LiDAR for Fire Model Inputs" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 3 Forest Stand Summary | Aerial LiDAR for Fire Model Inputs" />
  
  <meta name="twitter:description" content="Using the bookdown package to write a book of data exploration. The output format for this example is bookdown::gitbook." />
  

<meta name="author" content="George Woolsey" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="processing.html"/>
<link rel="next" href="validate-tree-detection-and-crown-delineation.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<link href="libs/htmltools-fill-0.5.8.1/fill.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.6.4/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.2.2/leaflet.js"></script>
<script src="libs/leaflet-providers-2.0.0/leaflet-providers_2.0.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.2.2/leaflet-providers-plugin.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<link href="libs/bsTable-3.3.7/bootstrapTable.min.css" rel="stylesheet" />
<script src="libs/bsTable-3.3.7/bootstrapTable.js"></script>
<script type="text/javascript">

// toggle visibility of R source blocks in R Markdown output
function toggle_R() {
  var x = document.getElementsByClassName('r');
  if (x.length == 0) return;
  function toggle_vis(o) {
    var d = o.style.display;
    o.style.display = (d == 'block' || d == '') ? 'none':'block';
  }

  for (i = 0; i < x.length; i++) {
    var y = x[i];
    if (y.tagName.toLowerCase() === 'pre') toggle_vis(y);
  }

    var elem = document.getElementById("myButton1");
    if (elem.value === "Hide Code") elem.value = "Show Code";
    else elem.value = "Hide Code";
}

document.write('<input onclick="toggle_R();" type="button" value="Hide Code" id="myButton1" style="position: absolute; top: 10%; right: 2%; z-index: 200"></input>')

</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#objective"><i class="fa fa-check"></i><b>1.1</b> Objective</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#data_desc"><i class="fa fa-check"></i><b>1.2</b> Data</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="processing.html"><a href="processing.html"><i class="fa fa-check"></i><b>2</b> Point Cloud Processing</a>
<ul>
<li class="chapter" data-level="2.1" data-path="processing.html"><a href="processing.html#lidar-data-location"><i class="fa fa-check"></i><b>2.1</b> Lidar Data Location</a></li>
<li class="chapter" data-level="2.2" data-path="processing.html"><a href="processing.html#individial-tree-detection-tuning-itd_tuning"><i class="fa fa-check"></i><b>2.2</b> Individial Tree Detection Tuning: <code id="itd">itd_tuning()</code></a></li>
<li class="chapter" data-level="2.3" data-path="processing.html"><a href="processing.html#point-cloud-tree-extraction-cloud2trees"><i class="fa fa-check"></i><b>2.3</b> Point Cloud Tree Extraction: <code id="trees">cloud2trees()</code></a></li>
<li class="chapter" data-level="2.4" data-path="processing.html"><a href="processing.html#dbh-modeling-trees_dbh"><i class="fa fa-check"></i><b>2.4</b> DBH Modeling: <code>trees_dbh()</code></a></li>
<li class="chapter" data-level="2.5" data-path="processing.html"><a href="processing.html#hmd-modeling-trees_hmd"><i class="fa fa-check"></i><b>2.5</b> HMD Modeling: <code>trees_hmd()</code></a></li>
<li class="chapter" data-level="2.6" data-path="processing.html"><a href="processing.html#cbh-modeling-trees_cbh"><i class="fa fa-check"></i><b>2.6</b> CBH Modeling: <code>trees_cbh()</code></a></li>
<li class="chapter" data-level="2.7" data-path="processing.html"><a href="processing.html#forest-type-trees_type"><i class="fa fa-check"></i><b>2.7</b> Forest Type: <code>trees_type()</code></a></li>
<li class="chapter" data-level="2.8" data-path="processing.html"><a href="processing.html#combine-data"><i class="fa fa-check"></i><b>2.8</b> Combine data</a></li>
<li class="chapter" data-level="2.9" data-path="processing.html"><a href="processing.html#crown-biomass-trees_biomass"><i class="fa fa-check"></i><b>2.9</b> Crown Biomass: <code>trees_biomass()</code></a></li>
<li class="chapter" data-level="2.10" data-path="processing.html"><a href="processing.html#data-export"><i class="fa fa-check"></i><b>2.10</b> Data Export</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html"><i class="fa fa-check"></i><b>3</b> Forest Stand Summary</a>
<ul>
<li class="chapter" data-level="3.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#load-data"><i class="fa fa-check"></i><b>3.1</b> Load data</a></li>
<li class="chapter" data-level="3.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#silvicultural-metrics"><i class="fa fa-check"></i><b>3.2</b> Silvicultural metrics</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#height-distribution"><i class="fa fa-check"></i><b>3.2.1</b> Height Distribution</a></li>
<li class="chapter" data-level="3.2.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#dbh-distribution"><i class="fa fa-check"></i><b>3.2.2</b> DBH Distribution</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#spatial-forest-structure"><i class="fa fa-check"></i><b>3.3</b> Spatial Forest Structure</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#chm"><i class="fa fa-check"></i><b>3.3.1</b> CHM</a></li>
<li class="chapter" data-level="3.3.2" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#function-to-rasterize"><i class="fa fa-check"></i><b>3.3.2</b> Function to Rasterize</a></li>
<li class="chapter" data-level="3.3.3" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#mean-dbh"><i class="fa fa-check"></i><b>3.3.3</b> Mean DBH</a></li>
<li class="chapter" data-level="3.3.4" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#qmd"><i class="fa fa-check"></i><b>3.3.4</b> QMD</a></li>
<li class="chapter" data-level="3.3.5" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#basal-area"><i class="fa fa-check"></i><b>3.3.5</b> Basal Area</a></li>
<li class="chapter" data-level="3.3.6" data-path="forest-stand-summary.html"><a href="forest-stand-summary.html#tph"><i class="fa fa-check"></i><b>3.3.6</b> TPH</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html"><i class="fa fa-check"></i><b>4</b> Validate Tree Detection and Crown Delineation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#neontreeevaluation-overview"><i class="fa fa-check"></i><b>4.1</b> <code>NeonTreeEvaluation</code> overview</a></li>
<li class="chapter" data-level="4.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#lidar-data-in-neontreeevaluation"><i class="fa fa-check"></i><b>4.2</b> lidar data in <code>NeonTreeEvaluation</code></a></li>
<li class="chapter" data-level="4.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#example-validation-process"><i class="fa fa-check"></i><b>4.3</b> Example validation process</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#preliminaries"><i class="fa fa-check"></i><b>4.3.1</b> Preliminaries</a></li>
<li class="chapter" data-level="4.3.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#filter-for-canopy-trees"><i class="fa fa-check"></i><b>4.3.2</b> Filter for “canopy” trees</a></li>
<li class="chapter" data-level="4.3.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#cloud2treescloud2trees"><i class="fa fa-check"></i><b>4.3.3</b> <code>cloud2trees::cloud2trees()</code></a></li>
<li class="chapter" data-level="4.3.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#format-extracted-tree-polygons"><i class="fa fa-check"></i><b>4.3.4</b> Format extracted tree polygons</a></li>
<li class="chapter" data-level="4.3.5" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#test-evaluation"><i class="fa fa-check"></i><b>4.3.5</b> Test evaluation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#full-validation-process"><i class="fa fa-check"></i><b>4.4</b> Full validation process</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#function-to-extract-trees"><i class="fa fa-check"></i><b>4.4.1</b> Function to extract trees</a></li>
<li class="chapter" data-level="4.4.2" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#build-evaluation-data"><i class="fa fa-check"></i><b>4.4.2</b> Build evaluation data</a></li>
<li class="chapter" data-level="4.4.3" data-path="validate-tree-detection-and-crown-delineation.html"><a href="validate-tree-detection-and-crown-delineation.html#full-evaluation"><i class="fa fa-check"></i><b>4.4.3</b> Full evaluation</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="cbh.html"><a href="cbh.html"><i class="fa fa-check"></i><b>5</b> CBH Process</a>
<ul>
<li class="chapter" data-level="5.1" data-path="cbh.html"><a href="cbh.html#example-lidar-data"><i class="fa fa-check"></i><b>5.1</b> Example lidar data</a></li>
<li class="chapter" data-level="5.2" data-path="cbh.html"><a href="cbh.html#extract-cbh"><i class="fa fa-check"></i><b>5.2</b> Extract CBH</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="cbh.html"><a href="cbh.html#return-cbh-metrics"><i class="fa fa-check"></i><b>5.2.1</b> Return CBH Metrics</a></li>
<li class="chapter" data-level="5.2.2" data-path="cbh.html"><a href="cbh.html#cbh-on-the-point-cloud"><i class="fa fa-check"></i><b>5.2.2</b> CBH on the point cloud</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Aerial LiDAR for Fire Model Inputs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="forest-stand-summary" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Section 3</span> Forest Stand Summary<a href="forest-stand-summary.html#forest-stand-summary" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>In this section we’ll process the point cloud-extracted <a href="processing.html#processing">tree list data</a> given stand boundaries that fall within the extent of the original point cloud data. When processing point cloud data with the objective for summarizing data within a forest stand, it is imperative to ensure that the point cloud extent completely covers and extends beyond the stand extent to avoid edge effects and tree artifacts.</p>
<div id="load-data" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Load data<a href="forest-stand-summary.html#load-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>first, we’ll load our stand data and the boundary data of the point cloud that we processed</p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="forest-stand-summary.html#cb86-1" tabindex="-1"></a><span class="co"># las data bounds</span></span>
<span id="cb86-2"><a href="forest-stand-summary.html#cb86-2" tabindex="-1"></a>las_ctg_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/raw_las_ctg_info.gpkg&quot;</span>, <span class="at">quiet =</span> T)</span>
<span id="cb86-3"><a href="forest-stand-summary.html#cb86-3" tabindex="-1"></a><span class="co"># get our proj crs</span></span>
<span id="cb86-4"><a href="forest-stand-summary.html#cb86-4" tabindex="-1"></a>proj_crs <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(las_ctg_sf)</span>
<span id="cb86-5"><a href="forest-stand-summary.html#cb86-5" tabindex="-1"></a><span class="co"># stands</span></span>
<span id="cb86-6"><a href="forest-stand-summary.html#cb86-6" tabindex="-1"></a>stand_sf <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_read</span>(<span class="st">&quot;../data/QUIK-Fire_Boundary/QUIK-Fire_Boundary.shp&quot;</span>, <span class="at">quiet =</span> T) <span class="sc">%&gt;%</span> </span>
<span id="cb86-7"><a href="forest-stand-summary.html#cb86-7" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_transform</span>(proj_crs) <span class="sc">%&gt;%</span> </span>
<span id="cb86-8"><a href="forest-stand-summary.html#cb86-8" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename_with</span>(<span class="sc">~</span><span class="fu">tolower</span>(stringr<span class="sc">::</span><span class="fu">str_replace_all</span>(.x,<span class="st">&quot;</span><span class="sc">\\</span><span class="st">.&quot;</span>, <span class="st">&quot;_&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb86-9"><a href="forest-stand-summary.html#cb86-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">unit_id =</span> id) <span class="sc">%&gt;%</span> </span>
<span id="cb86-10"><a href="forest-stand-summary.html#cb86-10" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb86-11"><a href="forest-stand-summary.html#cb86-11" tabindex="-1"></a>    <span class="at">stand_area_m2 =</span> sf<span class="sc">::</span><span class="fu">st_area</span>(.) <span class="sc">%&gt;%</span> <span class="fu">as.numeric</span>()</span>
<span id="cb86-12"><a href="forest-stand-summary.html#cb86-12" tabindex="-1"></a>    , <span class="at">stand_area_ha =</span> stand_area_m2<span class="sc">/</span><span class="dv">10000</span></span>
<span id="cb86-13"><a href="forest-stand-summary.html#cb86-13" tabindex="-1"></a>  )</span>
<span id="cb86-14"><a href="forest-stand-summary.html#cb86-14" tabindex="-1"></a><span class="co"># set our colors for the units</span></span>
<span id="cb86-15"><a href="forest-stand-summary.html#cb86-15" tabindex="-1"></a><span class="cf">if</span>(<span class="fu">nrow</span>(stand_sf)<span class="sc">&lt;</span><span class="fu">length</span>(harrypotter<span class="sc">::</span>hp_palettes<span class="sc">$</span>lunalovegood)){</span>
<span id="cb86-16"><a href="forest-stand-summary.html#cb86-16" tabindex="-1"></a>  my_pal <span class="ot">&lt;-</span> harrypotter<span class="sc">::</span><span class="fu">hp</span>(<span class="at">n=</span><span class="fu">nrow</span>(stand_sf), <span class="at">option =</span> <span class="st">&quot;lunalovegood&quot;</span>)</span>
<span id="cb86-17"><a href="forest-stand-summary.html#cb86-17" tabindex="-1"></a>}<span class="cf">else</span>{</span>
<span id="cb86-18"><a href="forest-stand-summary.html#cb86-18" tabindex="-1"></a>  my_pal <span class="ot">&lt;-</span> viridis<span class="sc">::</span><span class="fu">turbo</span>(<span class="at">n=</span><span class="fu">nrow</span>(stand_sf))</span>
<span id="cb86-19"><a href="forest-stand-summary.html#cb86-19" tabindex="-1"></a>}</span></code></pre></div>
<p>what is the stand data?</p>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="forest-stand-summary.html#cb87-1" tabindex="-1"></a>stand_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">glimpse</span>()</span></code></pre></div>
<pre><code>## Rows: 2
## Columns: 7
## $ unit_id       &lt;dbl&gt; 1, 2
## $ unit_name     &lt;chr&gt; &quot;300 RD to Rim&quot;, &quot;Middle Kehl Canyon&quot;
## $ hectares      &lt;dbl&gt; 119.658, 200.666
## $ acres         &lt;dbl&gt; 295.555, 495.645
## $ geometry      &lt;POLYGON [m]&gt; POLYGON ((470742 3810364, 4..., POLYGON ((469974.3 38112…
## $ stand_area_m2 &lt;dbl&gt; 1195649, 2005096
## $ stand_area_ha &lt;dbl&gt; 119.5649, 200.5096</code></pre>
<p>let’s look at these bounds on a map</p>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="forest-stand-summary.html#cb89-1" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb89-2"><a href="forest-stand-summary.html#cb89-2" tabindex="-1"></a>  las_ctg_sf</span>
<span id="cb89-3"><a href="forest-stand-summary.html#cb89-3" tabindex="-1"></a>  , <span class="at">layer.name =</span> <span class="st">&quot;point cloud tile&quot;</span></span>
<span id="cb89-4"><a href="forest-stand-summary.html#cb89-4" tabindex="-1"></a>  , <span class="at">color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb89-5"><a href="forest-stand-summary.html#cb89-5" tabindex="-1"></a>  , <span class="at">lwd =</span> <span class="dv">1</span></span>
<span id="cb89-6"><a href="forest-stand-summary.html#cb89-6" tabindex="-1"></a>  , <span class="at">alpha.regions =</span> <span class="dv">0</span></span>
<span id="cb89-7"><a href="forest-stand-summary.html#cb89-7" tabindex="-1"></a>  , <span class="at">label =</span> <span class="cn">FALSE</span></span>
<span id="cb89-8"><a href="forest-stand-summary.html#cb89-8" tabindex="-1"></a>  , <span class="at">legend =</span> <span class="cn">FALSE</span></span>
<span id="cb89-9"><a href="forest-stand-summary.html#cb89-9" tabindex="-1"></a>  , <span class="at">popup =</span> <span class="cn">FALSE</span></span>
<span id="cb89-10"><a href="forest-stand-summary.html#cb89-10" tabindex="-1"></a>) <span class="sc">+</span></span>
<span id="cb89-11"><a href="forest-stand-summary.html#cb89-11" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(</span>
<span id="cb89-12"><a href="forest-stand-summary.html#cb89-12" tabindex="-1"></a>  stand_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(unit_name)</span>
<span id="cb89-13"><a href="forest-stand-summary.html#cb89-13" tabindex="-1"></a>  , <span class="at">zcol =</span> <span class="st">&quot;unit_name&quot;</span></span>
<span id="cb89-14"><a href="forest-stand-summary.html#cb89-14" tabindex="-1"></a>  , <span class="at">col.regions =</span> my_pal</span>
<span id="cb89-15"><a href="forest-stand-summary.html#cb89-15" tabindex="-1"></a>  , <span class="at">layer.name =</span> <span class="st">&quot;stand bounds&quot;</span></span>
<span id="cb89-16"><a href="forest-stand-summary.html#cb89-16" tabindex="-1"></a>  , <span class="at">alpha.regions =</span> <span class="fl">0.8</span></span>
<span id="cb89-17"><a href="forest-stand-summary.html#cb89-17" tabindex="-1"></a>) </span></code></pre></div>
<div class="leaflet html-widget html-fill-item" id="htmlwidget-c836beee13b5e85b8722" style="width:1008px;height:672px;"></div>
<script type="application/json" data-for="htmlwidget-c836beee13b5e85b8722">{"x":{"options":{"minZoom":1,"maxZoom":52,"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"preferCanvas":false,"bounceAtZoomLimits":false,"maxBounds":[[[-90,-370]],[[90,370]]]},"calls":[{"method":"addProviderTiles","args":["OpenStreetMap","OpenStreetMap","OpenStreetMap",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"addProviderTiles","args":["Esri.WorldImagery","Esri.WorldImagery","Esri.WorldImagery",{"errorTileUrl":"","noWrap":false,"detectRetina":false,"pane":"tilePane"}]},{"method":"createMapPane","args":["polygon",420]},{"method":"addPolygons","args":[[[[{"lng":[-111.3590906056137,-111.359129155935,-111.348246743088,-111.3482093608689,-111.3590906056137],"lat":[34.41292258064113,34.42194061826054,34.42197208713579,34.41295403895751,34.41292258064113]}]],[[{"lng":[-111.3591291563206,-111.3591677237781,-111.3482841422981,-111.3482467434619,-111.3591291563206],"lat":[34.42194070844174,34.43095873270235,34.4309902121388,34.42197217731709,34.42194070844174]}]],[[{"lng":[-111.3591677241639,-111.359206308765,-111.3483215581326,-111.3482841426722,-111.3591677241639],"lat":[34.43095882288343,34.43997683378363,34.44000832378353,34.43099030231999,34.43095882288343]}]],[[{"lng":[-111.359206309151,-111.3592449109032,-111.3483589905986,-111.3483215585068,-111.359206309151],"lat":[34.43997692396457,34.44899492150276,34.44902642206831,34.44000841396457,34.43997692396457]}]],[[{"lng":[-111.3592449112893,-111.3592835302,-111.3483964397033,-111.348358990973,-111.3592449112893],"lat":[34.44899501168356,34.45801299585812,34.45804450699157,34.44902651224923,34.44899501168356]}]],[[{"lng":[-111.3592835305862,-111.3593221666628,-111.348433905454,-111.3483964400779,-111.3592835305862],"lat":[34.4580130860388,34.46703105684811,34.46706257855168,34.45804459717235,34.4580130860388]}]],[[{"lng":[-111.3593221670492,-111.3593608202991,-111.3484713878578,-111.3484339058287,-111.3593221670492],"lat":[34.46703114702865,34.4760491044711,34.47608063674702,34.46706266873232,34.46703114702865]}]],[[{"lng":[-111.3482092520552,-111.3482466342627,-111.3373642047988,-111.3373279907006,-111.3482092520552],"lat":[34.41295403926727,34.42197208744565,34.42200258809902,34.41298452968665,34.41295403926727]}]],[[{"lng":[-111.3482466346366,-111.3482840334612,-111.337400435357,-111.337364205161,-111.3482466346366],"lat":[34.42197217762695,34.43099021244876,34.43102072333842,34.42200267828045,34.42197217762695]}]],[[{"lng":[-111.3482840338352,-111.3483214492839,-111.3374366820201,-111.3374004357194,-111.3482840338352],"lat":[34.43099030262995,34.44000832409359,34.44003884522166,34.4310208135197,34.43099030262995]}]],[[{"lng":[-111.3483214496582,-111.3483588817382,-111.3374729447951,-111.3374366823827,-111.3483214496582],"lat":[34.44000841427463,34.44902642237847,34.44905695374714,34.44003893540282,34.44000841427463]}]],[[{"lng":[-111.3483588821126,-111.3483963308312,-111.3375092236889,-111.3374729451578,-111.3483588821126],"lat":[34.44902651255938,34.45804450730184,34.45807504891326,34.44905704392816,34.44902651255938]}]],[[{"lng":[-111.3483963312058,-111.3484337965702,-111.3375455187084,-111.3375092240517,-111.3483963312058],"lat":[34.45804459748261,34.46706257886205,34.46709313071839,34.45807513909414,34.45804459748261]}]],[[{"lng":[-111.3484337969449,-111.3484712789623,-111.3375818298608,-111.3375455190715,-111.3484337969449],"lat":[34.4670626690427,34.4760806370575,34.47611119916091,34.46709322089914,34.4670626690427]}]],[[{"lng":[-111.3373278818868,-111.3373640959733,-111.3264816504116,-111.3264466044413,-111.3373278818868],"lat":[34.41298452998672,34.42200258839919,34.42203212082592,34.41301405250429,34.41298452998672]}]],[[{"lng":[-111.3373640963356,-111.3374003265199,-111.326516712311,-111.3264816507622,-111.3373640963356],"lat":[34.42200267858061,34.43102072363869,34.43105026597675,34.42203221100743,34.42200267858061]}]],[[{"lng":[-111.3374003268822,-111.3374365731713,-111.3265517897958,-111.3265167126617,-111.3374003268822],"lat":[34.43102081381996,34.44003884552204,34.44006839777352,34.43105035615814,34.43102081381996]}]],[[{"lng":[-111.3374365735338,-111.3374728359345,-111.3265868828727,-111.3265517901466,-111.3374365735338],"lat":[34.44003893570318,34.44905695404761,34.44908651621461,34.44006848795475,34.44003893570318]}]],[[{"lng":[-111.3374728362973,-111.3375091148166,-111.3266219915486,-111.3265868832237,-111.3374728362973],"lat":[34.44905704422863,34.45807504921383,34.45810462129843,34.44908660639572,34.44905704422863]}]],[[{"lng":[-111.3375091151795,-111.3375454098245,-111.3266571158301,-111.3266219918998,-111.3375091151795],"lat":[34.45807513939471,34.46709313101906,34.46712271302336,34.45810471147941,34.45807513939471]}]],[[{"lng":[-111.3375454101875,-111.3375817209651,-111.326692255724,-111.3266571161814,-111.3375454101875],"lat":[34.4670932211998,34.47611119946169,34.47614079138779,34.4671228032042,34.4670932211998]}]],[[{"lng":[-111.3264464956274,-111.326481541586,-111.3155990804458,-111.3155652026101,-111.3264464956274],"lat":[34.41301405279468,34.4220321211164,34.42206068531185,34.41304260740583,34.41301405279468]}]],[[{"lng":[-111.3264815419365,-111.3265166034737,-111.3156329736795,-111.3155990807846,-111.3264815419365],"lat":[34.42203221129792,34.43105026626733,34.43107884004917,34.42206077549345,34.42203221129792]}]],[[{"lng":[-111.3265166038244,-111.3265516809468,-111.3156668819793,-111.3156329740186,-111.3265166038244],"lat":[34.43105035644871,34.44006839806421,34.44009698143444,34.43107893023063,34.43105035644871]}]],[[{"lng":[-111.3265516812976,-111.326586774012,-111.3157008053515,-111.3156668823184,-111.3265516812976],"lat":[34.44006848824544,34.4490865165054,34.44911510946607,34.44009707161578,34.44006848824544]}]],[[{"lng":[-111.326586774363,-111.3266218826762,-111.3157347438027,-111.3157008056908,-111.326586774363],"lat":[34.44908660668651,34.4581046215893,34.45813322414245,34.44911519964729,34.44908660668651]}]],[[{"lng":[-111.3266218830274,-111.326657006946,-111.3157686973394,-111.3157347441421,-111.3266218830274],"lat":[34.45810471177029,34.46712271331433,34.46715132546196,34.45813331432353,34.45810471177029]}]],[[{"lng":[-111.3266570072973,-111.3266921468282,-111.3158026659681,-111.315768697679,-111.3266570072973],"lat":[34.46712280349517,34.47614079167885,34.476169413423,34.4671514156429,34.46712280349517]}]],[[{"lng":[-111.3155650937961,-111.31559897162,-111.3047164954205,-111.304683785726,-111.3155650937961],"lat":[34.41304260768655,34.42206068559265,34.42208828155231,34.4130701943868,34.41304260768655]}]],[[{"lng":[-111.3155989719588,-111.3156328648421,-111.3047492199821,-111.3047164957476,-111.3155989719588],"lat":[34.42206077577426,34.43107884033005,34.43110644555117,34.422088371734,34.42206077577426]}]],[[{"lng":[-111.3156328651811,-111.3156667731301,-111.3047819590903,-111.3047492203094,-111.3156328651811],"lat":[34.43107893051153,34.44009698171543,34.44012459619995,34.43110653573274,34.43107893051153]}]],[[{"lng":[-111.3156667734693,-111.3157006964906,-111.3048147127513,-111.3047819594178,-111.3156667734693],"lat":[34.44009707189678,34.44911510974716,34.44914273349703,34.44012468638138,34.44009707189678]}]],[[{"lng":[-111.3157006968299,-111.3157346349301,-111.3048474809712,-111.3048147130789,-111.3157006968299],"lat":[34.44911519992836,34.45813322442364,34.45816085744082,34.44914282367834,34.44911519992836]}]],[[{"lng":[-111.3157346352696,-111.3157685884551,-111.3048802637566,-111.304847481299,-111.3157346352696],"lat":[34.45813331460471,34.46715132574324,34.46717896802971,34.45816094762199,34.45813331460471]}]],[[{"lng":[-111.3157685887947,-111.3158025570721,-111.3049130611136,-111.3048802640845,-111.3157685887947],"lat":[34.46715141592418,34.47616941370438,34.47619706526206,34.46717905821072,34.46715141592418]}]],[[{"lng":[-111.3046836769118,-111.3047163865945,-111.2938338958549,-111.2938023543079,-111.3046836769118],"lat":[34.41307019465783,34.42208828182342,34.42211490954298,34.41309681344286,34.41307019465783]}]],[[{"lng":[-111.3047163869217,-111.3047491111445,-111.2938654517383,-111.2938338961704,-111.3047163869217],"lat":[34.42208837200513,34.43110644582238,34.43113308247844,34.42211499972477,34.42208837200513]}]],[[{"lng":[-111.3047491114718,-111.304781850241,-111.2938970216486,-111.2938654520539,-111.3047491114718],"lat":[34.43110653600394,34.44012459647125,34.44015124206571,34.43113317266009,34.43110653600394]}]],[[{"lng":[-111.3047818505685,-111.3048146038903,-111.2939286055919,-111.2938970219643,-111.3047818505685],"lat":[34.44012468665269,34.44914273376843,34.44916938830315,34.44015133224722,34.44012468665269]}]],[[{"lng":[-111.3048146042179,-111.3048473720985,-111.2939602035745,-111.2939286059079,-111.3048146042179],"lat":[34.44914282394973,34.4581608577123,34.45818752118919,34.44916947848454,34.44914282394973]}]],[[{"lng":[-111.3048473724263,-111.3048801548722,-111.2939918156022,-111.2939602038905,-111.3048473724263],"lat":[34.45816094789348,34.46717896830127,34.46720564072221,34.45818761137045,34.45816094789348]}]],[[{"lng":[-111.3048801552001,-111.3049129522175,-111.2940234416812,-111.2939918159184,-111.3048801552001],"lat":[34.46717905848231,34.47619706553372,34.4762237469006,34.46720573090333,34.46717905848231]}]]],null,"point cloud tile",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#000000","weight":1,"opacity":0.9,"fill":true,"fillColor":"#6666FF","fillOpacity":0,"smoothFactor":1,"noClip":false},null,{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},null,{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":2,"opacity":0.9,"fillOpacity":0,"bringToFront":false,"sendToBack":false}]},{"method":"addScaleBar","args":[{"maxWidth":100,"metric":true,"imperial":true,"updateWhenIdle":true,"position":"bottomleft"}]},{"method":"addPolygons","args":[[[[{"lng":[-111.318453650637,-111.3182866480628,-111.317772884706,-111.3170343318785,-111.3165523730136,-111.3160133220289,-111.3152818887629,-111.3147299218832,-111.3143122984769,-111.3134699780787,-111.3129760932394,-111.3124952677317,-111.3122831263404,-111.311684782949,-111.3111829703959,-111.3107074412939,-111.3101614851318,-111.3098016045367,-111.3093819816423,-111.309033122576,-111.3086649884428,-111.3083521870997,-111.3081391681285,-111.3078542779671,-111.3074415219401,-111.306977601141,-111.3075034947721,-111.3078622667358,-111.3081949144087,-111.3084632736794,-111.3084096612568,-111.3087432009792,-111.309205815998,-111.3097184328307,-111.3100113643522,-111.3100747020982,-111.3102540543142,-111.3106780238355,-111.3110113893694,-111.3111648515436,-111.3113572609858,-111.3117303216926,-111.3121810428968,-111.3123494667637,-111.3122861763335,-111.3127627896504,-111.3136117138048,-111.3142163354694,-111.3147822443388,-111.3155015227932,-111.3158342288637,-111.315975052801,-111.3163856207979,-111.3168980926859,-111.3173219604144,-111.317487620429,-111.3175633930894,-111.3177818366606,-111.3181684790509,-111.3183750285075,-111.3187742546873,-111.3190708944468,-111.319354752721,-111.3197033384362,-111.320115190813,-111.320821776613,-111.3212318345467,-111.3215510249601,-111.3219094964817,-111.3221522726,-111.3228065599685,-111.3231780467556,-111.323575051641,-111.3237032347619,-111.3236627957221,-111.3237773747401,-111.3241118222639,-111.3243559792155,-111.3247556912324,-111.3249496731771,-111.3253487699412,-111.3256965376764,-111.3259931420752,-111.3260703230257,-111.3266104238422,-111.3271002741323,-111.3273968831595,-111.3277325002532,-111.3273348920163,-111.3268346618033,-111.3262570789151,-111.3256928513428,-111.3253853998881,-111.3250908512052,-111.3248739376451,-111.3247472351174,-111.3245691980895,-111.3241479727192,-111.3238168309001,-111.3233181968221,-111.3228955934634,-111.3221515720253,-111.3216385353475,-111.3208943748134,-111.3195327286205,-111.318530678885,-111.318453650637,-111.318453650637],"lat":[34.43435202505595,34.43441641670445,34.43463893699578,34.43495530853816,34.43508447080644,34.43542696829488,34.43592985171716,34.43626171735374,34.43639603494018,34.43649413233342,34.43687913853807,34.43731740674717,34.43735525684711,34.43733013469084,34.43731542347684,34.43744987610071,34.43767511107797,34.43777195863075,34.43736796087115,34.43696378282475,34.43656498213999,34.43546784482916,34.43526585162689,34.43476024375153,34.43446814635165,34.43425612211031,34.43382575664231,34.43343045305491,34.43292861938403,34.43243760643713,34.43185146987606,34.43159480058365,34.4314550584641,34.43092078691267,34.43012058302378,34.42985393520309,34.42965095002525,34.42950064087165,34.42920132781996,34.42895576916635,34.42880604659024,34.42880509626344,34.42893186048207,34.42925121517001,34.42952852354204,34.42969785742843,34.42966370499575,34.42966215305967,34.42962871931638,34.42932840017124,34.42885852388291,34.42867694880039,34.42838808112946,34.42783246079589,34.42766080990745,34.42724465980141,34.42687138084656,34.42680685650003,34.42699772213228,34.42718905547788,34.42730526997572,34.42750702677165,34.42773013519395,34.42805966865864,34.42811188880159,34.42786486905618,34.42744807259498,34.42681832385926,34.42636968222127,34.42594266329503,34.42548257995318,34.42507653815868,34.42461713024027,34.42449953661312,34.42401996636492,34.42371053773025,34.4237096519137,34.42364504768914,34.42388915540894,34.4241551275575,34.4242393425288,34.42435567137307,34.42454675205832,34.42454654631772,34.42450246723953,34.42476764547452,34.42495872271606,34.42525628962435,34.42555582017938,34.42593024015156,34.42626222647711,34.42672208838555,34.42705335092074,34.42739523786513,34.42785417225866,34.42835550468357,34.42888895164696,34.42974282767767,34.43060712315841,34.43140790366825,34.43191001586236,34.43246627109196,34.43287268175865,34.43339695122818,34.43393349060743,34.43430918652738,34.43435202505595,34.43435202505595]}]],[[{"lng":[-111.3268397729984,-111.324957358767,-111.3247532678549,-111.324589217805,-111.3240253862377,-111.323564029901,-111.3232206472068,-111.3228498400423,-111.3225189199106,-111.322083518372,-111.321930868375,-111.3218811160641,-111.3215869606315,-111.3215495425583,-111.3218342663583,-111.3225183448806,-111.3225456377526,-111.3219575616375,-111.3213681648128,-111.3211549295494,-111.320983146138,-111.3212821785884,-111.321270351223,-111.3210147159719,-111.3207465354655,-111.3207543556577,-111.3208855501223,-111.3207581873699,-111.320470207148,-111.3200407064801,-111.3199112216265,-111.319822896801,-111.319736366013,-111.3196333424714,-111.3194519069659,-111.319254792461,-111.3190064161332,-111.3183624227598,-111.318021002265,-111.3178851818559,-111.317916162157,-111.3181466993185,-111.3183485634185,-111.3185699825866,-111.3186049262061,-111.3185237074302,-111.3183977219174,-111.3182012019315,-111.3177623858106,-111.3172723006296,-111.3169917852182,-111.316830062988,-111.3167744460419,-111.3167174509903,-111.3167097189148,-111.3164917818521,-111.3163738976113,-111.3162246082552,-111.3159791311611,-111.3157664625152,-111.315510209457,-111.3154263323503,-111.3154630723167,-111.3155829265334,-111.3157705015339,-111.3158394853437,-111.3159019599289,-111.3158984770834,-111.315857999452,-111.3157307749377,-111.3155331588174,-111.3152748361077,-111.3150073867902,-111.3142894261145,-111.3134079811258,-111.3129778200328,-111.3134631691185,-111.3140436462076,-111.3141328098383,-111.3142823439588,-111.3144869316145,-111.3144888000602,-111.3145910678479,-111.3144191605765,-111.3145338254021,-111.3144751847972,-111.3146283096824,-111.3145890994708,-111.3143148392145,-111.3142336129567,-111.3142782277295,-111.3147020633985,-111.3150873667372,-111.315298807245,-111.3155093849634,-111.3153214166312,-111.3153457679593,-111.3154212244682,-111.3152584715578,-111.3152186913106,-111.3155398890671,-111.3158155323534,-111.3161366273706,-111.3159934931538,-111.3159782993858,-111.3161049129795,-111.3164506075557,-111.316964440464,-111.3175296536145,-111.3177341761155,-111.3177446208685,-111.3177682943048,-111.3179852335243,-111.3184211668607,-111.3188582297949,-111.3193329149521,-111.3201282145037,-111.3209626686051,-111.3215030916138,-111.321851802625,-111.3220203603428,-111.3222520189943,-111.3228040826745,-111.3234198528361,-111.3240482345626,-111.3248431123392,-111.3255096575813,-111.3262155743885,-111.3271531341884,-111.3271540895342,-111.3272477585034,-111.3274182048851,-111.3279891440535,-111.3286112285867,-111.329064822778,-111.3287984021072,-111.3283257451251,-111.3276089145989,-111.3268397729984],"lat":[34.44211397694168,34.44442143764614,34.44488033660615,34.44571220992324,34.44631063498294,34.44679153225881,34.44783706705263,34.44844563558654,34.44938987047622,34.44993465023739,34.45039340863766,34.45084123651525,34.451311026334,34.45162024875006,34.45204587749917,34.45258770662865,34.45299269356251,34.45399623140117,34.45465866759908,34.45526148642221,34.45576826102926,34.45656693356912,34.45683878035304,34.45729247801631,34.45783148353547,34.45819388388343,34.45884909492694,34.45919586081723,34.45960700432128,34.46002917713681,34.46024270472977,34.4607039563246,34.46079212299594,34.46077373840167,34.46044110536855,34.46021510733136,34.46004520477315,34.45990298120149,34.45979994036546,34.459616418356,34.45930188443869,34.45901081506244,34.45879443596994,34.45864462706446,34.45852728219356,34.45831963480671,34.45818405516387,34.45811261562513,34.45777531983187,34.45749145269676,34.4573269590574,34.45709820032032,34.45685317731157,34.45624307196544,34.4558993249877,34.45526565251011,34.4547169962538,34.45437095052778,34.45411042880004,34.45401904053988,34.45388645903756,34.45339634091415,34.45290058180347,34.45269241324927,34.45252803991047,34.45247989420351,34.45241177880992,34.45234116896027,34.45227065469,34.4522296779385,34.45229014750902,34.45246136510318,34.45277251092822,34.45261979665483,34.45262205936164,34.45200491319313,34.45103365972111,34.44969707360096,34.44945434196094,34.44901159029801,34.4486672968,34.44830753534885,34.44812872636219,34.44775075782363,34.44744666836044,34.4472496192218,34.4469081226176,34.44674566675803,34.44652252344533,34.44630687816012,34.44619483916181,34.44598855441772,34.44580102156117,34.44557129810322,34.44511239807944,34.44473980179058,34.44437198752794,34.44390810624504,34.443396871689,34.44308252002801,34.44295910773335,34.44269723920834,34.44254717694593,34.44212116827013,34.44150295843416,34.44095899831156,34.44051040647502,34.44029588625804,34.44005991153367,34.43970761776848,34.43906802238147,34.43852432780305,34.4380547470748,34.43765921220119,34.43756213808125,34.43720913679058,34.43658880788428,34.43611760367265,34.43613750300653,34.4364883483846,34.43682900780094,34.43684971649582,34.43654979518026,34.43608981078473,34.43556583300591,34.43484953925413,34.4342188577663,34.43379059766494,34.43338303296945,34.43362819839495,34.43455532222225,34.43537564554993,34.43662127389128,34.43778148607671,34.43862236432463,34.43958243300774,34.4404471197182,34.44138707518518,34.44211397694168]}]]],null,"stand bounds",{"crs":{"crsClass":"L.CRS.EPSG3857","code":null,"proj4def":null,"projectedBounds":null,"options":{}},"pane":"polygon","stroke":true,"color":"#333333","weight":0.5,"opacity":[0.9,0.9],"fill":true,"fillColor":["#084D49","#830042"],"fillOpacity":[0.8,0.8],"smoothFactor":1,"noClip":false},["<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>1&emsp;<\/td><\/tr><tr><td>1<\/td><th>unit_name&emsp;<\/th><td>300 RD to Rim&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>","<div class='scrollableContainer'><table class=mapview-popup id='popup'><tr class='coord'><td><\/td><th><b>Feature ID&emsp;<\/b><\/th><td>2&emsp;<\/td><\/tr><tr><td>1<\/td><th>unit_name&emsp;<\/th><td>Middle Kehl Canyon&emsp;<\/td><\/tr><tr><td>2<\/td><th>geometry&emsp;<\/th><td>sfc_POLYGON&emsp;<\/td><\/tr><\/table><\/div>"],{"maxWidth":800,"minWidth":50,"autoPan":true,"keepInView":false,"closeButton":true,"closeOnClick":true,"className":""},["300 RD to Rim","Middle Kehl Canyon"],{"interactive":false,"permanent":false,"direction":"auto","opacity":1,"offset":[0,0],"textsize":"10px","textOnly":false,"className":"","sticky":true},{"stroke":true,"weight":1,"opacity":0.9,"fillOpacity":0.6400000000000001,"bringToFront":false,"sendToBack":false}]},{"method":"addLayersControl","args":[["OpenStreetMap","Esri.WorldImagery"],["point cloud tile","stand bounds"],{"collapsed":true,"autoZIndex":true,"position":"topleft"}]},{"method":"addLegend","args":[{"colors":["#084D49","#830042"],"labels":["300 RD to Rim","Middle Kehl Canyon"],"na_color":null,"na_label":"NA","opacity":1,"position":"topright","type":"factor","title":"stand bounds","extra":null,"layerId":null,"className":"info legend","group":"stand bounds"}]},{"method":"addHomeButton","args":[-111.3593608202991,34.41292258064113,-111.2938023543079,34.4762237469006,true,null,"Zoom to full extent","<strong>Zoom full<\/strong>","bottomleft"]}],"limits":{"lat":[34.41292258064113,34.4762237469006],"lng":[-111.3593608202991,-111.2938023543079]},"fitBounds":[34.41292258064113,-111.3593608202991,34.4762237469006,-111.2938023543079,[]]},"evals":[],"jsHooks":{"render":[{"code":"function(el, x, data) {\n  return (\n      function(el, x, data) {\n      // get the leaflet map\n      var map = this; //HTMLWidgets.find('#' + el.id);\n      // we need a new div element because we have to handle\n      // the mouseover output separately\n      // debugger;\n      function addElement () {\n      // generate new div Element\n      var newDiv = $(document.createElement('div'));\n      // append at end of leaflet htmlwidget container\n      $(el).append(newDiv);\n      //provide ID and style\n      newDiv.addClass('lnlt');\n      newDiv.css({\n      'position': 'relative',\n      'bottomleft':  '0px',\n      'background-color': 'rgba(255, 255, 255, 0.7)',\n      'box-shadow': '0 0 2px #bbb',\n      'background-clip': 'padding-box',\n      'margin': '0',\n      'padding-left': '5px',\n      'color': '#333',\n      'font': '9px/1.5 \"Helvetica Neue\", Arial, Helvetica, sans-serif',\n      'z-index': '700',\n      });\n      return newDiv;\n      }\n\n\n      // check for already existing lnlt class to not duplicate\n      var lnlt = $(el).find('.lnlt');\n\n      if(!lnlt.length) {\n      lnlt = addElement();\n\n      // grab the special div we generated in the beginning\n      // and put the mousmove output there\n\n      map.on('mousemove', function (e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                           ' lon: ' + (e.latlng.lng).toFixed(5) +\n                           ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                           ' | zoom: ' + map.getZoom() +\n                           ' | x: ' + L.CRS.EPSG3857.project(e.latlng).x.toFixed(0) +\n                           ' | y: ' + L.CRS.EPSG3857.project(e.latlng).y.toFixed(0) +\n                           ' | epsg: 3857 ' +\n                           ' | proj4: +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +no_defs ');\n      } else {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      }\n      });\n\n      // remove the lnlt div when mouse leaves map\n      map.on('mouseout', function (e) {\n      var strip = document.querySelector('.lnlt');\n      if( strip !==null) strip.remove();\n      });\n\n      };\n\n      //$(el).keypress(67, function(e) {\n      map.on('preclick', function(e) {\n      if (e.originalEvent.ctrlKey) {\n      if (document.querySelector('.lnlt') === null) lnlt = addElement();\n      lnlt.text(\n                      ' lon: ' + (e.latlng.lng).toFixed(5) +\n                      ' | lat: ' + (e.latlng.lat).toFixed(5) +\n                      ' | zoom: ' + map.getZoom() + ' ');\n      var txt = document.querySelector('.lnlt').textContent;\n      console.log(txt);\n      //txt.innerText.focus();\n      //txt.select();\n      setClipboardText('\"' + txt + '\"');\n      }\n      });\n\n      }\n      ).call(this.getMap(), el, x, data);\n}","data":null},{"code":"function(el, x, data) {\n  return (function(el,x,data){\n           var map = this;\n\n           map.on('keypress', function(e) {\n               console.log(e.originalEvent.code);\n               var key = e.originalEvent.code;\n               if (key === 'KeyE') {\n                   var bb = this.getBounds();\n                   var txt = JSON.stringify(bb);\n                   console.log(txt);\n\n                   setClipboardText('\\'' + txt + '\\'');\n               }\n           })\n        }).call(this.getMap(), el, x, data);\n}","data":null}]}}</script>
<p>we processed point cloud data well outside these stand bounds (it is not necessary to process data <em>this</em> far outside of our stands, a one tile buffer in this situation would have sufficed)</p>
<p>load in the tree top points data from <code>cloud2trees::cloud2trees()</code></p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="forest-stand-summary.html#cb90-1" tabindex="-1"></a><span class="co"># get the data from already run</span></span>
<span id="cb90-2"><a href="forest-stand-summary.html#cb90-2" tabindex="-1"></a>treetops_sf <span class="ot">&lt;-</span></span>
<span id="cb90-3"><a href="forest-stand-summary.html#cb90-3" tabindex="-1"></a>  <span class="fu">list.files</span>(</span>
<span id="cb90-4"><a href="forest-stand-summary.html#cb90-4" tabindex="-1"></a>    <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span></span>
<span id="cb90-5"><a href="forest-stand-summary.html#cb90-5" tabindex="-1"></a>    , <span class="at">pattern =</span> <span class="st">&quot;final_detected_tree_tops.*</span><span class="sc">\\</span><span class="st">.gpkg$&quot;</span></span>
<span id="cb90-6"><a href="forest-stand-summary.html#cb90-6" tabindex="-1"></a>    , <span class="at">full.names =</span> T</span>
<span id="cb90-7"><a href="forest-stand-summary.html#cb90-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb90-8"><a href="forest-stand-summary.html#cb90-8" tabindex="-1"></a>  <span class="fu">normalizePath</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb90-9"><a href="forest-stand-summary.html#cb90-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb90-10"><a href="forest-stand-summary.html#cb90-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb90-11"><a href="forest-stand-summary.html#cb90-11" tabindex="-1"></a>      <span class="at">dsn =</span> x</span>
<span id="cb90-12"><a href="forest-stand-summary.html#cb90-12" tabindex="-1"></a>      , <span class="at">quiet =</span> T</span>
<span id="cb90-13"><a href="forest-stand-summary.html#cb90-13" tabindex="-1"></a>    )</span>
<span id="cb90-14"><a href="forest-stand-summary.html#cb90-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb90-15"><a href="forest-stand-summary.html#cb90-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>()</span></code></pre></div>
<p>we’ll keep only trees where the tree top point falls within one of our stands and then use this tree list to filter our crown data so that we get the full crown polygon even if it extends outside of the stand boundary</p>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb91-1"><a href="forest-stand-summary.html#cb91-1" tabindex="-1"></a>treetops_sf <span class="ot">&lt;-</span> treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb91-2"><a href="forest-stand-summary.html#cb91-2" tabindex="-1"></a>  sf<span class="sc">::</span><span class="fu">st_intersection</span>(stand_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(unit_id,unit_name,tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;stand_area_&quot;</span>)))</span></code></pre></div>
<p>load in the tree crown polygon data from <code>cloud2trees::cloud2trees()</code> and filter based on the tree list</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="forest-stand-summary.html#cb92-1" tabindex="-1"></a><span class="co"># get the data from already run</span></span>
<span id="cb92-2"><a href="forest-stand-summary.html#cb92-2" tabindex="-1"></a>crowns_sf <span class="ot">&lt;-</span></span>
<span id="cb92-3"><a href="forest-stand-summary.html#cb92-3" tabindex="-1"></a>  <span class="fu">list.files</span>(</span>
<span id="cb92-4"><a href="forest-stand-summary.html#cb92-4" tabindex="-1"></a>    <span class="st">&quot;../data/point_cloud_processing_delivery&quot;</span></span>
<span id="cb92-5"><a href="forest-stand-summary.html#cb92-5" tabindex="-1"></a>    , <span class="at">pattern =</span> <span class="st">&quot;final_detected_crowns.*</span><span class="sc">\\</span><span class="st">.gpkg$&quot;</span></span>
<span id="cb92-6"><a href="forest-stand-summary.html#cb92-6" tabindex="-1"></a>    , <span class="at">full.names =</span> T</span>
<span id="cb92-7"><a href="forest-stand-summary.html#cb92-7" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb92-8"><a href="forest-stand-summary.html#cb92-8" tabindex="-1"></a>  <span class="fu">normalizePath</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-9"><a href="forest-stand-summary.html#cb92-9" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(\(x)</span>
<span id="cb92-10"><a href="forest-stand-summary.html#cb92-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_read</span>(</span>
<span id="cb92-11"><a href="forest-stand-summary.html#cb92-11" tabindex="-1"></a>      <span class="at">dsn =</span> x</span>
<span id="cb92-12"><a href="forest-stand-summary.html#cb92-12" tabindex="-1"></a>      , <span class="at">quiet =</span> T</span>
<span id="cb92-13"><a href="forest-stand-summary.html#cb92-13" tabindex="-1"></a>    )</span>
<span id="cb92-14"><a href="forest-stand-summary.html#cb92-14" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb92-15"><a href="forest-stand-summary.html#cb92-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">bind_rows</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-16"><a href="forest-stand-summary.html#cb92-16" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">inner_join</span>(</span>
<span id="cb92-17"><a href="forest-stand-summary.html#cb92-17" tabindex="-1"></a>    treetops_sf <span class="sc">%&gt;%</span> </span>
<span id="cb92-18"><a href="forest-stand-summary.html#cb92-18" tabindex="-1"></a>      sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb92-19"><a href="forest-stand-summary.html#cb92-19" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">select</span>(treeID,unit_id,unit_name,tidyselect<span class="sc">::</span><span class="fu">starts_with</span>(<span class="st">&quot;stand_area_&quot;</span>))</span>
<span id="cb92-20"><a href="forest-stand-summary.html#cb92-20" tabindex="-1"></a>    , <span class="at">by =</span> <span class="st">&quot;treeID&quot;</span></span>
<span id="cb92-21"><a href="forest-stand-summary.html#cb92-21" tabindex="-1"></a>  )</span>
<span id="cb92-22"><a href="forest-stand-summary.html#cb92-22" tabindex="-1"></a><span class="co"># the records are the same</span></span>
<span id="cb92-23"><a href="forest-stand-summary.html#cb92-23" tabindex="-1"></a><span class="fu">identical</span>(<span class="fu">nrow</span>(treetops_sf), <span class="fu">nrow</span>(crowns_sf))</span></code></pre></div>
<p>save the data by unit for sharing with a boss, coworker, friend, etc.</p>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb93-1"><a href="forest-stand-summary.html#cb93-1" tabindex="-1"></a><span class="co"># make a dir for saving this stand-level data to</span></span>
<span id="cb93-2"><a href="forest-stand-summary.html#cb93-2" tabindex="-1"></a>outdir <span class="ot">&lt;-</span> <span class="st">&quot;../data/mogollon_rim_fire_unit_trees&quot;</span></span>
<span id="cb93-3"><a href="forest-stand-summary.html#cb93-3" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(outdir)){<span class="fu">dir.create</span>(outdir, <span class="at">showWarnings =</span> F)}</span></code></pre></div>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="forest-stand-summary.html#cb94-1" tabindex="-1"></a><span class="co"># write crowns and tree tops</span></span>
<span id="cb94-2"><a href="forest-stand-summary.html#cb94-2" tabindex="-1"></a>write_temp <span class="ot">&lt;-</span> crowns_sf<span class="sc">$</span>unit_id <span class="sc">%&gt;%</span></span>
<span id="cb94-3"><a href="forest-stand-summary.html#cb94-3" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-4"><a href="forest-stand-summary.html#cb94-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">new_crs =</span> proj_crs, <span class="at">my_outdir =</span> outdir){</span>
<span id="cb94-5"><a href="forest-stand-summary.html#cb94-5" tabindex="-1"></a>    <span class="co"># dsn&#39;s</span></span>
<span id="cb94-6"><a href="forest-stand-summary.html#cb94-6" tabindex="-1"></a>    cf <span class="ot">&lt;-</span> <span class="fu">file.path</span>( my_outdir, <span class="fu">paste0</span>(<span class="st">&quot;final_detected_crowns_unit_&quot;</span>,x,<span class="st">&quot;.gpkg&quot;</span>) )</span>
<span id="cb94-7"><a href="forest-stand-summary.html#cb94-7" tabindex="-1"></a>    tf <span class="ot">&lt;-</span> <span class="fu">file.path</span>( my_outdir, <span class="fu">paste0</span>(<span class="st">&quot;final_detected_tree_tops_unit_&quot;</span>,x,<span class="st">&quot;.gpkg&quot;</span>) )</span>
<span id="cb94-8"><a href="forest-stand-summary.html#cb94-8" tabindex="-1"></a>    <span class="do">### write the data to the disk</span></span>
<span id="cb94-9"><a href="forest-stand-summary.html#cb94-9" tabindex="-1"></a>    <span class="co"># crown vector polygons</span></span>
<span id="cb94-10"><a href="forest-stand-summary.html#cb94-10" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_write</span>(</span>
<span id="cb94-11"><a href="forest-stand-summary.html#cb94-11" tabindex="-1"></a>      crowns_sf <span class="sc">%&gt;%</span></span>
<span id="cb94-12"><a href="forest-stand-summary.html#cb94-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> x) <span class="sc">%&gt;%</span> </span>
<span id="cb94-13"><a href="forest-stand-summary.html#cb94-13" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(new_crs)</span>
<span id="cb94-14"><a href="forest-stand-summary.html#cb94-14" tabindex="-1"></a>      , <span class="at">dsn =</span> cf</span>
<span id="cb94-15"><a href="forest-stand-summary.html#cb94-15" tabindex="-1"></a>      , <span class="at">append =</span> <span class="cn">FALSE</span></span>
<span id="cb94-16"><a href="forest-stand-summary.html#cb94-16" tabindex="-1"></a>      , <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb94-17"><a href="forest-stand-summary.html#cb94-17" tabindex="-1"></a>    )</span>
<span id="cb94-18"><a href="forest-stand-summary.html#cb94-18" tabindex="-1"></a>    <span class="co"># tree top vector points</span></span>
<span id="cb94-19"><a href="forest-stand-summary.html#cb94-19" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_write</span>(</span>
<span id="cb94-20"><a href="forest-stand-summary.html#cb94-20" tabindex="-1"></a>      <span class="co"># get tree points</span></span>
<span id="cb94-21"><a href="forest-stand-summary.html#cb94-21" tabindex="-1"></a>      crowns_sf <span class="sc">%&gt;%</span></span>
<span id="cb94-22"><a href="forest-stand-summary.html#cb94-22" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> x) <span class="sc">%&gt;%</span></span>
<span id="cb94-23"><a href="forest-stand-summary.html#cb94-23" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb94-24"><a href="forest-stand-summary.html#cb94-24" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;tree_x&quot;</span>, <span class="st">&quot;tree_y&quot;</span>), <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(crowns_sf)) <span class="sc">%&gt;%</span> </span>
<span id="cb94-25"><a href="forest-stand-summary.html#cb94-25" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_transform</span>(new_crs) <span class="sc">%&gt;%</span> </span>
<span id="cb94-26"><a href="forest-stand-summary.html#cb94-26" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb94-27"><a href="forest-stand-summary.html#cb94-27" tabindex="-1"></a>          <span class="at">tree_x =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>]</span>
<span id="cb94-28"><a href="forest-stand-summary.html#cb94-28" tabindex="-1"></a>          , <span class="at">tree_y =</span> sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>]</span>
<span id="cb94-29"><a href="forest-stand-summary.html#cb94-29" tabindex="-1"></a>        )</span>
<span id="cb94-30"><a href="forest-stand-summary.html#cb94-30" tabindex="-1"></a>      , <span class="at">dsn =</span> tf</span>
<span id="cb94-31"><a href="forest-stand-summary.html#cb94-31" tabindex="-1"></a>      , <span class="at">append =</span> <span class="cn">FALSE</span></span>
<span id="cb94-32"><a href="forest-stand-summary.html#cb94-32" tabindex="-1"></a>      , <span class="at">quiet =</span> <span class="cn">TRUE</span></span>
<span id="cb94-33"><a href="forest-stand-summary.html#cb94-33" tabindex="-1"></a>    )</span>
<span id="cb94-34"><a href="forest-stand-summary.html#cb94-34" tabindex="-1"></a>  })</span></code></pre></div>
<p>load in the DTM, aggregate to 2 m resolution, and write it</p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="forest-stand-summary.html#cb95-1" tabindex="-1"></a>dtm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/dtm_1m.tif&quot;</span>)</span>
<span id="cb95-2"><a href="forest-stand-summary.html#cb95-2" tabindex="-1"></a><span class="co"># quick plot</span></span>
<span id="cb95-3"><a href="forest-stand-summary.html#cb95-3" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(dtm_rast, <span class="at">axes =</span> F, <span class="at">main =</span> <span class="st">&quot;DTM (m)&quot;</span>)</span>
<span id="cb95-4"><a href="forest-stand-summary.html#cb95-4" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">vect</span>(stand_sf), <span class="at">add =</span> T, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-79-1.png" width="1008" /></p>
<p>aggregate to 2 m</p>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="forest-stand-summary.html#cb96-1" tabindex="-1"></a>res_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(dtm_rast)[<span class="dv">1</span>]</span>
<span id="cb96-2"><a href="forest-stand-summary.html#cb96-2" tabindex="-1"></a>des_res_temp <span class="ot">&lt;-</span> <span class="dv">2</span></span>
<span id="cb96-3"><a href="forest-stand-summary.html#cb96-3" tabindex="-1"></a><span class="cf">if</span>(res_temp<span class="sc">&lt;</span>des_res_temp){</span>
<span id="cb96-4"><a href="forest-stand-summary.html#cb96-4" tabindex="-1"></a>  dtm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb96-5"><a href="forest-stand-summary.html#cb96-5" tabindex="-1"></a>    dtm_rast</span>
<span id="cb96-6"><a href="forest-stand-summary.html#cb96-6" tabindex="-1"></a>    , <span class="at">fact =</span> <span class="fu">round</span>(des_res_temp<span class="sc">/</span>res_temp)</span>
<span id="cb96-7"><a href="forest-stand-summary.html#cb96-7" tabindex="-1"></a>    , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb96-8"><a href="forest-stand-summary.html#cb96-8" tabindex="-1"></a>    , <span class="at">na.rm =</span> T</span>
<span id="cb96-9"><a href="forest-stand-summary.html#cb96-9" tabindex="-1"></a>    , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb96-10"><a href="forest-stand-summary.html#cb96-10" tabindex="-1"></a>    , <span class="at">filename =</span> <span class="fu">file.path</span>(outdir, <span class="fu">paste0</span>(<span class="st">&quot;dtm_&quot;</span>,des_res_temp, <span class="st">&quot;m.tif&quot;</span>))</span>
<span id="cb96-11"><a href="forest-stand-summary.html#cb96-11" tabindex="-1"></a>    , <span class="at">overwrite =</span> T</span>
<span id="cb96-12"><a href="forest-stand-summary.html#cb96-12" tabindex="-1"></a>  )</span>
<span id="cb96-13"><a href="forest-stand-summary.html#cb96-13" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## |---------|---------|---------|---------|=========================================                                          </code></pre>
<div class="sourceCode" id="cb98"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb98-1"><a href="forest-stand-summary.html#cb98-1" tabindex="-1"></a><span class="co"># what is the res?</span></span>
<span id="cb98-2"><a href="forest-stand-summary.html#cb98-2" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">res</span>(dtm_rast)</span></code></pre></div>
<pre><code>## [1] 2 2</code></pre>
<p>we can also load in the CHM raster and look at that quickly</p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="forest-stand-summary.html#cb100-1" tabindex="-1"></a>chm_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(<span class="st">&quot;../data/point_cloud_processing_delivery/chm_0.25m.tif&quot;</span>)</span>
<span id="cb100-2"><a href="forest-stand-summary.html#cb100-2" tabindex="-1"></a><span class="co"># quick plot</span></span>
<span id="cb100-3"><a href="forest-stand-summary.html#cb100-3" tabindex="-1"></a>chm_rast <span class="sc">%&gt;%</span> </span>
<span id="cb100-4"><a href="forest-stand-summary.html#cb100-4" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb100-5"><a href="forest-stand-summary.html#cb100-5" tabindex="-1"></a>    <span class="at">fact =</span> <span class="dv">1</span><span class="sc">/</span>terra<span class="sc">::</span><span class="fu">res</span>(chm_rast)[<span class="dv">1</span>]</span>
<span id="cb100-6"><a href="forest-stand-summary.html#cb100-6" tabindex="-1"></a>    , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb100-7"><a href="forest-stand-summary.html#cb100-7" tabindex="-1"></a>    , <span class="at">na.rm =</span> T</span>
<span id="cb100-8"><a href="forest-stand-summary.html#cb100-8" tabindex="-1"></a>    , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb100-9"><a href="forest-stand-summary.html#cb100-9" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb100-10"><a href="forest-stand-summary.html#cb100-10" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">plot</span>(</span>
<span id="cb100-11"><a href="forest-stand-summary.html#cb100-11" tabindex="-1"></a>    <span class="at">col =</span> viridis<span class="sc">::</span><span class="fu">plasma</span>(<span class="dv">100</span>)</span>
<span id="cb100-12"><a href="forest-stand-summary.html#cb100-12" tabindex="-1"></a>    , <span class="at">axes =</span> F, <span class="at">alpha =</span> <span class="fl">0.8</span></span>
<span id="cb100-13"><a href="forest-stand-summary.html#cb100-13" tabindex="-1"></a>    , <span class="at">main =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb100-14"><a href="forest-stand-summary.html#cb100-14" tabindex="-1"></a>  )</span>
<span id="cb100-15"><a href="forest-stand-summary.html#cb100-15" tabindex="-1"></a>terra<span class="sc">::</span><span class="fu">plot</span>(terra<span class="sc">::</span><span class="fu">vect</span>(stand_sf), <span class="at">add =</span> T, <span class="at">col =</span> <span class="cn">NA</span>, <span class="at">border =</span> <span class="st">&quot;black&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-82-1.png" width="1008" /></p>
</div>
<div id="silvicultural-metrics" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Silvicultural metrics<a href="forest-stand-summary.html#silvicultural-metrics" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s look at some common stand-level forestry metrics</p>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="forest-stand-summary.html#cb101-1" tabindex="-1"></a><span class="do">### stand-level summaries</span></span>
<span id="cb101-2"><a href="forest-stand-summary.html#cb101-2" tabindex="-1"></a>silv_metrics <span class="ot">&lt;-</span></span>
<span id="cb101-3"><a href="forest-stand-summary.html#cb101-3" tabindex="-1"></a>  treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb101-4"><a href="forest-stand-summary.html#cb101-4" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-5"><a href="forest-stand-summary.html#cb101-5" tabindex="-1"></a>    <span class="co"># dplyr::filter(dbh_cm &gt;= ostory_dbh_cm) %&gt;% </span></span>
<span id="cb101-6"><a href="forest-stand-summary.html#cb101-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-7"><a href="forest-stand-summary.html#cb101-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">group_by</span>(unit_id, unit_name, stand_area_ha) <span class="sc">%&gt;%</span></span>
<span id="cb101-8"><a href="forest-stand-summary.html#cb101-8" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">summarise</span>(</span>
<span id="cb101-9"><a href="forest-stand-summary.html#cb101-9" tabindex="-1"></a>      <span class="at">n_trees =</span> dplyr<span class="sc">::</span><span class="fu">n_distinct</span>(treeID)</span>
<span id="cb101-10"><a href="forest-stand-summary.html#cb101-10" tabindex="-1"></a>      , <span class="at">mean_dbh_cm =</span> <span class="fu">mean</span>(dbh_cm, <span class="at">na.rm =</span> T)</span>
<span id="cb101-11"><a href="forest-stand-summary.html#cb101-11" tabindex="-1"></a>      , <span class="at">mean_tree_height_m =</span> <span class="fu">mean</span>(tree_height_m, <span class="at">na.rm =</span> T)</span>
<span id="cb101-12"><a href="forest-stand-summary.html#cb101-12" tabindex="-1"></a>      , <span class="at">loreys_height_m =</span> <span class="fu">sum</span>(basal_area_m2<span class="sc">*</span>tree_height_m, <span class="at">na.rm =</span> T) <span class="sc">/</span> <span class="fu">sum</span>(basal_area_m2, <span class="at">na.rm =</span> T)</span>
<span id="cb101-13"><a href="forest-stand-summary.html#cb101-13" tabindex="-1"></a>      , <span class="at">basal_area_m2 =</span> <span class="fu">sum</span>(basal_area_m2, <span class="at">na.rm =</span> T)</span>
<span id="cb101-14"><a href="forest-stand-summary.html#cb101-14" tabindex="-1"></a>      , <span class="at">sum_dbh_cm_sq =</span> <span class="fu">sum</span>(dbh_cm<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm =</span> T)</span>
<span id="cb101-15"><a href="forest-stand-summary.html#cb101-15" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb101-16"><a href="forest-stand-summary.html#cb101-16" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb101-17"><a href="forest-stand-summary.html#cb101-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb101-18"><a href="forest-stand-summary.html#cb101-18" tabindex="-1"></a>      <span class="at">trees_per_ha =</span> (n_trees<span class="sc">/</span>stand_area_ha)</span>
<span id="cb101-19"><a href="forest-stand-summary.html#cb101-19" tabindex="-1"></a>      , <span class="at">basal_area_m2_per_ha =</span> (basal_area_m2<span class="sc">/</span>stand_area_ha)</span>
<span id="cb101-20"><a href="forest-stand-summary.html#cb101-20" tabindex="-1"></a>      , <span class="at">qmd_cm =</span> <span class="fu">sqrt</span>(sum_dbh_cm_sq<span class="sc">/</span>n_trees)</span>
<span id="cb101-21"><a href="forest-stand-summary.html#cb101-21" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span></span>
<span id="cb101-22"><a href="forest-stand-summary.html#cb101-22" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(sum_dbh_cm_sq))</span>
<span id="cb101-23"><a href="forest-stand-summary.html#cb101-23" tabindex="-1"></a></span>
<span id="cb101-24"><a href="forest-stand-summary.html#cb101-24" tabindex="-1"></a><span class="do">### export tabular</span></span>
<span id="cb101-25"><a href="forest-stand-summary.html#cb101-25" tabindex="-1"></a><span class="fu">write.csv</span>(</span>
<span id="cb101-26"><a href="forest-stand-summary.html#cb101-26" tabindex="-1"></a>    silv_metrics</span>
<span id="cb101-27"><a href="forest-stand-summary.html#cb101-27" tabindex="-1"></a>    , <span class="fu">file.path</span>(outdir, <span class="st">&quot;stand_silv_metrics.csv&quot;</span>)</span>
<span id="cb101-28"><a href="forest-stand-summary.html#cb101-28" tabindex="-1"></a>    , <span class="at">row.names =</span> F</span>
<span id="cb101-29"><a href="forest-stand-summary.html#cb101-29" tabindex="-1"></a>    , <span class="at">append =</span> F</span>
<span id="cb101-30"><a href="forest-stand-summary.html#cb101-30" tabindex="-1"></a>  )</span></code></pre></div>
<p>stand-level silvicultural summary</p>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb102-1"><a href="forest-stand-summary.html#cb102-1" tabindex="-1"></a>silv_metrics <span class="sc">%&gt;%</span> </span>
<span id="cb102-2"><a href="forest-stand-summary.html#cb102-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(</span>
<span id="cb102-3"><a href="forest-stand-summary.html#cb102-3" tabindex="-1"></a>    unit_name</span>
<span id="cb102-4"><a href="forest-stand-summary.html#cb102-4" tabindex="-1"></a>    , stand_area_ha</span>
<span id="cb102-5"><a href="forest-stand-summary.html#cb102-5" tabindex="-1"></a>    , n_trees</span>
<span id="cb102-6"><a href="forest-stand-summary.html#cb102-6" tabindex="-1"></a>    , mean_dbh_cm</span>
<span id="cb102-7"><a href="forest-stand-summary.html#cb102-7" tabindex="-1"></a>    , qmd_cm</span>
<span id="cb102-8"><a href="forest-stand-summary.html#cb102-8" tabindex="-1"></a>    , mean_tree_height_m</span>
<span id="cb102-9"><a href="forest-stand-summary.html#cb102-9" tabindex="-1"></a>    , loreys_height_m</span>
<span id="cb102-10"><a href="forest-stand-summary.html#cb102-10" tabindex="-1"></a>    , trees_per_ha</span>
<span id="cb102-11"><a href="forest-stand-summary.html#cb102-11" tabindex="-1"></a>    , basal_area_m2_per_ha</span>
<span id="cb102-12"><a href="forest-stand-summary.html#cb102-12" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-13"><a href="forest-stand-summary.html#cb102-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(</span>
<span id="cb102-14"><a href="forest-stand-summary.html#cb102-14" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">across</span>(</span>
<span id="cb102-15"><a href="forest-stand-summary.html#cb102-15" tabindex="-1"></a>      <span class="at">.cols =</span> <span class="fu">c</span>(stand_area_ha, n_trees) </span>
<span id="cb102-16"><a href="forest-stand-summary.html#cb102-16" tabindex="-1"></a>      , <span class="at">.fns =</span> <span class="sc">~</span> scales<span class="sc">::</span><span class="fu">comma</span>(.x, <span class="at">accuracy =</span> <span class="dv">1</span>)</span>
<span id="cb102-17"><a href="forest-stand-summary.html#cb102-17" tabindex="-1"></a>    )</span>
<span id="cb102-18"><a href="forest-stand-summary.html#cb102-18" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-19"><a href="forest-stand-summary.html#cb102-19" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kbl</span>(</span>
<span id="cb102-20"><a href="forest-stand-summary.html#cb102-20" tabindex="-1"></a>    <span class="at">digits =</span> <span class="dv">1</span></span>
<span id="cb102-21"><a href="forest-stand-summary.html#cb102-21" tabindex="-1"></a>    , <span class="at">escape =</span> F</span>
<span id="cb102-22"><a href="forest-stand-summary.html#cb102-22" tabindex="-1"></a>    , <span class="at">caption =</span> <span class="st">&quot;Silvicultral metrics by stand unit&quot;</span></span>
<span id="cb102-23"><a href="forest-stand-summary.html#cb102-23" tabindex="-1"></a>    , <span class="at">col.names =</span> <span class="fu">c</span>(</span>
<span id="cb102-24"><a href="forest-stand-summary.html#cb102-24" tabindex="-1"></a>      <span class="st">&quot;Unit Name&quot;</span></span>
<span id="cb102-25"><a href="forest-stand-summary.html#cb102-25" tabindex="-1"></a>      , <span class="st">&quot;area (ha)&quot;</span></span>
<span id="cb102-26"><a href="forest-stand-summary.html#cb102-26" tabindex="-1"></a>      , <span class="st">&quot;trees&quot;</span></span>
<span id="cb102-27"><a href="forest-stand-summary.html#cb102-27" tabindex="-1"></a>      , <span class="st">&quot;mean&lt;br&gt;DBH (cm)&quot;</span></span>
<span id="cb102-28"><a href="forest-stand-summary.html#cb102-28" tabindex="-1"></a>      , <span class="st">&quot;QMD (cm)&quot;</span></span>
<span id="cb102-29"><a href="forest-stand-summary.html#cb102-29" tabindex="-1"></a>      , <span class="st">&quot;mean&lt;br&gt;Ht. (m)&quot;</span></span>
<span id="cb102-30"><a href="forest-stand-summary.html#cb102-30" tabindex="-1"></a>      , <span class="st">&quot;Loreys&lt;br&gt;Ht. (m)&quot;</span></span>
<span id="cb102-31"><a href="forest-stand-summary.html#cb102-31" tabindex="-1"></a>      , <span class="st">&quot;TPH&quot;</span></span>
<span id="cb102-32"><a href="forest-stand-summary.html#cb102-32" tabindex="-1"></a>      , <span class="st">&quot;BA&lt;br&gt;m&lt;sup&gt;2&lt;/sup&gt; ha&lt;sup&gt;-1&lt;/sup&gt;&quot;</span></span>
<span id="cb102-33"><a href="forest-stand-summary.html#cb102-33" tabindex="-1"></a>      )</span>
<span id="cb102-34"><a href="forest-stand-summary.html#cb102-34" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb102-35"><a href="forest-stand-summary.html#cb102-35" tabindex="-1"></a>  kableExtra<span class="sc">::</span><span class="fu">kable_styling</span>()</span></code></pre></div>
<table class="table" style="margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:unnamed-chunk-84">Table 3.1: </span>Silvicultral metrics by stand unit
</caption>
<thead>
<tr>
<th style="text-align:left;">
Unit Name
</th>
<th style="text-align:left;">
area (ha)
</th>
<th style="text-align:left;">
trees
</th>
<th style="text-align:right;">
mean<br>DBH (cm)
</th>
<th style="text-align:right;">
QMD (cm)
</th>
<th style="text-align:right;">
mean<br>Ht. (m)
</th>
<th style="text-align:right;">
Loreys<br>Ht. (m)
</th>
<th style="text-align:right;">
TPH
</th>
<th style="text-align:right;">
BA<br>m<sup>2</sup> ha<sup>-1</sup>
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;">
300 RD to Rim
</td>
<td style="text-align:left;">
120
</td>
<td style="text-align:left;">
47,940
</td>
<td style="text-align:right;">
24.2
</td>
<td style="text-align:right;">
31.9
</td>
<td style="text-align:right;">
12.0
</td>
<td style="text-align:right;">
23.3
</td>
<td style="text-align:right;">
401.0
</td>
<td style="text-align:right;">
32.0
</td>
</tr>
<tr>
<td style="text-align:left;">
Middle Kehl Canyon
</td>
<td style="text-align:left;">
201
</td>
<td style="text-align:left;">
107,684
</td>
<td style="text-align:right;">
20.7
</td>
<td style="text-align:right;">
28.1
</td>
<td style="text-align:right;">
10.6
</td>
<td style="text-align:right;">
22.4
</td>
<td style="text-align:right;">
537.1
</td>
<td style="text-align:right;">
33.3
</td>
</tr>
</tbody>
</table>
<div id="height-distribution" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Height Distribution<a href="forest-stand-summary.html#height-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb103"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb103-1"><a href="forest-stand-summary.html#cb103-1" tabindex="-1"></a><span class="co"># there are always tree heights</span></span>
<span id="cb103-2"><a href="forest-stand-summary.html#cb103-2" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb103-3"><a href="forest-stand-summary.html#cb103-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> tree_height_m, <span class="at">color =</span> unit_name, <span class="at">fill =</span> unit_name)) <span class="sc">+</span></span>
<span id="cb103-4"><a href="forest-stand-summary.html#cb103-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb103-5"><a href="forest-stand-summary.html#cb103-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name)) <span class="sc">+</span></span>
<span id="cb103-6"><a href="forest-stand-summary.html#cb103-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb103-7"><a href="forest-stand-summary.html#cb103-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb103-8"><a href="forest-stand-summary.html#cb103-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb103-9"><a href="forest-stand-summary.html#cb103-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;tree ht. (m)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Distribution of tree height by stand&quot;</span>) <span class="sc">+</span></span>
<span id="cb103-10"><a href="forest-stand-summary.html#cb103-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb103-11"><a href="forest-stand-summary.html#cb103-11" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb103-12"><a href="forest-stand-summary.html#cb103-12" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb103-13"><a href="forest-stand-summary.html#cb103-13" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb103-14"><a href="forest-stand-summary.html#cb103-14" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb103-15"><a href="forest-stand-summary.html#cb103-15" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb103-16"><a href="forest-stand-summary.html#cb103-16" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-85-1.png" width="1008" /></p>
</div>
<div id="dbh-distribution" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> DBH Distribution<a href="forest-stand-summary.html#dbh-distribution" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb104-1"><a href="forest-stand-summary.html#cb104-1" tabindex="-1"></a>treetops_sf <span class="sc">%&gt;%</span></span>
<span id="cb104-2"><a href="forest-stand-summary.html#cb104-2" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">ggplot</span>(<span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x =</span> dbh_cm, <span class="at">color =</span> unit_name, <span class="at">fill =</span> unit_name)) <span class="sc">+</span></span>
<span id="cb104-3"><a href="forest-stand-summary.html#cb104-3" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb104-4"><a href="forest-stand-summary.html#cb104-4" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">facet_grid</span>(<span class="at">cols =</span> dplyr<span class="sc">::</span><span class="fu">vars</span>(unit_name)) <span class="sc">+</span></span>
<span id="cb104-5"><a href="forest-stand-summary.html#cb104-5" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_color_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb104-6"><a href="forest-stand-summary.html#cb104-6" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> my_pal) <span class="sc">+</span></span>
<span id="cb104-7"><a href="forest-stand-summary.html#cb104-7" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> scales<span class="sc">::</span><span class="fu">breaks_extended</span>(<span class="dv">11</span>)) <span class="sc">+</span></span>
<span id="cb104-8"><a href="forest-stand-summary.html#cb104-8" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;tree DBH (cm)&quot;</span>, <span class="at">y =</span> <span class="st">&quot;&quot;</span>, <span class="at">subtitle =</span> <span class="st">&quot;Distribution of tree DBH by stand&quot;</span>) <span class="sc">+</span></span>
<span id="cb104-9"><a href="forest-stand-summary.html#cb104-9" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme_light</span>() <span class="sc">+</span></span>
<span id="cb104-10"><a href="forest-stand-summary.html#cb104-10" tabindex="-1"></a>  ggplot2<span class="sc">::</span><span class="fu">theme</span>(</span>
<span id="cb104-11"><a href="forest-stand-summary.html#cb104-11" tabindex="-1"></a>    <span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span></span>
<span id="cb104-12"><a href="forest-stand-summary.html#cb104-12" tabindex="-1"></a>    , <span class="at">axis.text.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb104-13"><a href="forest-stand-summary.html#cb104-13" tabindex="-1"></a>    , <span class="at">axis.ticks.y =</span> ggplot2<span class="sc">::</span><span class="fu">element_blank</span>()</span>
<span id="cb104-14"><a href="forest-stand-summary.html#cb104-14" tabindex="-1"></a>    , <span class="at">strip.text =</span> ggplot2<span class="sc">::</span><span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">10</span>)</span>
<span id="cb104-15"><a href="forest-stand-summary.html#cb104-15" tabindex="-1"></a>  )</span></code></pre></div>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-86-1.png" width="1008" /></p>
</div>
</div>
<div id="spatial-forest-structure" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Spatial Forest Structure<a href="forest-stand-summary.html#spatial-forest-structure" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Because we have a spatial tree list, we can look at the spatial arrangement of forest structural metrics</p>
<p>first, let’s make a function to crop the raster to a stand and plot the raster and stand together</p>
<div class="sourceCode" id="cb105"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb105-1"><a href="forest-stand-summary.html#cb105-1" tabindex="-1"></a><span class="co"># function to crop and plot a raster data for a stand</span></span>
<span id="cb105-2"><a href="forest-stand-summary.html#cb105-2" tabindex="-1"></a>plot_raster_stand_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb105-3"><a href="forest-stand-summary.html#cb105-3" tabindex="-1"></a>    rast</span>
<span id="cb105-4"><a href="forest-stand-summary.html#cb105-4" tabindex="-1"></a>    , stand</span>
<span id="cb105-5"><a href="forest-stand-summary.html#cb105-5" tabindex="-1"></a>    , <span class="at">buffer=</span><span class="dv">5</span></span>
<span id="cb105-6"><a href="forest-stand-summary.html#cb105-6" tabindex="-1"></a>    , <span class="at">des_res=</span><span class="dv">1</span></span>
<span id="cb105-7"><a href="forest-stand-summary.html#cb105-7" tabindex="-1"></a>    , <span class="at">agg_fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb105-8"><a href="forest-stand-summary.html#cb105-8" tabindex="-1"></a>    , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb105-9"><a href="forest-stand-summary.html#cb105-9" tabindex="-1"></a>    , <span class="at">my_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb105-10"><a href="forest-stand-summary.html#cb105-10" tabindex="-1"></a>    , <span class="at">scale_name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb105-11"><a href="forest-stand-summary.html#cb105-11" tabindex="-1"></a>    , <span class="at">bbox =</span> F</span>
<span id="cb105-12"><a href="forest-stand-summary.html#cb105-12" tabindex="-1"></a>) {</span>
<span id="cb105-13"><a href="forest-stand-summary.html#cb105-13" tabindex="-1"></a>  <span class="co"># crop the raster</span></span>
<span id="cb105-14"><a href="forest-stand-summary.html#cb105-14" tabindex="-1"></a>  crop_rast <span class="ot">&lt;-</span> rast <span class="sc">%&gt;%</span> </span>
<span id="cb105-15"><a href="forest-stand-summary.html#cb105-15" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">crop</span>(</span>
<span id="cb105-16"><a href="forest-stand-summary.html#cb105-16" tabindex="-1"></a>      stand <span class="sc">%&gt;%</span> </span>
<span id="cb105-17"><a href="forest-stand-summary.html#cb105-17" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-18"><a href="forest-stand-summary.html#cb105-18" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_as_sfc</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-19"><a href="forest-stand-summary.html#cb105-19" tabindex="-1"></a>        sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb105-20"><a href="forest-stand-summary.html#cb105-20" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-21"><a href="forest-stand-summary.html#cb105-21" tabindex="-1"></a>        terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb105-22"><a href="forest-stand-summary.html#cb105-22" tabindex="-1"></a>    )</span>
<span id="cb105-23"><a href="forest-stand-summary.html#cb105-23" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span>bbox){</span>
<span id="cb105-24"><a href="forest-stand-summary.html#cb105-24" tabindex="-1"></a>    crop_rast <span class="ot">&lt;-</span> crop_rast <span class="sc">%&gt;%</span> </span>
<span id="cb105-25"><a href="forest-stand-summary.html#cb105-25" tabindex="-1"></a>      terra<span class="sc">::</span><span class="fu">mask</span>(</span>
<span id="cb105-26"><a href="forest-stand-summary.html#cb105-26" tabindex="-1"></a>        stand <span class="sc">%&gt;%</span> </span>
<span id="cb105-27"><a href="forest-stand-summary.html#cb105-27" tabindex="-1"></a>          sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer) <span class="sc">%&gt;%</span> </span>
<span id="cb105-28"><a href="forest-stand-summary.html#cb105-28" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb105-29"><a href="forest-stand-summary.html#cb105-29" tabindex="-1"></a>          terra<span class="sc">::</span><span class="fu">project</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb105-30"><a href="forest-stand-summary.html#cb105-30" tabindex="-1"></a>      )</span>
<span id="cb105-31"><a href="forest-stand-summary.html#cb105-31" tabindex="-1"></a>  }</span>
<span id="cb105-32"><a href="forest-stand-summary.html#cb105-32" tabindex="-1"></a>  <span class="co"># aggregate the raster</span></span>
<span id="cb105-33"><a href="forest-stand-summary.html#cb105-33" tabindex="-1"></a>  res_temp <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">res</span>(rast)[<span class="dv">1</span>]</span>
<span id="cb105-34"><a href="forest-stand-summary.html#cb105-34" tabindex="-1"></a>  <span class="cf">if</span>(res_temp<span class="sc">&lt;</span>des_res){</span>
<span id="cb105-35"><a href="forest-stand-summary.html#cb105-35" tabindex="-1"></a>    crop_rast <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">aggregate</span>(</span>
<span id="cb105-36"><a href="forest-stand-summary.html#cb105-36" tabindex="-1"></a>      crop_rast</span>
<span id="cb105-37"><a href="forest-stand-summary.html#cb105-37" tabindex="-1"></a>      , <span class="at">fact =</span> <span class="fu">round</span>(des_res<span class="sc">/</span>res_temp)</span>
<span id="cb105-38"><a href="forest-stand-summary.html#cb105-38" tabindex="-1"></a>      , <span class="at">fun =</span> agg_fun</span>
<span id="cb105-39"><a href="forest-stand-summary.html#cb105-39" tabindex="-1"></a>      , <span class="at">na.rm =</span> T</span>
<span id="cb105-40"><a href="forest-stand-summary.html#cb105-40" tabindex="-1"></a>      , <span class="at">cores =</span> lasR<span class="sc">::</span><span class="fu">half_cores</span>()</span>
<span id="cb105-41"><a href="forest-stand-summary.html#cb105-41" tabindex="-1"></a>    )</span>
<span id="cb105-42"><a href="forest-stand-summary.html#cb105-42" tabindex="-1"></a>  }</span>
<span id="cb105-43"><a href="forest-stand-summary.html#cb105-43" tabindex="-1"></a>  <span class="co"># plot it</span></span>
<span id="cb105-44"><a href="forest-stand-summary.html#cb105-44" tabindex="-1"></a>  crop_rast <span class="sc">%&gt;%</span> </span>
<span id="cb105-45"><a href="forest-stand-summary.html#cb105-45" tabindex="-1"></a>    terra<span class="sc">::</span><span class="fu">as.data.frame</span>(<span class="at">xy=</span>T) <span class="sc">%&gt;%</span> </span>
<span id="cb105-46"><a href="forest-stand-summary.html#cb105-46" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">f=</span><span class="dv">3</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb105-47"><a href="forest-stand-summary.html#cb105-47" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb105-48"><a href="forest-stand-summary.html#cb105-48" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_tile</span>(</span>
<span id="cb105-49"><a href="forest-stand-summary.html#cb105-49" tabindex="-1"></a>      <span class="at">mapping =</span> ggplot2<span class="sc">::</span><span class="fu">aes</span>(<span class="at">x=</span>x, <span class="at">y=</span>y, <span class="at">fill =</span> f)</span>
<span id="cb105-50"><a href="forest-stand-summary.html#cb105-50" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb105-51"><a href="forest-stand-summary.html#cb105-51" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">geom_sf</span>(</span>
<span id="cb105-52"><a href="forest-stand-summary.html#cb105-52" tabindex="-1"></a>      <span class="at">data =</span> stand <span class="sc">%&gt;%</span> sf<span class="sc">::</span><span class="fu">st_transform</span>(terra<span class="sc">::</span><span class="fu">crs</span>(rast))</span>
<span id="cb105-53"><a href="forest-stand-summary.html#cb105-53" tabindex="-1"></a>      , <span class="at">color =</span> stand_color, <span class="at">fill =</span> <span class="cn">NA</span>, <span class="at">lwd =</span> <span class="fl">1.5</span></span>
<span id="cb105-54"><a href="forest-stand-summary.html#cb105-54" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb105-55"><a href="forest-stand-summary.html#cb105-55" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">title =</span> my_title, <span class="at">fill =</span> scale_name) <span class="sc">+</span> </span>
<span id="cb105-56"><a href="forest-stand-summary.html#cb105-56" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">theme_void</span>()</span>
<span id="cb105-57"><a href="forest-stand-summary.html#cb105-57" tabindex="-1"></a>}</span>
<span id="cb105-58"><a href="forest-stand-summary.html#cb105-58" tabindex="-1"></a><span class="co"># plot_raster_stand_fn(</span></span>
<span id="cb105-59"><a href="forest-stand-summary.html#cb105-59" tabindex="-1"></a><span class="co">#   dtm_rast</span></span>
<span id="cb105-60"><a href="forest-stand-summary.html#cb105-60" tabindex="-1"></a><span class="co">#   , stand = stand_sf[1,]</span></span>
<span id="cb105-61"><a href="forest-stand-summary.html#cb105-61" tabindex="-1"></a><span class="co">#   , buffer = 5</span></span>
<span id="cb105-62"><a href="forest-stand-summary.html#cb105-62" tabindex="-1"></a><span class="co">#   , des_res = 1</span></span>
<span id="cb105-63"><a href="forest-stand-summary.html#cb105-63" tabindex="-1"></a><span class="co">#   , stand_color = my_pal[1]</span></span>
<span id="cb105-64"><a href="forest-stand-summary.html#cb105-64" tabindex="-1"></a><span class="co">#   , my_title = &quot;DTM&quot;</span></span>
<span id="cb105-65"><a href="forest-stand-summary.html#cb105-65" tabindex="-1"></a><span class="co">#   , scale_name = &quot;DTM (m)&quot;</span></span>
<span id="cb105-66"><a href="forest-stand-summary.html#cb105-66" tabindex="-1"></a><span class="co"># )</span></span></code></pre></div>
<div id="chm" class="section level3 hasAnchor" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> CHM<a href="forest-stand-summary.html#chm" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the canopy height model is a raster dataset that represents the height of objects above the ground, we set the minimum height at 2 m</p>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb106-1"><a href="forest-stand-summary.html#cb106-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb106-2"><a href="forest-stand-summary.html#cb106-2" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb106-3"><a href="forest-stand-summary.html#cb106-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">max</span>(terra<span class="sc">::</span><span class="fu">values</span>(chm_rast), <span class="at">na.rm =</span> T), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb106-4"><a href="forest-stand-summary.html#cb106-4" tabindex="-1"></a>    <span class="fu">plot_raster_stand_fn</span>(</span>
<span id="cb106-5"><a href="forest-stand-summary.html#cb106-5" tabindex="-1"></a>      chm_rast</span>
<span id="cb106-6"><a href="forest-stand-summary.html#cb106-6" tabindex="-1"></a>      , <span class="at">stand =</span> stand_sf[x,]</span>
<span id="cb106-7"><a href="forest-stand-summary.html#cb106-7" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb106-8"><a href="forest-stand-summary.html#cb106-8" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">2</span></span>
<span id="cb106-9"><a href="forest-stand-summary.html#cb106-9" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb106-10"><a href="forest-stand-summary.html#cb106-10" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Canopy Height Model&quot;</span></span>
<span id="cb106-11"><a href="forest-stand-summary.html#cb106-11" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;CHM (m)&quot;</span></span>
<span id="cb106-12"><a href="forest-stand-summary.html#cb106-12" tabindex="-1"></a>      , <span class="at">agg_fun =</span> <span class="st">&quot;max&quot;</span></span>
<span id="cb106-13"><a href="forest-stand-summary.html#cb106-13" tabindex="-1"></a>    ) <span class="sc">+</span> </span>
<span id="cb106-14"><a href="forest-stand-summary.html#cb106-14" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb106-15"><a href="forest-stand-summary.html#cb106-15" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;plasma&quot;</span>,<span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb106-16"><a href="forest-stand-summary.html#cb106-16" tabindex="-1"></a>  })</span></code></pre></div>
<pre><code>## |---------|---------|---------|---------|=========================================                                          </code></pre>
<p>check out our plots</p>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb108-1"><a href="forest-stand-summary.html#cb108-1" tabindex="-1"></a>p_temp</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-89-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-89-2.png" width="1008" /></p>
</div>
<div id="function-to-rasterize" class="section level3 hasAnchor" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Function to Rasterize<a href="forest-stand-summary.html#function-to-rasterize" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>the CHM was easy to plot because it was already a raster dataset; what if we want to plot a raster of a metric based on our vector tree data?</p>
<p>we need to define a function to rasterize our spatial tree list by aggregating the metric within a raster cell</p>
<div class="sourceCode" id="cb111"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb111-1"><a href="forest-stand-summary.html#cb111-1" tabindex="-1"></a>vect_to_rast_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb111-2"><a href="forest-stand-summary.html#cb111-2" tabindex="-1"></a>  vect</span>
<span id="cb111-3"><a href="forest-stand-summary.html#cb111-3" tabindex="-1"></a>  , <span class="at">des_res =</span> <span class="dv">1</span></span>
<span id="cb111-4"><a href="forest-stand-summary.html#cb111-4" tabindex="-1"></a>  , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb111-5"><a href="forest-stand-summary.html#cb111-5" tabindex="-1"></a>  , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span> <span class="co"># function(x){mean(x, na.rm=T)}</span></span>
<span id="cb111-6"><a href="forest-stand-summary.html#cb111-6" tabindex="-1"></a>  , <span class="at">field =</span> <span class="st">&quot;your_vector_attribute&quot;</span></span>
<span id="cb111-7"><a href="forest-stand-summary.html#cb111-7" tabindex="-1"></a>  , <span class="at">zero_na =</span> F</span>
<span id="cb111-8"><a href="forest-stand-summary.html#cb111-8" tabindex="-1"></a>) {</span>
<span id="cb111-9"><a href="forest-stand-summary.html#cb111-9" tabindex="-1"></a>  <span class="co"># sample sf object with a bounding box + buffer</span></span>
<span id="cb111-10"><a href="forest-stand-summary.html#cb111-10" tabindex="-1"></a>  my_sf <span class="ot">&lt;-</span> vect <span class="sc">%&gt;%</span> </span>
<span id="cb111-11"><a href="forest-stand-summary.html#cb111-11" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_bbox</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb111-12"><a href="forest-stand-summary.html#cb111-12" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_as_sfc</span>(<span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(vect)) <span class="sc">%&gt;%</span> </span>
<span id="cb111-13"><a href="forest-stand-summary.html#cb111-13" tabindex="-1"></a>    sf<span class="sc">::</span><span class="fu">st_buffer</span>(buffer)</span>
<span id="cb111-14"><a href="forest-stand-summary.html#cb111-14" tabindex="-1"></a>  <span class="co"># extract bbox coordinates</span></span>
<span id="cb111-15"><a href="forest-stand-summary.html#cb111-15" tabindex="-1"></a>  bbox <span class="ot">&lt;-</span> sf<span class="sc">::</span><span class="fu">st_bbox</span>(my_sf)</span>
<span id="cb111-16"><a href="forest-stand-summary.html#cb111-16" tabindex="-1"></a>  <span class="co"># create a terra raster using the bbox</span></span>
<span id="cb111-17"><a href="forest-stand-summary.html#cb111-17" tabindex="-1"></a>  my_raster <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rast</span>(</span>
<span id="cb111-18"><a href="forest-stand-summary.html#cb111-18" tabindex="-1"></a>    <span class="at">xmin =</span> bbox[<span class="dv">1</span>], <span class="at">ymin =</span> bbox[<span class="dv">2</span>], <span class="at">xmax =</span> bbox[<span class="dv">3</span>], <span class="at">ymax =</span> bbox[<span class="dv">4</span>]</span>
<span id="cb111-19"><a href="forest-stand-summary.html#cb111-19" tabindex="-1"></a>    , <span class="at">resolution =</span> des_res</span>
<span id="cb111-20"><a href="forest-stand-summary.html#cb111-20" tabindex="-1"></a>    , <span class="at">crs =</span> sf<span class="sc">::</span><span class="fu">st_crs</span>(vect)</span>
<span id="cb111-21"><a href="forest-stand-summary.html#cb111-21" tabindex="-1"></a>  )</span>
<span id="cb111-22"><a href="forest-stand-summary.html#cb111-22" tabindex="-1"></a>  <span class="co"># rasterize the vector data onto the grid, using a desired aggregation function (e.g., &quot;mean&quot;)</span></span>
<span id="cb111-23"><a href="forest-stand-summary.html#cb111-23" tabindex="-1"></a>  rasterized_data <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">rasterize</span>(</span>
<span id="cb111-24"><a href="forest-stand-summary.html#cb111-24" tabindex="-1"></a>    <span class="at">x =</span> vect</span>
<span id="cb111-25"><a href="forest-stand-summary.html#cb111-25" tabindex="-1"></a>    , <span class="at">y =</span> my_raster</span>
<span id="cb111-26"><a href="forest-stand-summary.html#cb111-26" tabindex="-1"></a>    , <span class="at">fun =</span> fun</span>
<span id="cb111-27"><a href="forest-stand-summary.html#cb111-27" tabindex="-1"></a>    , <span class="at">field =</span> field</span>
<span id="cb111-28"><a href="forest-stand-summary.html#cb111-28" tabindex="-1"></a>  )</span>
<span id="cb111-29"><a href="forest-stand-summary.html#cb111-29" tabindex="-1"></a>  <span class="cf">if</span>(zero_na){rasterized_data <span class="ot">&lt;-</span> terra<span class="sc">::</span><span class="fu">subst</span>(rasterized_data,<span class="cn">NA</span>,<span class="dv">0</span>)}</span>
<span id="cb111-30"><a href="forest-stand-summary.html#cb111-30" tabindex="-1"></a>  terra<span class="sc">::</span><span class="fu">crs</span>(rasterized_data) <span class="ot">&lt;-</span> vect <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">vect</span>() <span class="sc">%&gt;%</span> terra<span class="sc">::</span><span class="fu">crs</span>()</span>
<span id="cb111-31"><a href="forest-stand-summary.html#cb111-31" tabindex="-1"></a>  <span class="fu">return</span>(rasterized_data)</span>
<span id="cb111-32"><a href="forest-stand-summary.html#cb111-32" tabindex="-1"></a>}</span>
<span id="cb111-33"><a href="forest-stand-summary.html#cb111-33" tabindex="-1"></a><span class="co"># vect_to_rast_fn(</span></span>
<span id="cb111-34"><a href="forest-stand-summary.html#cb111-34" tabindex="-1"></a><span class="co">#   treetops_sf %&gt;% dplyr::filter(unit_id==treetops_sf$unit_id[2])</span></span>
<span id="cb111-35"><a href="forest-stand-summary.html#cb111-35" tabindex="-1"></a><span class="co">#   , des_res = 10</span></span>
<span id="cb111-36"><a href="forest-stand-summary.html#cb111-36" tabindex="-1"></a><span class="co">#   , field = &quot;dbh_cm&quot;</span></span>
<span id="cb111-37"><a href="forest-stand-summary.html#cb111-37" tabindex="-1"></a><span class="co">#   , fun = &quot;mean&quot; #function(x){mean(x, na.rm=T)}</span></span>
<span id="cb111-38"><a href="forest-stand-summary.html#cb111-38" tabindex="-1"></a><span class="co">#   , zero_na = F</span></span>
<span id="cb111-39"><a href="forest-stand-summary.html#cb111-39" tabindex="-1"></a><span class="co"># ) %&gt;%</span></span>
<span id="cb111-40"><a href="forest-stand-summary.html#cb111-40" tabindex="-1"></a><span class="co"># # terra::plot()</span></span>
<span id="cb111-41"><a href="forest-stand-summary.html#cb111-41" tabindex="-1"></a><span class="co"># terra::summary()</span></span></code></pre></div>
<p>we can combine our create a raster and plot it function</p>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb112-1"><a href="forest-stand-summary.html#cb112-1" tabindex="-1"></a><span class="co"># we can combine our create a raster and plot it function</span></span>
<span id="cb112-2"><a href="forest-stand-summary.html#cb112-2" tabindex="-1"></a>vect_to_rast_plot_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(</span>
<span id="cb112-3"><a href="forest-stand-summary.html#cb112-3" tabindex="-1"></a>  trees_vect</span>
<span id="cb112-4"><a href="forest-stand-summary.html#cb112-4" tabindex="-1"></a>  , stand_vect</span>
<span id="cb112-5"><a href="forest-stand-summary.html#cb112-5" tabindex="-1"></a>  , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span> <span class="co"># function(x){mean(x, na.rm=T)}</span></span>
<span id="cb112-6"><a href="forest-stand-summary.html#cb112-6" tabindex="-1"></a>  , <span class="at">field =</span> <span class="st">&quot;your_vector_attribute&quot;</span></span>
<span id="cb112-7"><a href="forest-stand-summary.html#cb112-7" tabindex="-1"></a>  , <span class="at">zero_na =</span> F </span>
<span id="cb112-8"><a href="forest-stand-summary.html#cb112-8" tabindex="-1"></a>  , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb112-9"><a href="forest-stand-summary.html#cb112-9" tabindex="-1"></a>  , <span class="at">des_res =</span> <span class="dv">10</span></span>
<span id="cb112-10"><a href="forest-stand-summary.html#cb112-10" tabindex="-1"></a>  , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb112-11"><a href="forest-stand-summary.html#cb112-11" tabindex="-1"></a>  , <span class="at">my_title =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-12"><a href="forest-stand-summary.html#cb112-12" tabindex="-1"></a>  , <span class="at">scale_name =</span> <span class="st">&quot;&quot;</span></span>
<span id="cb112-13"><a href="forest-stand-summary.html#cb112-13" tabindex="-1"></a>) {</span>
<span id="cb112-14"><a href="forest-stand-summary.html#cb112-14" tabindex="-1"></a>  <span class="co"># get the raster</span></span>
<span id="cb112-15"><a href="forest-stand-summary.html#cb112-15" tabindex="-1"></a>  rast <span class="ot">&lt;-</span> <span class="fu">vect_to_rast_fn</span>(</span>
<span id="cb112-16"><a href="forest-stand-summary.html#cb112-16" tabindex="-1"></a>    <span class="at">vect =</span> trees_vect</span>
<span id="cb112-17"><a href="forest-stand-summary.html#cb112-17" tabindex="-1"></a>    , <span class="at">des_res =</span> des_res</span>
<span id="cb112-18"><a href="forest-stand-summary.html#cb112-18" tabindex="-1"></a>    , <span class="at">buffer =</span> buffer</span>
<span id="cb112-19"><a href="forest-stand-summary.html#cb112-19" tabindex="-1"></a>    , <span class="at">fun =</span> fun</span>
<span id="cb112-20"><a href="forest-stand-summary.html#cb112-20" tabindex="-1"></a>    , <span class="at">field =</span> field</span>
<span id="cb112-21"><a href="forest-stand-summary.html#cb112-21" tabindex="-1"></a>    , <span class="at">zero_na =</span> zero_na</span>
<span id="cb112-22"><a href="forest-stand-summary.html#cb112-22" tabindex="-1"></a>  )</span>
<span id="cb112-23"><a href="forest-stand-summary.html#cb112-23" tabindex="-1"></a>  <span class="co"># plot it</span></span>
<span id="cb112-24"><a href="forest-stand-summary.html#cb112-24" tabindex="-1"></a>  <span class="fu">plot_raster_stand_fn</span>(</span>
<span id="cb112-25"><a href="forest-stand-summary.html#cb112-25" tabindex="-1"></a>      <span class="at">rast =</span> rast</span>
<span id="cb112-26"><a href="forest-stand-summary.html#cb112-26" tabindex="-1"></a>      , <span class="at">stand =</span> stand_vect</span>
<span id="cb112-27"><a href="forest-stand-summary.html#cb112-27" tabindex="-1"></a>      , <span class="at">buffer =</span> buffer</span>
<span id="cb112-28"><a href="forest-stand-summary.html#cb112-28" tabindex="-1"></a>      , <span class="at">des_res =</span> des_res</span>
<span id="cb112-29"><a href="forest-stand-summary.html#cb112-29" tabindex="-1"></a>      , <span class="at">stand_color =</span> stand_color</span>
<span id="cb112-30"><a href="forest-stand-summary.html#cb112-30" tabindex="-1"></a>      , <span class="at">my_title =</span> my_title</span>
<span id="cb112-31"><a href="forest-stand-summary.html#cb112-31" tabindex="-1"></a>      , <span class="at">scale_name =</span> scale_name</span>
<span id="cb112-32"><a href="forest-stand-summary.html#cb112-32" tabindex="-1"></a>  )</span>
<span id="cb112-33"><a href="forest-stand-summary.html#cb112-33" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mean-dbh" class="section level3 hasAnchor" number="3.3.3">
<h3><span class="header-section-number">3.3.3</span> Mean DBH<a href="forest-stand-summary.html#mean-dbh" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>take this for a spin to get a raster of mean DBH plotted with our stand boundary</p>
<div class="sourceCode" id="cb113"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb113-1"><a href="forest-stand-summary.html#cb113-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb113-2"><a href="forest-stand-summary.html#cb113-2" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb113-3"><a href="forest-stand-summary.html#cb113-3" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">max</span>(treetops_sf<span class="sc">$</span>dbh_cm,<span class="at">na.rm =</span> T), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb113-4"><a href="forest-stand-summary.html#cb113-4" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb113-5"><a href="forest-stand-summary.html#cb113-5" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb113-6"><a href="forest-stand-summary.html#cb113-6" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb113-7"><a href="forest-stand-summary.html#cb113-7" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="st">&quot;mean&quot;</span></span>
<span id="cb113-8"><a href="forest-stand-summary.html#cb113-8" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;dbh_cm&quot;</span></span>
<span id="cb113-9"><a href="forest-stand-summary.html#cb113-9" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb113-10"><a href="forest-stand-summary.html#cb113-10" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb113-11"><a href="forest-stand-summary.html#cb113-11" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">20</span></span>
<span id="cb113-12"><a href="forest-stand-summary.html#cb113-12" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb113-13"><a href="forest-stand-summary.html#cb113-13" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Arrangement of Mean DBH&quot;</span></span>
<span id="cb113-14"><a href="forest-stand-summary.html#cb113-14" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;DBH (cm)&quot;</span></span>
<span id="cb113-15"><a href="forest-stand-summary.html#cb113-15" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb113-16"><a href="forest-stand-summary.html#cb113-16" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb113-17"><a href="forest-stand-summary.html#cb113-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;mako&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb113-18"><a href="forest-stand-summary.html#cb113-18" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb114-1"><a href="forest-stand-summary.html#cb114-1" tabindex="-1"></a>p_temp</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-95-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-95-2.png" width="1008" /></p>
</div>
<div id="qmd" class="section level3 hasAnchor" number="3.3.4">
<h3><span class="header-section-number">3.3.4</span> QMD<a href="forest-stand-summary.html#qmd" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get the quadratic mean diameter (QMD) we are going to have to create a custom function that takes a list of DBH values and returns a single value</p>
<p>QMD is a measure of the diameter of the tree of mean basal area:</p>
<p><span class="math display">\[
\textrm{quadratic mean diameter (QMD)} = \sqrt{\frac{\sum{d_{i}^{2}}}{n}}
\]</span></p>
<p>, where <span class="math inline">\(d_{i}\)</span> is the diameter at breast height of an individual tree, and <span class="math inline">\(n\)</span> is the total number of trees.</p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="forest-stand-summary.html#cb117-1" tabindex="-1"></a>qmd_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb117-2"><a href="forest-stand-summary.html#cb117-2" tabindex="-1"></a>  <span class="fu">sqrt</span>(<span class="fu">sum</span>(x<span class="sc">^</span><span class="dv">2</span>, <span class="at">na.rm=</span>T)<span class="sc">/</span><span class="fu">length</span>(x[<span class="sc">!</span><span class="fu">is.na</span>(x)]))</span>
<span id="cb117-3"><a href="forest-stand-summary.html#cb117-3" tabindex="-1"></a>}</span>
<span id="cb117-4"><a href="forest-stand-summary.html#cb117-4" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb117-5"><a href="forest-stand-summary.html#cb117-5" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb117-6"><a href="forest-stand-summary.html#cb117-6" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">ul =</span> <span class="fu">round</span>(<span class="fu">qmd_fn</span>(<span class="fu">max</span>(treetops_sf<span class="sc">$</span>dbh_cm,<span class="at">na.rm =</span> T))<span class="sc">*</span>.<span class="dv">95</span>), <span class="at">ll =</span> <span class="dv">0</span>){</span>
<span id="cb117-7"><a href="forest-stand-summary.html#cb117-7" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb117-8"><a href="forest-stand-summary.html#cb117-8" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb117-9"><a href="forest-stand-summary.html#cb117-9" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb117-10"><a href="forest-stand-summary.html#cb117-10" tabindex="-1"></a>      , <span class="at">fun =</span> qmd_fn</span>
<span id="cb117-11"><a href="forest-stand-summary.html#cb117-11" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;dbh_cm&quot;</span></span>
<span id="cb117-12"><a href="forest-stand-summary.html#cb117-12" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb117-13"><a href="forest-stand-summary.html#cb117-13" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb117-14"><a href="forest-stand-summary.html#cb117-14" tabindex="-1"></a>      , <span class="at">des_res =</span> <span class="dv">20</span></span>
<span id="cb117-15"><a href="forest-stand-summary.html#cb117-15" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb117-16"><a href="forest-stand-summary.html#cb117-16" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Arrangement of Quadratic Mean Diameter&quot;</span></span>
<span id="cb117-17"><a href="forest-stand-summary.html#cb117-17" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;QMD (cm)&quot;</span></span>
<span id="cb117-18"><a href="forest-stand-summary.html#cb117-18" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb117-19"><a href="forest-stand-summary.html#cb117-19" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb117-20"><a href="forest-stand-summary.html#cb117-20" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">scale_fill_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;cividis&quot;</span>, <span class="at">begin =</span> <span class="fl">0.55</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb117-21"><a href="forest-stand-summary.html#cb117-21" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="forest-stand-summary.html#cb118-1" tabindex="-1"></a>p_temp</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-98-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-98-2.png" width="1008" /></p>
</div>
<div id="basal-area" class="section level3 hasAnchor" number="3.3.5">
<h3><span class="header-section-number">3.3.5</span> Basal Area<a href="forest-stand-summary.html#basal-area" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get Basal Area (BA) in square meters per hectare we will also need to create a function that uses the area of the raster cell</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="forest-stand-summary.html#cb121-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb121-2"><a href="forest-stand-summary.html#cb121-2" tabindex="-1"></a><span class="co"># max(silv_metrics$basal_area_m2_per_ha)*2</span></span>
<span id="cb121-3"><a href="forest-stand-summary.html#cb121-3" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb121-4"><a href="forest-stand-summary.html#cb121-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">my_res =</span> <span class="dv">20</span>, <span class="at">ul =</span> <span class="cn">NA</span>, <span class="at">ll =</span> <span class="cn">NA</span>){</span>
<span id="cb121-5"><a href="forest-stand-summary.html#cb121-5" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb121-6"><a href="forest-stand-summary.html#cb121-6" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb121-7"><a href="forest-stand-summary.html#cb121-7" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb121-8"><a href="forest-stand-summary.html#cb121-8" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">sum</span>(x, <span class="at">na.rm=</span>T)<span class="sc">/</span>((my_res<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">10000</span>)}</span>
<span id="cb121-9"><a href="forest-stand-summary.html#cb121-9" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;basal_area_m2&quot;</span></span>
<span id="cb121-10"><a href="forest-stand-summary.html#cb121-10" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb121-11"><a href="forest-stand-summary.html#cb121-11" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb121-12"><a href="forest-stand-summary.html#cb121-12" tabindex="-1"></a>      , <span class="at">des_res =</span> my_res</span>
<span id="cb121-13"><a href="forest-stand-summary.html#cb121-13" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb121-14"><a href="forest-stand-summary.html#cb121-14" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Arrangement of Basal Area&quot;</span></span>
<span id="cb121-15"><a href="forest-stand-summary.html#cb121-15" tabindex="-1"></a>      , <span class="at">scale_name =</span> latex2exp<span class="sc">::</span><span class="fu">TeX</span>(<span class="st">&quot;BA ($m ^ 2 </span><span class="sc">\\</span><span class="st">cdot ha^{-1}$)&quot;</span>)</span>
<span id="cb121-16"><a href="forest-stand-summary.html#cb121-16" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb121-17"><a href="forest-stand-summary.html#cb121-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb121-18"><a href="forest-stand-summary.html#cb121-18" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp</span>(<span class="at">option =</span> <span class="st">&quot;slytherin&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb121-19"><a href="forest-stand-summary.html#cb121-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="forest-stand-summary.html#cb122-1" tabindex="-1"></a>p_temp</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-101-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-101-2.png" width="1008" /></p>
</div>
<div id="tph" class="section level3 hasAnchor" number="3.3.6">
<h3><span class="header-section-number">3.3.6</span> TPH<a href="forest-stand-summary.html#tph" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to get trees per hectare (TPH) we will also need to create a function that uses the area of the raster cell</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="forest-stand-summary.html#cb125-1" tabindex="-1"></a><span class="co"># get the plot for each stand</span></span>
<span id="cb125-2"><a href="forest-stand-summary.html#cb125-2" tabindex="-1"></a><span class="co"># max(silv_metrics$basal_area_m2_per_ha)*2</span></span>
<span id="cb125-3"><a href="forest-stand-summary.html#cb125-3" tabindex="-1"></a>p_temp <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(stand_sf) <span class="sc">%&gt;%</span> </span>
<span id="cb125-4"><a href="forest-stand-summary.html#cb125-4" tabindex="-1"></a>  purrr<span class="sc">::</span><span class="fu">map</span>(<span class="cf">function</span>(x, <span class="at">my_res =</span> <span class="dv">20</span>, <span class="at">ul =</span> <span class="dv">2333</span>, <span class="at">ll =</span> <span class="cn">NA</span>){</span>
<span id="cb125-5"><a href="forest-stand-summary.html#cb125-5" tabindex="-1"></a>    <span class="fu">vect_to_rast_plot_fn</span>(</span>
<span id="cb125-6"><a href="forest-stand-summary.html#cb125-6" tabindex="-1"></a>      <span class="at">trees_vect =</span> treetops_sf <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(unit_id <span class="sc">==</span> stand_sf[x,]<span class="sc">$</span>unit_id)</span>
<span id="cb125-7"><a href="forest-stand-summary.html#cb125-7" tabindex="-1"></a>      , <span class="at">stand_vect =</span> stand_sf[x,]</span>
<span id="cb125-8"><a href="forest-stand-summary.html#cb125-8" tabindex="-1"></a>      , <span class="at">fun =</span> <span class="cf">function</span>(x){<span class="fu">length</span>(x)<span class="sc">/</span>((my_res<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span><span class="dv">10000</span>)}</span>
<span id="cb125-9"><a href="forest-stand-summary.html#cb125-9" tabindex="-1"></a>      , <span class="at">field =</span> <span class="st">&quot;tree_height_m&quot;</span> <span class="co"># just need something to count </span></span>
<span id="cb125-10"><a href="forest-stand-summary.html#cb125-10" tabindex="-1"></a>      , <span class="at">zero_na =</span> F </span>
<span id="cb125-11"><a href="forest-stand-summary.html#cb125-11" tabindex="-1"></a>      , <span class="at">buffer =</span> <span class="dv">5</span></span>
<span id="cb125-12"><a href="forest-stand-summary.html#cb125-12" tabindex="-1"></a>      , <span class="at">des_res =</span> my_res</span>
<span id="cb125-13"><a href="forest-stand-summary.html#cb125-13" tabindex="-1"></a>      , <span class="at">stand_color =</span> <span class="st">&quot;black&quot;</span></span>
<span id="cb125-14"><a href="forest-stand-summary.html#cb125-14" tabindex="-1"></a>      , <span class="at">my_title =</span> <span class="st">&quot;Arrangement of Trees per Hectare&quot;</span></span>
<span id="cb125-15"><a href="forest-stand-summary.html#cb125-15" tabindex="-1"></a>      , <span class="at">scale_name =</span> <span class="st">&quot;TPH&quot;</span></span>
<span id="cb125-16"><a href="forest-stand-summary.html#cb125-16" tabindex="-1"></a>    ) <span class="sc">+</span></span>
<span id="cb125-17"><a href="forest-stand-summary.html#cb125-17" tabindex="-1"></a>    ggplot2<span class="sc">::</span><span class="fu">labs</span>(<span class="at">subtitle =</span> <span class="fu">paste</span>(<span class="st">&quot;Unit:&quot;</span>,stand_sf[x,]<span class="sc">$</span>unit_name)) <span class="sc">+</span></span>
<span id="cb125-18"><a href="forest-stand-summary.html#cb125-18" tabindex="-1"></a>    harrypotter<span class="sc">::</span><span class="fu">scale_fill_hp</span>(<span class="at">option =</span> <span class="st">&quot;mischief&quot;</span>, <span class="at">limits =</span> <span class="fu">c</span>(ll,ul))</span>
<span id="cb125-19"><a href="forest-stand-summary.html#cb125-19" tabindex="-1"></a>  })</span></code></pre></div>
<p>check out our plots</p>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="forest-stand-summary.html#cb126-1" tabindex="-1"></a>p_temp</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-104-1.png" width="1008" /></p>
<pre><code>## 
## [[2]]</code></pre>
<p><img src="lidar_phys_fire_mods_files/figure-html/unnamed-chunk-104-2.png" width="1008" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="processing.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="validate-tree-detection-and-crown-delineation.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": null,
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection"
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
